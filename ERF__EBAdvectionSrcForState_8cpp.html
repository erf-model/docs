<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ERF: Source/EB/ERF_EBAdvectionSrcForState.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ERF
   </div>
   <div id="projectbrief">Energy Research and Forecasting: An Atmospheric Modeling Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ERF__EBAdvectionSrcForState_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ERF_EBAdvectionSrcForState.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="ERF__EBAdvection_8H_source.html">ERF_EBAdvection.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="ERF__EBAdvectionSrcForScalars_8H_source.html">ERF_EBAdvectionSrcForScalars.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="ERF__IndexDefines_8H_source.html">ERF_IndexDefines.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="ERF__TerrainMetrics_8H_source.html">ERF_TerrainMetrics.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="ERF__Advection_8H_source.html">ERF_Advection.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="ERF__AdvectionSrcForScalars_8H_source.html">ERF_AdvectionSrcForScalars.H</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ERF_EBAdvectionSrcForState.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="ERF__EBAdvectionSrcForState_8cpp__incl.png" border="0" usemap="#aSource_2EB_2ERF__EBAdvectionSrcForState_8cpp" alt=""/></div>
<map name="aSource_2EB_2ERF__EBAdvectionSrcForState_8cpp" id="aSource_2EB_2ERF__EBAdvectionSrcForState_8cpp">
<area shape="rect" title=" " alt="" coords="1368,5,1574,47"/>
<area shape="rect" href="ERF__EBAdvection_8H.html" title=" " alt="" coords="376,95,526,121"/>
<area shape="rect" href="ERF__IndexDefines_8H.html" title=" " alt="" coords="1614,468,1768,495"/>
<area shape="rect" href="ERF__TerrainMetrics_8H.html" title=" " alt="" coords="739,319,899,345"/>
<area shape="rect" href="ERF__EBAdvectionSrcForScalars_8H.html" title=" " alt="" coords="2736,95,2974,121"/>
<area shape="rect" href="ERF__Advection_8H.html" title=" " alt="" coords="780,95,914,121"/>
<area shape="rect" href="ERF__AdvectionSrcForScalars_8H.html" title=" " alt="" coords="1937,95,2157,121"/>
<area shape="rect" title=" " alt="" coords="31,543,114,569"/>
<area shape="rect" title=" " alt="" coords="733,393,878,420"/>
<area shape="rect" title=" " alt="" coords="169,169,301,196"/>
<area shape="rect" title=" " alt="" coords="326,169,512,196"/>
<area shape="rect" href="ERF__DataStruct_8H.html" title=" " alt="" coords="2324,319,2461,345"/>
<area shape="rect" href="ERF__SurfaceLayer_8H.html" title=" " alt="" coords="967,169,1119,196"/>
<area shape="rect" title=" " alt="" coords="2704,468,2763,495"/>
<area shape="rect" title=" " alt="" coords="2787,468,2867,495"/>
<area shape="rect" title=" " alt="" coords="2200,468,2358,495"/>
<area shape="rect" title=" " alt="" coords="2560,468,2680,495"/>
<area shape="rect" title=" " alt="" coords="2420,468,2536,495"/>
<area shape="rect" title=" " alt="" coords="944,468,1097,495"/>
<area shape="rect" href="ERF__Constants_8H.html" title=" " alt="" coords="1456,468,1590,495"/>
<area shape="rect" href="ERF__AdvStruct_8H.html" title=" " alt="" coords="2330,393,2460,420"/>
<area shape="rect" href="ERF__DiffStruct_8H.html" title=" " alt="" coords="2536,393,2665,420"/>
<area shape="rect" href="ERF__SpongeStruct_8H.html" title=" " alt="" coords="2690,393,2844,420"/>
<area shape="rect" href="ERF__TurbStruct_8H.html" title=" " alt="" coords="3020,393,3154,420"/>
<area shape="rect" href="ERF__TurbPertStruct_8H.html" title=" " alt="" coords="1842,393,2001,420"/>
<area shape="rect" title=" " alt="" coords="1462,543,1584,569"/>
<area shape="rect" title=" " alt="" coords="1627,543,1755,569"/>
<area shape="rect" href="ERF__MYNNStruct_8H.html" title=" " alt="" coords="3014,468,3160,495"/>
<area shape="rect" title=" " alt="" coords="1264,468,1432,495"/>
<area shape="rect" href="ERF__TileNoZ_8H.html" title=" " alt="" coords="1121,468,1240,495"/>
<area shape="rect" title=" " alt="" coords="1890,468,1954,495"/>
<area shape="rect" title=" " alt="" coords="974,319,1130,345"/>
<area shape="rect" title=" " alt="" coords="1408,319,1558,345"/>
<area shape="rect" title=" " alt="" coords="790,244,955,271"/>
<area shape="rect" href="ERF__MOSTAverage_8H.html" title=" " alt="" coords="1308,244,1466,271"/>
<area shape="rect" href="ERF__MOSTStress_8H.html" title=" " alt="" coords="1316,393,1463,420"/>
<area shape="rect" href="ERF__PBLHeight_8H.html" title=" " alt="" coords="1056,393,1190,420"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html" title=" " alt="" coords="136,393,318,420"/>
<area shape="rect" href="ERF__Interpolation_8H.html" title=" " alt="" coords="2382,169,2533,196"/>
<area shape="rect" title=" " alt="" coords="3229,169,3302,196"/>
<area shape="rect" title=" " alt="" coords="3327,169,3458,196"/>
<area shape="rect" href="ERF__Interpolation__UPW_8H.html" title=" " alt="" coords="2430,244,2618,271"/>
<area shape="rect" href="ERF__Interpolation__WENO_8H.html" title=" " alt="" coords="2642,244,2841,271"/>
<area shape="rect" href="ERF__Interpolation__WENO__Z_8H.html" title=" " alt="" coords="2140,244,2354,271"/>
<area shape="rect" href="ERF__EB_8H.html" title=" " alt="" coords="411,319,496,345"/>
<area shape="rect" title=" " alt="" coords="385,468,608,495"/>
<area shape="rect" title=" " alt="" coords="772,468,920,495"/>
<area shape="rect" title=" " alt="" coords="632,468,747,495"/>
<area shape="rect" title=" " alt="" coords="186,468,361,495"/>
<area shape="rect" href="ERF__EBAux_8H.html" title=" " alt="" coords="445,393,556,420"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a40428d543625a69a03e41eb19e52758c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ERF__EBAdvectionSrcForState_8cpp.html#a40428d543625a69a03e41eb19e52758c">EBAdvectionSrcForRho</a> (const Box &amp;bx, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;rho_u, const Array4&lt; const Real &gt; &amp;rho_v, const Array4&lt; const Real &gt; &amp;Omega, const Array4&lt; Real &gt; &amp;avg_xmom, const Array4&lt; Real &gt; &amp;avg_ymom, const Array4&lt; Real &gt; &amp;avg_zmom, const Array4&lt; const int &gt; &amp;mask_arr, const Array4&lt; const EBCellFlag &gt; &amp;cfg_arr, const Array4&lt; const Real &gt; &amp;ax_arr, const Array4&lt; const Real &gt; &amp;ay_arr, const Array4&lt; const Real &gt; &amp;az_arr, const Array4&lt; const Real &gt; &amp;fcx_arr, const Array4&lt; const Real &gt; &amp;fcy_arr, const Array4&lt; const Real &gt; &amp;fcz_arr, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_mx, const Array4&lt; const Real &gt; &amp;mf_my, const Array4&lt; const Real &gt; &amp;mf_uy, const Array4&lt; const Real &gt; &amp;mf_vx, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const bool fixed_rho, bool already_on_centroids)</td></tr>
<tr class="separator:a40428d543625a69a03e41eb19e52758c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a244aa0250aa8b00b72cdef06c88b1137"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ERF__EBAdvectionSrcForState_8cpp.html#a244aa0250aa8b00b72cdef06c88b1137">EBAdvectionSrcForScalars</a> (const Box &amp;bx, const int icomp, const int ncomp, const Array4&lt; const Real &gt; &amp;avg_xmom, const Array4&lt; const Real &gt; &amp;avg_ymom, const Array4&lt; const Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const int &gt; &amp;mask_arr, const Array4&lt; const EBCellFlag &gt; &amp;cfg_arr, const Array4&lt; const Real &gt; &amp;ax_arr, const Array4&lt; const Real &gt; &amp;ay_arr, const Array4&lt; const Real &gt; &amp;az_arr, const Array4&lt; const Real &gt; &amp;fcx_arr, const Array4&lt; const Real &gt; &amp;fcy_arr, const Array4&lt; const Real &gt; &amp;fcz_arr, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_mx, const Array4&lt; const Real &gt; &amp;mf_my, const <a class="el" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a> horiz_adv_type, const <a class="el" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a> vert_adv_type, const Real horiz_upw_frac, const Real vert_upw_frac, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const Box &amp;domain, const BCRec *bc_ptr_h, bool already_on_centroids)</td></tr>
<tr class="separator:a244aa0250aa8b00b72cdef06c88b1137"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a40428d543625a69a03e41eb19e52758c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40428d543625a69a03e41eb19e52758c">&#9670;&nbsp;</a></span>EBAdvectionSrcForRho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EBAdvectionSrcForRho </td>
          <td>(</td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>bx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>advectionSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>rho_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>rho_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>Omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_xmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_ymom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_zmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const int &gt; &amp;&#160;</td>
          <td class="paramname"><em>mask_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const EBCellFlag &gt; &amp;&#160;</td>
          <td class="paramname"><em>cfg_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>ax_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>ay_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>az_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>fcx_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>fcy_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>fcz_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>detJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>cellSizeInv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_mx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_my</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_uy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_vx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>flx_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>fixed_rho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>already_on_centroids</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for computing the advective tendency for the update equations for rho and (rho theta) This routine has explicit expressions for all cases (terrain or not) when the horizontal and vertical spatial orders are &lt;= 2, and calls more specialized functions when either (or both) spatial order(s) is greater than 2.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bx</td><td>box over which the scalars are updated </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">advectionSrc</td><td>tendency for the scalar update equation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_u</td><td>x-component of momentum </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_v</td><td>y-component of momentum </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Omega</td><td>component of momentum normal to the z-coordinate surface </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_xmom</td><td>x-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_ymom</td><td>y-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_zmom</td><td>z-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detJ</td><td>Jacobian of the metric transformation (= 1 if use_terrain is false) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cellSizeInv</td><td>inverse of the mesh spacing </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_m</td><td>map factor at cell centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_u</td><td>map factor at x-faces </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_v</td><td>map factor at y-faces </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    BL_PROFILE_VAR(<span class="stringliteral">&quot;EBAdvectionSrcForRho&quot;</span>, <a class="code" href="ERF__EBAdvectionSrcForState_8cpp.html#a40428d543625a69a03e41eb19e52758c">EBAdvectionSrcForRho</a>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">auto</span> dxInv = cellSizeInv[0], dyInv = cellSizeInv[1], dzInv = cellSizeInv[2];</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">const</span> Box <a class="code" href="ERF__DiffSetup_8H.html#a853a144267414a8a59c87f80ca5c958c">xbx</a> = surroundingNodes(bx,0).grow(IntVect(0, 1, 1));</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keyword">const</span> Box <a class="code" href="ERF__DiffSetup_8H.html#ae3d636c41f5271630a5816a4b8b668b2">ybx</a> = surroundingNodes(bx,1).grow(IntVect(1, 0, 1));</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">const</span> Box <a class="code" href="ERF__DiffSetup_8H.html#a4c74ed1b76138a2f5baa925afe40f9a8">zbx</a> = surroundingNodes(bx,2).grow(IntVect(1, 1, 0));</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    ParallelFor(<a class="code" href="ERF__DiffSetup_8H.html#a853a144267414a8a59c87f80ca5c958c">xbx</a>, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        flx_arr[0](i,j,k,0) = rho_u(i,j,k) / mf_uy(i,j,0);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        avg_xmom(i,j,k) = flx_arr[0](i,j,k,0);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    });</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    ParallelFor(<a class="code" href="ERF__DiffSetup_8H.html#ae3d636c41f5271630a5816a4b8b668b2">ybx</a>, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        flx_arr[1](i,j,k,0) = rho_v(i,j,k) / mf_vx(i,j,0);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        avg_ymom(i,j,k) = flx_arr[1](i,j,k,0);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    });</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    ParallelFor(<a class="code" href="ERF__DiffSetup_8H.html#a4c74ed1b76138a2f5baa925afe40f9a8">zbx</a>, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        Real mfsq = mf_mx(i,j,0) * mf_my(i,j,0);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        flx_arr[2](i,j,k,0) = Omega(i,j,k) / mfsq;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        avg_zmom(i,j,k) = flx_arr[2](i,j,k,0);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    });</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> (fixed_rho) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            advectionSrc(i,j,k,0) = 0.0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        });</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span> (already_on_centroids) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keywordflow">if</span> (detJ(i,j,k) &gt; 0.) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    Real mfsq = mf_mx(i,j,0) * mf_my(i,j,0);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    advectionSrc(i,j,k,0) = - mfsq / detJ(i,j,k) * (</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                                            ( ax_arr(i+1,j,k) * flx_arr[0](i+1,j,k,0) - ax_arr(i,j,k) * flx_arr[0](i,j,k,0) ) * dxInv +</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                                            ( ay_arr(i,j+1,k) * flx_arr[1](i,j+1,k,0) - ay_arr(i,j,k) * flx_arr[1](i,j,k,0) ) * dyInv +</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                            ( az_arr(i,j,k+1) * flx_arr[2](i,j,k+1,0) - az_arr(i,j,k) * flx_arr[2](i,j,k,0) ) * dzInv );</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    advectionSrc(i,j,k,0) = 0.;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            });</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">if</span> (detJ(i,j,k) &gt; 0.) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    Real mfsq = mf_mx(i,j,0) * mf_my(i,j,0);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    <span class="keywordflow">if</span> (cfg_arr(i,j,k).isCovered())</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        advectionSrc(i,j,k,0) = 0.;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg_arr(i,j,k).isRegular())</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        advectionSrc(i,j,k,0) = - mfsq / detJ(i,j,k) * (</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                                ( ax_arr(i+1,j,k) * flx_arr[0](i+1,j,k,0) - ax_arr(i,j,k) * flx_arr[0](i,j,k,0) ) * dxInv +</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                                ( ay_arr(i,j+1,k) * flx_arr[1](i,j+1,k,0) - ay_arr(i,j,k) * flx_arr[1](i,j,k,0) ) * dyInv +</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                                ( az_arr(i,j,k+1) * flx_arr[2](i,j,k+1,0) - az_arr(i,j,k) * flx_arr[2](i,j,k,0) ) * dzInv );</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <span class="comment">// Bilinear interpolation</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    Real fxm = flx_arr[0](i,j,k,0);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    <span class="keywordflow">if</span> (ax_arr(i,j,k) != Real(0.0) &amp;&amp; ax_arr(i,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0), fcx_arr(i,j,k,0)));</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0), fcx_arr(i,j,k,1)));</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                        Real fracy = (mask_arr(i-1,jj,k) || mask_arr(i,jj,k)) ? std::abs(fcx_arr(i,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                        Real fracz = (mask_arr(i-1,j,kk) || mask_arr(i,j,kk)) ? std::abs(fcx_arr(i,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                        fxm = (Real(1.0)-fracy)*(Real(1.0)-fracz)*fxm</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                            +      fracy *(Real(1.0)-fracz)*flx_arr[0](i,jj,k ,0)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                            +      fracz *(Real(1.0)-fracy)*flx_arr[0](i,j ,kk,0)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                            +      fracy *     fracz *flx_arr[0](i,jj,kk,0);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                    Real fxp = flx_arr[0](i+1,j,k,0);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    <span class="keywordflow">if</span> (ax_arr(i+1,j,k) != Real(0.0) &amp;&amp; ax_arr(i+1,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcx_arr(i+1,j,k,0)));</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcx_arr(i+1,j,k,1)));</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        Real fracy = (mask_arr(i,jj,k) || mask_arr(i+1,jj,k)) ? std::abs(fcx_arr(i+1,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        Real fracz = (mask_arr(i,j,kk) || mask_arr(i+1,j,kk)) ? std::abs(fcx_arr(i+1,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                        fxp = (Real(1.0)-fracy)*(Real(1.0)-fracz)*fxp</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                            +      fracy *(Real(1.0)-fracz)*flx_arr[0](i+1,jj,k ,0)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                            +      fracz *(Real(1.0)-fracy)*flx_arr[0](i+1,j ,kk,0)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                            +      fracy *     fracz *flx_arr[0](i+1,jj,kk,0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    Real fym = flx_arr[1](i,j,k,0);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                    <span class="keywordflow">if</span> (ay_arr(i,j,k) != Real(0.0) &amp;&amp; ay_arr(i,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j,k,0)));</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j,k,1)));</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                        Real fracx = (mask_arr(ii,j-1,k) || mask_arr(ii,j,k)) ? std::abs(fcy_arr(i,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        Real fracz = (mask_arr(i,j-1,kk) || mask_arr(i,j,kk)) ? std::abs(fcy_arr(i,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        fym = (Real(1.0)-fracx)*(Real(1.0)-fracz)*fym</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                            +      fracx *(Real(1.0)-fracz)*flx_arr[1](ii,j,k ,0)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                            +      fracz *(Real(1.0)-fracx)*flx_arr[1](i ,j,kk,0)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                            +      fracx *     fracz *flx_arr[1](ii,j,kk,0);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    Real fyp = flx_arr[1](i,j+1,k,0);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    <span class="keywordflow">if</span> (ay_arr(i,j+1,k) != Real(0.0) &amp;&amp; ay_arr(i,j+1,k) != Real(1.0)) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j+1,k,0)));</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j+1,k,1)));</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                        Real fracx = (mask_arr(ii,j,k) || mask_arr(ii,j+1,k)) ? std::abs(fcy_arr(i,j+1,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        Real fracz = (mask_arr(i,j,kk) || mask_arr(i,j+1,kk)) ? std::abs(fcy_arr(i,j+1,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                        fyp = (Real(1.0)-fracx)*(Real(1.0)-fracz)*fyp</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                            +      fracx *(Real(1.0)-fracz)*flx_arr[1](ii,j+1,k ,0)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                            +      fracz *(Real(1.0)-fracx)*flx_arr[1](i ,j+1,kk,0)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                            +      fracx *     fracz *flx_arr[1](ii,j+1,kk,0);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    Real fzm = flx_arr[2](i,j,k,0);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    <span class="keywordflow">if</span> (az_arr(i,j,k) != Real(0.0) &amp;&amp; az_arr(i,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k,0)));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k,1)));</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                        Real fracx = (mask_arr(ii,j,k-1) || mask_arr(ii,j,k)) ? std::abs(fcz_arr(i,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                        Real fracy = (mask_arr(i,jj,k-1) || mask_arr(i,jj,k)) ? std::abs(fcz_arr(i,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        fzm = (Real(1.0)-fracx)*(Real(1.0)-fracy)*fzm</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                            +      fracx *(Real(1.0)-fracy)*flx_arr[2](ii,j ,k,0)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                            +      fracy *(Real(1.0)-fracx)*flx_arr[2](i ,jj,k,0)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                            +      fracx *     fracy *flx_arr[2](ii,jj,k,0);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                    }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                    Real fzp = flx_arr[2](i,j,k+1,0);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    <span class="keywordflow">if</span> (az_arr(i,j,k+1) != Real(0.0) &amp;&amp; az_arr(i,j,k+1) != Real(1.0)) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k+1,0)));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k+1,1)));</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                        Real fracx = (mask_arr(ii,j,k) || mask_arr(ii,j,k+1)) ? std::abs(fcz_arr(i,j,k+1,0)) : Real(0.0);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                        Real fracy = (mask_arr(i,jj,k) || mask_arr(i,jj,k+1)) ? std::abs(fcz_arr(i,j,k+1,1)) : Real(0.0);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                        fzp = (Real(1.0)-fracx)*(Real(1.0)-fracy)*fzp</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                            +      fracx *(Real(1.0)-fracy)*flx_arr[2](ii,j ,k+1,0)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                            +      fracy *(Real(1.0)-fracx)*flx_arr[2](i ,jj,k+1,0)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                            +      fracx *     fracy *flx_arr[2](ii,jj,k+1,0);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    advectionSrc(i,j,k,0) = -  mfsq / detJ(i,j,k) * (</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                ( ax_arr(i+1,j,k) * fxp - ax_arr(i,j,k) * fxm ) * dxInv +</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                                ( ay_arr(i,j+1,k) * fyp - ay_arr(i,j,k) * fym ) * dyInv +</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                ( az_arr(i,j,k+1) * fzp - az_arr(i,j,k) * fzm ) * dzInv );</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    advectionSrc(i,j,k,0) = 0.;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            });</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        } <span class="comment">// already_on_centroids</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    } <span class="comment">// fixed_rho</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="ttc" id="aERF__DiffSetup_8H_html_a4c74ed1b76138a2f5baa925afe40f9a8"><div class="ttname"><a href="ERF__DiffSetup_8H.html#a4c74ed1b76138a2f5baa925afe40f9a8">zbx</a></div><div class="ttdeci">const Box zbx</div><div class="ttdef"><b>Definition:</b> ERF_DiffSetup.H:23</div></div>
<div class="ttc" id="aERF__DiffSetup_8H_html_a853a144267414a8a59c87f80ca5c958c"><div class="ttname"><a href="ERF__DiffSetup_8H.html#a853a144267414a8a59c87f80ca5c958c">xbx</a></div><div class="ttdeci">const Box xbx</div><div class="ttdef"><b>Definition:</b> ERF_DiffSetup.H:21</div></div>
<div class="ttc" id="aERF__DiffSetup_8H_html_ae3d636c41f5271630a5816a4b8b668b2"><div class="ttname"><a href="ERF__DiffSetup_8H.html#ae3d636c41f5271630a5816a4b8b668b2">ybx</a></div><div class="ttdeci">const Box ybx</div><div class="ttdef"><b>Definition:</b> ERF_DiffSetup.H:22</div></div>
<div class="ttc" id="aERF__EBAdvectionSrcForState_8cpp_html_a40428d543625a69a03e41eb19e52758c"><div class="ttname"><a href="ERF__EBAdvectionSrcForState_8cpp.html#a40428d543625a69a03e41eb19e52758c">EBAdvectionSrcForRho</a></div><div class="ttdeci">void EBAdvectionSrcForRho(const Box &amp;bx, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;rho_u, const Array4&lt; const Real &gt; &amp;rho_v, const Array4&lt; const Real &gt; &amp;Omega, const Array4&lt; Real &gt; &amp;avg_xmom, const Array4&lt; Real &gt; &amp;avg_ymom, const Array4&lt; Real &gt; &amp;avg_zmom, const Array4&lt; const int &gt; &amp;mask_arr, const Array4&lt; const EBCellFlag &gt; &amp;cfg_arr, const Array4&lt; const Real &gt; &amp;ax_arr, const Array4&lt; const Real &gt; &amp;ay_arr, const Array4&lt; const Real &gt; &amp;az_arr, const Array4&lt; const Real &gt; &amp;fcx_arr, const Array4&lt; const Real &gt; &amp;fcy_arr, const Array4&lt; const Real &gt; &amp;fcz_arr, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_mx, const Array4&lt; const Real &gt; &amp;mf_my, const Array4&lt; const Real &gt; &amp;mf_uy, const Array4&lt; const Real &gt; &amp;mf_vx, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const bool fixed_rho, bool already_on_centroids)</div><div class="ttdef"><b>Definition:</b> ERF_EBAdvectionSrcForState.cpp:32</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a244aa0250aa8b00b72cdef06c88b1137"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a244aa0250aa8b00b72cdef06c88b1137">&#9670;&nbsp;</a></span>EBAdvectionSrcForScalars()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EBAdvectionSrcForScalars </td>
          <td>(</td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>bx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>icomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>ncomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_xmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_ymom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_zmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_prim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>advectionSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const int &gt; &amp;&#160;</td>
          <td class="paramname"><em>mask_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const EBCellFlag &gt; &amp;&#160;</td>
          <td class="paramname"><em>cfg_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>ax_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>ay_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>az_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>fcx_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>fcy_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>fcz_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>detJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>cellSizeInv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_mx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_my</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a>&#160;</td>
          <td class="paramname"><em>horiz_adv_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a>&#160;</td>
          <td class="paramname"><em>vert_adv_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>horiz_upw_frac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>vert_upw_frac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>flx_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>domain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BCRec *&#160;</td>
          <td class="paramname"><em>bc_ptr_h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>already_on_centroids</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for computing the advective tendency for scalars when terrain_type is EB.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bx</td><td>box over which the scalars are updated if no external boundary conditions </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">icomp</td><td>component of first scalar to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ncomp</td><td>number of components to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_xmom</td><td>x-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_ymom</td><td>y-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_zmom</td><td>z-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell_prim</td><td>primitive form of scalar variables, here only potential temperature theta </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">advectionSrc</td><td>tendency for the scalar update equation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mask_arr</td><td>Cell-centered masks (=1 otherwise, =0 if physbnd) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg_arr</td><td>Cell-centered flags </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ax_arr</td><td>Area fraction of x-face </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ay_arr</td><td>Area fraction of y-face </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az_arr</td><td>Area fraction of z-face </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fcx_arr</td><td>Face centroid of x-face </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fcy_arr</td><td>Face centroid of y-face </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fcz_arr</td><td>Face centroid of z-face </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detJ</td><td>Jacobian of the metric transformation (= 1 if use_terrain is false) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cellSizeInv</td><td>inverse of the mesh spacing </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_mx</td><td>map factor at cell centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_my</td><td>map factor at cell centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">horiz_adv_type</td><td>advection scheme to be used in horiz. directions for dry scalars </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vert_adv_type</td><td>advection scheme to be used in vert. directions for dry scalars </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">horiz_upw_frac</td><td>upwinding fraction to be used in horiz. directions for dry scalars (for Blended schemes only) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vert_upw_frac</td><td>upwinding fraction to be used in vert. directions for dry scalars (for Blended schemes only) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;{</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    BL_PROFILE_VAR(<span class="stringliteral">&quot;EBAdvectionSrcForScalars&quot;</span>, <a class="code" href="ERF__EBAdvectionSrcForState_8cpp.html#a244aa0250aa8b00b72cdef06c88b1137">EBAdvectionSrcForScalars</a>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keyword">auto</span> dxInv = cellSizeInv[0], dyInv = cellSizeInv[1], dzInv = cellSizeInv[2];</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keyword">const</span> Box <a class="code" href="ERF__DiffSetup_8H.html#a853a144267414a8a59c87f80ca5c958c">xbx</a> = surroundingNodes(bx,0);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keyword">const</span> Box <a class="code" href="ERF__DiffSetup_8H.html#ae3d636c41f5271630a5816a4b8b668b2">ybx</a> = surroundingNodes(bx,1);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keyword">const</span> Box <a class="code" href="ERF__DiffSetup_8H.html#a4c74ed1b76138a2f5baa925afe40f9a8">zbx</a> = surroundingNodes(bx,2);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// Open bc will be imposed upon all vars (we only access cons here for simplicity)</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> xlo_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].lo(0) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> xhi_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].hi(0) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> ylo_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].lo(1) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> yhi_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].hi(1) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// Only advection operations in bndry normal direction with OPEN BC</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    Box  bx_xlo,  bx_xhi,  bx_ylo,  bx_yhi;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (xlo_open) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span> ( bx.smallEnd(0) == domain.smallEnd(0)) {  bx_xlo = makeSlab( bx,0,domain.smallEnd(0));}</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> (xhi_open) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">if</span> ( bx.bigEnd(0) == domain.bigEnd(0))     {  bx_xhi = makeSlab( bx,0,domain.bigEnd(0)  );}</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> (ylo_open) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span> ( bx.smallEnd(1) == domain.smallEnd(1)) {  bx_ylo = makeSlab( bx,1,domain.smallEnd(1));}</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (yhi_open) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">if</span> ( bx.bigEnd(1) == domain.bigEnd(1))     {  bx_yhi = makeSlab( bx,1,domain.bigEnd(1)  );}</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// Inline with 2nd order for efficiency</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// NOTE: For EB, avg_xmom, avg_ymom, avg_zmom were are weighted by area fractions in AdvectionSrcForRho</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">//       The flux is weighted by area fraction after its interpolation.</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">if</span> (horiz_adv_type == <a class="code" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a> &amp;&amp; vert_adv_type == <a class="code" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a>)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        ParallelFor(<a class="code" href="ERF__DiffSetup_8H.html#a853a144267414a8a59c87f80ca5c958c">xbx</a>, ncomp,[=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keyword">const</span> Real prim_on_face = 0.5 * (cell_prim(i,j,k,prim_index) + cell_prim(i-1,j,k,prim_index));</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            flx_arr[0](i,j,k,cons_index) = avg_xmom(i,j,k) * prim_on_face;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        });</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        ParallelFor(<a class="code" href="ERF__DiffSetup_8H.html#ae3d636c41f5271630a5816a4b8b668b2">ybx</a>, ncomp,[=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keyword">const</span> Real prim_on_face = 0.5 * (cell_prim(i,j,k,prim_index) + cell_prim(i,j-1,k,prim_index));</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            flx_arr[1](i,j,k,cons_index) = avg_ymom(i,j,k) * prim_on_face;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        });</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        ParallelFor(<a class="code" href="ERF__DiffSetup_8H.html#a4c74ed1b76138a2f5baa925afe40f9a8">zbx</a>, ncomp,[=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keyword">const</span> Real prim_on_face = 0.5 * (cell_prim(i,j,k,prim_index) + cell_prim(i,j,k-1,prim_index));</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            flx_arr[2](i,j,k,cons_index) = avg_zmom(i,j,k) * prim_on_face;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        });</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// Template higher order methods (horizontal first)</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">switch</span>(horiz_adv_type) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a>:</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            EBAdvectionSrcForScalarsVert&lt;CENTERED2&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                                avg_xmom, avg_ymom, avg_zmom, cfg_arr, ax_arr, ay_arr, az_arr,</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                                horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a40adf6565c1a31b2c72d8072412d0b9f">AdvType::Upwind_3rd</a>:</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            EBAdvectionSrcForScalarsVert&lt;UPWIND3&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                                avg_xmom, avg_ymom, avg_zmom, cfg_arr, ax_arr, ay_arr, az_arr,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                                horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a778e0ed47937713eb1c4bedef6b00161">AdvType::Centered_4th</a>:</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            EBAdvectionSrcForScalarsVert&lt;CENTERED4&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                                avg_xmom, avg_ymom, avg_zmom, cfg_arr, ax_arr, ay_arr, az_arr,</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                                horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a83aec89012c35752597047c6ebdd983a">AdvType::Upwind_5th</a>:</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            EBAdvectionSrcForScalarsVert&lt;UPWIND5&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                                avg_xmom, avg_ymom, avg_zmom, cfg_arr, ax_arr, ay_arr, az_arr,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                                horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a8c9475eb6bfde28e5bcb5230ac2e22a9">AdvType::Centered_6th</a>:</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            EBAdvectionSrcForScalarsVert&lt;CENTERED6&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                                avg_xmom, avg_ymom, avg_zmom, cfg_arr, ax_arr, ay_arr, az_arr,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                                horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            AMREX_ASSERT_WITH_MESSAGE(<span class="keyword">false</span>, <span class="stringliteral">&quot;Unknown advection scheme! WENO is currently not supported for EB.&quot;</span>);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// Compute divergence</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (already_on_centroids) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        ParallelFor(bx, ncomp, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">if</span> (detJ(i,j,k) &gt; 0.)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                Real invdetJ = 1.0 / detJ(i,j,k);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                Real mfsq    = mf_mx(i,j,0) * mf_my(i,j,0);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                advectionSrc(i,j,k,cons_index) = - invdetJ * mfsq * (</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                  ( ax_arr(i+1,j,k) * flx_arr[0](i+1,j,k,cons_index) - ax_arr(i,j,k) * flx_arr[0](i  ,j,k,cons_index) ) * dxInv +</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                  ( ay_arr(i,j+1,k) * flx_arr[1](i,j+1,k,cons_index) - ay_arr(i,j,k) * flx_arr[1](i,j  ,k,cons_index) ) * dyInv +</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                  ( az_arr(i,j,k+1) * flx_arr[2](i,j,k+1,cons_index) - az_arr(i,j,k) * flx_arr[2](i,j,k  ,cons_index) ) * dzInv );</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                advectionSrc(i,j,k,cons_index) = 0.;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        });</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        AMREX_HOST_DEVICE_FOR_4D(bx,ncomp,i,j,k,n,</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keywordflow">if</span> (detJ(i,j,k) &gt; 0.)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                Real invdetJ = 1.0 / detJ(i,j,k);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                Real mfsq    = mf_mx(i,j,0) * mf_my(i,j,0);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="keywordflow">if</span> (cfg_arr(i,j,k).isCovered())</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                    advectionSrc(i,j,k,cons_index) = Real(0.0);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg_arr(i,j,k).isRegular())</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                    advectionSrc(i,j,k,cons_index) = - invdetJ * mfsq * (</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                        ( ax_arr(i+1,j,k) * flx_arr[0](i+1,j,k,cons_index) - ax_arr(i,j,k) * flx_arr[0](i  ,j,k,cons_index) ) * dxInv +</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                        ( ay_arr(i,j+1,k) * flx_arr[1](i,j+1,k,cons_index) - ay_arr(i,j,k) * flx_arr[1](i,j  ,k,cons_index) ) * dyInv +</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                        ( az_arr(i,j,k+1) * flx_arr[2](i,j,k+1,cons_index) - az_arr(i,j,k) * flx_arr[2](i,j,k  ,cons_index) ) * dzInv );</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    <span class="comment">// Bilinear interpolation</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    Real fxm = flx_arr[0](i,j,k,cons_index);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                    <span class="keywordflow">if</span> (ax_arr(i,j,k) != Real(0.0) &amp;&amp; ax_arr(i,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0), fcx_arr(i,j,k,0)));</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0), fcx_arr(i,j,k,1)));</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                        Real fracy = (mask_arr(i-1,jj,k) || mask_arr(i,jj,k)) ? std::abs(fcx_arr(i,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                        Real fracz = (mask_arr(i-1,j,kk) || mask_arr(i,j,kk)) ? std::abs(fcx_arr(i,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                        fxm = (Real(1.0)-fracy)*(Real(1.0)-fracz)*fxm</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                            +      fracy *(Real(1.0)-fracz)*flx_arr[0](i,jj,k ,cons_index)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                            +      fracz *(Real(1.0)-fracy)*flx_arr[0](i,j ,kk,cons_index)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                            +      fracy *     fracz *flx_arr[0](i,jj,kk,cons_index);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    Real fxp = flx_arr[0](i+1,j,k,cons_index);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    <span class="keywordflow">if</span> (ax_arr(i+1,j,k) != Real(0.0) &amp;&amp; ax_arr(i+1,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcx_arr(i+1,j,k,0)));</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcx_arr(i+1,j,k,1)));</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        Real fracy = (mask_arr(i,jj,k) || mask_arr(i+1,jj,k)) ? std::abs(fcx_arr(i+1,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        Real fracz = (mask_arr(i,j,kk) || mask_arr(i+1,j,kk)) ? std::abs(fcx_arr(i+1,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        fxp = (Real(1.0)-fracy)*(Real(1.0)-fracz)*fxp</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                            +      fracy *(Real(1.0)-fracz)*flx_arr[0](i+1,jj,k ,cons_index)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                            +      fracz *(Real(1.0)-fracy)*flx_arr[0](i+1,j ,kk,cons_index)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                            +      fracy *     fracz *flx_arr[0](i+1,jj,kk,cons_index);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                    Real fym = flx_arr[1](i,j,k,cons_index);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                    <span class="keywordflow">if</span> (ay_arr(i,j,k) != Real(0.0) &amp;&amp; ay_arr(i,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j,k,0)));</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j,k,1)));</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                        Real fracx = (mask_arr(ii,j-1,k) || mask_arr(ii,j,k)) ? std::abs(fcy_arr(i,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                        Real fracz = (mask_arr(i,j-1,kk) || mask_arr(i,j,kk)) ? std::abs(fcy_arr(i,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        fym = (Real(1.0)-fracx)*(Real(1.0)-fracz)*fym</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                            +      fracx *(Real(1.0)-fracz)*flx_arr[1](ii,j,k ,cons_index)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                            +      fracz *(Real(1.0)-fracx)*flx_arr[1](i ,j,kk,cons_index)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                            +      fracx *     fracz *flx_arr[1](ii,j,kk,cons_index);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    Real fyp = flx_arr[1](i,j+1,k,cons_index);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    <span class="keywordflow">if</span> (ay_arr(i,j+1,k) != Real(0.0) &amp;&amp; ay_arr(i,j+1,k) != Real(1.0)) {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j+1,k,0)));</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                        <span class="keywordtype">int</span> kk = k + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcy_arr(i,j+1,k,1)));</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                        Real fracx = (mask_arr(ii,j,k) || mask_arr(ii,j+1,k)) ? std::abs(fcy_arr(i,j+1,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                        Real fracz = (mask_arr(i,j,kk) || mask_arr(i,j+1,kk)) ? std::abs(fcy_arr(i,j+1,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                        fyp = (Real(1.0)-fracx)*(Real(1.0)-fracz)*fyp</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                            +      fracx *(Real(1.0)-fracz)*flx_arr[1](ii,j+1,k ,cons_index)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                            +      fracz *(Real(1.0)-fracx)*flx_arr[1](i ,j+1,kk,cons_index)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                            +      fracx *     fracz *flx_arr[1](ii,j+1,kk,cons_index);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                    Real fzm = flx_arr[2](i,j,k,cons_index);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                    <span class="keywordflow">if</span> (az_arr(i,j,k) != Real(0.0) &amp;&amp; az_arr(i,j,k) != Real(1.0)) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k,0)));</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k,1)));</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                        Real fracx = (mask_arr(ii,j,k-1) || mask_arr(ii,j,k)) ? std::abs(fcz_arr(i,j,k,0)) : Real(0.0);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                        Real fracy = (mask_arr(i,jj,k-1) || mask_arr(i,jj,k)) ? std::abs(fcz_arr(i,j,k,1)) : Real(0.0);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                        fzm = (Real(1.0)-fracx)*(Real(1.0)-fracy)*fzm</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                            +      fracx *(Real(1.0)-fracy)*flx_arr[2](ii,j ,k,cons_index)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                            +      fracy *(Real(1.0)-fracx)*flx_arr[2](i ,jj,k,cons_index)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                            +      fracx *     fracy *flx_arr[2](ii,jj,k,cons_index);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                    }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    Real fzp = flx_arr[2](i,j,k+1,cons_index);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    <span class="keywordflow">if</span> (az_arr(i,j,k+1) != Real(0.0) &amp;&amp; az_arr(i,j,k+1) != Real(1.0)) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                        <span class="keywordtype">int</span> ii = i + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k+1,0)));</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                        <span class="keywordtype">int</span> jj = j + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::copysign(Real(1.0),fcz_arr(i,j,k+1,1)));</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                        Real fracx = (mask_arr(ii,j,k) || mask_arr(ii,j,k+1)) ? std::abs(fcz_arr(i,j,k+1,0)) : Real(0.0);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                        Real fracy = (mask_arr(i,jj,k) || mask_arr(i,jj,k+1)) ? std::abs(fcz_arr(i,j,k+1,1)) : Real(0.0);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                        fzp = (Real(1.0)-fracx)*(Real(1.0)-fracy)*fzp</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                            +      fracx *(Real(1.0)-fracy)*flx_arr[2](ii,j ,k+1,cons_index)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                            +      fracy *(Real(1.0)-fracx)*flx_arr[2](i ,jj,k+1,cons_index)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                            +      fracx *     fracy *flx_arr[2](ii,jj,k+1,cons_index);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    advectionSrc(i,j,k,cons_index) = - invdetJ * mfsq * (</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                          ( ax_arr(i+1,j,k) * fxp - ax_arr(i,j,k) * fxm ) * dxInv</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        + ( ay_arr(i,j+1,k) * fyp - ay_arr(i,j,k) * fym ) * dyInv</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        + ( az_arr(i,j,k+1) * fzp - az_arr(i,j,k) * fzm ) * dzInv );</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="comment">// eb_compute_divergence(i,j,k,n,advectionSrc,AMREX_D_DECL(flx_arr[0],flx_arr[1],flx_arr[2]),</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                <span class="comment">//                     mask_arr, cfg_arr, detJ, AMREX_D_DECL(ax_arr,ay_arr,az_arr),</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                <span class="comment">//                     AMREX_D_DECL(fcx_arr,fcy_arr,fcz_arr), cellSizeInv, already_on_centroids);</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                advectionSrc(i,j,k,cons_index) = 0.;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        });</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">// Special advection operator for open BC (bndry tangent operations)</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> (xlo_open) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordtype">bool</span> do_lo = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="ERF__Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_xlo, 0, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                           detJ, cellSizeInv, do_lo);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span> (xhi_open) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="ERF__Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_xhi, 0, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                           detJ, cellSizeInv);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (ylo_open) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordtype">bool</span> do_lo = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="ERF__Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_ylo, 1, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                           detJ, cellSizeInv, do_lo);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (yhi_open) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <a class="code" href="ERF__Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_yhi, 1, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                                           detJ, cellSizeInv);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="ttc" id="aERF__Advection_8H_html_abd84d0909db1f87c22b5a92aae03e919"><div class="ttname"><a href="ERF__Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a></div><div class="ttdeci">void AdvectionSrcForOpenBC_Tangent_Cons(const amrex::Box &amp;bx, const int &amp;dir, const int &amp;icomp, const int &amp;ncomp, const amrex::Array4&lt; amrex::Real &gt; &amp;cell_rhs, const amrex::Array4&lt; const amrex::Real &gt; &amp;cell_prim, const amrex::Array4&lt; const amrex::Real &gt; &amp;avg_xmom, const amrex::Array4&lt; const amrex::Real &gt; &amp;avg_ymom, const amrex::Array4&lt; const amrex::Real &gt; &amp;avg_zmom, const amrex::Array4&lt; const amrex::Real &gt; &amp;detJ, const amrex::GpuArray&lt; amrex::Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const bool do_lo=false)</div></div>
<div class="ttc" id="aERF__EBAdvectionSrcForState_8cpp_html_a244aa0250aa8b00b72cdef06c88b1137"><div class="ttname"><a href="ERF__EBAdvectionSrcForState_8cpp.html#a244aa0250aa8b00b72cdef06c88b1137">EBAdvectionSrcForScalars</a></div><div class="ttdeci">void EBAdvectionSrcForScalars(const Box &amp;bx, const int icomp, const int ncomp, const Array4&lt; const Real &gt; &amp;avg_xmom, const Array4&lt; const Real &gt; &amp;avg_ymom, const Array4&lt; const Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const int &gt; &amp;mask_arr, const Array4&lt; const EBCellFlag &gt; &amp;cfg_arr, const Array4&lt; const Real &gt; &amp;ax_arr, const Array4&lt; const Real &gt; &amp;ay_arr, const Array4&lt; const Real &gt; &amp;az_arr, const Array4&lt; const Real &gt; &amp;fcx_arr, const Array4&lt; const Real &gt; &amp;fcy_arr, const Array4&lt; const Real &gt; &amp;fcz_arr, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_mx, const Array4&lt; const Real &gt; &amp;mf_my, const AdvType horiz_adv_type, const AdvType vert_adv_type, const Real horiz_upw_frac, const Real vert_upw_frac, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const Box &amp;domain, const BCRec *bc_ptr_h, bool already_on_centroids)</div><div class="ttdef"><b>Definition:</b> ERF_EBAdvectionSrcForState.cpp:240</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a40adf6565c1a31b2c72d8072412d0b9f"><div class="ttname"><a href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a40adf6565c1a31b2c72d8072412d0b9f">AdvType::Upwind_3rd</a></div><div class="ttdeci">@ Upwind_3rd</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a778e0ed47937713eb1c4bedef6b00161"><div class="ttname"><a href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a778e0ed47937713eb1c4bedef6b00161">AdvType::Centered_4th</a></div><div class="ttdeci">@ Centered_4th</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a83aec89012c35752597047c6ebdd983a"><div class="ttname"><a href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a83aec89012c35752597047c6ebdd983a">AdvType::Upwind_5th</a></div><div class="ttdeci">@ Upwind_5th</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a8c9475eb6bfde28e5bcb5230ac2e22a9"><div class="ttname"><a href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a8c9475eb6bfde28e5bcb5230ac2e22a9">AdvType::Centered_6th</a></div><div class="ttdeci">@ Centered_6th</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049"><div class="ttname"><a href="ERF__IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a></div><div class="ttdeci">@ Centered_2nd</div></div>
<div class="ttc" id="anamespaceBCVars_html_a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec"><div class="ttname"><a href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a></div><div class="ttdeci">@ cons_bc</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:76</div></div>
<div class="ttc" id="anamespaceERFBCType_html_a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914"><div class="ttname"><a href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a></div><div class="ttdeci">@ open</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:215</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ERF__EBAdvectionSrcForState_8cpp_a244aa0250aa8b00b72cdef06c88b1137_cgraph.png" border="0" usemap="#aERF__EBAdvectionSrcForState_8cpp_a244aa0250aa8b00b72cdef06c88b1137_cgraph" alt=""/></div>
<map name="aERF__EBAdvectionSrcForState_8cpp_a244aa0250aa8b00b72cdef06c88b1137_cgraph" id="aERF__EBAdvectionSrcForState_8cpp_a244aa0250aa8b00b72cdef06c88b1137_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,39"/>
<area shape="rect" href="ERF__Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919" title=" " alt="" coords="244,5,423,47"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74389ed8173ad57b461b9d623a1f3867.html">Source</a></li><li class="navelem"><a class="el" href="dir_9c08f4b6b7cd879dc853cee646ab55d3.html">EB</a></li><li class="navelem"><a class="el" href="ERF__EBAdvectionSrcForState_8cpp.html">ERF_EBAdvectionSrcForState.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
