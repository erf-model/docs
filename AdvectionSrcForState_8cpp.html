<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ERF: Source/Advection/AdvectionSrcForState.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ERF
   </div>
   <div id="projectbrief">Energy Research and Forecasting: An Atmospheric Modeling Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('AdvectionSrcForState_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">AdvectionSrcForState.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="IndexDefines_8H_source.html">IndexDefines.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="TerrainMetrics_8H_source.html">TerrainMetrics.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="Advection_8H_source.html">Advection.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="AdvectionSrcForScalars_8H_source.html">AdvectionSrcForScalars.H</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for AdvectionSrcForState.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="AdvectionSrcForState_8cpp__incl.png" border="0" usemap="#aSource_2Advection_2AdvectionSrcForState_8cpp" alt=""/></div>
<map name="aSource_2Advection_2AdvectionSrcForState_8cpp" id="aSource_2Advection_2AdvectionSrcForState_8cpp">
<area shape="rect" title=" " alt="" coords="1606,5,1810,47"/>
<area shape="rect" href="IndexDefines_8H.html" title=" " alt="" coords="1410,468,1531,495"/>
<area shape="rect" href="TerrainMetrics_8H.html" title=" " alt="" coords="1957,393,2085,420"/>
<area shape="rect" href="Advection_8H.html" title=" " alt="" coords="2097,169,2199,196"/>
<area shape="rect" href="AdvectionSrcForScalars_8H.html" title=" " alt="" coords="1153,95,1341,121"/>
<area shape="rect" title=" " alt="" coords="1108,543,1231,569"/>
<area shape="rect" title=" " alt="" coords="1407,543,1535,569"/>
<area shape="rect" title=" " alt="" coords="1980,543,2063,569"/>
<area shape="rect" title=" " alt="" coords="771,468,925,495"/>
<area shape="rect" title=" " alt="" coords="2126,468,2271,495"/>
<area shape="rect" title=" " alt="" coords="2211,244,2343,271"/>
<area shape="rect" title=" " alt="" coords="2368,244,2555,271"/>
<area shape="rect" href="DataStruct_8H.html" title=" " alt="" coords="527,319,633,345"/>
<area shape="rect" href="ABLMost_8H.html" title=" " alt="" coords="1525,244,1619,271"/>
<area shape="rect" title=" " alt="" coords="288,468,347,495"/>
<area shape="rect" title=" " alt="" coords="40,468,120,495"/>
<area shape="rect" title=" " alt="" coords="547,468,706,495"/>
<area shape="rect" title=" " alt="" coords="144,468,264,495"/>
<area shape="rect" title=" " alt="" coords="371,468,487,495"/>
<area shape="rect" href="ERF__Constants_8H.html" title=" " alt="" coords="949,468,1083,495"/>
<area shape="rect" href="AdvStruct_8H.html" title=" " alt="" coords="531,393,629,420"/>
<area shape="rect" href="DiffStruct_8H.html" title=" " alt="" coords="35,393,133,420"/>
<area shape="rect" href="SpongeStruct_8H.html" title=" " alt="" coords="157,393,280,420"/>
<area shape="rect" href="TurbStruct_8H.html" title=" " alt="" coords="405,393,507,420"/>
<area shape="rect" href="TurbPertStruct_8H.html" title=" " alt="" coords="1059,393,1186,420"/>
<area shape="rect" title=" " alt="" coords="1107,468,1275,495"/>
<area shape="rect" href="TileNoZ_8H.html" title=" " alt="" coords="1299,468,1386,495"/>
<area shape="rect" title=" " alt="" coords="1553,393,1709,420"/>
<area shape="rect" title=" " alt="" coords="1784,393,1933,420"/>
<area shape="rect" href="MOSTAverage_8H.html" title=" " alt="" coords="1661,319,1787,345"/>
<area shape="rect" href="MOSTStress_8H.html" title=" " alt="" coords="1211,393,1325,420"/>
<area shape="rect" href="Interpolation_8H.html" title=" " alt="" coords="706,169,825,196"/>
<area shape="rect" href="Interpolation__UPW_8H.html" title=" " alt="" coords="502,244,658,271"/>
<area shape="rect" href="Interpolation__WENO_8H.html" title=" " alt="" coords="682,244,849,271"/>
<area shape="rect" href="Interpolation__WENO__Z_8H.html" title=" " alt="" coords="873,244,1055,271"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9683ebdeaa4713791cdaf407ff259e2b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AdvectionSrcForState_8cpp.html#a9683ebdeaa4713791cdaf407ff259e2b">AdvectionSrcForRho</a> (const Box &amp;bx, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;rho_u, const Array4&lt; const Real &gt; &amp;rho_v, const Array4&lt; const Real &gt; &amp;Omega, const Array4&lt; Real &gt; &amp;avg_xmom, const Array4&lt; Real &gt; &amp;avg_ymom, const Array4&lt; Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;ax_arr, const Array4&lt; const Real &gt; &amp;ay_arr, const Array4&lt; const Real &gt; &amp;az_arr, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const Array4&lt; const Real &gt; &amp;mf_u, const Array4&lt; const Real &gt; &amp;mf_v, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const bool const_rho)</td></tr>
<tr class="separator:a9683ebdeaa4713791cdaf407ff259e2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af74514bb4ea28557762b8ea5e62fe5b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AdvectionSrcForState_8cpp.html#af74514bb4ea28557762b8ea5e62fe5b5">AdvectionSrcForScalars</a> (const Box &amp;bx, const int icomp, const int ncomp, const Array4&lt; const Real &gt; &amp;avg_xmom, const Array4&lt; const Real &gt; &amp;avg_ymom, const Array4&lt; const Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const <a class="el" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a> horiz_adv_type, const <a class="el" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a> vert_adv_type, const Real horiz_upw_frac, const Real vert_upw_frac, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const Box &amp;domain, const BCRec *bc_ptr_h)</td></tr>
<tr class="separator:af74514bb4ea28557762b8ea5e62fe5b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a9683ebdeaa4713791cdaf407ff259e2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9683ebdeaa4713791cdaf407ff259e2b">&#9670;&nbsp;</a></span>AdvectionSrcForRho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdvectionSrcForRho </td>
          <td>(</td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>bx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>advectionSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>rho_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>rho_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>Omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_xmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_ymom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_zmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>ax_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>ay_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>az_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>detJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>cellSizeInv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>flx_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>const_rho</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for computing the advective tendency for the update equations for rho and (rho theta) This routine has explicit expressions for all cases (terrain or not) when the horizontal and vertial spatial orders are &lt;= 2, and calls more specialized functions when either (or both) spatial order(s) is greater than 2.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bx</td><td>box over which the scalars are updated </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">advectionSrc</td><td>tendency for the scalar update equation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_u</td><td>x-component of momentum </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_v</td><td>y-component of momentum </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Omega</td><td>component of momentum normal to the z-coordinate surface </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_xmom</td><td>x-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_ymom</td><td>y-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_zmom</td><td>z-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detJ</td><td>Jacobian of the metric transformation (= 1 if use_terrain is false) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cellSizeInv</td><td>inverse of the mesh spacing </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_m</td><td>map factor at cell centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_u</td><td>map factor at x-faces </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_v</td><td>map factor at y-faces </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    BL_PROFILE_VAR(<span class="stringliteral">&quot;AdvectionSrcForRho&quot;</span>, <a class="code" href="AdvectionSrcForState_8cpp.html#a9683ebdeaa4713791cdaf407ff259e2b">AdvectionSrcForRho</a>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">auto</span> dxInv = cellSizeInv[0], dyInv = cellSizeInv[1], dzInv = cellSizeInv[2];</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">const</span> Box xbx = surroundingNodes(bx,0);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keyword">const</span> Box ybx = surroundingNodes(bx,1);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keyword">const</span> Box zbx = surroundingNodes(bx,2);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    ParallelFor(xbx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        (flx_arr[0])(i,j,k,0) = ax_arr(i,j,k) * rho_u(i,j,k) / mf_u(i,j,0);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        avg_xmom(i,j,k) = (flx_arr[0])(i,j,k,0);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    });</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    ParallelFor(ybx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        (flx_arr[1])(i,j,k,0) = ay_arr(i,j,k) * rho_v(i,j,k) / mf_v(i,j,0);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        avg_ymom(i,j,k) = (flx_arr[1])(i,j,k,0);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    });</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    ParallelFor(zbx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        (flx_arr[2])(i,j,k,0) = az_arr(i,j,k) * Omega(i,j,k) / mfsq;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        avg_zmom(i,j,k  ) = (flx_arr[2])(i,j,k,0);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    });</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (const_rho) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            advectionSrc(i,j,k,0) = 0.0;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        });</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">if</span> (detJ(i,j,k) &gt; 0.) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                advectionSrc(i,j,k,0) = - mfsq / detJ(i,j,k) * (</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                  ( (flx_arr[0])(i+1,j,k,0) - (flx_arr[0])(i  ,j,k,0) ) * dxInv +</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                  ( (flx_arr[1])(i,j+1,k,0) - (flx_arr[1])(i,j  ,k,0) ) * dyInv +</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                  ( (flx_arr[2])(i,j,k+1,0) - (flx_arr[2])(i,j,k  ,0) ) * dzInv );</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                advectionSrc(i,j,k,0) = 0.;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        });</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div>
<div class="ttc" id="aAdvectionSrcForState_8cpp_html_a9683ebdeaa4713791cdaf407ff259e2b"><div class="ttname"><a href="AdvectionSrcForState_8cpp.html#a9683ebdeaa4713791cdaf407ff259e2b">AdvectionSrcForRho</a></div><div class="ttdeci">void AdvectionSrcForRho(const Box &amp;bx, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;rho_u, const Array4&lt; const Real &gt; &amp;rho_v, const Array4&lt; const Real &gt; &amp;Omega, const Array4&lt; Real &gt; &amp;avg_xmom, const Array4&lt; Real &gt; &amp;avg_ymom, const Array4&lt; Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;ax_arr, const Array4&lt; const Real &gt; &amp;ay_arr, const Array4&lt; const Real &gt; &amp;az_arr, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const Array4&lt; const Real &gt; &amp;mf_u, const Array4&lt; const Real &gt; &amp;mf_v, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const bool const_rho)</div><div class="ttdef"><b>Definition:</b> AdvectionSrcForState.cpp:30</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af74514bb4ea28557762b8ea5e62fe5b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af74514bb4ea28557762b8ea5e62fe5b5">&#9670;&nbsp;</a></span>AdvectionSrcForScalars()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdvectionSrcForScalars </td>
          <td>(</td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>bx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>icomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>ncomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_xmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_ymom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_zmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_prim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>advectionSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>detJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>cellSizeInv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a>&#160;</td>
          <td class="paramname"><em>horiz_adv_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70">AdvType</a>&#160;</td>
          <td class="paramname"><em>vert_adv_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>horiz_upw_frac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>vert_upw_frac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>flx_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>domain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BCRec *&#160;</td>
          <td class="paramname"><em>bc_ptr_h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for computing the advective tendency for the update equations for all scalars other than rho and (rho theta) This routine has explicit expressions for all cases (terrain or not) when the horizontal and vertial spatial orders are &lt;= 2, and calls more specialized functions when either (or both) spatial order(s) is greater than 2.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bx</td><td>box over which the scalars are updated if no external boundary conditions </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">icomp</td><td>component of first scalar to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ncomp</td><td>number of components to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_xmom</td><td>x-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_ymom</td><td>y-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_zmom</td><td>z-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell_prim</td><td>primtive form of scalar variales, here only potential temperature theta </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">advectionSrc</td><td>tendency for the scalar update equation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detJ</td><td>Jacobian of the metric transformation (= 1 if use_terrain is false) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cellSizeInv</td><td>inverse of the mesh spacing </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_m</td><td>map factor at cell centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">horiz_adv_type</td><td>advection scheme to be used in horiz. directions for dry scalars </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vert_adv_type</td><td>advection scheme to be used in vert. directions for dry scalars </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">horiz_upw_frac</td><td>upwinding fraction to be used in horiz. directions for dry scalars (for Blended schemes only) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vert_upw_frac</td><td>upwinding fraction to be used in vert. directions for dry scalars (for Blended schemes only) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    BL_PROFILE_VAR(<span class="stringliteral">&quot;AdvectionSrcForScalars&quot;</span>, <a class="code" href="AdvectionSrcForState_8cpp.html#af74514bb4ea28557762b8ea5e62fe5b5">AdvectionSrcForScalars</a>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keyword">auto</span> dxInv =     cellSizeInv[0], dyInv =     cellSizeInv[1], dzInv =     cellSizeInv[2];</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keyword">const</span> Box xbx = surroundingNodes(bx,0);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keyword">const</span> Box ybx = surroundingNodes(bx,1);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keyword">const</span> Box zbx = surroundingNodes(bx,2);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// Open bc will be imposed upon all vars (we only access cons here for simplicity)</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> xlo_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].lo(0) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> xhi_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].hi(0) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> ylo_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].lo(1) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> yhi_open = (bc_ptr_h[<a class="code" href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a>].hi(1) == <a class="code" href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// Only advection operations in bndry normal direction with OPEN BC</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    Box  bx_xlo,  bx_xhi,  bx_ylo,  bx_yhi;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> (xlo_open) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> ( bx.smallEnd(0) == domain.smallEnd(0)) {  bx_xlo = makeSlab( bx,0,domain.smallEnd(0));}</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (xhi_open) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">if</span> ( bx.bigEnd(0) == domain.bigEnd(0))     {  bx_xhi = makeSlab( bx,0,domain.bigEnd(0)  );}</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (ylo_open) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">if</span> ( bx.smallEnd(1) == domain.smallEnd(1)) {  bx_ylo = makeSlab( bx,1,domain.smallEnd(1));}</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (yhi_open) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">if</span> ( bx.bigEnd(1) == domain.bigEnd(1))     {  bx_yhi = makeSlab( bx,1,domain.bigEnd(1)  );}</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// Inline with 2nd order for efficiency</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// NOTE: we don&#39;t need to weight avg_xmom, avg_ymom, avg_zmom with terrain metrics</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">//       (or with EB area fractions)</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">//       because that was done when they were constructed in AdvectionSrcForRhoAndTheta</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (horiz_adv_type == <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a> &amp;&amp; vert_adv_type == <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a>)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        ParallelFor(xbx, ncomp,[=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keyword">const</span> Real prim_on_face = 0.5 * (cell_prim(i,j,k,prim_index) + cell_prim(i-1,j,k,prim_index));</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            (flx_arr[0])(i,j,k,cons_index) = avg_xmom(i,j,k) * prim_on_face;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        });</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        ParallelFor(ybx, ncomp,[=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keyword">const</span> Real prim_on_face = 0.5 * (cell_prim(i,j,k,prim_index) + cell_prim(i,j-1,k,prim_index));</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            (flx_arr[1])(i,j,k,cons_index) = avg_ymom(i,j,k) * prim_on_face;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        });</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        ParallelFor(zbx, ncomp,[=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keyword">const</span> Real prim_on_face = 0.5 * (cell_prim(i,j,k,prim_index) + cell_prim(i,j,k-1,prim_index));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            (flx_arr[2])(i,j,k,cons_index) = avg_zmom(i,j,k) * prim_on_face;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        });</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// Template higher order methods (horizontal first)</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">switch</span>(horiz_adv_type) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a>:</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            AdvectionSrcForScalarsVert&lt;CENTERED2&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                                                  avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                                  horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a40adf6565c1a31b2c72d8072412d0b9f">AdvType::Upwind_3rd</a>:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            AdvectionSrcForScalarsVert&lt;UPWIND3&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                                                avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                                horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a778e0ed47937713eb1c4bedef6b00161">AdvType::Centered_4th</a>:</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            AdvectionSrcForScalarsVert&lt;CENTERED4&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                                  avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                                  horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a83aec89012c35752597047c6ebdd983a">AdvType::Upwind_5th</a>:</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            AdvectionSrcForScalarsVert&lt;UPWIND5&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                                                avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                                horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a8c9475eb6bfde28e5bcb5230ac2e22a9">AdvType::Centered_6th</a>:</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            AdvectionSrcForScalarsVert&lt;CENTERED6&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                                  avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                                  horiz_upw_frac, vert_upw_frac, vert_adv_type);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada35597e5f00fa867fe6e39d651a2195">AdvType::Weno_3</a>:</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            AdvectionSrcForScalarsWrapper&lt;WENO3,WENO3&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                                       avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                                       horiz_upw_frac, vert_upw_frac);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70af2429e8de544f3ebd7c9668e3dbebaa8">AdvType::Weno_5</a>:</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            AdvectionSrcForScalarsWrapper&lt;WENO5,WENO5&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                                                       avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                                       horiz_upw_frac, vert_upw_frac);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a9c29b64a7627155706a1cd93682b4351">AdvType::Weno_3Z</a>:</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            AdvectionSrcForScalarsWrapper&lt;WENO_Z3,WENO_Z3&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                                           horiz_upw_frac, vert_upw_frac);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70af8b942d20ed08b25df71ea1c87244210">AdvType::Weno_3MZQ</a>:</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            AdvectionSrcForScalarsWrapper&lt;WENO_MZQ3,WENO_MZQ3&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                                               avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                                               horiz_upw_frac, vert_upw_frac);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70aeb75f5943c7837da80e2048f2b344efc">AdvType::Weno_5Z</a>:</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            AdvectionSrcForScalarsWrapper&lt;WENO_Z5,WENO_Z5&gt;(bx, ncomp, icomp, flx_arr, cell_prim,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                                           horiz_upw_frac, vert_upw_frac);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            AMREX_ASSERT_WITH_MESSAGE(<span class="keyword">false</span>, <span class="stringliteral">&quot;Unknown advection scheme!&quot;</span>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    ParallelFor(bx, ncomp, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        Real invdetJ = (detJ(i,j,k) &gt; 0.) ?  1. / detJ(i,j,k) : 1.;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        advectionSrc(i,j,k,cons_index) = - invdetJ * mfsq * (</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          ( (flx_arr[0])(i+1,j,k,cons_index) - (flx_arr[0])(i  ,j,k,cons_index) ) * dxInv +</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          ( (flx_arr[1])(i,j+1,k,cons_index) - (flx_arr[1])(i,j  ,k,cons_index) ) * dyInv +</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;          ( (flx_arr[2])(i,j,k+1,cons_index) - (flx_arr[2])(i,j,k  ,cons_index) ) * dzInv );</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    });</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// Special advection operator for open BC (bndry tangent operations)</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (xlo_open) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordtype">bool</span> do_lo = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <a class="code" href="Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_xlo, 0, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                           detJ, cellSizeInv, do_lo);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">if</span> (xhi_open) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_xhi, 0, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                           detJ, cellSizeInv);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (ylo_open) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordtype">bool</span> do_lo = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_ylo, 1, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                           detJ, cellSizeInv, do_lo);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (yhi_open) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a>(bx_yhi, 1, icomp, ncomp, advectionSrc, cell_prim,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                           avg_xmom, avg_ymom, avg_zmom,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                           detJ, cellSizeInv);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div>
<div class="ttc" id="aAdvectionSrcForState_8cpp_html_af74514bb4ea28557762b8ea5e62fe5b5"><div class="ttname"><a href="AdvectionSrcForState_8cpp.html#af74514bb4ea28557762b8ea5e62fe5b5">AdvectionSrcForScalars</a></div><div class="ttdeci">void AdvectionSrcForScalars(const Box &amp;bx, const int icomp, const int ncomp, const Array4&lt; const Real &gt; &amp;avg_xmom, const Array4&lt; const Real &gt; &amp;avg_ymom, const Array4&lt; const Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const AdvType horiz_adv_type, const AdvType vert_adv_type, const Real horiz_upw_frac, const Real vert_upw_frac, const GpuArray&lt; const Array4&lt; Real &gt;, AMREX_SPACEDIM &gt; &amp;flx_arr, const Box &amp;domain, const BCRec *bc_ptr_h)</div><div class="ttdef"><b>Definition:</b> AdvectionSrcForState.cpp:120</div></div>
<div class="ttc" id="aAdvection_8H_html_abd84d0909db1f87c22b5a92aae03e919"><div class="ttname"><a href="Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919">AdvectionSrcForOpenBC_Tangent_Cons</a></div><div class="ttdeci">void AdvectionSrcForOpenBC_Tangent_Cons(const amrex::Box &amp;bx, const int &amp;dir, const int &amp;icomp, const int &amp;ncomp, const amrex::Array4&lt; amrex::Real &gt; &amp;cell_rhs, const amrex::Array4&lt; const amrex::Real &gt; &amp;cell_prim, const amrex::Array4&lt; const amrex::Real &gt; &amp;avg_xmom, const amrex::Array4&lt; const amrex::Real &gt; &amp;avg_ymom, const amrex::Array4&lt; const amrex::Real &gt; &amp;avg_zmom, const amrex::Array4&lt; const amrex::Real &gt; &amp;detJ, const amrex::GpuArray&lt; amrex::Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const bool do_lo=false)</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a40adf6565c1a31b2c72d8072412d0b9f"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a40adf6565c1a31b2c72d8072412d0b9f">AdvType::Upwind_3rd</a></div><div class="ttdeci">@ Upwind_3rd</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a778e0ed47937713eb1c4bedef6b00161"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a778e0ed47937713eb1c4bedef6b00161">AdvType::Centered_4th</a></div><div class="ttdeci">@ Centered_4th</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a83aec89012c35752597047c6ebdd983a"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a83aec89012c35752597047c6ebdd983a">AdvType::Upwind_5th</a></div><div class="ttdeci">@ Upwind_5th</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a8c9475eb6bfde28e5bcb5230ac2e22a9"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a8c9475eb6bfde28e5bcb5230ac2e22a9">AdvType::Centered_6th</a></div><div class="ttdeci">@ Centered_6th</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70a9c29b64a7627155706a1cd93682b4351"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70a9c29b64a7627155706a1cd93682b4351">AdvType::Weno_3Z</a></div><div class="ttdeci">@ Weno_3Z</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70ada35597e5f00fa867fe6e39d651a2195"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada35597e5f00fa867fe6e39d651a2195">AdvType::Weno_3</a></div><div class="ttdeci">@ Weno_3</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70ada570868919bafaab1776170229a7049">AdvType::Centered_2nd</a></div><div class="ttdeci">@ Centered_2nd</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70aeb75f5943c7837da80e2048f2b344efc"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70aeb75f5943c7837da80e2048f2b344efc">AdvType::Weno_5Z</a></div><div class="ttdeci">@ Weno_5Z</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70af2429e8de544f3ebd7c9668e3dbebaa8"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70af2429e8de544f3ebd7c9668e3dbebaa8">AdvType::Weno_5</a></div><div class="ttdeci">@ Weno_5</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ada2d84e0dbbfb8d748defbf018748a70af8b942d20ed08b25df71ea1c87244210"><div class="ttname"><a href="IndexDefines_8H.html#ada2d84e0dbbfb8d748defbf018748a70af8b942d20ed08b25df71ea1c87244210">AdvType::Weno_3MZQ</a></div><div class="ttdeci">@ Weno_3MZQ</div></div>
<div class="ttc" id="anamespaceBCVars_html_a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec"><div class="ttname"><a href="namespaceBCVars.html#a00367571247ba920989360b94c156f4aaaf601346b01655b32acf66d07b856aec">BCVars::cons_bc</a></div><div class="ttdeci">@ cons_bc</div><div class="ttdef"><b>Definition:</b> IndexDefines.H:47</div></div>
<div class="ttc" id="anamespaceERFBCType_html_a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914"><div class="ttname"><a href="namespaceERFBCType.html#a40fbdd5a379a92debb4bcaaccac6e01ca2b4e1a73027449d9af83a25ed67ae914">ERFBCType::open</a></div><div class="ttdeci">@ open</div><div class="ttdef"><b>Definition:</b> IndexDefines.H:157</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="AdvectionSrcForState_8cpp_af74514bb4ea28557762b8ea5e62fe5b5_cgraph.png" border="0" usemap="#aAdvectionSrcForState_8cpp_af74514bb4ea28557762b8ea5e62fe5b5_cgraph" alt=""/></div>
<map name="aAdvectionSrcForState_8cpp_af74514bb4ea28557762b8ea5e62fe5b5_cgraph" id="aAdvectionSrcForState_8cpp_af74514bb4ea28557762b8ea5e62fe5b5_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,180,39"/>
<area shape="rect" href="Advection_8H.html#abd84d0909db1f87c22b5a92aae03e919" title=" " alt="" coords="228,5,407,47"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74389ed8173ad57b461b9d623a1f3867.html">Source</a></li><li class="navelem"><a class="el" href="dir_87c27e56fd01e6f1a6e2085b6fe8a1a5.html">Advection</a></li><li class="navelem"><a class="el" href="AdvectionSrcForState_8cpp.html">AdvectionSrcForState.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
