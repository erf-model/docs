<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ERF: Source/Advection/AdvectionSrcForState.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ERF
   </div>
   <div id="projectbrief">Energy Research and Forecasting: An Atmospheric Modeling Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('AdvectionSrcForState_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">AdvectionSrcForState.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="IndexDefines_8H_source.html">IndexDefines.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="TerrainMetrics_8H_source.html">TerrainMetrics.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="Advection_8H_source.html">Advection.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="Interpolation_8H_source.html">Interpolation.H</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="Interpolation__WENO_8H_source.html">Interpolation_WENO.H</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for AdvectionSrcForState.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="AdvectionSrcForState_8cpp__incl.png" border="0" usemap="#aSource_2Advection_2AdvectionSrcForState_8cpp" alt=""/></div>
<map name="aSource_2Advection_2AdvectionSrcForState_8cpp" id="aSource_2Advection_2AdvectionSrcForState_8cpp">
<area shape="rect" title=" " alt="" coords="986,5,1190,47"/>
<area shape="rect" href="IndexDefines_8H.html" title=" " alt="" coords="321,393,442,420"/>
<area shape="rect" href="TerrainMetrics_8H.html" title=" " alt="" coords="885,319,1013,345"/>
<area shape="rect" href="Advection_8H.html" title=" " alt="" coords="687,95,788,121"/>
<area shape="rect" href="Interpolation_8H.html" title=" " alt="" coords="1126,95,1245,121"/>
<area shape="rect" href="Interpolation__WENO_8H.html" title=" " alt="" coords="1269,95,1435,121"/>
<area shape="rect" title=" " alt="" coords="813,468,936,495"/>
<area shape="rect" title=" " alt="" coords="317,468,445,495"/>
<area shape="rect" title=" " alt="" coords="912,393,995,420"/>
<area shape="rect" title=" " alt="" coords="1025,393,1178,420"/>
<area shape="rect" title=" " alt="" coords="641,393,786,420"/>
<area shape="rect" title=" " alt="" coords="739,169,871,196"/>
<area shape="rect" title=" " alt="" coords="93,169,304,196"/>
<area shape="rect" href="DataStruct_8H.html" title=" " alt="" coords="1270,169,1375,196"/>
<area shape="rect" href="ABLMost_8H.html" title=" " alt="" coords="621,169,715,196"/>
<area shape="rect" title=" " alt="" coords="1435,244,1493,271"/>
<area shape="rect" title=" " alt="" coords="1517,244,1597,271"/>
<area shape="rect" title=" " alt="" coords="651,319,810,345"/>
<area shape="rect" title=" " alt="" coords="1621,244,1741,271"/>
<area shape="rect" title=" " alt="" coords="1139,319,1255,345"/>
<area shape="rect" href="ERF__Constants_8H.html" title=" " alt="" coords="1227,244,1360,271"/>
<area shape="rect" title=" " alt="" coords="195,319,351,345"/>
<area shape="rect" title=" " alt="" coords="376,319,525,345"/>
<area shape="rect" href="MOSTAverage_8H.html" title=" " alt="" coords="554,244,681,271"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac25d5c259a751e623f2b9d1986593847"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AdvectionSrcForState_8cpp.html#ac25d5c259a751e623f2b9d1986593847">AdvectionSrcForRhoAndTheta</a> (const Box &amp;bx, const Box &amp;valid_bx, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;rho_u, const Array4&lt; const Real &gt; &amp;rho_v, const Array4&lt; const Real &gt; &amp;Omega, Real fac, const Array4&lt; Real &gt; &amp;avg_xmom, const Array4&lt; Real &gt; &amp;avg_ymom, const Array4&lt; Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; const Real &gt; &amp;z_nd, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const Array4&lt; const Real &gt; &amp;mf_u, const Array4&lt; const Real &gt; &amp;mf_v, const bool all_use_WENO, const int spatial_order_WENO, const int horiz_spatial_order, const int vert_spatial_order, const int use_terrain)</td></tr>
<tr class="separator:ac25d5c259a751e623f2b9d1986593847"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac478ae8b84bf11830e1ec2dddc735a78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AdvectionSrcForState_8cpp.html#ac478ae8b84bf11830e1ec2dddc735a78">AdvectionSrcForScalars</a> (const Box &amp;bx, const int &amp;icomp, const int &amp;ncomp, const Array4&lt; const Real &gt; &amp;avg_xmom, const Array4&lt; const Real &gt; &amp;avg_ymom, const Array4&lt; const Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const bool all_use_WENO, const bool moist_use_WENO, const int spatial_order_WENO, const int horiz_spatial_order, const int vert_spatial_order, const int use_terrain)</td></tr>
<tr class="separator:ac478ae8b84bf11830e1ec2dddc735a78"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac25d5c259a751e623f2b9d1986593847"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac25d5c259a751e623f2b9d1986593847">&#9670;&nbsp;</a></span>AdvectionSrcForRhoAndTheta()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdvectionSrcForRhoAndTheta </td>
          <td>(</td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>bx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>valid_bx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>advectionSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>rho_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>rho_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>Omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>fac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_xmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_ymom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_zmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_prim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>z_nd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>detJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>cellSizeInv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>all_use_WENO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>spatial_order_WENO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>horiz_spatial_order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>vert_spatial_order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>use_terrain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for computing the advective tendency for the update equations for rho and (rho theta) This routine has explicit expressions for all cases (terrain or not) when the horizontal and vertial spatial orders are &lt;= 2, and calls more specialized functions when either (or both) spatial order(s) is greater than 2.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bx</td><td>box over which the scalars are updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">valid_bx</td><td>box that contains only the cells not in the specified or relaxation zones </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">advectionSrc</td><td>tendency for the scalar update equation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_u</td><td>x-component of momentum </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_v</td><td>y-component of momentum </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Omega</td><td>component of momentum normal to the z-coordinate surface </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fac</td><td>weighting factor for use in defining time-averaged momentum </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_xmom</td><td>x-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_ymom</td><td>y-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">avg_zmom</td><td>z-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell_prim</td><td>primtive form of scalar variales, here only potential temperature theta </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">z_nd</td><td>height coordinate at nodes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detJ</td><td>Jacobian of the metric transformation (= 1 if use_terrain is false) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cellSizeInv</td><td>inverse of the mesh spacing </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_m</td><td>map factor at cell centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_u</td><td>map factor at x-faces </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_v</td><td>map factor at y-faces </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">all_use_WENO</td><td>whether all variables (or just moisture variables) use WENO advection scheme </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spatial_order_WENO</td><td>spatial order if using WENO (3,5, or 7) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">horiz_spatial_order</td><td>spatial order to be used for lateral derivatives if not using WENO (2-6) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vert_spatial_order</td><td>spatial order to be used for vertical derivatives if not using WENO (2-6) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_terrain</td><td>if true, use the terrain-aware derivatives (with metric terms) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;{</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    BL_PROFILE_VAR(<span class="stringliteral">&quot;AdvectionSrcForRhoAndTheta&quot;</span>, <a class="code" href="AdvectionSrcForState_8cpp.html#ac25d5c259a751e623f2b9d1986593847">AdvectionSrcForRhoAndTheta</a>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">auto</span> dxInv = cellSizeInv[0], dyInv = cellSizeInv[1], dzInv = cellSizeInv[2];</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// We note that valid_bx is the actual grid, while bx may be a tile within that grid</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; vbx_hi = amrex::ubound(valid_bx);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> ( use_terrain &amp;&amp; (std::max(horiz_spatial_order,vert_spatial_order) == 2) &amp;&amp; !all_use_WENO) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        amrex::ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            Real invdetJ = 1./ detJ(i,j,k);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            Real xflux_lo = rho_u(i  ,j,k) / mf_u(i  ,j  ,0);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            Real xflux_hi = rho_u(i+1,j,k) / mf_u(i+1,j  ,0);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            Real yflux_lo = rho_v(i,j  ,k) / mf_v(i  ,j  ,0);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            Real yflux_hi = rho_v(i,j+1,k) / mf_v(i  ,j+1,0);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            Real zflux_lo = Omega(i,j,k  );</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            Real zflux_hi = Omega(i,j,k+1);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            Real met_h_zeta_xlo = <a class="code" href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e">Compute_h_zeta_AtIface</a>(i  ,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            xflux_lo *= met_h_zeta_xlo;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            Real met_h_zeta_xhi = <a class="code" href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e">Compute_h_zeta_AtIface</a>(i+1,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            xflux_hi *= met_h_zeta_xhi;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            Real met_h_zeta_ylo = <a class="code" href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f">Compute_h_zeta_AtJface</a>(i  ,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            yflux_lo *= met_h_zeta_ylo;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            Real met_h_zeta_yhi = <a class="code" href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f">Compute_h_zeta_AtJface</a>(i  ,j+1,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            yflux_hi *= met_h_zeta_yhi;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            avg_xmom(i  ,j,k) += fac*xflux_lo;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">if</span> (i == vbx_hi.x)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                avg_xmom(i+1,j,k) += fac*xflux_hi;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            avg_ymom(i,j  ,k) += fac*yflux_lo;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">if</span> (j == vbx_hi.y)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                avg_ymom(i,j+1,k) += fac*yflux_hi;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            avg_zmom(i,j,k  ) += fac*zflux_lo;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">if</span> (k == vbx_hi.z)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                avg_zmom(i,j,k+1) += fac*zflux_hi;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            advectionSrc(i,j,k,0) = - invdetJ * (</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                ( xflux_hi - xflux_lo ) * dxInv * mfsq +</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                ( yflux_hi - yflux_lo ) * dyInv * mfsq +</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                ( zflux_hi - zflux_lo ) * dzInv);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = 0;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            advectionSrc(i,j,k,1) = - invdetJ * 0.5 * (</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                ( xflux_hi * (cell_prim(i,j,k,prim_index) + cell_prim(i+1,j,k,prim_index)) -</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                  xflux_lo * (cell_prim(i,j,k,prim_index) + cell_prim(i-1,j,k,prim_index)) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                ( yflux_hi * (cell_prim(i,j,k,prim_index) + cell_prim(i,j+1,k,prim_index)) -</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                  yflux_lo * (cell_prim(i,j,k,prim_index) + cell_prim(i,j-1,k,prim_index)) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                ( zflux_hi * (cell_prim(i,j,k,prim_index) + cell_prim(i,j,k+1,prim_index)) -</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                  zflux_lo * (cell_prim(i,j,k,prim_index) + cell_prim(i,j,k-1,prim_index)) ) * dzInv);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        });</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( use_terrain &amp;&amp; (std::max(horiz_spatial_order,vert_spatial_order) &gt; 2) &amp;&amp; !all_use_WENO) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        amrex::ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            Real invdetJ = 1./ detJ(i,j,k);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            Real zflux_lo = Omega(i,j,k  );</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            Real zflux_hi = Omega(i,j,k+1);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            Real met_h_zeta_xhi = <a class="code" href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e">Compute_h_zeta_AtIface</a>(i+1,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            Real xflux_hi = rho_u(i+1,j  ,k) * met_h_zeta_xhi * 1./mf_u(i  ,j  ,0);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            Real met_h_zeta_xlo = <a class="code" href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e">Compute_h_zeta_AtIface</a>(i  ,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            Real xflux_lo = rho_u(i  ,j  ,k) * met_h_zeta_xlo * 1./mf_u(i+1,j  ,0);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            Real met_h_zeta_yhi = <a class="code" href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f">Compute_h_zeta_AtJface</a>(i  ,j+1,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            Real yflux_hi = rho_v(i  ,j+1,k) * met_h_zeta_yhi * 1./mf_v(i  ,j  ,0);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            Real met_h_zeta_ylo = <a class="code" href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f">Compute_h_zeta_AtJface</a>(i  ,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            Real yflux_lo = rho_v(i  ,j  ,k) * met_h_zeta_ylo * 1./mf_v(i  ,j+1,0);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            avg_xmom(i  ,j,k) += fac*xflux_lo;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <span class="keywordflow">if</span> (i == vbx_hi.x)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                avg_xmom(i+1,j,k) += fac*xflux_hi;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            avg_ymom(i,j  ,k) += fac*yflux_lo;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordflow">if</span> (j == vbx_hi.y)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                avg_ymom(i,j+1,k) += fac*yflux_hi;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            avg_zmom(i,j,k  ) += fac*zflux_lo;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">if</span> (k == vbx_hi.z)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                avg_zmom(i,j,k+1) += fac*zflux_hi;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            Real mf   = mf_m(i,j,0);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            Real mfsq = mf*mf;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            advectionSrc(i,j,k,0) = - invdetJ * (</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                ( xflux_hi - xflux_lo ) * dxInv * mfsq +</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                ( yflux_hi - yflux_lo ) * dyInv * mfsq +</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                ( zflux_hi - zflux_lo ) * dzInv);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = 0;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            advectionSrc(i,j,k,1) = - invdetJ * (</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                ( xflux_hi * <a class="code" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f">InterpolateInX</a>(i+1,j  , k  , cell_prim, prim_index, rho_u(i+1,j,k), horiz_spatial_order) -</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                  xflux_lo * <a class="code" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f">InterpolateInX</a>(i  ,j  , k  , cell_prim, prim_index, rho_u(i  ,j,k), horiz_spatial_order) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                ( yflux_hi * <a class="code" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1">InterpolateInY</a>(i  ,j+1, k  , cell_prim, prim_index, rho_v(i,j+1,k), horiz_spatial_order) -</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                  yflux_lo * <a class="code" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1">InterpolateInY</a>(i  ,j  , k  , cell_prim, prim_index, rho_v(i  ,j,k), horiz_spatial_order) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                ( zflux_hi * <a class="code" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885">InterpolateInZ</a>(i  ,j  , k+1, cell_prim, prim_index, Omega(i,j,k+1), vert_spatial_order) -</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                  zflux_lo * <a class="code" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885">InterpolateInZ</a>(i  ,j  , k  , cell_prim, prim_index, Omega(i  ,j,k), vert_spatial_order) ) * dzInv);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        });</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (use_terrain) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        amrex::ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            Real invdetJ = 1./ detJ(i,j,k);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            Real zflux_lo = Omega(i,j,k  );</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            Real zflux_hi = Omega(i,j,k+1);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            Real met_h_zeta_xhi = <a class="code" href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e">Compute_h_zeta_AtIface</a>(i+1,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            Real xflux_hi = rho_u(i+1,j  ,k) * met_h_zeta_xhi * 1./mf_u(i  ,j  ,0);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            Real met_h_zeta_xlo = <a class="code" href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e">Compute_h_zeta_AtIface</a>(i  ,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            Real xflux_lo = rho_u(i  ,j  ,k) * met_h_zeta_xlo * 1./mf_u(i+1,j  ,0);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            Real met_h_zeta_yhi = <a class="code" href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f">Compute_h_zeta_AtJface</a>(i  ,j+1,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            Real yflux_hi = rho_v(i  ,j+1,k) * met_h_zeta_yhi * 1./mf_v(i  ,j  ,0);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            Real met_h_zeta_ylo = <a class="code" href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f">Compute_h_zeta_AtJface</a>(i  ,j  ,k,cellSizeInv,z_nd);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            Real yflux_lo = rho_v(i  ,j  ,k) * met_h_zeta_ylo * 1./mf_v(i  ,j+1,0);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            avg_xmom(i  ,j,k) += fac*xflux_lo;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">if</span> (i == vbx_hi.x)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                avg_xmom(i+1,j,k) += fac*xflux_hi;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            avg_ymom(i,j  ,k) += fac*yflux_lo;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">if</span> (j == vbx_hi.y)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                avg_ymom(i,j+1,k) += fac*yflux_hi;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            avg_zmom(i,j,k  ) += fac*zflux_lo;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keywordflow">if</span> (k == vbx_hi.z)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                avg_zmom(i,j,k+1) += fac*zflux_hi;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            Real mf   = mf_m(i,j,0);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            Real mfsq = mf*mf;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            advectionSrc(i,j,k,0) = - invdetJ * (</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                ( xflux_hi - xflux_lo ) * dxInv * mfsq +</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                ( yflux_hi - yflux_lo ) * dyInv * mfsq +</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                ( zflux_hi - zflux_lo ) * dzInv);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = 0;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            advectionSrc(i,j,k,1) = - invdetJ * (</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                ( xflux_hi * <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i+1,j  , k  , cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                  xflux_lo * <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i  ,j  , k  , cell_prim, prim_index, spatial_order_WENO) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                ( yflux_hi * <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i  ,j+1, k  , cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                  yflux_lo * <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i  ,j  , k  , cell_prim, prim_index, spatial_order_WENO) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                ( zflux_hi * <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i  ,j  , k+1, cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                  zflux_lo * <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i  ,j  , k  , cell_prim, prim_index, spatial_order_WENO) ) * dzInv);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        });</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !use_terrain &amp;&amp; (std::max(horiz_spatial_order,vert_spatial_order) == 2) &amp;&amp; !all_use_WENO) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        amrex::ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            Real xflux_lo = rho_u(i  ,j,k) / mf_u(i  ,j  ,0);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            Real xflux_hi = rho_u(i+1,j,k) / mf_u(i+1,j  ,0);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            Real yflux_lo = rho_v(i,j  ,k) / mf_v(i  ,j  ,0);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            Real yflux_hi = rho_v(i,j+1,k) / mf_v(i  ,j+1,0);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            Real zflux_lo = Omega(i,j,k  );</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            Real zflux_hi = Omega(i,j,k+1);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            avg_xmom(i  ,j,k) += fac*xflux_lo;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">if</span> (i == vbx_hi.x)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                avg_xmom(i+1,j,k) += fac*xflux_hi;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            avg_ymom(i,j  ,k) += fac*yflux_lo;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">if</span> (j == vbx_hi.y)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                avg_ymom(i,j+1,k) += fac*yflux_hi;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            avg_zmom(i,j,k  ) += fac*zflux_lo;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keywordflow">if</span> (k == vbx_hi.z)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;               avg_zmom(i,j,k+1) += fac*zflux_hi;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            advectionSrc(i,j,k,0) = -(</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                ( xflux_hi - xflux_lo ) * dxInv * mfsq +</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                ( yflux_hi - yflux_lo ) * dyInv * mfsq +</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                ( zflux_hi - zflux_lo ) * dzInv);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = 0;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            advectionSrc(i,j,k,1) = - 0.5 * (</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;              ( xflux_hi * (cell_prim(i+1,j,k,prim_index) + cell_prim(i,j,k,prim_index)) -</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                xflux_lo * (cell_prim(i-1,j,k,prim_index) + cell_prim(i,j,k,prim_index)) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;              ( yflux_hi * (cell_prim(i,j+1,k,prim_index) + cell_prim(i,j,k,prim_index)) -</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                yflux_lo * (cell_prim(i,j-1,k,prim_index) + cell_prim(i,j,k,prim_index)) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;              ( zflux_hi * (cell_prim(i,j,k+1,prim_index) + cell_prim(i,j,k,prim_index)) -</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                zflux_lo * (cell_prim(i,j,k-1,prim_index) + cell_prim(i,j,k,prim_index)) ) * dzInv);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        });</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !use_terrain &amp;&amp; (std::max(horiz_spatial_order,vert_spatial_order) &gt; 2) &amp;&amp; !all_use_WENO) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        amrex::ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            Real xflux_lo = rho_u(i  ,j,k) / mf_u(i  ,j  ,0);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            Real xflux_hi = rho_u(i+1,j,k) / mf_u(i+1,j  ,0);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            Real yflux_lo = rho_v(i,j  ,k) / mf_v(i  ,j  ,0);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            Real yflux_hi = rho_v(i,j+1,k) / mf_v(i  ,j+1,0);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            Real zflux_lo = Omega(i,j,k  );</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            Real zflux_hi = Omega(i,j,k+1);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            avg_xmom(i  ,j,k) += fac*xflux_lo;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">if</span> (i == vbx_hi.x)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                avg_xmom(i+1,j,k) += fac*xflux_hi;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            avg_ymom(i,j  ,k) += fac*yflux_lo;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">if</span> (j == vbx_hi.y)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                avg_ymom(i,j+1,k) += fac*yflux_hi;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            avg_zmom(i,j,k  ) += fac*zflux_lo;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">if</span> (k == vbx_hi.z)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;               avg_zmom(i,j,k+1) += fac*zflux_hi;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            Real mf   = mf_m(i,j,0);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            Real mfsq = mf*mf;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            advectionSrc(i,j,k,0) = -(</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                ( xflux_hi - xflux_lo ) * dxInv * mfsq +</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                ( yflux_hi - yflux_lo ) * dyInv * mfsq +</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                ( zflux_hi - zflux_lo ) * dzInv);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = 0;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            advectionSrc(i,j,k,1) = -(</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;              ( xflux_hi * <a class="code" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f">InterpolateInX</a>(i+1,j  , k  , cell_prim, prim_index, rho_u(i+1,j,k), horiz_spatial_order) -</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                xflux_lo * <a class="code" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f">InterpolateInX</a>(i  ,j  , k  , cell_prim, prim_index, rho_u(i  ,j,k), horiz_spatial_order) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;              ( yflux_hi * <a class="code" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1">InterpolateInY</a>(i  ,j+1, k  , cell_prim, prim_index, rho_v(i,j+1,k), horiz_spatial_order) -</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                yflux_lo * <a class="code" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1">InterpolateInY</a>(i  ,j  , k  , cell_prim, prim_index, rho_v(i  ,j,k), horiz_spatial_order) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;              ( zflux_hi * <a class="code" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885">InterpolateInZ</a>(i  ,j  , k+1, cell_prim, prim_index, Omega(i,j,k+1), vert_spatial_order) -</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                zflux_lo * <a class="code" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885">InterpolateInZ</a>(i  ,j  , k  , cell_prim, prim_index, Omega(i  ,j,k), vert_spatial_order) ) * dzInv);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        });</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        amrex::ParallelFor(bx, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            Real xflux_lo = rho_u(i  ,j,k) / mf_u(i  ,j  ,0);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            Real xflux_hi = rho_u(i+1,j,k) / mf_u(i+1,j  ,0);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            Real yflux_lo = rho_v(i,j  ,k) / mf_v(i  ,j  ,0);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            Real yflux_hi = rho_v(i,j+1,k) / mf_v(i  ,j+1,0);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            Real zflux_lo = Omega(i,j,k  );</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            Real zflux_hi = Omega(i,j,k+1);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            avg_xmom(i  ,j,k) += fac*xflux_lo;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">if</span> (i == vbx_hi.x)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                avg_xmom(i+1,j,k) += fac*xflux_hi;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            avg_ymom(i,j  ,k) += fac*yflux_lo;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="keywordflow">if</span> (j == vbx_hi.y)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                avg_ymom(i,j+1,k) += fac*yflux_hi;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            avg_zmom(i,j,k  ) += fac*zflux_lo;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">if</span> (k == vbx_hi.z)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;               avg_zmom(i,j,k+1) += fac*zflux_hi;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            Real mf   = mf_m(i,j,0);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            Real mfsq = mf*mf;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            advectionSrc(i,j,k,0) = -(</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                ( xflux_hi - xflux_lo ) * dxInv * mfsq +</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                ( yflux_hi - yflux_lo ) * dyInv * mfsq +</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                ( zflux_hi - zflux_lo ) * dzInv);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = 0;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            advectionSrc(i,j,k,1) = -(</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                ( xflux_hi * <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i+1,j  , k  , cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                  xflux_lo * <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i  ,j  , k  , cell_prim, prim_index, spatial_order_WENO) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                ( yflux_hi * <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i  ,j+1, k  , cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                  yflux_lo * <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i  ,j  , k  , cell_prim, prim_index, spatial_order_WENO) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                ( zflux_hi * <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i  ,j  , k+1, cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                  zflux_lo * <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i  ,j  , k  , cell_prim, prim_index, spatial_order_WENO) ) * dzInv);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        });</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="ttc" id="aAdvectionSrcForState_8cpp_html_ac25d5c259a751e623f2b9d1986593847"><div class="ttname"><a href="AdvectionSrcForState_8cpp.html#ac25d5c259a751e623f2b9d1986593847">AdvectionSrcForRhoAndTheta</a></div><div class="ttdeci">void AdvectionSrcForRhoAndTheta(const Box &amp;bx, const Box &amp;valid_bx, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;rho_u, const Array4&lt; const Real &gt; &amp;rho_v, const Array4&lt; const Real &gt; &amp;Omega, Real fac, const Array4&lt; Real &gt; &amp;avg_xmom, const Array4&lt; Real &gt; &amp;avg_ymom, const Array4&lt; Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; const Real &gt; &amp;z_nd, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const Array4&lt; const Real &gt; &amp;mf_u, const Array4&lt; const Real &gt; &amp;mf_v, const bool all_use_WENO, const int spatial_order_WENO, const int horiz_spatial_order, const int vert_spatial_order, const int use_terrain)</div><div class="ttdef"><b>Definition:</b> AdvectionSrcForState.cpp:40</div></div>
<div class="ttc" id="aInterpolation_8H_html_a400206f0a38c82153724e460cc3ff10f"><div class="ttname"><a href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f">InterpolateInX</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real InterpolateInX(int i, int j, int k, const amrex::Array4&lt; const amrex::Real &gt; &amp;qty, int qty_index, amrex::Real upw, int spatial_order)</div><div class="ttdef"><b>Definition:</b> Interpolation.H:38</div></div>
<div class="ttc" id="aInterpolation_8H_html_a5e18e863acabb5607a6f560750ee1885"><div class="ttname"><a href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885">InterpolateInZ</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real InterpolateInZ(int i, int j, int k, const amrex::Array4&lt; const amrex::Real &gt; &amp;qty, int qty_index, amrex::Real upw, int spatial_order)</div><div class="ttdef"><b>Definition:</b> Interpolation.H:101</div></div>
<div class="ttc" id="aInterpolation_8H_html_a8646c3324acc178c35e6aa1dfa6f55c1"><div class="ttname"><a href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1">InterpolateInY</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real InterpolateInY(int i, int j, int k, const amrex::Array4&lt; const amrex::Real &gt; &amp;qty, int qty_index, amrex::Real upw, int spatial_order)</div><div class="ttdef"><b>Definition:</b> Interpolation.H:70</div></div>
<div class="ttc" id="aInterpolation__WENO_8H_html_a0fcd042e4095852a52b53eebaa61fb90"><div class="ttname"><a href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real InterpolateInX_WENO(int i, int j, int k, const amrex::Array4&lt; const amrex::Real &gt; &amp;qty, int qty_index, int spatial_order)</div><div class="ttdef"><b>Definition:</b> Interpolation_WENO.H:9</div></div>
<div class="ttc" id="aInterpolation__WENO_8H_html_a49a79d89525c0954af5c6d7bc1faf822"><div class="ttname"><a href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real InterpolateInZ_WENO(int i, int j, int k, const amrex::Array4&lt; const amrex::Real &gt; &amp;qty, int qty_index, int spatial_order)</div><div class="ttdef"><b>Definition:</b> Interpolation_WENO.H:121</div></div>
<div class="ttc" id="aInterpolation__WENO_8H_html_a9a1e24f3795c776517ee7d4a5d8e410e"><div class="ttname"><a href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real InterpolateInY_WENO(int i, int j, int k, const amrex::Array4&lt; const amrex::Real &gt; &amp;qty, int qty_index, int spatial_order)</div><div class="ttdef"><b>Definition:</b> Interpolation_WENO.H:65</div></div>
<div class="ttc" id="aTerrainMetrics_8H_html_a8d96671d41364f1e24391375a2bc0f1e"><div class="ttname"><a href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e">Compute_h_zeta_AtIface</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real Compute_h_zeta_AtIface(const int &amp;i, const int &amp;j, const int &amp;k, const amrex::GpuArray&lt; amrex::Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const amrex::Array4&lt; const amrex::Real &gt; &amp;z_nd)</div><div class="ttdef"><b>Definition:</b> TerrainMetrics.H:67</div></div>
<div class="ttc" id="aTerrainMetrics_8H_html_ada12bcb6beb3fa0d00dbdacb37f3c60f"><div class="ttname"><a href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f">Compute_h_zeta_AtJface</a></div><div class="ttdeci">AMREX_GPU_DEVICE AMREX_FORCE_INLINE amrex::Real Compute_h_zeta_AtJface(const int &amp;i, const int &amp;j, const int &amp;k, const amrex::GpuArray&lt; amrex::Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const amrex::Array4&lt; const amrex::Real &gt; &amp;z_nd)</div><div class="ttdef"><b>Definition:</b> TerrainMetrics.H:110</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="AdvectionSrcForState_8cpp_ac25d5c259a751e623f2b9d1986593847_cgraph.png" border="0" usemap="#aAdvectionSrcForState_8cpp_ac25d5c259a751e623f2b9d1986593847_cgraph" alt=""/></div>
<map name="aAdvectionSrcForState_8cpp_ac25d5c259a751e623f2b9d1986593847_cgraph" id="aAdvectionSrcForState_8cpp_ac25d5c259a751e623f2b9d1986593847_cgraph">
<area shape="rect" title=" " alt="" coords="5,183,220,209"/>
<area shape="rect" href="TerrainMetrics_8H.html#a8d96671d41364f1e24391375a2bc0f1e" title=" " alt="" coords="268,5,452,32"/>
<area shape="rect" href="TerrainMetrics_8H.html#ada12bcb6beb3fa0d00dbdacb37f3c60f" title=" " alt="" coords="268,56,452,83"/>
<area shape="rect" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f" title=" " alt="" coords="303,107,417,133"/>
<area shape="rect" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90" title=" " alt="" coords="279,157,441,184"/>
<area shape="rect" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1" title=" " alt="" coords="303,208,417,235"/>
<area shape="rect" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e" title=" " alt="" coords="279,259,441,285"/>
<area shape="rect" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885" title=" " alt="" coords="303,309,417,336"/>
<area shape="rect" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822" title=" " alt="" coords="279,360,441,387"/>
<area shape="rect" href="Interpolation_8H.html#a71fca84dbe981db2b26af15f7201ce57" title=" " alt="" coords="500,208,621,235"/>
</map>
</div>

</div>
</div>
<a id="ac478ae8b84bf11830e1ec2dddc735a78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac478ae8b84bf11830e1ec2dddc735a78">&#9670;&nbsp;</a></span>AdvectionSrcForScalars()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdvectionSrcForScalars </td>
          <td>(</td>
          <td class="paramtype">const Box &amp;&#160;</td>
          <td class="paramname"><em>bx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int &amp;&#160;</td>
          <td class="paramname"><em>icomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int &amp;&#160;</td>
          <td class="paramname"><em>ncomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_xmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_ymom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>avg_zmom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_prim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>advectionSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>detJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;&#160;</td>
          <td class="paramname"><em>cellSizeInv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Array4&lt; const Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>mf_m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>all_use_WENO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>moist_use_WENO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>spatial_order_WENO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>horiz_spatial_order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>vert_spatial_order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>use_terrain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for computing the advective tendency for the update equations for all scalars other than rho and (rho theta) This routine has explicit expressions for all cases (terrain or not) when the horizontal and vertial spatial orders are &lt;= 2, and calls more specialized functions when either (or both) spatial order(s) is greater than 2.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bx</td><td>box over which the scalars are updated if no external boundary conditions </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">icomp</td><td>component of first scalar to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ncomp</td><td>number of components to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_xmom</td><td>x-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_ymom</td><td>y-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">avg_zmom</td><td>z-component of time-averaged momentum defined in this routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell_prim</td><td>primtive form of scalar variales, here only potential temperature theta </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">advectionSrc</td><td>tendency for the scalar update equation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detJ</td><td>Jacobian of the metric transformation (= 1 if use_terrain is false) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cellSizeInv</td><td>inverse of the mesh spacing </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mf_m</td><td>map factor at cell centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">all_use_WENO</td><td>whether all variables use WENO advection scheme </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">moist_use_WENO</td><td>whether moisture variables use WENO advection scheme </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spatial_order_WENO</td><td>spatial order if using WENO (3,5, or 7) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">horiz_spatial_order</td><td>spatial order to be used for lateral derivatives if not using WENO (2-6) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vert_spatial_order</td><td>spatial order to be used for vertical derivatives if not using WENO (2-6) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_terrain</td><td>if true, use the terrain-aware derivatives (with metric terms) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;{</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    BL_PROFILE_VAR(<span class="stringliteral">&quot;AdvectionSrcForScalars&quot;</span>, <a class="code" href="AdvectionSrcForState_8cpp.html#ac478ae8b84bf11830e1ec2dddc735a78">AdvectionSrcForScalars</a>);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keyword">auto</span> dxInv = cellSizeInv[0], dyInv = cellSizeInv[1], dzInv = cellSizeInv[2];</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordtype">int</span> ncomp_end{ncomp};</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">int</span> moist_off = <a class="code" href="IndexDefines_8H.html#a0296f21cd48e5d8236c62ae4ce319b2f">RhoScalar_comp</a>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">#if defined(ERF_USE_MOISTURE)</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    moist_off = RhoQt_comp;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">#elif defined(ERF_USE_WARM_NO_PRECIP)</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    moist_off = RhoQv_comp;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">// Running with WENO for moisture but not for other vars</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span>(moist_use_WENO &amp;&amp; ((icomp+ncomp)==<a class="code" href="IndexDefines_8H.html#ad5195ac8f863f5a9a7eaa0db094f7639">NVAR</a>) ) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        ncomp_end -= 2;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        amrex::ParallelFor(bx, 2, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            Real invdetJ = (use_terrain) ?  1. / detJ(i,j,k) : 1.;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="comment">// NOTE: we don&#39;t need to weight avg_xmom, avg_ymom, avg_zmom with terrain metrics</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="comment">//       because that was done when they were constructed in AdvectionSrcForRhoAndTheta</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = moist_off + n;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            advectionSrc(i,j,k,cons_index) = - invdetJ * (</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            ( avg_xmom(i+1,j,k) *</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i+1,j,k,cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;              avg_xmom(i  ,j,k) *</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i  ,j,k,cell_prim, prim_index, spatial_order_WENO) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            ( avg_ymom(i,j+1,k) *</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i,j+1,k,cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;              avg_ymom(i,j  ,k) *</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i,j  ,k,cell_prim, prim_index, spatial_order_WENO) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            ( avg_zmom(i,j,k+1) *</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i,j,k+1,cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;              avg_zmom(i,j,k  ) *</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i,j,k  ,cell_prim, prim_index, spatial_order_WENO) ) * dzInv );</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        });</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">if</span> ((std::max(horiz_spatial_order,vert_spatial_order) == 2) &amp;&amp; !all_use_WENO) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        amrex::ParallelFor(bx, ncomp_end, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            Real invdetJ = (use_terrain) ?  1. / detJ(i,j,k) : 1.;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="comment">// NOTE: we don&#39;t need to weight avg_xmom, avg_ymom, avg_zmom with terrain metrics</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="comment">//       because that was done when they were constructed in AdvectionSrcForRhoAndTheta</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            advectionSrc(i,j,k,cons_index) = - 0.5 * invdetJ * (</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;              ( avg_xmom(i+1,j,k) * (cell_prim(i,j,k,prim_index) + cell_prim(i+1,j,k,prim_index)) -</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                avg_xmom(i  ,j,k) * (cell_prim(i,j,k,prim_index) + cell_prim(i-1,j,k,prim_index)) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;              ( avg_ymom(i,j+1,k) * (cell_prim(i,j,k,prim_index) + cell_prim(i,j+1,k,prim_index)) -</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                avg_ymom(i,j  ,k) * (cell_prim(i,j,k,prim_index) + cell_prim(i,j-1,k,prim_index)) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;              ( avg_zmom(i,j,k+1) * (cell_prim(i,j,k,prim_index) + cell_prim(i,j,k+1,prim_index)) -</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                avg_zmom(i,j,k  ) * (cell_prim(i,j,k,prim_index) + cell_prim(i,j,k-1,prim_index)) ) * dzInv);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        });</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((std::max(horiz_spatial_order,vert_spatial_order) &gt; 2) &amp;&amp; !all_use_WENO) { <span class="comment">// order &gt; 2</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        amrex::ParallelFor(bx, ncomp_end, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            Real invdetJ = (use_terrain) ?  1. / detJ(i,j,k) : 1.;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="comment">// NOTE: we don&#39;t need to weight avg_xmom, avg_ymom, avg_zmom with terrain metrics</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="comment">//       because that was done when they were constructed in AdvectionSrcForRhoAndTheta</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            advectionSrc(i,j,k,cons_index) = - invdetJ * (</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            ( avg_xmom(i+1,j,k) *</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                <a class="code" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f">InterpolateInX</a>(i+1,j,k,cell_prim, prim_index, avg_xmom(i+1,j,k), horiz_spatial_order) -</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;              avg_xmom(i  ,j,k) *</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                <a class="code" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f">InterpolateInX</a>(i  ,j,k,cell_prim, prim_index, avg_xmom(i  ,j,k), horiz_spatial_order) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            ( avg_ymom(i,j+1,k) *</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                <a class="code" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1">InterpolateInY</a>(i,j+1,k,cell_prim, prim_index, avg_ymom(i,j+1,k), horiz_spatial_order) -</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;              avg_ymom(i,j  ,k) *</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <a class="code" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1">InterpolateInY</a>(i,j  ,k,cell_prim, prim_index, avg_ymom(i  ,j,k), horiz_spatial_order) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            ( avg_zmom(i,j,k+1) *</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <a class="code" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885">InterpolateInZ</a>(i,j,k+1,cell_prim, prim_index, avg_zmom(i,j,k+1), vert_spatial_order) -</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;              avg_zmom(i,j,k  ) *</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <a class="code" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885">InterpolateInZ</a>(i,j,k  ,cell_prim, prim_index, avg_zmom(i  ,j,k), vert_spatial_order) ) * dzInv );</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        });</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// all_use_WENO</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        amrex::ParallelFor(bx, ncomp_end, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> n) noexcept</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            Real invdetJ = (use_terrain) ?  1. / detJ(i,j,k) : 1.;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="comment">// NOTE: we don&#39;t need to weight avg_xmom, avg_ymom, avg_zmom with terrain metrics</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="comment">//       because that was done when they were constructed in AdvectionSrcForRhoAndTheta</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cons_index = icomp + n;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> prim_index = cons_index - 1;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            Real mfsq = mf_m(i,j,0) * mf_m(i,j,0);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            advectionSrc(i,j,k,cons_index) = - invdetJ * (</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            ( avg_xmom(i+1,j,k) *</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i+1,j,k,cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;              avg_xmom(i  ,j,k) *</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90">InterpolateInX_WENO</a>(i  ,j,k,cell_prim, prim_index, spatial_order_WENO) ) * dxInv * mfsq +</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            ( avg_ymom(i,j+1,k) *</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i,j+1,k,cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;              avg_ymom(i,j  ,k) *</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e">InterpolateInY_WENO</a>(i,j  ,k,cell_prim, prim_index, spatial_order_WENO) ) * dyInv * mfsq +</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            ( avg_zmom(i,j,k+1) *</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i,j,k+1,cell_prim, prim_index, spatial_order_WENO) -</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;              avg_zmom(i,j,k  ) *</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                <a class="code" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822">InterpolateInZ_WENO</a>(i,j,k  ,cell_prim, prim_index, spatial_order_WENO) ) * dzInv );</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        });</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div>
<div class="ttc" id="aAdvectionSrcForState_8cpp_html_ac478ae8b84bf11830e1ec2dddc735a78"><div class="ttname"><a href="AdvectionSrcForState_8cpp.html#ac478ae8b84bf11830e1ec2dddc735a78">AdvectionSrcForScalars</a></div><div class="ttdeci">void AdvectionSrcForScalars(const Box &amp;bx, const int &amp;icomp, const int &amp;ncomp, const Array4&lt; const Real &gt; &amp;avg_xmom, const Array4&lt; const Real &gt; &amp;avg_ymom, const Array4&lt; const Real &gt; &amp;avg_zmom, const Array4&lt; const Real &gt; &amp;cell_prim, const Array4&lt; Real &gt; &amp;advectionSrc, const Array4&lt; const Real &gt; &amp;detJ, const GpuArray&lt; Real, AMREX_SPACEDIM &gt; &amp;cellSizeInv, const Array4&lt; const Real &gt; &amp;mf_m, const bool all_use_WENO, const bool moist_use_WENO, const int spatial_order_WENO, const int horiz_spatial_order, const int vert_spatial_order, const int use_terrain)</div><div class="ttdef"><b>Definition:</b> AdvectionSrcForState.cpp:341</div></div>
<div class="ttc" id="aIndexDefines_8H_html_a0296f21cd48e5d8236c62ae4ce319b2f"><div class="ttname"><a href="IndexDefines_8H.html#a0296f21cd48e5d8236c62ae4ce319b2f">RhoScalar_comp</a></div><div class="ttdeci">#define RhoScalar_comp</div><div class="ttdef"><b>Definition:</b> IndexDefines.H:16</div></div>
<div class="ttc" id="aIndexDefines_8H_html_ad5195ac8f863f5a9a7eaa0db094f7639"><div class="ttname"><a href="IndexDefines_8H.html#ad5195ac8f863f5a9a7eaa0db094f7639">NVAR</a></div><div class="ttdeci">#define NVAR</div><div class="ttdef"><b>Definition:</b> IndexDefines.H:26</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="AdvectionSrcForState_8cpp_ac478ae8b84bf11830e1ec2dddc735a78_cgraph.png" border="0" usemap="#aAdvectionSrcForState_8cpp_ac478ae8b84bf11830e1ec2dddc735a78_cgraph" alt=""/></div>
<map name="aAdvectionSrcForState_8cpp_ac478ae8b84bf11830e1ec2dddc735a78_cgraph" id="aAdvectionSrcForState_8cpp_ac478ae8b84bf11830e1ec2dddc735a78_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,180,159"/>
<area shape="rect" href="Interpolation_8H.html#a400206f0a38c82153724e460cc3ff10f" title=" " alt="" coords="252,5,367,32"/>
<area shape="rect" href="Interpolation__WENO_8H.html#a0fcd042e4095852a52b53eebaa61fb90" title=" " alt="" coords="228,56,391,83"/>
<area shape="rect" href="Interpolation_8H.html#a8646c3324acc178c35e6aa1dfa6f55c1" title=" " alt="" coords="253,107,366,133"/>
<area shape="rect" href="Interpolation__WENO_8H.html#a9a1e24f3795c776517ee7d4a5d8e410e" title=" " alt="" coords="229,157,390,184"/>
<area shape="rect" href="Interpolation_8H.html#a5e18e863acabb5607a6f560750ee1885" title=" " alt="" coords="252,208,367,235"/>
<area shape="rect" href="Interpolation__WENO_8H.html#a49a79d89525c0954af5c6d7bc1faf822" title=" " alt="" coords="228,259,391,285"/>
<area shape="rect" href="Interpolation_8H.html#a71fca84dbe981db2b26af15f7201ce57" title=" " alt="" coords="439,107,560,133"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74389ed8173ad57b461b9d623a1f3867.html">Source</a></li><li class="navelem"><a class="el" href="dir_87c27e56fd01e6f1a6e2085b6fe8a1a5.html">Advection</a></li><li class="navelem"><a class="el" href="AdvectionSrcForState_8cpp.html">AdvectionSrcForState.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
