<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ERF: Morrison Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ERF
   </div>
   <div id="projectbrief">Energy Research and Forecasting: An Atmospheric Modeling Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classMorrison.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classMorrison-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Morrison Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="ERF__Morrison_8H_source.html">ERF_Morrison.H</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Morrison:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison__inherit__graph.png" border="0" usemap="#aMorrison_inherit__map" alt="Inheritance graph"/></div>
<map name="aMorrison_inherit__map" id="aMorrison_inherit__map">
<area shape="rect" title=" " alt="" coords="8,80,87,107"/>
<area shape="rect" href="classNullMoist.html" title=" " alt="" coords="5,5,89,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Morrison:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison__coll__graph.png" border="0" usemap="#aMorrison_coll__map" alt="Collaboration graph"/></div>
<map name="aMorrison_coll__map" id="aMorrison_coll__map">
<area shape="rect" title=" " alt="" coords="547,468,625,495"/>
<area shape="rect" href="classNullMoist.html" title=" " alt="" coords="259,161,343,188"/>
<area shape="rect" title=" " alt="" coords="5,131,44,157"/>
<area shape="rect" title=" " alt="" coords="257,212,344,239"/>
<area shape="rect" title=" " alt="" coords="195,395,407,421"/>
<area shape="rect" title=" " alt="" coords="245,445,356,472"/>
<area shape="rect" title=" " alt="" coords="219,497,383,538"/>
<area shape="rect" title=" " alt="" coords="275,601,326,628"/>
<area shape="rect" title=" " alt="" coords="257,700,345,727"/>
<area shape="rect" title=" " alt="" coords="259,751,342,777"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a13a8f76ec153a1ac3536a0291b591e08"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a13a8f76ec153a1ac3536a0291b591e08">Morrison</a> ()</td></tr>
<tr class="separator:a13a8f76ec153a1ac3536a0291b591e08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a0f44390b82e965df1a69296676495b"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a0a0f44390b82e965df1a69296676495b">~Morrison</a> ()=default</td></tr>
<tr class="separator:a0a0f44390b82e965df1a69296676495b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a883ebd47f7f1232c523a87076ccb1ad5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a883ebd47f7f1232c523a87076ccb1ad5">Define</a> (<a class="el" href="structSolverChoice.html">SolverChoice</a> &amp;sc) override</td></tr>
<tr class="separator:a883ebd47f7f1232c523a87076ccb1ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f2177b8af1d7f3f0597a7248343569e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a9f2177b8af1d7f3f0597a7248343569e">Init</a> (const amrex::MultiFab &amp;cons_in, const amrex::BoxArray &amp;grids, const amrex::Geometry &amp;geom, const amrex::Real &amp;dt_advance, std::unique_ptr&lt; amrex::MultiFab &gt; &amp;z_phys_nd, std::unique_ptr&lt; amrex::MultiFab &gt; &amp;detJ_cc) override</td></tr>
<tr class="separator:a9f2177b8af1d7f3f0597a7248343569e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fe61e6c89f21c46207142a8ef2d67b1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a5fe61e6c89f21c46207142a8ef2d67b1">Copy_State_to_Micro</a> (const amrex::MultiFab &amp;cons_in) override</td></tr>
<tr class="separator:a5fe61e6c89f21c46207142a8ef2d67b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a816f41f9bbd55757684c2f307940b117"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a816f41f9bbd55757684c2f307940b117">Copy_Micro_to_State</a> (amrex::MultiFab &amp;cons_in) override</td></tr>
<tr class="separator:a816f41f9bbd55757684c2f307940b117"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b223b2f67d6de76f1edd249b4a16d63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a3b223b2f67d6de76f1edd249b4a16d63">Update_Micro_Vars</a> (amrex::MultiFab &amp;cons_in) override</td></tr>
<tr class="separator:a3b223b2f67d6de76f1edd249b4a16d63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3dba4bdf7e085ec4b872fd28317b521"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#af3dba4bdf7e085ec4b872fd28317b521">Update_State_Vars</a> (amrex::MultiFab &amp;cons_in) override</td></tr>
<tr class="separator:af3dba4bdf7e085ec4b872fd28317b521"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14321f6398d7555cc4bcb02dae4b0be1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a14321f6398d7555cc4bcb02dae4b0be1">Advance</a> (const amrex::Real &amp;dt_advance, const <a class="el" href="structSolverChoice.html">SolverChoice</a> &amp;sc) override</td></tr>
<tr class="separator:a14321f6398d7555cc4bcb02dae4b0be1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b77aa8b347b286ffeae1aabc2e4b69a"><td class="memItemLeft" align="right" valign="top">amrex::MultiFab *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a6b77aa8b347b286ffeae1aabc2e4b69a">Qmoist_Ptr</a> (const int &amp;varIdx) override</td></tr>
<tr class="separator:a6b77aa8b347b286ffeae1aabc2e4b69a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d3bd1b9f29e84bc115d7a9f42595f76"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a7d3bd1b9f29e84bc115d7a9f42595f76">Compute_Coefficients</a> ()</td></tr>
<tr class="separator:a7d3bd1b9f29e84bc115d7a9f42595f76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fc43dc29aa5c3106aa69d1350c793c1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a9fc43dc29aa5c3106aa69d1350c793c1">Qmoist_Size</a> () override</td></tr>
<tr class="separator:a9fc43dc29aa5c3106aa69d1350c793c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44bce0ee7f1e62e84fa21f326346ad0b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a44bce0ee7f1e62e84fa21f326346ad0b">Qstate_Size</a> () override</td></tr>
<tr class="separator:a44bce0ee7f1e62e84fa21f326346ad0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2269eb1d7ce46e6eba5ffe3ad1489c57"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a2269eb1d7ce46e6eba5ffe3ad1489c57">Qmoist_Restart_Vars</a> (const <a class="el" href="structSolverChoice.html">SolverChoice</a> &amp;, std::vector&lt; int &gt; &amp;a_idx, std::vector&lt; std::string &gt; &amp;a_names) const override</td></tr>
<tr class="separator:a2269eb1d7ce46e6eba5ffe3ad1489c57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classNullMoist"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classNullMoist')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classNullMoist.html">NullMoist</a></td></tr>
<tr class="memitem:a987746c147545a1a7d0efd21e5e34a12 inherit pub_methods_classNullMoist"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNullMoist.html#a987746c147545a1a7d0efd21e5e34a12">NullMoist</a> ()</td></tr>
<tr class="separator:a987746c147545a1a7d0efd21e5e34a12 inherit pub_methods_classNullMoist"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75e2d77cb28efa62759818d066b53bb9 inherit pub_methods_classNullMoist"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNullMoist.html#a75e2d77cb28efa62759818d066b53bb9">~NullMoist</a> ()=default</td></tr>
<tr class="separator:a75e2d77cb28efa62759818d066b53bb9 inherit pub_methods_classNullMoist"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a9899e6e638c26d33096fd5f40a2f7704"><td class="memItemLeft" align="right" valign="top">AMREX_GPU_HOST_DEVICE static AMREX_FORCE_INLINE amrex::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a9899e6e638c26d33096fd5f40a2f7704">NewtonIterSat</a> (int &amp;i, int &amp;j, int &amp;k, const amrex::Real &amp;fac_cond, const amrex::Real &amp;fac_fus, const amrex::Real &amp;fac_sub, const amrex::Real &amp;an, const amrex::Real &amp;bn, const amrex::Array4&lt; amrex::Real &gt; &amp;tabs_array, const amrex::Array4&lt; amrex::Real &gt; &amp;pres_array, const amrex::Array4&lt; amrex::Real &gt; &amp;qv_array, const amrex::Array4&lt; amrex::Real &gt; &amp;qc_array, const amrex::Array4&lt; amrex::Real &gt; &amp;qi_array, const amrex::Array4&lt; amrex::Real &gt; &amp;qn_array, const amrex::Array4&lt; amrex::Real &gt; &amp;qt_array)</td></tr>
<tr class="separator:a9899e6e638c26d33096fd5f40a2f7704"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:aeb27c9fd26acdb5c0ada38bef3763b6d"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#aeb27c9fd26acdb5c0ada38bef3763b6d">FabPtr</a> = std::shared_ptr&lt; amrex::MultiFab &gt;</td></tr>
<tr class="separator:aeb27c9fd26acdb5c0ada38bef3763b6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:aae728919a37c1eebbf4956d78da9f3cd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#aae728919a37c1eebbf4956d78da9f3cd">m_qmoist_size</a> = 8</td></tr>
<tr class="separator:aae728919a37c1eebbf4956d78da9f3cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f9d7082f6b82a86ab3ffe666857d8cf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a5f9d7082f6b82a86ab3ffe666857d8cf">m_qstate_size</a> = 6</td></tr>
<tr class="separator:a5f9d7082f6b82a86ab3ffe666857d8cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6284af8ee4608059214c45bc39425011"><td class="memItemLeft" align="right" valign="top">amrex::Vector&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a6284af8ee4608059214c45bc39425011">MicVarMap</a></td></tr>
<tr class="separator:a6284af8ee4608059214c45bc39425011"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a104c04cee2e446fcfa520dfb79c6563d"><td class="memItemLeft" align="right" valign="top">amrex::Geometry&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a></td></tr>
<tr class="separator:a104c04cee2e446fcfa520dfb79c6563d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb7bda8ea77a4cd5a81e504f5131440e"><td class="memItemLeft" align="right" valign="top">amrex::BoxArray&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#acb7bda8ea77a4cd5a81e504f5131440e">m_gtoe</a></td></tr>
<tr class="separator:acb7bda8ea77a4cd5a81e504f5131440e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bc485a108780b844d2ecdc70f7a618b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a7bc485a108780b844d2ecdc70f7a618b">nlev</a></td></tr>
<tr class="separator:a7bc485a108780b844d2ecdc70f7a618b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac84562ae1d4a60e286c7566cb1203194"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a></td></tr>
<tr class="separator:ac84562ae1d4a60e286c7566cb1203194"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed36f1497440d681a1a10977a0b5f5ae"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a></td></tr>
<tr class="separator:aed36f1497440d681a1a10977a0b5f5ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b6b084ace42c7992815942eed92212f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a9b6b084ace42c7992815942eed92212f">m_axis</a></td></tr>
<tr class="separator:a9b6b084ace42c7992815942eed92212f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a903d92435272b6b12ab6e7bcaf6fa23c"><td class="memItemLeft" align="right" valign="top">amrex::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a903d92435272b6b12ab6e7bcaf6fa23c">m_fac_cond</a></td></tr>
<tr class="separator:a903d92435272b6b12ab6e7bcaf6fa23c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af97b098dae958c8fc69ec92b6779acf3"><td class="memItemLeft" align="right" valign="top">amrex::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#af97b098dae958c8fc69ec92b6779acf3">m_fac_fus</a></td></tr>
<tr class="separator:af97b098dae958c8fc69ec92b6779acf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94005ac35edcdb59eb0b2f2d18e53425"><td class="memItemLeft" align="right" valign="top">amrex::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a94005ac35edcdb59eb0b2f2d18e53425">m_fac_sub</a></td></tr>
<tr class="separator:a94005ac35edcdb59eb0b2f2d18e53425"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4930ab51ce1a492bdddb2aa1cb001b21"><td class="memItemLeft" align="right" valign="top">amrex::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a4930ab51ce1a492bdddb2aa1cb001b21">m_gOcp</a></td></tr>
<tr class="separator:a4930ab51ce1a492bdddb2aa1cb001b21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8a4391c39d380a1e77105cfbe3d88ac"><td class="memItemLeft" align="right" valign="top">amrex::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#ad8a4391c39d380a1e77105cfbe3d88ac">m_rdOcp</a></td></tr>
<tr class="separator:ad8a4391c39d380a1e77105cfbe3d88ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71131fbedee0de3f7bc4abfd339921e9"><td class="memItemLeft" align="right" valign="top">amrex::MultiFab *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a71131fbedee0de3f7bc4abfd339921e9">m_z_phys_nd</a></td></tr>
<tr class="separator:a71131fbedee0de3f7bc4abfd339921e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88d75ccdce5c7a7de7033c7ceb2fed41"><td class="memItemLeft" align="right" valign="top">amrex::MultiFab *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a88d75ccdce5c7a7de7033c7ceb2fed41">m_detJ_cc</a></td></tr>
<tr class="separator:a88d75ccdce5c7a7de7033c7ceb2fed41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade405c635b58955a140d38af3b06e6aa"><td class="memItemLeft" align="right" valign="top">amrex::Array&lt; <a class="el" href="classMorrison.html#aeb27c9fd26acdb5c0ada38bef3763b6d">FabPtr</a>, <a class="el" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0acf4ab6355daf2584b0bb61fd45c79511">MicVar_Morr::NumVars</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a></td></tr>
<tr class="separator:ade405c635b58955a140d38af3b06e6aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5df21d7c7adfd10586783871524fac4"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#aa5df21d7c7adfd10586783871524fac4">accrrc</a></td></tr>
<tr class="separator:aa5df21d7c7adfd10586783871524fac4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e5363db069243651289087f05115fcd"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a9e5363db069243651289087f05115fcd">accrsi</a></td></tr>
<tr class="separator:a9e5363db069243651289087f05115fcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3f26a0a44abe58527b22336648d8e56"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#af3f26a0a44abe58527b22336648d8e56">accrsc</a></td></tr>
<tr class="separator:af3f26a0a44abe58527b22336648d8e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96fb0e34b50bf691859ca0434b594b2e"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a96fb0e34b50bf691859ca0434b594b2e">coefice</a></td></tr>
<tr class="separator:a96fb0e34b50bf691859ca0434b594b2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9054cb36d2b174d1033972de065b37b"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#ac9054cb36d2b174d1033972de065b37b">evaps1</a></td></tr>
<tr class="separator:ac9054cb36d2b174d1033972de065b37b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0b73c861dc791272e1ac6d781d72562"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#ad0b73c861dc791272e1ac6d781d72562">evaps2</a></td></tr>
<tr class="separator:ad0b73c861dc791272e1ac6d781d72562"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a540699586b918c354be6e8347fbbd83c"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a540699586b918c354be6e8347fbbd83c">accrgi</a></td></tr>
<tr class="separator:a540699586b918c354be6e8347fbbd83c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e4e4de3f0961b43f5972bc78c964d38"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a5e4e4de3f0961b43f5972bc78c964d38">accrgc</a></td></tr>
<tr class="separator:a5e4e4de3f0961b43f5972bc78c964d38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae5e0add59ee0f17b03518b5888d0a61"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#aae5e0add59ee0f17b03518b5888d0a61">evapg1</a></td></tr>
<tr class="separator:aae5e0add59ee0f17b03518b5888d0a61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a186c1ded94acbad74e980303e9867a61"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a186c1ded94acbad74e980303e9867a61">evapg2</a></td></tr>
<tr class="separator:a186c1ded94acbad74e980303e9867a61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdd637dd50f94ad624ad86ec6bed76d8"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#abdd637dd50f94ad624ad86ec6bed76d8">evapr1</a></td></tr>
<tr class="separator:abdd637dd50f94ad624ad86ec6bed76d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeeb1fc95ab35c46faf404d62d505108e"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#aeeb1fc95ab35c46faf404d62d505108e">evapr2</a></td></tr>
<tr class="separator:aeeb1fc95ab35c46faf404d62d505108e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae08598f7fe3990c39c84b9222d3a8cdb"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#ae08598f7fe3990c39c84b9222d3a8cdb">rho1d</a></td></tr>
<tr class="separator:ae08598f7fe3990c39c84b9222d3a8cdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46d87d763b7db8aa5e9c9e1d8ed40ac2"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a46d87d763b7db8aa5e9c9e1d8ed40ac2">pres1d</a></td></tr>
<tr class="separator:a46d87d763b7db8aa5e9c9e1d8ed40ac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a625091bf149aa3bd952e50b9b438681d"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a625091bf149aa3bd952e50b9b438681d">tabs1d</a></td></tr>
<tr class="separator:a625091bf149aa3bd952e50b9b438681d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7430923cd0f47c37a3251286bc68a5dc"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a7430923cd0f47c37a3251286bc68a5dc">qt1d</a></td></tr>
<tr class="separator:a7430923cd0f47c37a3251286bc68a5dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d0b90f78d6e626e91fb286fd4b1bbb8"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a8d0b90f78d6e626e91fb286fd4b1bbb8">qv1d</a></td></tr>
<tr class="separator:a8d0b90f78d6e626e91fb286fd4b1bbb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28bcd44d952e8e94b71d198dbaf29ffb"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a28bcd44d952e8e94b71d198dbaf29ffb">qn1d</a></td></tr>
<tr class="separator:a28bcd44d952e8e94b71d198dbaf29ffb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8be05adcddf26645e0afe16f7fd7959b"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a8be05adcddf26645e0afe16f7fd7959b">gamaz</a></td></tr>
<tr class="separator:a8be05adcddf26645e0afe16f7fd7959b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47672a46dbf0d5919e8a4575a9bf2b21"><td class="memItemLeft" align="right" valign="top">amrex::TableData&lt; amrex::Real, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a47672a46dbf0d5919e8a4575a9bf2b21">zmid</a></td></tr>
<tr class="separator:a47672a46dbf0d5919e8a4575a9bf2b21"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a5c8fa0f20176eac476a6a0a3fc95de37"><td class="memItemLeft" align="right" valign="top">static constexpr amrex::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMorrison.html#a5c8fa0f20176eac476a6a0a3fc95de37">CFL_MAX</a> = 0.5</td></tr>
<tr class="separator:a5c8fa0f20176eac476a6a0a3fc95de37"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Typedef Documentation</h2>
<a id="aeb27c9fd26acdb5c0ada38bef3763b6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb27c9fd26acdb5c0ada38bef3763b6d">&#9670;&nbsp;</a></span>FabPtr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classMorrison.html#aeb27c9fd26acdb5c0ada38bef3763b6d">Morrison::FabPtr</a> =  std::shared_ptr&lt;amrex::MultiFab&gt;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a13a8f76ec153a1ac3536a0291b591e08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13a8f76ec153a1ac3536a0291b591e08">&#9670;&nbsp;</a></span>Morrison()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Morrison::Morrison </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0a0f44390b82e965df1a69296676495b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a0f44390b82e965df1a69296676495b">&#9670;&nbsp;</a></span>~Morrison()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual Morrison::~Morrison </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a14321f6398d7555cc4bcb02dae4b0be1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14321f6398d7555cc4bcb02dae4b0be1">&#9670;&nbsp;</a></span>Advance()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Advance </td>
          <td>(</td>
          <td class="paramtype">const amrex::Real &amp;&#160;</td>
          <td class="paramname"><em>dt_advance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSolverChoice.html">SolverChoice</a> &amp;&#160;</td>
          <td class="paramname"><em>sc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#aa2f97dcd622bc4ef212421d496ee2297">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment">// Store timestep</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        amrex::Real dt = dt_advance;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment">// Loop through the grids</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">for</span> (amrex::MFIter mfi(*<a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a786bbec2d1f95dad377cda134055cda1">MicVar_Morr::qcl</a>],<a class="code" href="ERF__TileNoZ_8H.html#a8da113f1d5603f7297fe1d03e5013f00">TileNoZ</a>()); mfi.isValid(); ++mfi)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          <span class="keyword">const</span> amrex::Box&amp; box = mfi.tilebox();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;          <span class="comment">// Get array data from class member variables</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; theta_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7f3916bd057e43e125de3cbef18bcad3">MicVar_Morr::theta</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qv_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a27ed8ba8d37ae85125221394270eceaf">MicVar_Morr::qv</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qcl_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a786bbec2d1f95dad377cda134055cda1">MicVar_Morr::qcl</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qpr_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab77c2781abdd9ebaa8b4cc3b271b57aa">MicVar_Morr::qpr</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qci_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0abdf878ba9b9f2644fa4354fbd6775d89">MicVar_Morr::qci</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qps_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0aa1b82f9b40da8ffccead09f9e102ff82">MicVar_Morr::qps</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qpg_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a434cf2c831802bb076e8bc31d16f0887">MicVar_Morr::qpg</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ni_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a9021df498ba0043b1ac9ecf05f45c584">MicVar_Morr::ni</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          [[maybe_unused]] <span class="keyword">auto</span> <span class="keyword">const</span>&amp; nc_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a32b6a00f33c7394555eff62ce6457bc6">MicVar_Morr::nc</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ns_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a92a76bfaaf4385e0d2051d0124f254ea">MicVar_Morr::ns</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; nr_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a6764e4c83976308b665ab846e77b53b0">MicVar_Morr::nr</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ng_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a281c2ff050bdb2a9349d3408926af821">MicVar_Morr::ng</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          [[maybe_unused]] <span class="keyword">auto</span> <span class="keyword">const</span>&amp; rho_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab60d6bdceb03bf869685c46558bcbe89">MicVar_Morr::rho</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; pres_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">MicVar_Morr::pres</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          [[maybe_unused]] <span class="keyword">auto</span> <span class="keyword">const</span>&amp; tabs_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">MicVar_Morr::tabs</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; rain_accum_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ad5e247bb2905b3b4a81c6487da6e0e45">MicVar_Morr::rain_accum</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; snow_accum_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0af0a4b2d254cb85c987d8c9a64a592e50">MicVar_Morr::snow_accum</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; graup_accum_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab593766917aa9a7d6accf04b88139545">MicVar_Morr::graup_accum</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; w_arr = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a93264ee6dc9b23e994674a68250a2f16">MicVar_Morr::omega</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          <span class="comment">// Get radar reflectivity array if radar diagnostics enabled</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          <span class="comment">//        auto const&amp; refl_arr = m_do_radar_ref ? m_radar-&gt;array(mfi) : nullptr;</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          <span class="comment">//        auto const&amp; refl_arr = m_radar-&gt;array(mfi);</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          <span class="comment">// Extract box dimensions</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> ilo = box.loVect()[0];</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> ihi = box.hiVect()[0];</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> jlo = box.loVect()[1];</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> jhi = box.hiVect()[1];</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> klo = box.loVect()[2];</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> khi = box.hiVect()[2];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          amrex::Box grown_box(box); grown_box.grow(3);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="preprocessor">#ifdef ERF_USE_MORR_FORT</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> ilom = grown_box.loVect()[0];</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> ihim = grown_box.hiVect()[0];</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> jlom = grown_box.loVect()[1];</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> jhim = grown_box.hiVect()[1];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> klom = grown_box.loVect()[2];</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">int</span> khim = grown_box.hiVect()[2];</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;          <span class="comment">// Calculate Exner function (PII) to convert potential temperature to temperature</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;          <span class="comment">// PII = (P/P0)^(R/cp)</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          FArrayBox pii_fab(grown_box, 1);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; pii_arr = pii_fab.array();</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;          <span class="keyword">const</span> amrex::Real <a class="code" href="namespacemodule__model__constants.html#a2dcccd992b668c86eecdd9a825970d4a">p0</a> = 100000.0; <span class="comment">// Reference pressure (Pa)</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;          <span class="keyword">const</span> amrex::Real rdcp = <a class="code" href="classMorrison.html#ad8a4391c39d380a1e77105cfbe3d88ac">m_rdOcp</a>; <span class="comment">// R/cp ratio</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          <span class="comment">// Calculate Exner function</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;          ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="comment">// NOTE: the Morrison Fortran version uses Pa not hPa so we didn&#39;t divide p by 100</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="comment">//       so we don&#39;t need to multiply by 100 here</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            pii_arr(i,j,k) = std::pow((pres_arr(i,j,k)) / <a class="code" href="namespacemodule__model__constants.html#a2dcccd992b668c86eecdd9a825970d4a">p0</a>, rdcp);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          });</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          <span class="comment">// Create arrays for height differences (dz)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          FArrayBox dz_fab(grown_box, 1);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dz_arr = dz_fab.array();</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          <span class="comment">// Calculate height differences</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          <span class="keyword">const</span> amrex::Real dz_val = <a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a>.CellSize(<a class="code" href="classMorrison.html#a9b6b084ace42c7992815942eed92212f">m_axis</a>);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;          ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            dz_arr(i,j,k) = dz_val;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          });</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;          amrex::Box grown_boxD(grown_box); grown_boxD.makeSlab(2,0);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;          <span class="comment">// Arrays to store precipitation rates</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          FArrayBox    rainncv_fab(grown_boxD, 1);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;          FArrayBox         sr_fab(grown_boxD, 1);     <span class="comment">// Ratio of snow to total precipitation</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;          FArrayBox    snowncv_fab(grown_boxD, 1);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;          FArrayBox graupelncv_fab(grown_boxD, 1);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; rainncv_arr = rainncv_fab.array();</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; sr_arr = sr_fab.array();</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; snowncv_arr = snowncv_fab.array();</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; graupelncv_arr = graupelncv_fab.array();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          <span class="comment">// Initialize precipitation rate arrays to zero</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;          ParallelFor(grown_boxD, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            rainncv_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            sr_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            snowncv_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            graupelncv_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          });</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;          <span class="comment">// Create terrain height array (not actually used by Morrison scheme)</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;          FArrayBox ht_fab(amrex::Box(amrex::IntVect(ilo, jlo, 0), amrex::IntVect(ihi, jhi, 0)), 1);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;          [[maybe_unused]] <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ht_arr = ht_fab.array();</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;          ParallelFor(amrex::Box(amrex::IntVect(ilo, jlo, 0), amrex::IntVect(ihi, jhi, 0)), [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            ht_arr(i,j,k) = 0.0;  <span class="comment">// Not used by Morrison scheme</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          });</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;          <span class="comment">// Create dummy arrays for cumulus tendencies (if needed)</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;          FArrayBox qrcuten_fab(grown_box, 1);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;          FArrayBox qscuten_fab(grown_box, 1);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;          FArrayBox qicuten_fab(grown_box, 1);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qrcuten_arr = qrcuten_fab.array();</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qscuten_arr = qscuten_fab.array();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qicuten_arr = qicuten_fab.array();</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;          <span class="comment">// Initialize tendencies to zero (no cumulus parameterization in this example)</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;          ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            qrcuten_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            qscuten_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            qicuten_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          });</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">#ifdef ERF_USE_MORR_FORT</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          <span class="comment">// WRF-Chem related variables (optional)</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;          <span class="keywordtype">bool</span> flag_qndrop = <span class="keyword">false</span>;  <span class="comment">// Flag to indicate droplet number prediction</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          <span class="comment">// Now create arrays for other optional variables</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;          FArrayBox rainprod_fab(grown_box, 1);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          FArrayBox evapprod_fab(grown_box, 1);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          FArrayBox qlsink_fab(grown_box, 1);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          FArrayBox precr_fab(grown_box, 1);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          FArrayBox preci_fab(grown_box, 1);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          FArrayBox precs_fab(grown_box, 1);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          FArrayBox precg_fab(grown_box, 1);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; rainprod_arr = rainprod_fab.array();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; evapprod_arr = evapprod_fab.array();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qlsink_arr = qlsink_fab.array();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; precr_arr = precr_fab.array();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; preci_arr = preci_fab.array();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; precs_arr = precs_fab.array();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; precg_arr = precg_fab.array();</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          <span class="comment">// Initialize WRF-Chem arrays to zero</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            rainprod_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            evapprod_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            qlsink_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            precr_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            preci_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            precs_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            precg_arr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          });</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;          <span class="comment">// Create FArrayBox for slope parameters and PSD variables</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          FArrayBox lamc_fab(grown_box, 1);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;          FArrayBox lami_fab(grown_box, 1);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;          FArrayBox lams_fab(grown_box, 1);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;          FArrayBox lamr_fab(grown_box, 1);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;          FArrayBox lamg_fab(grown_box, 1);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;          FArrayBox cdist1_fab(grown_box, 1);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;          FArrayBox n0i_fab(grown_box, 1);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          FArrayBox n0s_fab(grown_box, 1);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;          FArrayBox n0r_fab(grown_box, 1);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;          FArrayBox n0g_fab(grown_box, 1);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          FArrayBox pgam_fab(grown_box, 1);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;          <span class="comment">// Get Array4 objects for each parameter</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; lamc = lamc_fab.array();</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; lami = lami_fab.array();</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; lams = lams_fab.array();</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; lamr = lamr_fab.array();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; lamg = lamg_fab.array();</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; cdist1 = cdist1_fab.array();</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; n0i = n0i_fab.array();</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; n0s = n0s_fab.array();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; n0r = n0r_fab.array();</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; n0g = n0g_fab.array();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span>&amp; pgam = pgam_fab.array();</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;          <span class="comment">// Initialize all values to zero</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;          ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            lamc(i,j,k) = 0.0;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            lami(i,j,k) = 0.0;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            lams(i,j,k) = 0.0;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            lamr(i,j,k) = 0.0;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            lamg(i,j,k) = 0.0;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            cdist1(i,j,k) = 0.0;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            n0i(i,j,k) = 0.0;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            n0s(i,j,k) = 0.0;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            n0r(i,j,k) = 0.0;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            n0g(i,j,k) = 0.0;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            pgam(i,j,k) = 0.0;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          });</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="preprocessor">#ifdef ERF_USE_MORR_FORT</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <span class="comment">// Prepare data pointers for Fortran call</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          <span class="comment">// These would be passed directly to the Fortran interface</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          <span class="keywordtype">double</span> dummy_reflectivity = 0.0;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          <span class="keywordtype">double</span>* dummy_reflectivity_ptr = &amp;dummy_reflectivity;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          <span class="comment">// Example call (pseudo-code - actual interface would depend on your Fortran interop setup)</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          <span class="comment">// Microphysics options/switches</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;          <span class="keywordtype">int</span> m_iact = 2;    <span class="comment">// CCN activation option (1: power-law, 2: lognormal aerosol)</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          <span class="keywordtype">int</span> m_inum = 1;    <span class="comment">// Droplet number option (0: predict, 1: constant)</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          <span class="keywordtype">int</span> m_iliq = 0;    <span class="comment">// Liquid-only option (0: include ice, 1: liquid only)</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          <span class="keywordtype">int</span> m_inuc = 0;    <span class="comment">// Ice nucleation option (0: mid-latitude, 1: arctic)</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          [[maybe_unused]] <span class="keywordtype">int</span> m_ibase = 2;   <span class="comment">// Cloud base activation option</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;          [[maybe_unused]] <span class="keywordtype">int</span> m_isub = 0;    <span class="comment">// Sub-grid vertical velocity option</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          <span class="keywordtype">int</span> m_igraup = 0;  <span class="comment">// Graupel option (0: include graupel, 1: no graupel)</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          <span class="keywordtype">int</span> m_ihail = 0;   <span class="comment">// Graupel/hail option (0: graupel, 1: hail)</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;          <span class="keywordflow">if</span>(sc.<a class="code" href="structSolverChoice.html#aacbfbe6f4a3040db3efdc6dbf8fa291b">moisture_type</a> == MoistureType::Morrison_NoIce) {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            m_iliq = 1;    <span class="comment">// Liquid-only option (0: include ice, 1: liquid only)</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            m_inuc = 0;    <span class="comment">// Ice nucleation option (0: mid-latitude, 1: arctic)</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            m_ibase = 2;   <span class="comment">// Cloud base activation option</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            m_isub = 0;    <span class="comment">// Sub-grid vertical velocity option</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            m_igraup = 1;  <span class="comment">// Graupel option (0: include graupel, 1: no graupel)</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            m_ihail = 0;   <span class="comment">// Graupel/hail option (0: graupel, 1: hail)</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          [[maybe_unused]] <span class="keywordtype">bool</span> m_do_radar_ref = <span class="keyword">false</span>;  <span class="comment">// Radar reflectivity calculation flag</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          <span class="comment">// Physical constants</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;          amrex::Real m_pi;          <span class="comment">// Pi constant</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;          amrex::Real m_R;           <span class="comment">// Gas constant for dry air (J/kg/K)</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;          amrex::Real m_Rd;           <span class="comment">// Gas constant for dry air (J/kg/K)</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;          amrex::Real m_Rv;          <span class="comment">// Gas constant for water vapor (J/kg/K)</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          [[maybe_unused]] amrex::Real m_cp;          <span class="comment">// Specific heat at constant pressure (J/kg/K)</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          amrex::Real m_g;           <span class="comment">// Gravitational acceleration (m/s^2)</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          amrex::Real m_ep_2;        <span class="comment">// Molecular weight ratio (Rd/Rv)</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          <span class="comment">// Reference density and species densities</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          amrex::Real m_rhosu;       <span class="comment">// Standard air density at 850 mb (kg/m^3)</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          amrex::Real m_rhow;        <span class="comment">// Density of liquid water (kg/m^3)</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;          amrex::Real m_rhoi;        <span class="comment">// Bulk density of cloud ice (kg/m^3)</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          amrex::Real m_rhosn;       <span class="comment">// Bulk density of snow (kg/m^3)</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          amrex::Real m_rhog;        <span class="comment">// Bulk density of graupel/hail (kg/m^3)</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          <span class="comment">// Fall speed parameters (V=AD^B)</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;          amrex::Real m_ai, m_bi;    <span class="comment">// Cloud ice fall speed parameters</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          [[maybe_unused]] amrex::Real m_ac, m_bc;    <span class="comment">// Cloud droplet fall speed parameters</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;          amrex::Real m_as, m_bs;    <span class="comment">// Snow fall speed parameters</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          amrex::Real m_ar, m_br;    <span class="comment">// Rain fall speed parameters</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          amrex::Real m_ag, m_bg;    <span class="comment">// Graupel/hail fall speed parameters</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          <span class="comment">// Microphysical parameters</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          amrex::Real m_aimm;        <span class="comment">// Parameter in Bigg immersion freezing</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;          amrex::Real m_bimm;        <span class="comment">// Parameter in Bigg immersion freezing</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          amrex::Real m_ecr;         <span class="comment">// Collection efficiency between droplets/rain and snow/rain</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          amrex::Real m_dcs;         <span class="comment">// Threshold size for cloud ice autoconversion (m)</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;          amrex::Real m_mi0;         <span class="comment">// Initial mass of nucleated ice crystal (kg)</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;          amrex::Real m_mg0;         <span class="comment">// Mass of embryo graupel (kg)</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          amrex::Real m_f1s;         <span class="comment">// Ventilation parameter for snow</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          amrex::Real m_f2s;         <span class="comment">// Ventilation parameter for snow</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          amrex::Real m_f1r;         <span class="comment">// Ventilation parameter for rain</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          amrex::Real m_f2r;         <span class="comment">// Ventilation parameter for rain</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          amrex::Real m_qsmall;      <span class="comment">// Smallest allowed hydrometeor mixing ratio</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          amrex::Real m_eii;         <span class="comment">// Collection efficiency, ice-ice collisions</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          amrex::Real m_eci;         <span class="comment">// Collection efficiency, ice-droplet collisions</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          amrex::Real m_cpw;         <span class="comment">// Specific heat of liquid water (J/kg/K)</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;          amrex::Real m_rin;         <span class="comment">// Radius of contact nuclei (m)</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          amrex::Real m_mmult;       <span class="comment">// Mass of splintered ice particle (kg)</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="comment">// Size distribution parameters</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          amrex::Real m_ci, m_di;    <span class="comment">// Cloud ice size distribution parameters</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          amrex::Real m_cs, m_ds;    <span class="comment">// Snow size distribution parameters</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          amrex::Real m_cg, m_dg;    <span class="comment">// Graupel size distribution parameters</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          <span class="comment">// Lambda limits for size distributions</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          amrex::Real m_lammaxi, m_lammini;    <span class="comment">// Cloud ice lambda limits</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          amrex::Real m_lammaxr, m_lamminr;    <span class="comment">// Rain lambda limits</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          amrex::Real m_lammaxs, m_lammins;    <span class="comment">// Snow lambda limits</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          amrex::Real m_lammaxg, m_lamming;    <span class="comment">// Graupel lambda limits</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          <span class="comment">// Constant droplet concentration (if INUM = 1)</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          amrex::Real m_ndcnst = 250.0;  <span class="comment">// Droplet number concentration (cm^-3)</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          <span class="comment">// CCN spectra parameters (for IACT = 1)</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          [[maybe_unused]] amrex::Real m_k1;          <span class="comment">// Exponent in CCN activation formula</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          [[maybe_unused]] amrex::Real m_c1;          <span class="comment">// Coefficient in CCN activation formula (cm^-3)</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          <span class="comment">// Aerosol activation parameters (for IACT = 2)</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          [[maybe_unused]] amrex::Real m_mw;          <span class="comment">// Molecular weight water (kg/mol)</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;          [[maybe_unused]] amrex::Real m_osm;         <span class="comment">// Osmotic coefficient</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;          [[maybe_unused]] amrex::Real m_vi;          <span class="comment">// Number of ions dissociated in solution</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;          [[maybe_unused]] amrex::Real m_epsm;        <span class="comment">// Aerosol soluble fraction</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          [[maybe_unused]] amrex::Real m_rhoa;        <span class="comment">// Aerosol bulk density (kg/m^3)</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;          [[maybe_unused]] amrex::Real m_map;         <span class="comment">// Molecular weight aerosol (kg/mol)</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;          [[maybe_unused]] amrex::Real m_ma;          <span class="comment">// Molecular weight of air (kg/mol)</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          [[maybe_unused]] amrex::Real m_rr;          <span class="comment">// Universal gas constant (J/mol/K)</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          [[maybe_unused]] amrex::Real m_bact;        <span class="comment">// Activation parameter</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;          [[maybe_unused]] amrex::Real m_rm1;         <span class="comment">// Geometric mean radius, mode 1 (m)</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;          [[maybe_unused]] amrex::Real m_rm2;         <span class="comment">// Geometric mean radius, mode 2 (m)</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;          amrex::Real m_nanew1;      <span class="comment">// Total aerosol concentration, mode 1 (m^-3)</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          amrex::Real m_nanew2;      <span class="comment">// Total aerosol concentration, mode 2 (m^-3)</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          [[maybe_unused]] amrex::Real m_sig1;        <span class="comment">// Standard deviation of aerosol dist, mode 1</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          [[maybe_unused]] amrex::Real m_sig2;        <span class="comment">// Standard deviation of aerosol dist, mode 2</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;          [[maybe_unused]] amrex::Real m_f11;         <span class="comment">// Correction factor for activation, mode 1</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          [[maybe_unused]] amrex::Real m_f12;         <span class="comment">// Correction factor for activation, mode 1</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;          [[maybe_unused]] amrex::Real m_f21;         <span class="comment">// Correction factor for activation, mode 2</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;          [[maybe_unused]] amrex::Real m_f22;         <span class="comment">// Correction factor for activation, mode 2</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;          <span class="comment">// Precomputed constants for efficiency</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          amrex::Real m_cons1, m_cons2, m_cons3, m_cons4, m_cons5;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;          amrex::Real m_cons6, m_cons7, m_cons8, m_cons9, m_cons10;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;          amrex::Real m_cons11, m_cons12, m_cons13, m_cons14, m_cons15;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          amrex::Real m_cons16, m_cons17, m_cons18, m_cons19, m_cons20;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;          amrex::Real m_cons21, m_cons22, m_cons23, m_cons24, m_cons25;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          amrex::Real m_cons26, m_cons27, m_cons28, m_cons29; [[maybe_unused]] amrex::Real m_cons30;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;          amrex::Real m_cons31, m_cons32, m_cons34, m_cons35; [[maybe_unused]] amrex::Real m_cons33;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          amrex::Real m_cons36, m_cons37, m_cons38, m_cons39, m_cons40;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          amrex::Real m_cons41;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;          <span class="comment">// Set microphysics control parameters</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;          m_inum = 1;           <span class="comment">// Use constant droplet number concentration</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;          m_ndcnst = 250.0;     <span class="comment">// Droplet number concentration (cm^-3)</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          <span class="comment">// Mathematical constants</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          m_pi = 3.1415926535897932384626434;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;          m_R = 287.0;         <span class="comment">// Gas constant for dry air (J/kg/K)</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          m_Rd = 287.0;         <span class="comment">// Gas constant for dry air (J/kg/K)</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          m_Rv = 461.6;        <span class="comment">// Gas constant for water vapor (J/kg/K)</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          m_cp = 7.0*287.0/2.0;        <span class="comment">// Specific heat at constant pressure (J/kg/K)</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;          m_g = 9.81;           <span class="comment">// Gravitational acceleration (m/s^2)</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;          m_ep_2 = m_Rd / m_Rv;     <span class="comment">// Molecular weight ratio (Rd/Rv)</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          <span class="comment">// Reference density</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;          m_rhosu = 85000.0/(287.15*273.15);  <span class="comment">// Standard air density at 850 mb (kg/m^3)</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          <span class="comment">// Densities for different hydrometeor species</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;          m_rhow = 997.0;     <span class="comment">// Density of liquid water (kg/m^3)</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          m_rhoi = 500.0;     <span class="comment">// Bulk density of cloud ice (kg/m^3)</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          m_rhosn = 100.0;    <span class="comment">// Bulk density of snow (kg/m^3)</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;          <span class="comment">// Set density for graupel or hail based on configuration</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;          <span class="keywordflow">if</span> (m_ihail == 0) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            m_rhog = 400.0; <span class="comment">// Bulk density of graupel (kg/m^3)</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            m_rhog = 900.0; <span class="comment">// Bulk density of hail (kg/m^3)</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;          <span class="comment">// Fall speed parameters (V=AD^B) for different hydrometeors</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          <span class="comment">// Cloud ice</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          m_ai = 700.0;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          m_bi = 1.0;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;          <span class="comment">// Cloud droplets</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;          m_ac = 3.0E7;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;          m_bc = 2.0;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          <span class="comment">// Snow</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;          m_as = 11.72;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;          m_bs = 0.41;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          <span class="comment">// Rain</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;          m_ar = 841.99667;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          m_br = 0.8;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;          <span class="comment">// Graupel/hail (dependent on configuration)</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;          <span class="keywordflow">if</span> (m_ihail == 0) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="comment">// Graupel parameters</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            m_ag = 19.3;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            m_bg = 0.37;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="comment">// Hail parameters (Matsun and Huggins 1980)</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            m_ag = 114.5;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            m_bg = 0.5;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;          <span class="comment">// Microphysical parameters</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          m_aimm = 0.66;       <span class="comment">// Parameter in Bigg immersion freezing</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;          m_bimm = 100.0;      <span class="comment">// Parameter in Bigg immersion freezing</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;          m_ecr = 1.0;         <span class="comment">// Collection efficiency between rain and snow/graupel</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          m_dcs = 125.0E-6;    <span class="comment">// Threshold size for cloud ice autoconversion (m)</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          m_mi0 = 4.0/3.0*m_pi*m_rhoi*std::pow(10.0E-6, 3);  <span class="comment">// Initial mass of nucleated ice crystal (kg)</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          m_mg0 = 1.6E-10;     <span class="comment">// Mass of embryo graupel (kg)</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          <span class="comment">// Ventilation parameters</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          m_f1s = 0.86;        <span class="comment">// Ventilation parameter for snow</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          m_f2s = 0.28;        <span class="comment">// Ventilation parameter for snow</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          m_f1r = 0.78;        <span class="comment">// Ventilation parameter for rain</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          m_f2r = 0.308;       <span class="comment">// Ventilation parameter for rain</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;          <span class="comment">// Smallest allowed hydrometeor mixing ratio</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          m_qsmall = 1.0E-14;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          <span class="comment">// Collection efficiencies</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;          m_eii = 0.1;         <span class="comment">// Ice-ice collision efficiency</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;          m_eci = 0.7;         <span class="comment">// Ice-droplet collision efficiency</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          <span class="comment">// Specific heat of liquid water (J/kg/K)</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          m_cpw = 4187.0;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          <span class="comment">// Size distribution parameters</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;          m_ci = m_rhoi * m_pi / 6.0;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          m_di = 3.0;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;          m_cs = m_rhosn * m_pi / 6.0;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          m_ds = 3.0;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          m_cg = m_rhog * m_pi / 6.0;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          m_dg = 3.0;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          <span class="comment">// Radius of contact nuclei (m)</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;          m_rin = 0.1E-6;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;          <span class="comment">// Mass of splintered ice particle (kg)</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;          m_mmult = 4.0/3.0*m_pi*m_rhoi*std::pow(5.0E-6, 3);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          <span class="comment">// Set lambda limits for size distributions</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;          <span class="comment">// Maximum and minimum values for lambda parameter in size distributions</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;          m_lammaxi = 1.0/1.0E-6;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          m_lammini = 1.0/(2.0*m_dcs + 100.0E-6);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;          m_lammaxr = 1.0/20.0E-6;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;          m_lamminr = 1.0/2800.0E-6;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          m_lammaxs = 1.0/10.0E-6;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          m_lammins = 1.0/2000.0E-6;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;          m_lammaxg = 1.0/20.0E-6;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          m_lamming = 1.0/2000.0E-6;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          <span class="comment">// Set CCN parameters for different environments</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;          <span class="keywordflow">if</span> (m_iact == 1) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="comment">// Maritime CCN spectrum parameters (modified from Rasmussen et al. 2002)</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            <span class="comment">// NCCN = C*S^K, where S is supersaturation in %</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            m_k1 = 0.4;        <span class="comment">// Exponent in CCN activation formula</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            m_c1 = 120.0;      <span class="comment">// Coefficient in CCN activation formula (cm^-3)</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;          }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;          <span class="comment">// Initialize aerosol activation parameters for lognormal distribution</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;          <span class="keywordflow">if</span> (m_iact == 2) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="comment">// Parameters for ammonium sulfate</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            m_mw = 0.018;      <span class="comment">// Molecular weight of water (kg/mol)</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            m_osm = 1.0;       <span class="comment">// Osmotic coefficient</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            m_vi = 3.0;        <span class="comment">// Number of ions dissociated in solution</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            m_epsm = 0.7;      <span class="comment">// Aerosol soluble fraction</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            m_rhoa = 1777.0;   <span class="comment">// Aerosol bulk density (kg/m^3)</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            m_map = 0.132;     <span class="comment">// Molecular weight of aerosol (kg/mol)</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            m_ma = 0.0284;     <span class="comment">// Molecular weight of air (kg/mol)</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            m_rr = 8.3145;     <span class="comment">// Universal gas constant (J/mol/K)</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            m_bact = m_vi * m_osm * m_epsm * m_mw * m_rhoa / (m_map * m_rhow);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <span class="comment">//            m_a_w = 2.0 * m_mw * 0.0761 / (m_rhow * m_r_v * 293.15);  // &quot;A&quot; parameter</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="comment">// Aerosol size distribution parameters for MPACE (Morrison et al. 2007, JGR)</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="comment">// Mode 1</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            m_rm1 = 0.052E-6;  <span class="comment">// Geometric mean radius, mode 1 (m)</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            m_sig1 = 2.04;     <span class="comment">// Standard deviation of aerosol size distribution, mode 1</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            m_nanew1 = 72.2E6; <span class="comment">// Total aerosol concentration, mode 1 (m^-3)</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            m_f11 = 0.5 * std::exp(2.5 * std::pow(std::log(m_sig1), 2));</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            m_f21 = 1.0 + 0.25 * std::log(m_sig1);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="comment">// Mode 2</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            m_rm2 = 1.3E-6;    <span class="comment">// Geometric mean radius, mode 2 (m)</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            m_sig2 = 2.5;      <span class="comment">// Standard deviation of aerosol size distribution, mode 2</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            m_nanew2 = 1.8E6;  <span class="comment">// Total aerosol concentration, mode 2 (m^-3)</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            m_f12 = 0.5 * std::exp(2.5 * std::pow(std::log(m_sig2), 2));</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            m_f22 = 1.0 + 0.25 * std::log(m_sig2);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;          }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;          <span class="comment">// Precompute constants for efficiency</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;          m_cons1 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1.0 + m_ds) * m_cs;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          m_cons2 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1.0 + m_dg) * m_cg;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;          m_cons3 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(4.0 + m_bs) / 6.0;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;          m_cons4 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(4.0 + m_br) / 6.0;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          m_cons5 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1.0 + m_bs);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;          m_cons6 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1.0 + m_br);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;          m_cons7 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(4.0 + m_bg) / 6.0;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          m_cons8 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1.0 + m_bg);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;          m_cons9 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(5.0/2.0 + m_br/2.0);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;          m_cons10 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(5.0/2.0 + m_bs/2.0);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;          m_cons11 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(5.0/2.0 + m_bg/2.0);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;          m_cons12 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1.0 + m_di) * m_ci;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;          m_cons13 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(m_bs + 3.0) * m_pi / 4.0 * m_eci;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;          m_cons14 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(m_bg + 3.0) * m_pi / 4.0 * m_eci;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          m_cons15 = -1108.0 * m_eii * std::pow(m_pi, (1.0-m_bs)/3.0) *</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            std::pow(m_rhosn, (-2.0-m_bs)/3.0) / (4.0*720.0);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;          m_cons16 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(m_bi + 3.0) * m_pi / 4.0 * m_eci;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;          m_cons17 = 4.0 * 2.0 * 3.0 * m_rhosu * m_pi * m_eci * m_eci *</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(2.0*m_bs + 2.0) / (8.0*(m_rhog-m_rhosn));</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          m_cons18 = m_rhosn * m_rhosn;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;          m_cons19 = m_rhow * m_rhow;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;          m_cons20 = 20.0 * m_pi * m_pi * m_rhow * m_bimm;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;          m_cons21 = 4.0 / (m_dcs * m_rhoi);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;          m_cons22 = m_pi * m_rhoi * std::pow(m_dcs, 3) / 6.0;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;          m_cons23 = m_pi / 4.0 * m_eii * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(m_bs + 3.0);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;          m_cons24 = m_pi / 4.0 * m_ecr * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(m_br + 3.0);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          m_cons25 = m_pi * m_pi / 24.0 * m_rhow * m_ecr * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(m_br + 6.0);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          m_cons26 = m_pi / 6.0 * m_rhow;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;          m_cons27 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1.0 + m_bi);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;          m_cons28 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(4.0 + m_bi) / 6.0;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;          m_cons29 = 4.0/3.0 * m_pi * m_rhow * std::pow(25.0E-6, 3);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;          m_cons30 = 4.0/3.0 * m_pi * m_rhow;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;          m_cons31 = m_pi * m_pi * m_ecr * m_rhosn;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          m_cons32 = m_pi / 2.0 * m_ecr;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;          m_cons33 = m_pi * m_pi * m_ecr * m_rhog;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          m_cons34 = 5.0/2.0 + m_br/2.0;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;          m_cons35 = 5.0/2.0 + m_bs/2.0;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;          m_cons36 = 5.0/2.0 + m_bg/2.0;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          m_cons37 = 4.0 * m_pi * 1.38E-23 / (6.0 * m_pi * m_rin);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          m_cons38 = m_pi * m_pi / 3.0 * m_rhow;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;          m_cons39 = m_pi * m_pi / 36.0 * m_rhow * m_bimm;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;          m_cons40 = m_pi / 6.0 * m_bimm;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          m_cons41 = m_pi * m_pi * m_ecr * m_rhow;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;          <span class="comment">// Set CCN parameters for different environments</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          <span class="keywordflow">if</span> (m_iact == 1) {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="comment">// Maritime CCN spectrum parameters (modified from Rasmussen et al. 2002)</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="comment">// NCCN = C*S^K, where S is supersaturation in %</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            m_k1 = 0.4;        <span class="comment">// Exponent in CCN activation formula</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            m_c1 = 120.0;      <span class="comment">// Coefficient in CCN activation formula (cm^-3)</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;          }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;          <span class="comment">// Initialize aerosol activation parameters for IACT=2</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;          <span class="keywordflow">if</span> (m_iact == 2) {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            <span class="comment">// Parameters for ammonium sulfate</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            m_mw = 0.018;      <span class="comment">// Molecular weight of water (kg/mol)</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            m_osm = 1.0;       <span class="comment">// Osmotic coefficient</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            m_vi = 3.0;        <span class="comment">// Number of ions dissociated in solution</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            m_epsm = 0.7;      <span class="comment">// Aerosol soluble fraction</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            m_rhoa = 1777.0;   <span class="comment">// Aerosol bulk density (kg/m^3)</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            m_map = 0.132;     <span class="comment">// Molecular weight of aerosol (kg/mol)</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            m_ma = 0.0284;     <span class="comment">// Molecular weight of air (kg/mol)</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            m_rr = 8.3145;     <span class="comment">// Universal gas constant (J/mol/K)</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            m_bact = m_vi * m_osm * m_epsm * m_mw * m_rhoa / (m_map * m_rhow);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            <span class="comment">// Aerosol size distribution parameters for MPACE (Morrison et al. 2007, JGR)</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            <span class="comment">// Mode 1</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            m_rm1 = 0.052E-6;  <span class="comment">// Geometric mean radius, mode 1 (m)</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            m_sig1 = 2.04;     <span class="comment">// Standard deviation of aerosol size distribution, mode 1</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            m_nanew1 = 72.2E6; <span class="comment">// Total aerosol concentration, mode 1 (m^-3)</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            m_f11 = 0.5 * std::exp(2.5 * std::pow(std::log(m_sig1), 2));</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            m_f21 = 1.0 + 0.25 * std::log(m_sig1);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="comment">// Mode 2</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            m_rm2 = 1.3E-6;    <span class="comment">// Geometric mean radius, mode 2 (m)</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            m_sig2 = 2.5;      <span class="comment">// Standard deviation of aerosol size distribution, mode 2</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            m_nanew2 = 1.8E6;  <span class="comment">// Total aerosol concentration, mode 2 (m^-3)</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            m_f12 = 0.5 * std::exp(2.5 * std::pow(std::log(m_sig2), 2));</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            m_f22 = 1.0 + 0.25 * std::log(m_sig2);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          <span class="comment">// Set microphysics control parameters</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          m_iact = 2;  <span class="comment">// Lognormal aerosol activation</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          m_inuc = 0;      <span class="comment">// Mid-latitude ice nucleation (Cooper)</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;          <span class="keywordflow">if</span> (sc.<a class="code" href="structSolverChoice.html#aacbfbe6f4a3040db3efdc6dbf8fa291b">moisture_type</a> == MoistureType::Morrison_NoIce) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;              m_iliq = 1;           <span class="comment">// Include ice processes</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;              m_igraup = 1;         <span class="comment">// Include graupel processes</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;              m_iliq = 0;           <span class="comment">// Include ice processes</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;              m_igraup = 0;         <span class="comment">// Include graupel processes</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          m_ihail = 0;          <span class="comment">// Use graupel (0) instead of hail (1)</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          m_isub = 0;           <span class="comment">// Sub-grid vertical velocity option</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;          m_do_radar_ref = <span class="keyword">false</span>; <span class="comment">// Disable radar reflectivity by default</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;          amrex::Box boxD(box); boxD.makeSlab(2,0);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;          ParmParse <a class="code" href="ERF__MicrophysicsUtils_8H.html#ac54f1d17d8842acb42b2312cd353e469">pp</a>(<span class="stringliteral">&quot;erf&quot;</span>);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;          <span class="keywordtype">bool</span> run_morr_cpp = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;          <span class="keywordtype">bool</span> use_morr_cpp_answer = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;          <a class="code" href="ERF__MicrophysicsUtils_8H.html#ac54f1d17d8842acb42b2312cd353e469">pp</a>.query(<span class="stringliteral">&quot;use_morr_cpp_answer&quot;</span>, use_morr_cpp_answer);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;          Print() &lt;&lt; <span class="stringliteral">&quot;use_morr_cpp_answer&quot;</span> &lt;&lt; use_morr_cpp_answer &lt;&lt;std::endl;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;          <span class="keywordtype">bool</span> run_morr_fort = !use_morr_cpp_answer;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;          std::string filename = std::string(<span class="stringliteral">&quot;output_cpp&quot;</span>) + std::to_string(use_morr_cpp_answer) + <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;          <span class="keywordflow">if</span>(run_morr_cpp) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="comment">// Create dummy arrays for tendencies</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            FArrayBox qc3dten_fab(grown_box, 1);   <span class="comment">// CLOUD WATER MIXING RATIO TENDENCY</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            FArrayBox qi3dten_fab(grown_box, 1);   <span class="comment">// CLOUD ICE MIXING RATIO TENDENCY</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            FArrayBox qni3dten_fab(grown_box, 1);  <span class="comment">// SNOW MIXING RATIO TENDENCY</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            FArrayBox qr3dten_fab(grown_box, 1);   <span class="comment">// RAIN MIXING RATIO TENDENCY</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            FArrayBox ni3dten_fab(grown_box, 1);   <span class="comment">// CLOUD ICE NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            FArrayBox ns3dten_fab(grown_box, 1);   <span class="comment">// SNOW NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            FArrayBox nr3dten_fab(grown_box, 1);   <span class="comment">// RAIN NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="comment">// Get array references</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qc3dten = qc3dten_fab.array();    <span class="comment">// CLOUD WATER MIXING RATIO TENDENCY (KG/KG/S)</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qi3dten = qi3dten_fab.array();    <span class="comment">// CLOUD ICE MIXING RATIO TENDENCY (KG/KG/S)</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qni3dten = qni3dten_fab.array();  <span class="comment">// SNOW MIXING RATIO TENDENCY (KG/KG/S)</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qr3dten = qr3dten_fab.array();    <span class="comment">// RAIN MIXING RATIO TENDENCY (KG/KG/S)</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ni3dten = ni3dten_fab.array();    <span class="comment">// CLOUD ICE NUMBER CONCENTRATION (1/KG/S)</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ns3dten = ns3dten_fab.array();    <span class="comment">// SNOW NUMBER CONCENTRATION (1/KG/S)</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; nr3dten = nr3dten_fab.array();    <span class="comment">// RAIN NUMBER CONCENTRATION (1/KG/S)</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            <span class="comment">// Initialize tendencies to zero (no precipitation implemented yet)</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;              qc3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;              qi3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;              qni3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;              qr3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;              ni3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;              ns3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;              nr3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            });</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            <span class="comment">// Create arrays for mixing ratios and number concentrations</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            FArrayBox qc3d_fab(grown_box, 1);    <span class="comment">// CLOUD WATER MIXING RATIO</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            FArrayBox qi3d_fab(grown_box, 1);    <span class="comment">// CLOUD ICE MIXING RATIO</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            FArrayBox qni3d_fab(grown_box, 1);   <span class="comment">// SNOW MIXING RATIO</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            FArrayBox qr3d_fab(grown_box, 1);    <span class="comment">// RAIN MIXING RATIO</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            FArrayBox ni3d_fab(grown_box, 1);    <span class="comment">// CLOUD ICE NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            FArrayBox ns3d_fab(grown_box, 1);    <span class="comment">// SNOW NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            FArrayBox nr3d_fab(grown_box, 1);    <span class="comment">// RAIN NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <span class="comment">// Get array references</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qc3d = qc3d_fab.array();        <span class="comment">// CLOUD WATER MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qi3d = qi3d_fab.array();        <span class="comment">// CLOUD ICE MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qni3d = qni3d_fab.array();      <span class="comment">// SNOW MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qr3d = qr3d_fab.array();        <span class="comment">// RAIN MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ni3d = ni3d_fab.array();        <span class="comment">// CLOUD ICE NUMBER CONCENTRATION (1/KG)</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ns3d = ns3d_fab.array();        <span class="comment">// SNOW NUMBER CONCENTRATION (1/KG)</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; nr3d = nr3d_fab.array();        <span class="comment">// RAIN NUMBER CONCENTRATION (1/KG)</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160; </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="comment">// Initialize mixing ratios and number concentrations to zero</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;              qc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;              qi3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;              qni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;              qr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;              ni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;              ns3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;              nr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            });</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="comment">// Create arrays for temperature, vapor, and pressure variables</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            FArrayBox t3dten_fab(grown_box, 1);    <span class="comment">// TEMPERATURE TENDENCY</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            FArrayBox qv3dten_fab(grown_box, 1);   <span class="comment">// WATER VAPOR MIXING RATIO TENDENCY</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            FArrayBox t3d_fab(grown_box, 1);       <span class="comment">// TEMPERATURE</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            FArrayBox qv3d_fab(grown_box, 1);      <span class="comment">// WATER VAPOR MIXING RATIO</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            FArrayBox pres_fab(grown_box, 1);      <span class="comment">// ATMOSPHERIC PRESSURE</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            FArrayBox dzq_fab(grown_box, 1);       <span class="comment">// DIFFERENCE IN HEIGHT ACROSS LEVEL</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            FArrayBox w3d_fab(grown_box, 1);       <span class="comment">// GRID-SCALE VERTICAL VELOCITY</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            <span class="comment">// WRF-chem variables</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            FArrayBox nc3d_fab(grown_box, 1);      <span class="comment">// CLOUD DROPLET NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            FArrayBox nc3dten_fab(grown_box, 1);   <span class="comment">// CLOUD DROPLET NUMBER CONCENTRATION TENDENCY</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="comment">// Graupel variables</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            FArrayBox qg3dten_fab(grown_box, 1);   <span class="comment">// GRAUPEL MIX RATIO TENDENCY</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            FArrayBox ng3dten_fab(grown_box, 1);   <span class="comment">// GRAUPEL NUMB CONC TENDENCY</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            FArrayBox qg3d_fab(grown_box, 1);      <span class="comment">// GRAUPEL MIX RATIO</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            FArrayBox ng3d_fab(grown_box, 1);      <span class="comment">// GRAUPEL NUMBER CONC</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="comment">// Sedimentation tendencies</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            FArrayBox qgsten_fab(grown_box, 1);    <span class="comment">// GRAUPEL SED TEND</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            FArrayBox qrsten_fab(grown_box, 1);    <span class="comment">// RAIN SED TEND</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            FArrayBox qisten_fab(grown_box, 1);    <span class="comment">// CLOUD ICE SED TEND</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            FArrayBox qnisten_fab(grown_box, 1);   <span class="comment">// SNOW SED TEND</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            FArrayBox qcsten_fab(grown_box, 1);    <span class="comment">// CLOUD WAT SED TEND</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            <span class="comment">// Cumulus tendencies</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            FArrayBox qrcu1d_fab(grown_box, 1);    <span class="comment">// RAIN FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            FArrayBox qscu1d_fab(grown_box, 1);    <span class="comment">// SNOW FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            FArrayBox qicu1d_fab(grown_box, 1);    <span class="comment">// ICE FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160; </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            <span class="comment">// Get array references</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; t3dten = t3dten_fab.array();      <span class="comment">// TEMPERATURE TENDENCY (K/S)</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qv3dten = qv3dten_fab.array();    <span class="comment">// WATER VAPOR MIXING RATIO TENDENCY (KG/KG/S)</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; t3d = t3d_fab.array();            <span class="comment">// TEMPERATURE (K)</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qv3d = qv3d_fab.array();          <span class="comment">// WATER VAPOR MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a> = pres_fab.array();          <span class="comment">// ATMOSPHERIC PRESSURE (PA)</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dzq = dzq_fab.array();            <span class="comment">// DIFFERENCE IN HEIGHT ACROSS LEVEL (m)</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; w3d = w3d_fab.array();            <span class="comment">// GRID-SCALE VERTICAL VELOCITY (M/S)</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="comment">// WRF-chem variables</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; nc3d = nc3d_fab.array();          <span class="comment">// CLOUD DROPLET NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; nc3dten = nc3dten_fab.array();    <span class="comment">// CLOUD DROPLET NUMBER CONCENTRATION TENDENCY</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <span class="comment">// Graupel variables</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qg3dten = qg3dten_fab.array();    <span class="comment">// GRAUPEL MIX RATIO TENDENCY (KG/KG/S)</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ng3dten = ng3dten_fab.array();    <span class="comment">// GRAUPEL NUMB CONC TENDENCY (1/KG/S)</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qg3d = qg3d_fab.array();          <span class="comment">// GRAUPEL MIX RATIO (KG/KG)</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ng3d = ng3d_fab.array();          <span class="comment">// GRAUPEL NUMBER CONC (1/KG)</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160; </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            <span class="comment">// Sedimentation tendencies</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qgsten = qgsten_fab.array();      <span class="comment">// GRAUPEL SED TEND (KG/KG/S)</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qrsten = qrsten_fab.array();      <span class="comment">// RAIN SED TEND (KG/KG/S)</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qisten = qisten_fab.array();      <span class="comment">// CLOUD ICE SED TEND (KG/KG/S)</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qnisten = qnisten_fab.array();    <span class="comment">// SNOW SED TEND (KG/KG/S)</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qcsten = qcsten_fab.array();      <span class="comment">// CLOUD WAT SED TEND (KG/KG/S)</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <span class="comment">// Cumulus tendencies</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qrcu1d = qrcu1d_fab.array();      <span class="comment">// RAIN FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qscu1d = qscu1d_fab.array();      <span class="comment">// SNOW FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; qicu1d = qicu1d_fab.array();      <span class="comment">// ICE FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            <span class="comment">// Initialize tendency arrays to zero</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;              t3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;              qv3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;              nc3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;              qg3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;              ng3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;              qgsten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;              qrsten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;              qisten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;              qnisten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;              qcsten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            });</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            <span class="comment">// Create arrays for precipitation rates</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            FArrayBox precrt_fab(grown_box, 1);    <span class="comment">// TOTAL PRECIP PER TIME STEP</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            FArrayBox snowrt_fab(grown_box, 1);    <span class="comment">// SNOW PER TIME STEP</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            FArrayBox snowprt_fab(grown_box, 1);   <span class="comment">// TOTAL CLOUD ICE PLUS SNOW PER TIME STEP</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            FArrayBox grplprt_fab(grown_box, 1);   <span class="comment">// TOTAL GRAUPEL PER TIME STEP</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="comment">// Create arrays for effective radii</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            FArrayBox effc_fab(grown_box, 1);      <span class="comment">// DROPLET EFFECTIVE RADIUS</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            FArrayBox effi_fab(grown_box, 1);      <span class="comment">// CLOUD ICE EFFECTIVE RADIUS</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            FArrayBox effs_fab(grown_box, 1);      <span class="comment">// SNOW EFFECTIVE RADIUS</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            FArrayBox effr_fab(grown_box, 1);      <span class="comment">// RAIN EFFECTIVE RADIUS</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            FArrayBox effg_fab(grown_box, 1);      <span class="comment">// GRAUPEL EFFECTIVE RADIUS</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <span class="comment">// Get array references for precipitation rates</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; precrt = precrt_fab.array();      <span class="comment">// TOTAL PRECIP PER TIME STEP (mm)</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; snowrt = snowrt_fab.array();      <span class="comment">// SNOW PER TIME STEP (mm)</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; snowprt = snowprt_fab.array();    <span class="comment">// TOTAL CLOUD ICE PLUS SNOW PER TIME STEP (mm)</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; grplprt = grplprt_fab.array();    <span class="comment">// TOTAL GRAUPEL PER TIME STEP (mm)</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="comment">// Get array references for effective radii</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; effc = effc_fab.array();          <span class="comment">// DROPLET EFFECTIVE RADIUS (MICRON)</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; effi = effi_fab.array();          <span class="comment">// CLOUD ICE EFFECTIVE RADIUS (MICRON)</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; effs = effs_fab.array();          <span class="comment">// SNOW EFFECTIVE RADIUS (MICRON)</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; effr = effr_fab.array();          <span class="comment">// RAIN EFFECTIVE RADIUS (MICRON)</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; effg = effg_fab.array();          <span class="comment">// GRAUPEL EFFECTIVE RADIUS (MICRON)</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <span class="comment">// Initialize these arrays to zero (they will be computed later)</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;              precrt(i,j,k) = 0.0;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;              snowrt(i,j,k) = 0.0;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;              snowprt(i,j,k) = 0.0;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;              grplprt(i,j,k) = 0.0;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;              effc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;              effi(i,j,k) = 0.0;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;              effs(i,j,k) = 0.0;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;              effr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;              effg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            });</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160; </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <span class="comment">// Create FArrayBoxes for scalar variables</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            FArrayBox rho_fab(grown_box, 1);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            FArrayBox mu_fab(grown_box, 1);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            FArrayBox ain_fab(grown_box, 1);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            FArrayBox arn_fab(grown_box, 1);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            FArrayBox asn_fab(grown_box, 1);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            FArrayBox acn_fab(grown_box, 1);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            FArrayBox agn_fab(grown_box, 1);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <span class="comment">// Get Array4 views</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a> = rho_fab.array();</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; mu = mu_fab.array();</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ain = ain_fab.array();</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; arn = arn_fab.array();</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; asn = asn_fab.array();</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; acn = acn_fab.array();</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; agn = agn_fab.array();</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160; </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            <span class="comment">// Initialize all values to zero</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;              <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) = 0.0;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;              mu(i,j,k) = 0.0;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;              ain(i,j,k) = 0.0;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;              arn(i,j,k) = 0.0;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;              asn(i,j,k) = 0.0;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;              acn(i,j,k) = 0.0;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;              agn(i,j,k) = 0.0;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            });</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; </div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            <span class="comment">// Create FArrayBoxes for fall speed working variables</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            FArrayBox dumi_fab(grown_box, 1);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;            FArrayBox dumr_fab(grown_box, 1);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            FArrayBox dumfni_fab(grown_box, 1);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            FArrayBox dumg_fab(grown_box, 1);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            FArrayBox dumfng_fab(grown_box, 1);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            FArrayBox uni_fab(grown_box, 1);</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;            FArrayBox umi_fab(grown_box, 1);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            FArrayBox umr_fab(grown_box, 1);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            FArrayBox fr_fab(grown_box, 1);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            FArrayBox fi_fab(grown_box, 1);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            FArrayBox fni_fab(grown_box, 1);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            FArrayBox fg_fab(grown_box, 1);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            FArrayBox fng_fab(grown_box, 1);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            FArrayBox rgvm_fab(grown_box, 1);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            FArrayBox faloutr_fab(grown_box, 1);</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            FArrayBox falouti_fab(grown_box, 1);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            FArrayBox faloutni_fab(grown_box, 1);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            FArrayBox faltndr_fab(grown_box, 1);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            FArrayBox faltndi_fab(grown_box, 1);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            FArrayBox faltndni_fab(grown_box, 1);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            FArrayBox dumqs_fab(grown_box, 1);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            FArrayBox dumfns_fab(grown_box, 1);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            FArrayBox ums_fab(grown_box, 1);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            FArrayBox uns_fab(grown_box, 1);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;            FArrayBox fs_fab(grown_box, 1);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;            FArrayBox fns_fab(grown_box, 1);</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            FArrayBox falouts_fab(grown_box, 1);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            FArrayBox faloutns_fab(grown_box, 1);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;            FArrayBox faloutg_fab(grown_box, 1);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            FArrayBox faloutng_fab(grown_box, 1);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            FArrayBox faltnds_fab(grown_box, 1);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            FArrayBox faltndns_fab(grown_box, 1);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            FArrayBox unr_fab(grown_box, 1);</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            FArrayBox faltndg_fab(grown_box, 1);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            FArrayBox faltndng_fab(grown_box, 1);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            FArrayBox dumc_fab(grown_box, 1);</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            FArrayBox dumfnc_fab(grown_box, 1);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            FArrayBox unc_fab(grown_box, 1);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            FArrayBox umc_fab(grown_box, 1);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            FArrayBox ung_fab(grown_box, 1);</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            FArrayBox umg_fab(grown_box, 1);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            FArrayBox fc_fab(grown_box, 1);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            FArrayBox faloutc_fab(grown_box, 1);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            FArrayBox faloutnc_fab(grown_box, 1);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            FArrayBox faltndc_fab(grown_box, 1);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            FArrayBox faltndnc_fab(grown_box, 1);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            FArrayBox fnc_fab(grown_box, 1);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            FArrayBox dumfnr_fab(grown_box, 1);</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            FArrayBox faloutnr_fab(grown_box, 1);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            FArrayBox faltndnr_fab(grown_box, 1);</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            FArrayBox fnr_fab(grown_box, 1);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            FArrayBox dlams_fab(grown_box, 1);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;            FArrayBox dlamr_fab(grown_box, 1);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            FArrayBox dlami_fab(grown_box, 1);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            FArrayBox dlamc_fab(grown_box, 1);</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            FArrayBox dlamg_fab(grown_box, 1);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            <span class="comment">// Create Array4 references</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumi = dumi_fab.array();</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumr = dumr_fab.array();</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumfni = dumfni_fab.array();</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumg = dumg_fab.array();</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumfng = dumfng_fab.array();</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; uni = uni_fab.array();</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; umi = umi_fab.array();</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; umr = umr_fab.array();</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fr = fr_fab.array();</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fi = fi_fab.array();</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fni = fni_fab.array();</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fg = fg_fab.array();</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fng = fng_fab.array();</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; rgvm = rgvm_fab.array();</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutr = faloutr_fab.array();</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; falouti = falouti_fab.array();</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutni = faloutni_fab.array();</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndr = faltndr_fab.array();</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndi = faltndi_fab.array();</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndni = faltndni_fab.array();</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumqs = dumqs_fab.array();</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumfns = dumfns_fab.array();</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ums = ums_fab.array();</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; uns = uns_fab.array();</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fs = fs_fab.array();</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fns = fns_fab.array();</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; falouts = falouts_fab.array();</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutns = faloutns_fab.array();</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutg = faloutg_fab.array();</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutng = faloutng_fab.array();</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltnds = faltnds_fab.array();</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndns = faltndns_fab.array();</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; unr = unr_fab.array();</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndg = faltndg_fab.array();</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndng = faltndng_fab.array();</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumc = dumc_fab.array();</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumfnc = dumfnc_fab.array();</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; unc = unc_fab.array();</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; umc = umc_fab.array();</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; ung = ung_fab.array();</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; umg = umg_fab.array();</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fc = fc_fab.array();</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutc = faloutc_fab.array();</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutnc = faloutnc_fab.array();</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndc = faltndc_fab.array();</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndnc = faltndnc_fab.array();</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fnc = fnc_fab.array();</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dumfnr = dumfnr_fab.array();</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faloutnr = faloutnr_fab.array();</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; faltndnr = faltndnr_fab.array();</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; fnr = fnr_fab.array();</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dlams = dlams_fab.array();</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dlamr = dlamr_fab.array();</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dlami = dlami_fab.array();</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dlamc = dlamc_fab.array();</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; dlamg = dlamg_fab.array();</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            <span class="comment">// Initialize arrays to 0</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;            ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                dlams(i,j,k) = 0.0;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                dlamr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                dlami(i,j,k) = 0.0;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                dlamc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                dlamg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                dumi(i,j,k) = 0.0;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                dumr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                dumfni(i,j,k) = 0.0;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                dumg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                dumfng(i,j,k) = 0.0;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                uni(i,j,k) = 0.0;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                umi(i,j,k) = 0.0;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                umr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                fr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                fi(i,j,k) = 0.0;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                fni(i,j,k) = 0.0;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                fg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                fng(i,j,k) = 0.0;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                rgvm(i,j,k) = 0.0;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                faloutr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                falouti(i,j,k) = 0.0;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                faloutni(i,j,k) = 0.0;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                faltndr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                faltndi(i,j,k) = 0.0;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                faltndni(i,j,k) = 0.0;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                dumqs(i,j,k) = 0.0;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                dumfns(i,j,k) = 0.0;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                ums(i,j,k) = 0.0;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                uns(i,j,k) = 0.0;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                fs(i,j,k) = 0.0;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                fns(i,j,k) = 0.0;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                falouts(i,j,k) = 0.0;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                faloutns(i,j,k) = 0.0;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                faloutg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                faloutng(i,j,k) = 0.0;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                faltnds(i,j,k) = 0.0;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                faltndns(i,j,k) = 0.0;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                unr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                faltndg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                faltndng(i,j,k) = 0.0;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                dumc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                dumfnc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                unc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                umc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                ung(i,j,k) = 0.0;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                umg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                fc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                faloutc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                faloutnc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                faltndc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                faltndnc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                fnc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                dumfnr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                faloutnr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                faltndnr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                fnr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            });</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160; </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            <span class="comment">// Create FArrayBoxes for thermodynamic variables</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            FArrayBox xxls_fab(grown_box, 1);  <span class="comment">// Latent heat of sublimation</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            FArrayBox xxlv_fab(grown_box, 1);  <span class="comment">// Latent heat of vaporization</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            FArrayBox cpm_fab(grown_box, 1);   <span class="comment">// Specific heat at constant pressure for moist air</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            FArrayBox xlf_fab(grown_box, 1);   <span class="comment">// Latent heat of freezing</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160; </div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="comment">// Get Array4 references</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; xxls = xxls_fab.array();  <span class="comment">// XXLS: Latent heat of sublimation</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; xxlv = xxlv_fab.array();  <span class="comment">// XXLV: Latent heat of vaporization</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; cpm = cpm_fab.array();    <span class="comment">// CPM: Specific heat at constant pressure for moist air</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a> = xlf_fab.array();    <span class="comment">// XLF: Latent heat of freezing</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;            <span class="comment">// Initialize values to zero</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            ParallelFor(grown_box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k) {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                xxls(i,j,k) = 0.0;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                xxlv(i,j,k) = 0.0;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                cpm(i,j,k) = 0.0;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) = 0.0;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            });</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">          ////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment"></span>          <span class="comment">// ParallelFor for testing partial C++ implementation</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          <span class="comment">// NOTE: Currently all Array4 values are copied to locals</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;          <span class="comment">//       This means we&#39;re not updating or outputting anything</span><span class="comment"></span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">          ////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment"></span>          ParallelFor( box, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;          {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            <span class="comment">// Tendencies and mixing ratios</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            qc3d(i,j,k) = qcl_arr(i,j,k);   <span class="comment">// CLOUD WATER MIXING RATIO</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            qi3d(i,j,k) = qci_arr(i,j,k);   <span class="comment">// CLOUD ICE MIXING RATIO</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            qni3d(i,j,k) = qps_arr(i,j,k);  <span class="comment">// SNOW MIXING RATIO</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            qr3d(i,j,k) = qpr_arr(i,j,k);   <span class="comment">// RAIN MIXING RATIO</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            ni3d(i,j,k) = ni_arr(i,j,k);    <span class="comment">// CLOUD ICE NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            ns3d(i,j,k) = ns_arr(i,j,k);    <span class="comment">// SNOW NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            nr3d(i,j,k) = nr_arr(i,j,k);    <span class="comment">// RAIN NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            nc3d(i,j,k) = nc_arr(i,j,k);    <span class="comment">// RAIN NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160; </div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            t3d(i,j,k) = theta_arr(i,j,k) * pii_arr(i,j,k);  <span class="comment">// TEMPERATURE</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;            qv3d(i,j,k) = qv_arr(i,j,k);                     <span class="comment">// WATER VAPOR MIXING RATIO</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) = pres_arr(i,j,k);                   <span class="comment">// ATMOSPHERIC PRESSURE</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            dzq(i,j,k) = dz_arr(i,j,k);                      <span class="comment">// DIFFERENCE IN HEIGHT ACROSS LEVEL</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            w3d(i,j,k) = w_arr(i,j,k);                       <span class="comment">// GRID-SCALE VERTICAL VELOCITY</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            qg3d(i,j,k) = qpg_arr(i,j,k);                    <span class="comment">// GRAUPEL MIX RATIO</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            ng3d(i,j,k) = ng_arr(i,j,k);                     <span class="comment">// GRAUPEL NUMBER CONC</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            qrcu1d(i,j,k) = qrcuten_arr(i,j,k);              <span class="comment">// RAIN FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            qscu1d(i,j,k) = qscuten_arr(i,j,k);              <span class="comment">// SNOW FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            qicu1d(i,j,k) = qicuten_arr(i,j,k);              <span class="comment">// ICE FROM CUMULUS PARAMETERIZATION</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;         });</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          ParallelFor( boxD, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> )</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;         {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;           <span class="keywordtype">int</span> ltrue=0;                      <span class="comment">// LTRUE: SWITCH = 0: NO HYDROMETEORS IN COLUMN, = 1: HYDROMETEORS IN COLUMN</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;           <span class="keywordtype">int</span> nstep;                        <span class="comment">// NSTEP: Timestep counter</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;           <span class="keywordtype">int</span> iinum=m_inum;                      <span class="comment">// iinum: Integer control variable</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=klo; k&lt;=khi; k++) {</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;            <span class="comment">// Model input parameters</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            <span class="comment">//amrex::Real dt;                 // DT: MODEL TIME STEP (SEC)</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            <span class="comment">//amrex::Real lami(i,j,k);               // LAMI: Slope parameter for cloud ice (m^-1)</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160; </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            <span class="comment">// Microphysical processes</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;            [[maybe_unused]] amrex::Real nsubc;              <span class="comment">// NSUBC: Loss of NC during evaporation</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            amrex::Real nsubi;              <span class="comment">// NSUBI: Loss of NI during sublimation</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            amrex::Real nsubs;              <span class="comment">// NSUBS: Loss of NS during sublimation</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            amrex::Real nsubr;              <span class="comment">// NSUBR: Loss of NR during evaporation</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            amrex::Real prd;                <span class="comment">// PRD: Deposition cloud ice</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            amrex::Real pre;                <span class="comment">// PRE: Evaporation of rain</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            amrex::Real prds;               <span class="comment">// PRDS: Deposition snow</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;            amrex::Real nnuccc;             <span class="comment">// NNUCCC: Change N due to contact freezing droplets</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            amrex::Real mnuccc;             <span class="comment">// MNUCCC: Change Q due to contact freezing droplets</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            amrex::Real pra;                <span class="comment">// PRA: Accretion droplets by rain</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            amrex::Real prc;                <span class="comment">// PRC: Autoconversion droplets</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            amrex::Real pcc;                <span class="comment">// PCC: Condensation/evaporation droplets</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            amrex::Real nnuccd;             <span class="comment">// NNUCCD: Change N freezing aerosol (primary ice nucleation)</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            amrex::Real mnuccd;             <span class="comment">// MNUCCD: Change Q freezing aerosol (primary ice nucleation)</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            amrex::Real mnuccr;             <span class="comment">// MNUCCR: Change Q due to contact freezing rain</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;            amrex::Real nnuccr;             <span class="comment">// NNUCCR: Change N due to contact freezing rain</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            amrex::Real npra;               <span class="comment">// NPRA: Change N due to droplet accretion by rain</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            amrex::Real nragg;              <span class="comment">// NRAGG: Self-collection/breakup of rain</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            amrex::Real nsagg;              <span class="comment">// NSAGG: Self-collection of snow</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;            amrex::Real nprc;               <span class="comment">// NPRC: Change NC autoconversion droplets</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;            amrex::Real nprc1;              <span class="comment">// NPRC1: Change NR autoconversion droplets</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            amrex::Real prai;               <span class="comment">// PRAI: Change Q accretion cloud ice by snow</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;            amrex::Real prci;               <span class="comment">// PRCI: Change Q autoconversion cloud ice to snow</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;            amrex::Real psacws;             <span class="comment">// PSACWS: Change Q droplet accretion by snow</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            amrex::Real npsacws;            <span class="comment">// NPSACWS: Change N droplet accretion by snow</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            amrex::Real psacwi;             <span class="comment">// PSACWI: Change Q droplet accretion by cloud ice</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;            amrex::Real npsacwi;            <span class="comment">// NPSACWI: Change N droplet accretion by cloud ice</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;            amrex::Real nprci;              <span class="comment">// NPRCI: Change N autoconversion cloud ice by snow</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;            amrex::Real nprai;              <span class="comment">// NPRAI: Change N accretion cloud ice</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;            amrex::Real nmults;             <span class="comment">// NMULTS: Ice multiplication due to riming droplets by snow</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            amrex::Real nmultr;             <span class="comment">// NMULTR: Ice multiplication due to riming rain by snow</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            amrex::Real qmults;             <span class="comment">// QMULTS: Change Q due to ice multiplication droplets/snow</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;            amrex::Real qmultr;             <span class="comment">// QMULTR: Change Q due to ice multiplication rain/snow</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;            amrex::Real pracs;              <span class="comment">// PRACS: Change Q rain-snow collection</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            amrex::Real npracs;             <span class="comment">// NPRACS: Change N rain-snow collection</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;            [[maybe_unused]] amrex::Real pccn;               <span class="comment">// PCCN: Change Q droplet activation</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            amrex::Real psmlt;              <span class="comment">// PSMLT: Change Q melting snow to rain</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            amrex::Real evpms;              <span class="comment">// EVPMS: Change Q melting snow evaporating</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            amrex::Real nsmlts;             <span class="comment">// NSMLTS: Change N melting snow</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            amrex::Real nsmltr;             <span class="comment">// NSMLTR: Change N melting snow to rain</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;            amrex::Real piacr;              <span class="comment">// PIACR: Change QR, ice-rain collection</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            amrex::Real niacr;              <span class="comment">// NIACR: Change N, ice-rain collection</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;            amrex::Real praci;              <span class="comment">// PRACI: Change QI, ice-rain collection</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;            amrex::Real piacrs;             <span class="comment">// PIACRS: Change QR, ice rain collision, added to snow</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;            amrex::Real niacrs;             <span class="comment">// NIACRS: Change N, ice rain collision, added to snow</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            amrex::Real pracis;             <span class="comment">// PRACIS: Change QI, ice rain collision, added to snow</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;            amrex::Real eprd;               <span class="comment">// EPRD: Sublimation cloud ice</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            amrex::Real eprds;              <span class="comment">// EPRDS: Sublimation snow</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            <span class="comment">// Graupel processes</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            amrex::Real pracg;              <span class="comment">// PRACG: Change in Q collection rain by graupel</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;            amrex::Real psacwg;             <span class="comment">// PSACWG: Change in Q collection droplets by graupel</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            amrex::Real pgsacw;             <span class="comment">// PGSACW: Conversion Q to graupel due to collection droplets by snow</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            amrex::Real pgracs;             <span class="comment">// PGRACS: Conversion Q to graupel due to collection rain by snow</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            amrex::Real prdg;               <span class="comment">// PRDG: Deposition of graupel</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            amrex::Real eprdg;              <span class="comment">// EPRDG: Sublimation of graupel</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            amrex::Real evpmg;              <span class="comment">// EVPMG: Change Q melting of graupel and evaporation</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            amrex::Real pgmlt;              <span class="comment">// PGMLT: Change Q melting of graupel</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;            amrex::Real npracg;             <span class="comment">// NPRACG: Change N collection rain by graupel</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            amrex::Real npsacwg;            <span class="comment">// NPSACWG: Change N collection droplets by graupel</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            amrex::Real nscng;              <span class="comment">// NSCNG: Change N conversion to graupel due to collection droplets by snow</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            amrex::Real ngracs;             <span class="comment">// NGRACS: Change N conversion to graupel due to collection rain by snow</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            amrex::Real ngmltg;             <span class="comment">// NGMLTG: Change N melting graupel</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            amrex::Real ngmltr;             <span class="comment">// NGMLTR: Change N melting graupel to rain</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;            amrex::Real nsubg;              <span class="comment">// NSUBG: Change N sublimation/deposition of graupel</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            amrex::Real psacr;              <span class="comment">// PSACR: Conversion due to collection of snow by rain</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            amrex::Real nmultg;             <span class="comment">// NMULTG: Ice multiplication due to accretion droplets by graupel</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            amrex::Real nmultrg;            <span class="comment">// NMULTRG: Ice multiplication due to accretion rain by graupel</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            amrex::Real qmultg;             <span class="comment">// QMULTG: Change Q due to ice multiplication droplets/graupel</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;            amrex::Real qmultrg;            <span class="comment">// QMULTRG: Change Q due to ice multiplication rain/graupel</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160; </div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            <span class="comment">// Time-varying atmospheric parameters</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;            amrex::Real kap;                <span class="comment">// KAP: Thermal conductivity of air</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;            amrex::Real evs;                <span class="comment">// EVS: Saturation vapor pressure</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;            amrex::Real eis;                <span class="comment">// EIS: Ice saturation vapor pressure</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            amrex::Real qvs;                <span class="comment">// QVS: Saturation mixing ratio</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;            amrex::Real qvi;                <span class="comment">// QVI: Ice saturation mixing ratio</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            amrex::Real qvqvs;              <span class="comment">// QVQVS: Saturation ratio</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;            amrex::Real qvqvsi;             <span class="comment">// QVQVSI: Ice saturation ratio</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;            amrex::Real dv;                 <span class="comment">// DV: Diffusivity of water vapor in air</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;            amrex::Real sc_schmidt;         <span class="comment">// SC: Schmidt number</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;            amrex::Real ab;                 <span class="comment">// AB: Correction to condensation rate due to latent heating</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            amrex::Real abi;                <span class="comment">// ABI: Correction to deposition rate due to latent heating</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160; </div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            <span class="comment">// Dummy variables</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;            amrex::Real dum;                <span class="comment">// DUM: General dummy variable</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            amrex::Real dum1;               <span class="comment">// DUM1: General dummy variable</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;            [[maybe_unused]] amrex::Real dum2;               <span class="comment">// DUM2: General dummy variable</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            amrex::Real dumt;               <span class="comment">// DUMT: Dummy variable for temperature</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            amrex::Real dumqv;              <span class="comment">// DUMQV: Dummy variable for water vapor</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            amrex::Real dumqss;             <span class="comment">// DUMQSS: Dummy saturation mixing ratio</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            [[maybe_unused]] amrex::Real dumqsi;             <span class="comment">// DUMQSI: Dummy ice saturation mixing ratio</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            amrex::Real dums;               <span class="comment">// DUMS: General dummy variable</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160; </div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            <span class="comment">// Prognostic supersaturation</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            amrex::Real dqsdt;              <span class="comment">// DQSDT: Change of saturation mixing ratio with temperature</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            amrex::Real dqsidt;             <span class="comment">// DQSIDT: Change in ice saturation mixing ratio with temperature</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            amrex::Real epsi;               <span class="comment">// EPSI: 1/phase relaxation time (see M2005), ice</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            amrex::Real epss;               <span class="comment">// EPSS: 1/phase relaxation time (see M2005), snow</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            amrex::Real epsr;               <span class="comment">// EPSR: 1/phase relaxation time (see M2005), rain</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            amrex::Real epsg;               <span class="comment">// EPSG: 1/phase relaxation time (see M2005), graupel</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            amrex::Real kc2;                <span class="comment">// KC2: Total ice nucleation rate</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            amrex::Real di0;                <span class="comment">// DC0: Characteristic diameter for ice</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            [[maybe_unused]] amrex::Real dc0;                <span class="comment">// DC0: Characteristic diameter for cloud droplets</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            amrex::Real ds0;                <span class="comment">// DS0: Characteristic diameter for snow</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            amrex::Real dg0;                <span class="comment">// DG0: Characteristic diameter for graupel</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            amrex::Real dumqc;              <span class="comment">// DUMQC: Dummy variable for cloud water mixing ratio</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            [[maybe_unused]] amrex::Real dumqr;              <span class="comment">// DUMQR: Dummy variable for rain mixing ratio</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            amrex::Real ratio;              <span class="comment">// RATIO: General ratio variable</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            amrex::Real sum_dep;            <span class="comment">// SUM_DEP: Sum of deposition/sublimation</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            amrex::Real fudgef;             <span class="comment">// FUDGEF: Adjustment factor</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            <span class="comment">// For WRF-CHEM</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            [[maybe_unused]] amrex::Real c2prec;             <span class="comment">// C2PREC: Cloud to precipitation conversion</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            [[maybe_unused]] amrex::Real csed;               <span class="comment">// CSED: Cloud sedimentation</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;            [[maybe_unused]] amrex::Real ised;               <span class="comment">// ISED: Ice sedimentation</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;            [[maybe_unused]] amrex::Real ssed;               <span class="comment">// SSED: Snow sedimentation</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            [[maybe_unused]] amrex::Real gsed;               <span class="comment">// GSED: Graupel sedimentation</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            [[maybe_unused]] amrex::Real rsed;               <span class="comment">// RSED: Rain sedimentation</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            [[maybe_unused]] amrex::Real tqimelt;            <span class="comment">// tqimelt: Melting of cloud ice (tendency)</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <span class="comment">// NC3DTEN LOCAL ARRAY INITIALIZED</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            nc3dten(i,j,k) = 0.0;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;            <span class="comment">// INITIALIZE VARIABLES FOR WRF-CHEM OUTPUT TO ZERO</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            c2prec = 0.0;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            csed = 0.0;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            ised = 0.0;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            ssed = 0.0;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            gsed = 0.0;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            rsed = 0.0;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160; </div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            <span class="comment">// LATENT HEAT OF VAPORIZATION</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;            xxlv(i,j,k) = 3.1484E6 - 2370.0 * t3d(i,j,k);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            <span class="comment">// LATENT HEAT OF SUBLIMATION</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;            xxls(i,j,k) = 3.15E6 - 2370.0 * t3d(i,j,k) + 0.3337E6;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;            <span class="comment">// Assuming CP is a constant defined elsewhere (specific heat of dry air at constant pressure)</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            <span class="keyword">const</span> amrex::Real CP = 1004.5; <span class="comment">// J/kg/K</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            cpm(i,j,k) = CP * (1.0 + 0.887 * qv3d(i,j,k));</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            <span class="comment">// SATURATION VAPOR PRESSURE AND MIXING RATIO</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;            <span class="comment">// hm, add fix for low pressure, 5/12/10</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            <span class="comment">// Assuming POLYSVP is defined elsewhere</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            evs = std::min(0.99 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k), <a class="code" href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7">calc_saturation_vapor_pressure</a>(t3d(i,j,k), 0));  <span class="comment">// PA</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;            eis = std::min(0.99 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k), <a class="code" href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7">calc_saturation_vapor_pressure</a>(t3d(i,j,k), 1));  <span class="comment">// PA</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            <span class="comment">// MAKE SURE ICE SATURATION DOESN&#39;T EXCEED WATER SAT. NEAR FREEZING</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            <span class="keywordflow">if</span> (eis &gt; evs) {</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;              eis = evs; <span class="comment">// temporary update: adjust ice saturation pressure</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;            }</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160; </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;            <span class="comment">// SATURATION MIXING RATIOS</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            qvs = m_ep_2 * evs / (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) - evs); <span class="comment">// budget equation: calculate water saturation mixing ratio</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            qvi = m_ep_2 * eis / (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) - eis); <span class="comment">// budget equation: calculate ice saturation mixing ratio</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            <span class="comment">// SATURATION RATIOS</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            qvqvs = qv3d(i,j,k) / qvs; <span class="comment">// budget equation: calculate water saturation ratio</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            qvqvsi = qv3d(i,j,k) / qvi; <span class="comment">// budget equation: calculate ice saturation ratio</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            <span class="comment">// AIR DENSITY</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) = <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) / (m_R * t3d(i,j,k)); <span class="comment">// budget equation: calculate air density</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160; </div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            ds0 = 3.0;       <span class="comment">// Size distribution parameter for snow</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            di0 = 3.0;       <span class="comment">// Size distribution parameter for cloud ice</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            dg0 = 3.0;       <span class="comment">// Size distribution parameter for graupel</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> CI = 800.0;     <span class="comment">// Mass-diameter relationship parameter for cloud ice</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            <span class="comment">// ADD NUMBER CONCENTRATION DUE TO CUMULUS TENDENCY</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            <span class="comment">// ASSUME N0 ASSOCIATED WITH CUMULUS PARAM RAIN IS 10^7 M^-4</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            <span class="comment">// ASSUME N0 ASSOCIATED WITH CUMULUS PARAM SNOW IS 2 X 10^7 M^-4</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            <span class="comment">// FOR DETRAINED CLOUD ICE, ASSUME MEAN VOLUME DIAM OF 80 MICRON</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            <span class="keywordflow">if</span> (qrcu1d(i,j,k) &gt;= 1.0e-10) {</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;              dum = 1.8e5 * std::pow(qrcu1d(i,j,k) * dt / (m_pi * m_rhow * std::pow(<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 3)), 0.25); <span class="comment">// rate equation: calculate rain number concentration from cumulus</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;              nr3d(i,j,k) += dum; <span class="comment">// budget equation: update rain number concentration</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            }</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            <span class="keywordflow">if</span> (qscu1d(i,j,k) &gt;= 1.0e-10) {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;              dum = 3.e5 * std::pow(qscu1d(i,j,k) * dt / (m_cons1 * std::pow(<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 3)), 1.0 / (ds0 + 1.0)); <span class="comment">// rate equation: calculate snow number concentration from cumulus</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;              ns3d(i,j,k) += dum; <span class="comment">// budget equation: update snow number concentration</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            }</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            <span class="keywordflow">if</span> (qicu1d(i,j,k) &gt;= 1.0e-10) {</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;              dum = qicu1d(i,j,k) * dt / (CI * std::pow(80.0e-6, di0)); <span class="comment">// rate equation: calculate cloud ice number concentration from cumulus</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;              ni3d(i,j,k) += dum; <span class="comment">// budget equation: update cloud ice number concentration</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            }</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            <span class="comment">// AT SUBSATURATION, REMOVE SMALL AMOUNTS OF CLOUD/PRECIP WATER</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            <span class="comment">// hm modify 7/0/09 change limit to 1.e-8</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            <span class="keywordflow">if</span> (qvqvs &lt; 0.9) {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;              <span class="keywordflow">if</span> (qr3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                qv3d(i,j,k) += qr3d(i,j,k); <span class="comment">// budget equation: transfer rain to vapor</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                t3d(i,j,k) -= qr3d(i,j,k) * xxlv(i,j,k) / cpm(i,j,k); <span class="comment">// budget equation: adjust temperature</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                qr3d(i,j,k) = 0.0; <span class="comment">// temporary update: set rain to zero</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;              }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;              <span class="keywordflow">if</span> (qc3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                qv3d(i,j,k) += qc3d(i,j,k); <span class="comment">// budget equation: transfer cloud water to vapor</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                t3d(i,j,k) -= qc3d(i,j,k) * xxlv(i,j,k) / cpm(i,j,k); <span class="comment">// budget equation: adjust temperature</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                qc3d(i,j,k) = 0.0; <span class="comment">// temporary update: set cloud water to zero</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;              }</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;            <span class="keywordflow">if</span> (qvqvsi &lt; 0.9) {</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;              <span class="keywordflow">if</span> (qi3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                qv3d(i,j,k) += qi3d(i,j,k); <span class="comment">// budget equation: transfer cloud ice to vapor</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                t3d(i,j,k) -= qi3d(i,j,k) * xxls(i,j,k) / cpm(i,j,k); <span class="comment">// budget equation: adjust temperature</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                qi3d(i,j,k) = 0.0; <span class="comment">// temporary update: set cloud ice to zero</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;              }</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;              <span class="keywordflow">if</span> (qni3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                qv3d(i,j,k) += qni3d(i,j,k); <span class="comment">// budget equation: transfer snow to vapor</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                t3d(i,j,k) -= qni3d(i,j,k) * xxls(i,j,k) / cpm(i,j,k); <span class="comment">// budget equation: adjust temperature</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                qni3d(i,j,k) = 0.0; <span class="comment">// temporary update: set snow to zero</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;              }</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;              <span class="keywordflow">if</span> (qg3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                qv3d(i,j,k) += qg3d(i,j,k); <span class="comment">// budget equation: transfer graupel to vapor</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                t3d(i,j,k) -= qg3d(i,j,k) * xxls(i,j,k) / cpm(i,j,k); <span class="comment">// budget equation: adjust temperature</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                qg3d(i,j,k) = 0.0; <span class="comment">// temporary update: set graupel to zero</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;              }</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            }</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            <span class="comment">// HEAT OF FUSION</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;            <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) = xxls(i,j,k) - xxlv(i,j,k);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160; </div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            <span class="comment">// IF MIXING RATIO &lt; QSMALL SET MIXING RATIO AND NUMBER CONC TO ZERO</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            <span class="comment">// Note: QSMALL is not defined in the variable list, so I&#39;ll define it</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            <span class="keyword">const</span> amrex::Real QSMALL = m_qsmall;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;            <span class="keywordflow">if</span> (qc3d(i,j,k) &lt; QSMALL) {</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;              qc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;              nc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;              effc(i,j,k) = 0.0;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            }</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            <span class="keywordflow">if</span> (qr3d(i,j,k) &lt; QSMALL) {</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;              qr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;              nr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;              effr(i,j,k) = 0.0;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            }</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            <span class="keywordflow">if</span> (qi3d(i,j,k) &lt; QSMALL) {</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;              qi3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;              ni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;              effi(i,j,k) = 0.0;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <span class="keywordflow">if</span> (qni3d(i,j,k) &lt; QSMALL) {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;              qni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;              ns3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;              effs(i,j,k) = 0.0;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            }</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            <span class="keywordflow">if</span> (qg3d(i,j,k) &lt; QSMALL) {</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;              qg3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;              ng3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;              effg(i,j,k) = 0.0;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            }</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            <span class="comment">// INITIALIZE SEDIMENTATION TENDENCIES FOR MIXING RATIO</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            qrsten(i,j,k) = 0.0;  <span class="comment">// temporary update: initialize QRSTEN</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            qisten(i,j,k) = 0.0;  <span class="comment">// temporary update: initialize QISTEN</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            qnisten(i,j,k) = 0.0; <span class="comment">// temporary update: initialize QNISTEN</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            qcsten(i,j,k) = 0.0;  <span class="comment">// temporary update: initialize QCSTEN</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            qgsten(i,j,k) = 0.0;  <span class="comment">// temporary update: initialize QGSTEN</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160; </div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;            <span class="comment">// MICROPHYSICS PARAMETERS VARYING IN TIME/HEIGHT</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            mu(i,j,k) = 1.496e-6 * std::pow(t3d(i,j,k), 1.5) / (t3d(i,j,k) + 120.0); <span class="comment">// budget equation: calculate air viscosity</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160; </div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            <span class="comment">// Fall speed with density correction (Heymsfield and Benssemer 2006)</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            dum = std::pow(m_rhosu / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.54); <span class="comment">// temporary update: calculate density correction factor</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160; </div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            <span class="comment">// AA revision 4/1/11: Ikawa and Saito 1991 air-density correction</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            ain(i,j,k) = std::pow(m_rhosu / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.35) * m_ai; <span class="comment">// budget equation: calculate ice fall speed parameter</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            arn(i,j,k) = dum * m_ar; <span class="comment">// budget equation: calculate rain fall speed parameter</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            asn(i,j,k) = dum * m_as; <span class="comment">// budget equation: calculate snow fall speed parameter</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160; </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            <span class="comment">// AA revision 4/1/11: temperature-dependent Stokes fall speed</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            acn(i,j,k) = m_g * m_rhow / (18.0 * mu(i,j,k)); <span class="comment">// budget equation: calculate cloud droplet fall speed parameter</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160; </div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            <span class="comment">// HM ADD GRAUPEL 8/28/06</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;            agn(i,j,k) = dum * m_ag; <span class="comment">// budget equation: calculate graupel fall speed parameter</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;            <span class="comment">// hm 4/7/09 bug fix, initialize lami(i,j,k) to prevent later division by zero</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            lami(i,j,k) = 0.0; <span class="comment">// temporary update: initialize LAMI</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160; </div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="comment">// If there is no cloud/precip water, and if subsaturated, then skip microphysics for this level</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            <span class="keywordtype">bool</span> skipMicrophysics = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="keywordtype">bool</span> skipConcentrations = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            <span class="keywordflow">if</span> (qc3d(i,j,k) &lt; QSMALL &amp;&amp; qi3d(i,j,k) &lt; QSMALL &amp;&amp; qni3d(i,j,k) &lt; QSMALL &amp;&amp; qr3d(i,j,k) &lt; QSMALL &amp;&amp; qg3d(i,j,k) &lt; QSMALL) {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;              <span class="keywordflow">if</span> ((t3d(i,j,k) &lt; 273.15 &amp;&amp; qvqvsi &lt; 0.999) || (t3d(i,j,k) &gt;= 273.15 &amp;&amp; qvqvs &lt; 0.999)) {</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                skipMicrophysics = <span class="keyword">true</span>;<span class="comment">//                goto label_200;</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;              }</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            }</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160; </div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            <span class="keywordflow">if</span>(!skipMicrophysics) {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160; </div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            <span class="comment">// Thermal conductivity for air</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;              kap = 1.414e3 * mu(i,j,k); <span class="comment">// budget equation: calculate thermal conductivity</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160; </div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            <span class="comment">// Diffusivity of water vapor</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;            dv = 8.794e-5 * std::pow(t3d(i,j,k), 1.81) / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k); <span class="comment">// budget equation: calculate vapor diffusivity</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160; </div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <span class="comment">// Schmidt number</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;            sc_schmidt = mu(i,j,k) / (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv); <span class="comment">// budget equation: calculate Schmidt number</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160; </div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;            <span class="comment">// Psychometric corrections</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <span class="comment">// Rate of change sat. mix. ratio with temperature</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;            dum = (m_Rv * std::pow(t3d(i,j,k),2)); <span class="comment">// temporary update: calculate temperature factor</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;            dqsdt = xxlv(i,j,k) * qvs / dum; <span class="comment">// budget equation: calculate DQSDT</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;            dqsidt = xxls(i,j,k) * qvi / dum; <span class="comment">// budget equation: calculate DQSIDT</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            abi = 1.0 + dqsidt * xxls(i,j,k) / cpm(i,j,k); <span class="comment">// budget equation: calculate ABI</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            ab = 1.0 + dqsdt * xxlv(i,j,k) / cpm(i,j,k); <span class="comment">// budget equation: calculate AB</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160; </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            <span class="comment">// CASE FOR TEMPERATURE ABOVE FREEZING</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            <span class="keywordflow">if</span> (t3d(i,j,k) &gt;= 273.15) {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;              <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;              <span class="comment">// ALLOW FOR CONSTANT DROPLET NUMBER</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;              <span class="comment">// INUM = 0, PREDICT DROPLET NUMBER</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;              <span class="comment">// INUM = 1, SET CONSTANT DROPLET NUMBER</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;              <span class="keywordflow">if</span> (m_inum == 1) {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                <span class="comment">// CONVERT NDCNST FROM CM-3 TO KG-1</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                <span class="comment">// Note: NDCNST constant would need to be defined elsewhere</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                nc3d(i,j,k) = m_ndcnst * 1.0e6 / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k); <span class="comment">// Set cloud droplet number concentration</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;              }</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160; </div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;              <span class="comment">// GET SIZE DISTRIBUTION PARAMETERS</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;              <span class="comment">// MELT VERY SMALL SNOW AND GRAUPEL MIXING RATIOS, ADD TO RAIN</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;              <span class="keywordflow">if</span> (qni3d(i,j,k) &lt; 1.0e-6) {</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                qr3d(i,j,k) = qr3d(i,j,k) + qni3d(i,j,k);         <span class="comment">// Transfer snow to rain</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                nr3d(i,j,k) = nr3d(i,j,k) + ns3d(i,j,k);          <span class="comment">// Transfer snow number to rain</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                t3d(i,j,k) = t3d(i,j,k) - qni3d(i,j,k) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) / cpm(i,j,k); <span class="comment">// Adjust temperature</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                qni3d(i,j,k) = 0.0;                 <span class="comment">// Set snow to zero</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                ns3d(i,j,k) = 0.0;                  <span class="comment">// Set snow number to zero</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;              }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160; </div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;              <span class="keywordflow">if</span> (qg3d(i,j,k) &lt; 1.0e-6) {</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                qr3d(i,j,k) = qr3d(i,j,k) + qg3d(i,j,k);          <span class="comment">// Transfer graupel to rain</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                nr3d(i,j,k) = nr3d(i,j,k) + ng3d(i,j,k);          <span class="comment">// Transfer graupel number to rain</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                t3d(i,j,k) = t3d(i,j,k) - qg3d(i,j,k) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) / cpm(i,j,k);  <span class="comment">// Adjust temperature</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                qg3d(i,j,k) = 0.0;                  <span class="comment">// Set graupel to zero</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                ng3d(i,j,k) = 0.0;                  <span class="comment">// Set graupel number to zero</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;              }</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;              <span class="comment">// Skip to label 300 if concentrations are below thresholds</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;              <span class="keywordflow">if</span> (qc3d(i,j,k) &lt; m_qsmall &amp;&amp; qni3d(i,j,k) &lt; 1.0e-8 &amp;&amp; qr3d(i,j,k) &lt; m_qsmall &amp;&amp; qg3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                skipConcentrations=<span class="keyword">true</span>;<span class="comment">//                goto label_300;</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;              }</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;              <span class="keywordflow">if</span>(!skipConcentrations) {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                ns3d(i,j,k) = amrex::max(0.0,ns3d(i,j,k));</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                nc3d(i,j,k) = amrex::max(0.0,nc3d(i,j,k));</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                nr3d(i,j,k) = amrex::max(0.0,nr3d(i,j,k));</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                ng3d(i,j,k) = amrex::max(0.0,ng3d(i,j,k));</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160; </div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                <span class="comment">// ========================================================================</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                <span class="comment">// USING WRF APPROACH FOR SIZE DISTRIBUTION PARAMETERS</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                <span class="comment">// ========================================================================</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                <span class="comment">// Rain</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                  <span class="comment">// Calculate lambda parameter using cons26 (pi*rhow/6)</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                  lamr(i,j,k) = pow(m_pi * m_rhow * nr3d(i,j,k) / qr3d(i,j,k), 1.0/3.0);</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                  n0r(i,j,k) = nr3d(i,j,k)*lamr(i,j,k);</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160; </div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                  <span class="comment">// Check for slope and adjust vars</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                  <span class="keywordflow">if</span> (lamr(i,j,k) &lt; m_lamminr) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                    lamr(i,j,k) = m_lamminr;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                    n0r(i,j,k) = pow(lamr(i,j,k), 4.0) * qr3d(i,j,k) / (m_pi * m_rhow);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                    nr3d(i,j,k) = n0r(i,j,k) / lamr(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamr(i,j,k) &gt; m_lammaxr) {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                    lamr(i,j,k) = m_lammaxr;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                    n0r(i,j,k) = pow(lamr(i,j,k), 4.0) * qr3d(i,j,k) / (m_pi * m_rhow);</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                    nr3d(i,j,k) = n0r(i,j,k) / lamr(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                  }</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                }</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160; </div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                <span class="comment">// Cloud droplets</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                  <span class="comment">// Calculate air density factor (moist air density)</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                  dum = <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k)/(287.15*t3d(i,j,k));</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160; </div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                  <span class="comment">// MARTIN ET AL. (1994) FORMULA FOR PGAM (WRF implementation)</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                  pgam(i,j,k) = 0.0005714*(nc3d(i,j,k)/1.0e6*dum) + 0.2714;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                  pgam(i,j,k) = 1.0/(pgam(i,j,k)*pgam(i,j,k)) - 1.0;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                  pgam(i,j,k) = amrex::max(pgam(i,j,k), 2.0);</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                  pgam(i,j,k) = amrex::min(pgam(i,j,k), 10.0);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160; </div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                  <span class="comment">// Calculate gamma function values</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                  amrex::Real gamma_pgam_plus_1 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 1.0);</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                  amrex::Real gamma_pgam_plus_4 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0);</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160; </div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                  <span class="comment">// Calculate lambda parameter</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                  lamc(i,j,k) = pow((m_cons26 * nc3d(i,j,k) * gamma_pgam_plus_4) / (qc3d(i,j,k) * gamma_pgam_plus_1), 1.0/3.0);</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160; </div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                  <span class="comment">// Lambda bounds from WRF - 60 micron max diameter, 1 micron min diameter</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                  amrex::Real lambda_min = (pgam(i,j,k) + 1.0)/60.0e-6;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                  amrex::Real lambda_max = (pgam(i,j,k) + 1.0)/1.0e-6;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160; </div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                  <span class="comment">// Check bounds and update number concentration if needed</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                  <span class="keywordflow">if</span> (lamc(i,j,k) &lt; lambda_min) {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                    lamc(i,j,k) = lambda_min;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                    <span class="comment">// Update cloud droplet number using the same formula as in WRF</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                    nc3d(i,j,k) = exp(3.0*log(lamc(i,j,k)) + log(qc3d(i,j,k)) +</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                               log(gamma_pgam_plus_1) - log(gamma_pgam_plus_4))/ m_cons26;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamc(i,j,k) &gt; lambda_max) {</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                    lamc(i,j,k) = lambda_max;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;                    <span class="comment">// Update cloud droplet number using the same formula as in WRF</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                    nc3d(i,j,k) = exp(3.0*log(lamc(i,j,k)) + log(qc3d(i,j,k)) +</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;                               log(gamma_pgam_plus_1) - log(gamma_pgam_plus_4))/ m_cons26;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                  }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                  <span class="comment">// Calculate intercept parameter</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                  cdist1(i,j,k) = nc3d(i,j,k) * pow(lamc(i,j,k), pgam(i,j,k)+1) / gamma_pgam_plus_1;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                }</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160; </div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                <span class="comment">// Snow</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                  <span class="comment">// Calculate lambda parameter</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                  lams(i,j,k) = pow(m_cons1 * ns3d(i,j,k) / qni3d(i,j,k), 1.0/ds0);</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160; </div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                  <span class="comment">// Calculate intercept parameter</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                  n0s(i,j,k) = ns3d(i,j,k) * lams(i,j,k);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                  <span class="comment">// Check for slope and adjust vars</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                  <span class="keywordflow">if</span> (lams(i,j,k) &lt; m_lammins) {</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                    lams(i,j,k) = m_lammins;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                    n0s(i,j,k) = pow(lams(i,j,k), 4.0) * qni3d(i,j,k) / m_cons1;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                    ns3d(i,j,k) = n0s(i,j,k) / lams(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lams(i,j,k) &gt; m_lammaxs) {</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                    lams(i,j,k) = m_lammaxs;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;                    n0s(i,j,k) = pow(lams(i,j,k), 4.0) * qni3d(i,j,k) / m_cons1;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                    ns3d(i,j,k) = n0s(i,j,k) / lams(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                  }</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                }</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160; </div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                <span class="comment">// Graupel</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;                <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                  <span class="comment">// Calculate lambda parameter</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                  lamg(i,j,k) = pow(m_cons2 * ng3d(i,j,k) / qg3d(i,j,k), 1.0/dg0);</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160; </div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                  <span class="comment">// Calculate intercept parameter</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;                  n0g(i,j,k) = ng3d(i,j,k) * lamg(i,j,k);</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160; </div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                  <span class="comment">// Check for slope and adjust vars</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                  <span class="keywordflow">if</span> (lamg(i,j,k) &lt; m_lamming) {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                    lamg(i,j,k) = m_lamming;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                    n0g(i,j,k) = pow(lamg(i,j,k), 4.0) * qg3d(i,j,k) / m_cons2;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                    ng3d(i,j,k) = n0g(i,j,k) / lamg(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamg(i,j,k) &gt; m_lammaxg) {</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                    lamg(i,j,k) = m_lammaxg;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                    n0g(i,j,k) = pow(lamg(i,j,k), 4.0) * qg3d(i,j,k) / m_cons2;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                    ng3d(i,j,k) = n0g(i,j,k) / lamg(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                  }</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                }<span class="comment"></span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">                ////////////////////// First instance of ZERO OUT PROCESS RATES</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment"></span>                <span class="comment">// Zero out process rates</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                prc = 0.0;         <span class="comment">// Cloud water to rain conversion rate (PRC)</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                nprc = 0.0;        <span class="comment">// Change in cloud droplet number due to autoconversion (NPRC)</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                nprc1 = 0.0;       <span class="comment">// Change in rain number due to autoconversion (NPRC1)</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                pra = 0.0;         <span class="comment">// Accretion of cloud water by rain (PRA)</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                npra = 0.0;        <span class="comment">// Change in cloud droplet number due to accretion by rain (NPRA)</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                nragg = 0.0;       <span class="comment">// Self-collection/breakup of rain (NRAGG)</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                nsmlts = 0.0;      <span class="comment">// Loss of snow number during melting (NSMLTS)</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                nsmltr = 0.0;      <span class="comment">// Change in rain number due to snow melting (NSMLTR)</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                evpms = 0.0;       <span class="comment">// Melting snow evaporation rate (EVPMS)</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                pcc = 0.0;         <span class="comment">// Condensation/evaporation of cloud water (PCC)</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                pre = 0.0;         <span class="comment">// Evaporation of rain (PRE)</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                nsubc = 0.0;       <span class="comment">// Loss of cloud droplet number during evaporation (NSUBC)</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                nsubr = 0.0;       <span class="comment">// Loss of rain number during evaporation (NSUBR)</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                pracg = 0.0;       <span class="comment">// Collection of rain by graupel (PRACG)</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                npracg = 0.0;      <span class="comment">// Change in number due to collection of rain by graupel (NPRACG)</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                psmlt = 0.0;       <span class="comment">// Melting of snow (PSMLT)</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                pgmlt = 0.0;       <span class="comment">// Melting of graupel (PGMLT)</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                evpmg = 0.0;       <span class="comment">// Evaporation of melting graupel (EVPMG)</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                pracs = 0.0;       <span class="comment">// Collection of snow by rain (PRACS)</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                npracs = 0.0;      <span class="comment">// Change in number due to collection of snow by rain (NPRACS)</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                ngmltg = 0.0;      <span class="comment">// Loss of graupel number during melting (NGMLTG)</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                ngmltr = 0.0;      <span class="comment">// Change in rain number due to graupel melting (NGMLTR)</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                <span class="comment">// CALCULATION OF MICROPHYSICAL PROCESS RATES, T &gt; 273.15 K</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160; </div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                <span class="comment">// AUTOCONVERSION OF CLOUD LIQUID WATER TO RAIN</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                <span class="comment">// FORMULA FROM BEHENG (1994)</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                <span class="comment">// USING NUMERICAL SIMULATION OF STOCHASTIC COLLECTION EQUATION</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                <span class="comment">// AND INITIAL CLOUD DROPLET SIZE DISTRIBUTION SPECIFIED</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                <span class="comment">// AS A GAMMA DISTRIBUTION</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160; </div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                <span class="comment">// USE MINIMUM VALUE OF 1.E-6 TO PREVENT FLOATING POINT ERROR</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160; </div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= 1.0e-6) {</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                  <span class="comment">// HM ADD 12/13/06, REPLACE WITH NEWER FORMULA</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                  <span class="comment">// FROM KHAIROUTDINOV AND KOGAN 2000, MWR</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                  prc = 1350.0 * std::pow(qc3d(i,j,k), 2.47) *</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                    std::pow((nc3d(i,j,k)/1.0e6*<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)), -1.79);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160; </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                  <span class="comment">// note: nprc1 is change in Nr,</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                  <span class="comment">// nprc is change in Nc</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                  nprc1 = prc / m_cons29;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                  nprc = prc / (qc3d(i,j,k) / nc3d(i,j,k));</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160; </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                  <span class="comment">// hm bug fix 3/20/12</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                  nprc = std::min(nprc, nc3d(i,j,k) / dt);</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                  nprc1 = std::min(nprc1, nprc);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                }</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160; </div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                <span class="comment">// HM ADD 12/13/06, COLLECTION OF SNOW BY RAIN ABOVE FREEZING</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                <span class="comment">// FORMULA FROM IKAWA AND SAITO (1991)</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160; </div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qni3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                  amrex::Real ums_local = asn(i,j,k) * m_cons3 / std::pow(lams(i,j,k), m_bs);</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                  amrex::Real umr_local = arn(i,j,k) * m_cons4 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                  amrex::Real uns_local = asn(i,j,k) * m_cons5 / std::pow(lams(i,j,k), m_bs);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                  amrex::Real unr_local = arn(i,j,k) * m_cons6 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160; </div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                  <span class="comment">// SET REALISTIC LIMITS ON FALLSPEEDS</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                  <span class="comment">// bug fix, 10/08/09</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                  dum = std::pow(m_rhosu/<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.54);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                  ums_local = std::min(ums_local, 1.2*dum);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                  uns_local = std::min(uns_local, 1.2*dum);</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                  umr_local = std::min(umr_local, 9.1*dum);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                  unr_local = std::min(unr_local, 9.1*dum);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160; </div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160; </div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                  <span class="comment">// hm fix, 2/12/13</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                  <span class="comment">// for above freezing conditions to get accelerated melting of snow,</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                  <span class="comment">// we need collection of rain by snow (following Lin et al. 1983)</span><span class="comment"></span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">                  ////////////////////////Might need pow expanding</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment"></span>                  pracs = m_cons41 * (std::sqrt(std::pow(1.2*umr_local-0.95*ums_local, 2) +</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                                                0.08*ums_local*umr_local) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                                      n0r(i,j,k) * n0s(i,j,k) / std::pow(lamr(i,j,k), 3) *</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                                      (5.0/(std::pow(lamr(i,j,k), 3) * lams(i,j,k)) +</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                                       2.0/(std::pow(lamr(i,j,k), 2) * std::pow(lams(i,j,k), 2)) +</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                                       0.5/(lamr(i,j,k) * std::pow(lams(i,j,k), 3))));</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                }</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                <span class="comment">// ADD COLLECTION OF GRAUPEL BY RAIN ABOVE FREEZING</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                <span class="comment">// ASSUME ALL RAIN COLLECTION BY GRAUPEL ABOVE FREEZING IS SHED</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                <span class="comment">// ASSUME SHED DROPS ARE 1 MM IN SIZE</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160; </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qg3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                  amrex::Real umg_local = agn(i,j,k) * m_cons7 / std::pow(lamg(i,j,k), m_bg);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                  amrex::Real umr_local = arn(i,j,k) * m_cons4 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                  amrex::Real ung_local = agn(i,j,k) * m_cons8 / std::pow(lamg(i,j,k), m_bg);</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                  amrex::Real unr_local = arn(i,j,k) * m_cons6 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160; </div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                  <span class="comment">// SET REALISTIC LIMITS ON FALLSPEEDS</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                  <span class="comment">// bug fix, 10/08/09</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                  dum = std::pow(m_rhosu/<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.54);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                  umg_local = std::min(umg_local, 20.0*dum);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                  ung_local = std::min(ung_local, 20.0*dum);</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                  umr_local = std::min(umr_local, 9.1*dum);</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                  unr_local = std::min(unr_local, 9.1*dum);</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                  <span class="comment">// PRACG IS MIXING RATIO OF RAIN PER SEC COLLECTED BY GRAUPEL/HAIL</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                  pracg = m_cons41 * (std::sqrt(std::pow(1.2*umr_local-0.95*umg_local, 2) +</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                                                0.08*umg_local*umr_local) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                                      n0r(i,j,k) * n0g(i,j,k) / std::pow(lamr(i,j,k), 3) *</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                                      (5.0/(std::pow(lamr(i,j,k), 3) * lamg(i,j,k)) +</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                                       2.0/(std::pow(lamr(i,j,k), 2) * std::pow(lamg(i,j,k), 2)) +</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                                       0.5/(lamr(i,j,k) * std::pow(lamg(i,j,k), 3))));</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160; </div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                  <span class="comment">// ASSUME 1 MM DROPS ARE SHED, GET NUMBER SHED PER SEC</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                  dum = pracg/5.2e-7;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160; </div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                  npracg = m_cons32 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * (std::sqrt(1.7*std::pow(unr_local-ung_local, 2) +</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                                                              0.3*unr_local*ung_local) * n0r(i,j,k) * n0g(i,j,k) *</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                                                    (1.0/(std::pow(lamr(i,j,k), 3) * lamg(i,j,k)) +</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                                                     1.0/(std::pow(lamr(i,j,k), 2) * std::pow(lamg(i,j,k), 2)) +</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                                                     1.0/(lamr(i,j,k) * std::pow(lamg(i,j,k), 3))));</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                  <span class="comment">// hm 7/15/13, remove limit so that the number of collected drops can smaller than</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                  <span class="comment">// number of shed drops</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                  npracg = npracg - dum;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                }</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                <span class="comment">// ACCRETION OF CLOUD LIQUID WATER BY RAIN</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                <span class="comment">// CONTINUOUS COLLECTION EQUATION WITH</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                <span class="comment">// GRAVITATIONAL COLLECTION KERNEL, DROPLET FALL SPEED NEGLECTED</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160; </div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qc3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                  <span class="comment">// 12/13/06 HM ADD, REPLACE WITH NEWER FORMULA FROM</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                  <span class="comment">// KHAIROUTDINOV AND KOGAN 2000, MWR</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                  dum = qc3d(i,j,k) * qr3d(i,j,k);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                  pra = 67.0 * std::pow(dum, 1.15);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                  npra = pra / (qc3d(i,j,k) / nc3d(i,j,k));</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                }</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160; </div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                <span class="comment">// SELF-COLLECTION OF RAIN DROPS</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                <span class="comment">// FROM BEHENG(1994)</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                <span class="comment">// FROM NUMERICAL SIMULATION OF THE STOCHASTIC COLLECTION EQUATION</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                <span class="comment">// AS DESCRIBED ABOVE FOR AUTOCONVERSION</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160; </div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                  <span class="comment">// include breakup add 10/09/09</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                  dum1 = 300.0e-6;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                  <span class="keywordflow">if</span> (1.0/lamr(i,j,k) &lt; dum1) {</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                    dum = 1.0;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                    dum = 2.0 - std::exp(2300.0 * (1.0/lamr(i,j,k) - dum1));</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                  }</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                  nragg = -5.78 * dum * nr3d(i,j,k) * qr3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                <span class="comment">// CALCULATE EVAP OF RAIN (RUTLEDGE AND HOBBS 1983)</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                  epsr = 2.0 * m_pi * n0r(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv *</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                    (m_f1r/(lamr(i,j,k)*lamr(i,j,k)) +</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                     m_f2r * std::sqrt(arn(i,j,k)*<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)/mu(i,j,k)) *</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                     std::pow(sc_schmidt, 1.0/3.0) * m_cons9 /</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                     std::pow(lamr(i,j,k), m_cons34));</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                  epsr = 0.0;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                }</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                <span class="comment">// NO CONDENSATION ONTO RAIN, ONLY EVAP ALLOWED</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                <span class="keywordflow">if</span> (qv3d(i,j,k) &lt; qvs) {</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                  pre = epsr * (qv3d(i,j,k) - qvs) / ab;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                  pre = std::min(pre, 0.0);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                  pre = 0.0;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                }</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                <span class="comment">// MELTING OF SNOW</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                <span class="comment">// SNOW MAY PERSIST ABOVE FREEZING, FORMULA FROM RUTLEDGE AND HOBBS, 1984</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                <span class="comment">// IF WATER SUPERSATURATION, SNOW MELTS TO FORM RAIN</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160; </div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                  <span class="comment">// fix 053011</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                  <span class="comment">// HM, MODIFY FOR V3.2, ADD ACCELERATED MELTING DUE TO COLLISION WITH RAIN</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                  dum = -m_cpw/<a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) * (t3d(i,j,k) - 273.15) * pracs;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160; </div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                  <span class="comment">// hm fix 1/20/15</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                  psmlt = 2.0 * m_pi * n0s(i,j,k) * kap * (273.15 - t3d(i,j,k)) /</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;                    <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) * (m_f1s/(lams(i,j,k)*lams(i,j,k)) +</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                           m_f2s * std::sqrt(asn(i,j,k)*<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)/mu(i,j,k)) *</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                           std::pow(sc_schmidt, 1.0/3.0) * m_cons10 /</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                           std::pow(lams(i,j,k), m_cons35)) + dum;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160; </div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                  <span class="comment">// IN WATER SUBSATURATION, SNOW MELTS AND EVAPORATES</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                  <span class="keywordflow">if</span> (qvqvs &lt; 1.0) {</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                    epss = 2.0 * m_pi * n0s(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv *</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                      (m_f1s/(lams(i,j,k)*lams(i,j,k)) +</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                       m_f2s * std::sqrt(asn(i,j,k)*<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)/mu(i,j,k)) *</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                       std::pow(sc_schmidt, 1.0/3.0) * m_cons10 /</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                       std::pow(lams(i,j,k), m_cons35));</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160; </div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                    <span class="comment">// hm fix 8/4/08</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                    evpms = (qv3d(i,j,k) - qvs) * epss / ab;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                    evpms = std::max(evpms, psmlt);</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                    psmlt = psmlt - evpms;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                  }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                }</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                <span class="comment">// MELTING OF GRAUPEL</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                <span class="comment">// GRAUPEL MAY PERSIST ABOVE FREEZING, FORMULA FROM RUTLEDGE AND HOBBS, 1984</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                <span class="comment">// IF WATER SUPERSATURATION, GRAUPEL MELTS TO FORM RAIN</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                  <span class="comment">// fix 053011</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                  <span class="comment">// HM, MODIFY FOR V3.2, ADD ACCELERATED MELTING DUE TO COLLISION WITH RAIN</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160; </div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                  dum = -m_cpw/<a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) * (t3d(i,j,k) - 273.15) * pracg;</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160; </div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                  <span class="comment">// hm fix 1/20/15</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                  pgmlt = 2.0 * m_pi * n0g(i,j,k) * kap * (273.15 - t3d(i,j,k)) /</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                    <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) * (m_f1s/(lamg(i,j,k)*lamg(i,j,k)) +</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                           m_f2s * std::sqrt(agn(i,j,k)*<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)/mu(i,j,k)) *</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                           std::pow(sc_schmidt, 1.0/3.0) * m_cons11 /</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                           std::pow(lamg(i,j,k), m_cons36)) + dum;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160; </div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                  <span class="comment">// IN WATER SUBSATURATION, GRAUPEL MELTS AND EVAPORATES</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                  <span class="keywordflow">if</span> (qvqvs &lt; 1.0) {</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                    epsg = 2.0 * m_pi * n0g(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv *</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                      (m_f1s/(lamg(i,j,k)*lamg(i,j,k)) +</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                       m_f2s * std::sqrt(agn(i,j,k)*<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)/mu(i,j,k)) *</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                       std::pow(sc_schmidt, 1.0/3.0) * m_cons11 /</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                       std::pow(lamg(i,j,k), m_cons36));</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160; </div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                    <span class="comment">// hm fix 8/4/08</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                    evpmg = (qv3d(i,j,k) - qvs) * epsg / ab;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                    evpmg = std::max(evpmg, pgmlt);</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                    pgmlt = pgmlt - evpmg;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                  }</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                }</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                <span class="comment">// HM, V3.2</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                <span class="comment">// RESET PRACG AND PRACS TO ZERO, THIS IS DONE BECAUSE THERE IS NO</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                <span class="comment">// TRANSFER OF MASS FROM SNOW AND GRAUPEL TO RAIN DIRECTLY FROM COLLECTION</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                <span class="comment">// ABOVE FREEZING, IT IS ONLY USED FOR ENHANCEMENT OF MELTING AND SHEDDING</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160; </div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                pracg = 0.0;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;                pracs = 0.0;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                <span class="comment">// CONSERVATION OF QC</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                dum = (prc + pra) * dt;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160; </div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qc3d(i,j,k) &amp;&amp; qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                  ratio = qc3d(i,j,k) / dum;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                  prc = prc * ratio;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                  pra = pra * ratio;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                }</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160; </div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                <span class="comment">// CONSERVATION OF SNOW</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                dum = (-psmlt - evpms + pracs) * dt;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160; </div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qni3d(i,j,k) &amp;&amp; qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                  <span class="comment">// NO SOURCE TERMS FOR SNOW AT T &gt; FREEZING</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                  ratio = qni3d(i,j,k) / dum;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                  psmlt = psmlt * ratio;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                  evpms = evpms * ratio;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;                  pracs = pracs * ratio;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                }</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160; </div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                <span class="comment">// CONSERVATION OF GRAUPEL</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                dum = (-pgmlt - evpmg + pracg) * dt;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160; </div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qg3d(i,j,k) &amp;&amp; qg3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                  <span class="comment">// NO SOURCE TERM FOR GRAUPEL ABOVE FREEZING</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;                  ratio = qg3d(i,j,k) / dum;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                  pgmlt = pgmlt * ratio;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                  evpmg = evpmg * ratio;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                  pracg = pracg * ratio;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                }</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160; </div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                <span class="comment">// CONSERVATION OF QR</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                <span class="comment">// HM 12/13/06, ADDED CONSERVATION OF RAIN SINCE PRE IS NEGATIVE</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160; </div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                dum = (-pracs - pracg - pre - pra - prc + psmlt + pgmlt) * dt;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160; </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qr3d(i,j,k) &amp;&amp; qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                  ratio = (qr3d(i,j,k)/dt + pracs + pracg + pra + prc - psmlt - pgmlt) / (-pre);</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                  pre = pre * ratio;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                }</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                <span class="comment">// Update tendencies</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;                qv3dten(i,j,k) = qv3dten(i,j,k) + (-pre - evpms - evpmg);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160; </div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                t3dten(i,j,k) = t3dten(i,j,k) + (pre * xxlv(i,j,k) +</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                                                 (evpms + evpmg) * xxls(i,j,k) +</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                                                 (psmlt + pgmlt - pracs - pracg) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k)) / cpm(i,j,k);</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160; </div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                qc3dten(i,j,k) = qc3dten(i,j,k) + (-pra - prc);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                qr3dten(i,j,k) = qr3dten(i,j,k) + (pre + pra + prc - psmlt - pgmlt + pracs + pracg);</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                qni3dten(i,j,k) = qni3dten(i,j,k) + (psmlt + evpms - pracs);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                qg3dten(i,j,k) = qg3dten(i,j,k) + (pgmlt + evpmg - pracg);</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160; </div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                <span class="comment">// fix 053011</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                <span class="comment">// HM, bug fix 5/12/08, npracg is subtracted from nr not ng</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                nc3dten(i,j,k) = nc3dten(i,j,k) + (-npra - nprc);</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                nr3dten(i,j,k) = nr3dten(i,j,k) + (nprc1 + nragg - npracg);</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160; </div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                <span class="comment">// HM ADD, WRF-CHEM, ADD TENDENCIES FOR C2PREC</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                c2prec = pra + prc;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160; </div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                <span class="keywordflow">if</span> (pre &lt; 0.0) {</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                  dum = pre * dt / qr3d(i,j,k);</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                  nsubr = dum * nr3d(i,j,k) / dt;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                }</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160; </div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                <span class="keywordflow">if</span> (evpms + psmlt &lt; 0.0) {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                  dum = (evpms + psmlt) * dt / qni3d(i,j,k);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                  nsmlts = dum * ns3d(i,j,k) / dt;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                }</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160; </div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                <span class="keywordflow">if</span> (psmlt &lt; 0.0) {</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                  dum = psmlt * dt / qni3d(i,j,k);</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                  nsmltr = dum * ns3d(i,j,k) / dt;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                }</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160; </div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;                <span class="keywordflow">if</span> (evpmg + pgmlt &lt; 0.0) {</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                  dum = (evpmg + pgmlt) * dt / qg3d(i,j,k);</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                  ngmltg = dum * ng3d(i,j,k) / dt;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                }</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160; </div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                <span class="keywordflow">if</span> (pgmlt &lt; 0.0) {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                  dum = pgmlt * dt / qg3d(i,j,k);</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                  ngmltr = dum * ng3d(i,j,k) / dt;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160; </div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                ns3dten(i,j,k) = ns3dten(i,j,k) + nsmlts;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                ng3dten(i,j,k) = ng3dten(i,j,k) + ngmltg;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                nr3dten(i,j,k) = nr3dten(i,j,k) + (nsubr - nsmltr - ngmltr);</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160; </div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;              }</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;              <span class="comment">//Right after 300 CONTINUE</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">//            label_300:</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;              <span class="comment">// Calculate saturation adjustment to condense extra vapor above water saturation</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;              dumt = t3d(i,j,k) + dt * t3dten(i,j,k);</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;              dumqv = qv3d(i,j,k) + dt * qv3dten(i,j,k);</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160; </div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;              <span class="comment">// Fix for low pressure (added 5/12/10)</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;              dum = std::min(0.99 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k), <a class="code" href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7">calc_saturation_vapor_pressure</a>(dumt, 0));</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;              dumqss = m_ep_2 * dum / (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) - dum);</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;              dumqc = qc3d(i,j,k) + dt * qc3dten(i,j,k);</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;              dumqc = std::max(dumqc, 0.0);</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160; </div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;              <span class="comment">// Saturation adjustment for liquid</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;              dums = dumqv - dumqss;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;              pcc = dums / (1.0 + std::pow(xxlv(i,j,k), 2) * dumqss / (cpm(i,j,k) * m_Rv * std::pow(dumt, 2))) / dt;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;              <span class="keywordflow">if</span> (pcc * dt + dumqc &lt; 0.0) {</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                pcc = -dumqc / dt;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;              }</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160; </div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;              <span class="comment">// Update tendencies</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;              qv3dten(i,j,k) -= pcc;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;              t3dten(i,j,k) += pcc * xxlv(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;              qc3dten(i,j,k) += pcc;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;            } <span class="keywordflow">else</span> { <span class="comment">//cold</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;              <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;              <span class="comment">// ALLOW FOR CONSTANT DROPLET NUMBER</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;              <span class="comment">// INUM = 0, PREDICT DROPLET NUMBER</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;              <span class="comment">// INUM = 1, SET CONSTANT DROPLET NUMBER</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160; </div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;              <span class="keywordflow">if</span> (m_inum == 1) {</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                <span class="comment">// CONVERT NDCNST FROM CM-3 TO KG-1</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                <span class="comment">// Note: NDCNST constant would need to be defined elsewhere</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                nc3d(i,j,k) = m_ndcnst * 1.0e6 / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k); <span class="comment">// Set cloud droplet number concentration</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;              }</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160; </div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;              ni3d(i,j,k) = amrex::max(0.0,ni3d(i,j,k));</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;              ns3d(i,j,k) = amrex::max(0.0,ns3d(i,j,k));</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;              nc3d(i,j,k) = amrex::max(0.0,nc3d(i,j,k));</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;              nr3d(i,j,k) = amrex::max(0.0,nr3d(i,j,k));</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;              ng3d(i,j,k) = amrex::max(0.0,ng3d(i,j,k));</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160; </div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;              <span class="comment">// ========================================================================</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;              <span class="comment">// USING WRF APPROACH FOR SIZE DISTRIBUTION PARAMETERS</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;              <span class="comment">// ========================================================================</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;              <span class="comment">// Rain</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;              <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                <span class="comment">// Calculate lambda parameter using cons26 (pi*rhow/6)</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                lamr(i,j,k) = pow(m_pi * m_rhow * nr3d(i,j,k) / qr3d(i,j,k), 1.0/3.0);</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160; </div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                <span class="comment">// Check for slope and adjust vars</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                <span class="keywordflow">if</span> (lamr(i,j,k) &lt; m_lamminr) {</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                  lamr(i,j,k) = m_lamminr;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;                  n0r(i,j,k) = pow(lamr(i,j,k), 4.0) * qr3d(i,j,k) / (m_pi * m_rhow);</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                  nr3d(i,j,k) = n0r(i,j,k) / lamr(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamr(i,j,k) &gt; m_lammaxr) {</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                  lamr(i,j,k) = m_lammaxr;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                  n0r(i,j,k) = pow(lamr(i,j,k), 4.0) * qr3d(i,j,k) / (m_pi * m_rhow);</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                  nr3d(i,j,k) = n0r(i,j,k) / lamr(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                  <span class="comment">// Calculate intercept parameter using WRF formula</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                  n0r(i,j,k) = pow(lamr(i,j,k), 4.0) * qr3d(i,j,k) / (m_pi * m_rhow);</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                }</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;              }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160; </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160; </div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;              <span class="comment">// Cloud droplets</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;              <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                <span class="comment">// Calculate air density factor (moist air density)</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                dum = <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k)/(287.15*t3d(i,j,k));</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160; </div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                <span class="comment">// MARTIN ET AL. (1994) FORMULA FOR PGAM (WRF implementation)</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                pgam(i,j,k) = 0.0005714*(nc3d(i,j,k)/1.0e6*dum) + 0.2714;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                pgam(i,j,k) = 1.0/(std::pow(pgam(i,j,k), 2)) - 1.0;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                pgam(i,j,k) = amrex::max(pgam(i,j,k), 2.0);</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                pgam(i,j,k) = amrex::min(pgam(i,j,k), 10.0);</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160; </div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                <span class="comment">// Calculate gamma function values</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                amrex::Real gamma_pgam_plus_1 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 1.0);</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                amrex::Real gamma_pgam_plus_4 = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0);</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160; </div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                <span class="comment">// Calculate lambda parameter</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                lamc(i,j,k) = pow((m_cons26 * nc3d(i,j,k) * gamma_pgam_plus_4) / (qc3d(i,j,k) * gamma_pgam_plus_1), 1.0/3.0);</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160; </div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                <span class="comment">// Lambda bounds from WRF - 60 micron max diameter, 1 micron min diameter</span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                amrex::Real lambda_min = (pgam(i,j,k) + 1.0)/60.0e-6;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                amrex::Real lambda_max = (pgam(i,j,k) + 1.0)/1.0e-6;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160; </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                <span class="comment">// Check bounds and update number concentration if needed</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                <span class="keywordflow">if</span> (lamc(i,j,k) &lt; lambda_min) {</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                  lamc(i,j,k) = lambda_min;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                  <span class="comment">// Update cloud droplet number using the same formula as in WRF</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                  nc3d(i,j,k) = exp(3.0*log(lamc(i,j,k)) + log(qc3d(i,j,k)) +</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                                    log(gamma_pgam_plus_1) - log(gamma_pgam_plus_4))/ m_cons26;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamc(i,j,k) &gt; lambda_max) {</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                  lamc(i,j,k) = lambda_max;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                  <span class="comment">// Update cloud droplet number using the same formula as in WRF</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                  nc3d(i,j,k) = exp(3.0*log(lamc(i,j,k)) + log(qc3d(i,j,k)) +</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                                    log(gamma_pgam_plus_1) - log(gamma_pgam_plus_4))/ m_cons26;</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160; </div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                <span class="comment">// Calculate intercept parameter</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                cdist1(i,j,k) = nc3d(i,j,k) / gamma_pgam_plus_1;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;              }</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160; </div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;              <span class="comment">// Snow</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;              <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                <span class="comment">// Calculate lambda parameter</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                lams(i,j,k) = pow(m_cons1 * ns3d(i,j,k) / qni3d(i,j,k), 1.0/ds0);</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160; </div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                <span class="comment">// Calculate intercept parameter</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                n0s(i,j,k) = ns3d(i,j,k) * lams(i,j,k);</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160; </div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                <span class="comment">// Check for slope and adjust vars</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                <span class="keywordflow">if</span> (lams(i,j,k) &lt; m_lammins) {</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                  lams(i,j,k) = m_lammins;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                  n0s(i,j,k) = pow(lams(i,j,k), 4.0) * qni3d(i,j,k) / m_cons1;</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                  ns3d(i,j,k) = n0s(i,j,k) / lams(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lams(i,j,k) &gt; m_lammaxs) {</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                  lams(i,j,k) = m_lammaxs;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                  n0s(i,j,k) = pow(lams(i,j,k), 4.0) * qni3d(i,j,k) / m_cons1;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                  ns3d(i,j,k) = n0s(i,j,k) / lams(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                }</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;              }</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160; </div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;              <span class="comment">// Cloud ice</span></div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;              <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                <span class="comment">// Calculate lambda parameter</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                lami(i,j,k) = pow(m_cons12 * ni3d(i,j,k) / qi3d(i,j,k), 1.0/3.0);</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160; </div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                <span class="comment">// Calculate intercept parameter (initial calculation)</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                n0i(i,j,k) = ni3d(i,j,k) * lami(i,j,k);</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160; </div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                <span class="comment">// Check for slope (apply bounds)</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                <span class="keywordflow">if</span> (lami(i,j,k) &lt; m_lammini) {</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                  lami(i,j,k) = m_lammini;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                  <span class="comment">// Recalculate n0i(i,j,k) when lambda is adjusted</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                  n0i(i,j,k) = pow(lami(i,j,k), 4.0) * qi3d(i,j,k) / m_cons12;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                  <span class="comment">// Update ni3d when lambda is adjusted</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                  ni3d(i,j,k) = n0i(i,j,k) / lami(i,j,k);</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lami(i,j,k) &gt; m_lammaxi) {</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                  lami(i,j,k) = m_lammaxi;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                  <span class="comment">// Recalculate n0i(i,j,k) when lambda is adjusted</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                  n0i(i,j,k) = pow(lami(i,j,k), 4.0) * qi3d(i,j,k) / m_cons12;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                  <span class="comment">// Update ni3d when lambda is adjusted</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                  ni3d(i,j,k) = n0i(i,j,k) / lami(i,j,k);</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                }</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;              }</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;              <span class="comment">// Graupel</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;              <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                <span class="comment">// Calculate lambda parameter</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                lamg(i,j,k) = pow(m_cons2 * ng3d(i,j,k) / qg3d(i,j,k), 1.0/dg0);</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160; </div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                <span class="comment">// Calculate intercept parameter</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                n0g(i,j,k) = ng3d(i,j,k) * lamg(i,j,k);</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160; </div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                <span class="comment">// Check for slope and adjust vars</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                <span class="keywordflow">if</span> (lamg(i,j,k) &lt; m_lamming) {</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                  lamg(i,j,k) = m_lamming;</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                  n0g(i,j,k) = pow(lamg(i,j,k), 4.0) * qg3d(i,j,k) / m_cons2;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                  ng3d(i,j,k) = n0g(i,j,k) / lamg(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamg(i,j,k) &gt; m_lammaxg) {</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                  lamg(i,j,k) = m_lammaxg;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                  n0g(i,j,k) = pow(lamg(i,j,k), 4.0) * qg3d(i,j,k) / m_cons2;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                  ng3d(i,j,k) = n0g(i,j,k) / lamg(i,j,k);  <span class="comment">// Update number concentration</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                }</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;              }<span class="comment"></span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="comment">                ////////////////////// Second instance of ZERO OUT PROCESS RATES</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment"></span>                <span class="comment">// Zero out process rates</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                mnuccc = 0.0;      <span class="comment">// Change Q due to contact freezing droplets (MNUCCC)</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                nnuccc = 0.0;      <span class="comment">// Change N due to contact freezing droplets (NNUCCC)</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                prc = 0.0;         <span class="comment">// Autoconversion droplets (PRC)</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                nprc = 0.0;        <span class="comment">// Change NC autoconversion droplets (NPRC)</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                nprc1 = 0.0;       <span class="comment">// Change NR autoconversion droplets (NPRC1)</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                nsagg = 0.0;       <span class="comment">// Self-collection of snow (NSAGG)</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                psacws = 0.0;      <span class="comment">// Change Q droplet accretion by snow (PSACWS)</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                npsacws = 0.0;     <span class="comment">// Change N droplet accretion by snow (NPSACWS)</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                psacwi = 0.0;      <span class="comment">// Change Q droplet accretion by cloud ice (PSACWI)</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                npsacwi = 0.0;     <span class="comment">// Change N droplet accretion by cloud ice (NPSACWI)</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                pracs = 0.0;       <span class="comment">// Change Q rain-snow collection (PRACS)</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                npracs = 0.0;      <span class="comment">// Change N rain-snow collection (NPRACS)</span></div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                nmults = 0.0;      <span class="comment">// Ice multiplication due to riming droplets by snow (NMULTS)</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                qmults = 0.0;      <span class="comment">// Change Q due to ice multiplication droplets/snow (QMULTS)</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                nmultr = 0.0;      <span class="comment">// Ice multiplication due to riming rain by snow (NMULTR)</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                qmultr = 0.0;      <span class="comment">// Change Q due to ice multiplication rain/snow (QMULTR)</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                nmultg = 0.0;      <span class="comment">// Ice multiplication due to accretion droplets by graupel (NMULTG)</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                qmultg = 0.0;      <span class="comment">// Change Q due to ice multiplication droplets/graupel (QMULTG)</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                nmultrg = 0.0;     <span class="comment">// Ice multiplication due to accretion rain by graupel (NMULTRG)</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                qmultrg = 0.0;     <span class="comment">// Change Q due to ice multiplication rain/graupel (QMULTRG)</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                mnuccr = 0.0;      <span class="comment">// Change Q due to contact freezing rain (MNUCCR)</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                nnuccr = 0.0;      <span class="comment">// Change N due to contact freezing rain (NNUCCR)</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                pra = 0.0;         <span class="comment">// Accretion droplets by rain (PRA)</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                npra = 0.0;        <span class="comment">// Change N due to droplet accretion by rain (NPRA)</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                nragg = 0.0;       <span class="comment">// Self-collection/breakup of rain (NRAGG)</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                prci = 0.0;        <span class="comment">// Change Q autoconversion cloud ice to snow (PRCI)</span></div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                nprci = 0.0;       <span class="comment">// Change N autoconversion cloud ice by snow (NPRCI)</span></div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                prai = 0.0;        <span class="comment">// Change Q accretion cloud ice by snow (PRAI)</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                nprai = 0.0;       <span class="comment">// Change N accretion cloud ice (NPRAI)</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                nnuccd = 0.0;      <span class="comment">// Change N freezing aerosol (primary ice nucleation) (NNUCCD)</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                mnuccd = 0.0;      <span class="comment">// Change Q freezing aerosol (primary ice nucleation) (MNUCCD)</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                pcc = 0.0;         <span class="comment">// Condensation/evaporation droplets (PCC)</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                pre = 0.0;         <span class="comment">// Evaporation of rain (PRE)</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                prd = 0.0;         <span class="comment">// Deposition cloud ice (PRD)</span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                prds = 0.0;        <span class="comment">// Deposition snow (PRDS)</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                eprd = 0.0;        <span class="comment">// Sublimation cloud ice (EPRD)</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                eprds = 0.0;       <span class="comment">// Sublimation snow (EPRDS)</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                nsubc = 0.0;       <span class="comment">// Loss of NC during evaporation (NSUBC)</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                nsubi = 0.0;       <span class="comment">// Loss of NI during sublimation (NSUBI)</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                nsubs = 0.0;       <span class="comment">// Loss of NS during sublimation (NSUBS)</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                nsubr = 0.0;       <span class="comment">// Loss of NR during evaporation (NSUBR)</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                piacr = 0.0;       <span class="comment">// Change QR, ice-rain collection (PIACR)</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                niacr = 0.0;       <span class="comment">// Change N, ice-rain collection (NIACR)</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                praci = 0.0;       <span class="comment">// Change QI, ice-rain collection (PRACI)</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                piacrs = 0.0;      <span class="comment">// Change QR, ice rain collision, added to snow (PIACRS)</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                niacrs = 0.0;      <span class="comment">// Change N, ice rain collision, added to snow (NIACRS)</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                pracis = 0.0;      <span class="comment">// Change QI, ice rain collision, added to snow (PRACIS)</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160; </div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                <span class="comment">// Graupel processes</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                pracg = 0.0;       <span class="comment">// Change in Q collection rain by graupel (PRACG)</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                psacr = 0.0;       <span class="comment">// Conversion due to collection of snow by rain (PSACR)</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                psacwg = 0.0;      <span class="comment">// Change in Q collection droplets by graupel (PSACWG)</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                pgsacw = 0.0;      <span class="comment">// Conversion Q to graupel due to collection droplets by snow (PGSACW)</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                pgracs = 0.0;      <span class="comment">// Conversion Q to graupel due to collection rain by snow (PGRACS)</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                prdg = 0.0;        <span class="comment">// Deposition of graupel (PRDG)</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                eprdg = 0.0;       <span class="comment">// Sublimation of graupel (EPRDG)</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                npracg = 0.0;      <span class="comment">// Change N collection rain by graupel (NPRACG)</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                npsacwg = 0.0;     <span class="comment">// Change N collection droplets by graupel (NPSACWG)</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                nscng = 0.0;       <span class="comment">// Change N conversion to graupel due to collection droplets by snow (NSCNG)</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                ngracs = 0.0;      <span class="comment">// Change N conversion to graupel due to collection rain by snow (NGRACS)</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                nsubg = 0.0;       <span class="comment">// Change N sublimation/deposition of graupel (NSUBG)</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment">                ////////////////////// CALCULATION OF MICROPHYSICAL PROCESS RATES</span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment"></span>                <span class="comment">// FREEZING OF CLOUD DROPLETS - ONLY ALLOWED BELOW -4C</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= m_qsmall &amp;&amp; t3d(i,j,k) &lt; 269.15) {</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                  <span class="comment">// NUMBER OF CONTACT NUCLEI (M^-3) FROM MEYERS ET AL., 1992</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                  <span class="comment">// FACTOR OF 1000 IS TO CONVERT FROM L^-1 TO M^-3</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                  <span class="comment">// MEYERS CURVE</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                  amrex::Real nacnt = std::exp(-2.80 + 0.262 * (273.15 - t3d(i,j,k))) * 1000.0;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160; </div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                  <span class="comment">// MEAN FREE PATH</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                  dum = 7.37 * t3d(i,j,k) / (288.0 * 10.0 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k)) / 100.0;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160; </div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                  <span class="comment">// EFFECTIVE DIFFUSIVITY OF CONTACT NUCLEI</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                  <span class="comment">// BASED ON BROWNIAN DIFFUSION</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                  amrex::Real dap = m_cons37 * t3d(i,j,k) * (1.0 + dum / m_rin) / mu(i,j,k);</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160; </div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                  <span class="comment">// CONTACT FREEZING</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                  mnuccc = m_cons38 * dap * nacnt * std::exp(std::log(cdist1(i,j,k)) +</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                                                             std::log(<a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 5.0)) - 4.0 * std::log(lamc(i,j,k)));</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                  nnuccc = 2.0 * m_pi * dap * nacnt * cdist1(i,j,k) *</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                    <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 2.0) / lamc(i,j,k);</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160; </div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                  <span class="comment">// IMMERSION FREEZING (BIGG 1953)</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                  <span class="comment">// hm 7/15/13 fix for consistency w/ original formula</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                  mnuccc = mnuccc + m_cons39 *</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                    std::exp(std::log(cdist1(i,j,k)) + std::log(<a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(7.0 + pgam(i,j,k))) - 6.0 * std::log(lamc(i,j,k))) *</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                    (std::exp(m_aimm * (273.15 - t3d(i,j,k))) - 1.0);</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160; </div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                  nnuccc = nnuccc +</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                    m_cons40 * std::exp(std::log(cdist1(i,j,k)) + std::log(<a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0)) - 3.0 * std::log(lamc(i,j,k))) *</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                    (std::exp(m_aimm * (273.15 - t3d(i,j,k))) - 1.0);</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160; </div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                  <span class="comment">// PUT IN A CATCH HERE TO PREVENT DIVERGENCE BETWEEN NUMBER CONC. AND</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                  <span class="comment">// MIXING RATIO, SINCE STRICT CONSERVATION NOT CHECKED FOR NUMBER CONC</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                  nnuccc = std::min(nnuccc, nc3d(i,j,k) / dt);</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                }</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160; </div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                <span class="comment">// AUTOCONVERSION OF CLOUD LIQUID WATER TO RAIN</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                <span class="comment">// FORMULA FROM BEHENG (1994)</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                <span class="comment">// USING NUMERICAL SIMULATION OF STOCHASTIC COLLECTION EQUATION</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                <span class="comment">// AND INITIAL CLOUD DROPLET SIZE DISTRIBUTION SPECIFIED</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                <span class="comment">// AS A GAMMA DISTRIBUTION</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160; </div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                <span class="comment">// USE MINIMUM VALUE OF 1.E-6 TO PREVENT FLOATING POINT ERROR</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= 1.0e-6) {</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                  <span class="comment">// hm add 12/13/06, replace with newer formula</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                  <span class="comment">// from khairoutdinov and kogan 2000, mwr</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                  prc = 1350.0 * std::pow(qc3d(i,j,k), 2.47) *</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                    std::pow((nc3d(i,j,k) / 1.0e6 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)), -1.79);</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160; </div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                  <span class="comment">// note: nprc1 is change in nr,</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                  <span class="comment">// nprc is change in nc</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                  nprc1 = prc / m_cons29;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                  nprc = prc / (qc3d(i,j,k) / nc3d(i,j,k));</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160; </div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                  <span class="comment">// hm bug fix 3/20/12</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                  nprc = std::min(nprc, nc3d(i,j,k) / dt);</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                  nprc1 = std::min(nprc1, nprc);</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                }</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                <span class="comment">// SNOW AGGREGATION FROM PASSARELLI, 1978, USED BY REISNER, 1998</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                <span class="comment">// THIS IS HARD-WIRED FOR BS = 0.4 FOR NOW</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                  nsagg = m_cons15 * asn(i,j,k) * std::pow(<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), ((2.0 + m_bs) / 3.0)) *</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                    std::pow(qni3d(i,j,k), ((2.0 + m_bs) / 3.0)) *</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                    std::pow((ns3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k)), ((4.0 - m_bs) / 3.0)) / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                }</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160; </div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                <span class="comment">// ACCRETION OF CLOUD DROPLETS ONTO SNOW/GRAUPEL</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                <span class="comment">// HERE USE CONTINUOUS COLLECTION EQUATION WITH</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                <span class="comment">// SIMPLE GRAVITATIONAL COLLECTION KERNEL IGNORING</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160; </div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                <span class="comment">// SNOW</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                  psacws = m_cons13 * asn(i,j,k) * qc3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                    n0s(i,j,k) / std::pow(lams(i,j,k), (m_bs + 3.0));</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160; </div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                  npsacws = m_cons13 * asn(i,j,k) * nc3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                    n0s(i,j,k) / std::pow(lams(i,j,k), (m_bs + 3.0));</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                }</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160; </div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                <span class="comment">// COLLECTION OF CLOUD WATER BY GRAUPEL</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                  psacwg = m_cons14 * agn(i,j,k) * qc3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                    n0g(i,j,k) / std::pow(lamg(i,j,k), (m_bg + 3.0));</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160; </div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                  npsacwg = m_cons14 * agn(i,j,k) * nc3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                    n0g(i,j,k) / std::pow(lamg(i,j,k), (m_bg + 3.0));</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                }</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                <span class="comment">// hm, add 12/13/06</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                <span class="comment">// CLOUD ICE COLLECTING DROPLETS, ASSUME THAT CLOUD ICE MEAN DIAM &gt; 100 MICRON</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                <span class="comment">// BEFORE RIMING CAN OCCUR</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                <span class="comment">// ASSUME THAT RIME COLLECTED ON CLOUD ICE DOES NOT LEAD</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                <span class="comment">// TO HALLET-MOSSOP SPLINTERING</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                  <span class="comment">// PUT IN SIZE DEPENDENT COLLECTION EFFICIENCY BASED ON STOKES LAW</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                  <span class="comment">// FROM THOMPSON ET AL. 2004, MWR</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                  <span class="keywordflow">if</span> (1.0 / lami(i,j,k) &gt;= 100.0e-6) {</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                    psacwi = m_cons16 * ain(i,j,k) * qc3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                      n0i(i,j,k) / std::pow(lami(i,j,k), (m_bi + 3.0));</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160; </div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                    npsacwi = m_cons16 * ain(i,j,k) * nc3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                      n0i(i,j,k) / std::pow(lami(i,j,k), (m_bi + 3.0));</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                  }</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                }</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160; </div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;                <span class="comment">// ACCRETION OF RAIN WATER BY SNOW</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                <span class="comment">// FORMULA FROM IKAWA AND SAITO, 1991, USED BY REISNER ET AL, 1998</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qni3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                  amrex::Real ums_local = asn(i,j,k) * m_cons3 / std::pow(lams(i,j,k), m_bs);</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                  amrex::Real umr_local = arn(i,j,k) * m_cons4 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                  amrex::Real uns_local = asn(i,j,k) * m_cons5 / std::pow(lams(i,j,k), m_bs);</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                  amrex::Real unr_local = arn(i,j,k) * m_cons6 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160; </div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                  <span class="comment">// SET REASLISTIC LIMITS ON FALLSPEEDS</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                  <span class="comment">// bug fix, 10/08/09</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                  dum = std::pow(m_rhosu / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.54);</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                  ums_local = std::min(ums_local, 1.2 * dum);</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                  uns_local = std::min(uns_local, 1.2 * dum);</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                  umr_local = std::min(umr_local, 9.1 * dum);</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                  unr_local = std::min(unr_local, 9.1 * dum);</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160; </div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                  pracs = m_cons41 * (std::sqrt(std::pow(1.2 * umr_local - 0.95 * ums_local, 2) +</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                                                0.08 * ums_local * umr_local) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * n0r(i,j,k) * n0s(i,j,k) /</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                                      std::pow(lamr(i,j,k), 3) * (5.0 / (std::pow(lamr(i,j,k), 3) * lams(i,j,k)) +</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                                                           2.0 / (std::pow(lamr(i,j,k), 2) * std::pow(lams(i,j,k), 2)) +</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                                                           0.5 / (lamr(i,j,k) * std::pow(lams(i,j,k), 3))));</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160; </div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                  npracs = m_cons32 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * std::sqrt(1.7 * std::pow(unr_local - uns_local, 2) +</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                                                             0.3 * unr_local * uns_local) * n0r(i,j,k) * n0s(i,j,k) *</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                    (1.0 / (std::pow(lamr(i,j,k), 3) * lams(i,j,k)) +</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                     1.0 / (std::pow(lamr(i,j,k), 2) * std::pow(lams(i,j,k), 2)) +</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                     1.0 / (lamr(i,j,k) * std::pow(lams(i,j,k), 3)));</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160; </div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                  <span class="comment">// MAKE SURE PRACS DOESN&#39;T EXCEED TOTAL RAIN MIXING RATIO</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                  <span class="comment">// AS THIS MAY OTHERWISE RESULT IN TOO MUCH TRANSFER OF WATER DURING</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                  <span class="comment">// RIME-SPLINTERING</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                  pracs = std::min(pracs, qr3d(i,j,k) / dt);</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160; </div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                  <span class="comment">// COLLECTION OF SNOW BY RAIN - NEEDED FOR GRAUPEL CONVERSION CALCULATIONS</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                  <span class="comment">// ONLY CALCULATE IF SNOW AND RAIN MIXING RATIOS EXCEED 0.1 G/KG</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                  <span class="comment">// hm modify for wrfv3.1</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                  <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 0.1e-3 &amp;&amp; qr3d(i,j,k) &gt;= 0.1e-3) {</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                    psacr = m_cons31 * (std::sqrt(std::pow(1.2 * umr_local - 0.95 * ums_local, 2) +</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                                                  0.08 * ums_local * umr_local) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * n0r(i,j,k) * n0s(i,j,k) /</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                                        std::pow(lams(i,j,k), 3) * (5.0 / (std::pow(lams(i,j,k), 3) * lamr(i,j,k)) +</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                                                             2.0 / (std::pow(lams(i,j,k), 2) * std::pow(lamr(i,j,k), 2)) +</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                                                             0.5 / (lams(i,j,k) * std::pow(lamr(i,j,k), 3))));</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                  }</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                }</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160; </div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;                <span class="comment">// COLLECTION OF RAINWATER BY GRAUPEL, FROM IKAWA AND SAITO 1990,</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                <span class="comment">// USED BY REISNER ET AL 1998</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qg3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;                  amrex::Real umg_local = agn(i,j,k) * m_cons7 / std::pow(lamg(i,j,k), m_bg);</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                  amrex::Real umr_local = arn(i,j,k) * m_cons4 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;                  amrex::Real ung_local = agn(i,j,k) * m_cons8 / std::pow(lamg(i,j,k), m_bg);</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                  amrex::Real unr_local = arn(i,j,k) * m_cons6 / std::pow(lamr(i,j,k), m_br);</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160; </div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                  <span class="comment">// SET REASLISTIC LIMITS ON FALLSPEEDS</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                  <span class="comment">// bug fix, 10/08/09</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                  dum = std::pow(m_rhosu / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.54);</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                  umg_local = std::min(umg_local, 20.0 * dum);</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                  ung_local = std::min(ung_local, 20.0 * dum);</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                  umr_local = std::min(umr_local, 9.1 * dum);</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                  unr_local = std::min(unr_local, 9.1 * dum);</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160; </div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                  pracg = m_cons41 * (std::sqrt(std::pow(1.2 * umr_local - 0.95 * umg_local, 2) +</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                                                0.08 * umg_local * umr_local) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * n0r(i,j,k) * n0g(i,j,k) /</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                                      std::pow(lamr(i,j,k), 3) * (5.0 / (std::pow(lamr(i,j,k), 3) * lamg(i,j,k)) +</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                                                           2.0 / (std::pow(lamr(i,j,k), 2) * std::pow(lamg(i,j,k), 2)) +</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                                                           0.5 / (lamr(i,j,k) * std::pow(lamg(i,j,k), 3))));</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160; </div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                  npracg = m_cons32 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * std::sqrt(1.7 * std::pow(unr_local - ung_local, 2) +</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                                                             0.3 * unr_local * ung_local) * n0r(i,j,k) * n0g(i,j,k) *</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                    (1.0 / (std::pow(lamr(i,j,k), 3) * lamg(i,j,k)) +</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;                     1.0 / (std::pow(lamr(i,j,k), 2) * std::pow(lamg(i,j,k), 2)) +</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                     1.0 / (lamr(i,j,k) * std::pow(lamg(i,j,k), 3)));</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160; </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                  <span class="comment">// MAKE SURE PRACG DOESN&#39;T EXCEED TOTAL RAIN MIXING RATIO</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                  <span class="comment">// AS THIS MAY OTHERWISE RESULT IN TOO MUCH TRANSFER OF WATER DURING</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                  <span class="comment">// RIME-SPLINTERING</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                  pracg = std::min(pracg, qr3d(i,j,k) / dt);</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                }</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160; </div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                <span class="comment">// RIME-SPLINTERING - SNOW</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;                <span class="comment">// HALLET-MOSSOP (1974)</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                <span class="comment">// NUMBER OF SPLINTERS FORMED IS BASED ON MASS OF RIMED WATER</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                <span class="comment">// hm add threshold snow and droplet mixing ratio for rime-splintering</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;                <span class="comment">// to limit rime-splintering in stratiform clouds</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                <span class="comment">// these thresholds correspond with graupel thresholds in rh 1984</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                <span class="comment">//v1.4</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 0.1e-3) {</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                  <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= 0.5e-3 || qr3d(i,j,k) &gt;= 0.1e-3) {</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                    <span class="keywordflow">if</span> (psacws &gt; 0.0 || pracs &gt; 0.0) {</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                      <span class="keywordflow">if</span> (t3d(i,j,k) &lt; 270.16 &amp;&amp; t3d(i,j,k) &gt; 265.16) {</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                        amrex::Real fmult = 0.0;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160; </div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                        <span class="keywordflow">if</span> (t3d(i,j,k) &gt; 270.16) {</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                          fmult = 0.0;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t3d(i,j,k) &lt;= 270.16 &amp;&amp; t3d(i,j,k) &gt; 268.16) {</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                          fmult = (270.16 - t3d(i,j,k)) / 2.0;</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t3d(i,j,k) &gt;= 265.16 &amp;&amp; t3d(i,j,k) &lt;= 268.16) {</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                          fmult = (t3d(i,j,k) - 265.16) / 3.0;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t3d(i,j,k) &lt; 265.16) {</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                          fmult = 0.0;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                        }</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160; </div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                        <span class="comment">// 1000 IS TO CONVERT FROM KG TO G</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                        <span class="comment">// SPLINTERING FROM DROPLETS ACCRETED ONTO SNOW</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                        <span class="keywordflow">if</span> (psacws &gt; 0.0) {</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                          nmults = 35.0e4 * psacws * fmult * 1000.0;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                          qmults = nmults * m_mmult;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160; </div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                          <span class="comment">// CONSTRAIN SO THAT TRANSFER OF MASS FROM SNOW TO ICE CANNOT BE MORE MASS</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                          <span class="comment">// THAN WAS RIMED ONTO SNOW</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                          qmults = std::min(qmults, psacws);</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                          psacws = psacws - qmults;</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                        }</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160; </div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                        <span class="comment">// RIMING AND SPLINTERING FROM ACCRETED RAINDROPS</span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                        <span class="keywordflow">if</span> (pracs &gt; 0.0) {</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                          nmultr = 35.0e4 * pracs * fmult * 1000.0;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                          qmultr = nmultr * m_mmult;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160; </div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                          <span class="comment">// CONSTRAIN SO THAT TRANSFER OF MASS FROM SNOW TO ICE CANNOT BE MORE MASS</span></div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                          <span class="comment">// THAN WAS RIMED ONTO SNOW</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                          qmultr = std::min(qmultr, pracs);</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                          pracs = pracs - qmultr;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                        }</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                      }</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                    }</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                  }</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                }</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160; </div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                <span class="comment">// RIME-SPLINTERING - GRAUPEL</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                <span class="comment">// HALLET-MOSSOP (1974)</span></div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                <span class="comment">// NUMBER OF SPLINTERS FORMED IS BASED ON MASS OF RIMED WATER</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                <span class="comment">// hm add threshold snow mixing ratio for rime-splintering</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                <span class="comment">// to limit rime-splintering in stratiform clouds</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                <span class="comment">// v1.4</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= 0.1e-3) {</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                  <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= 0.5e-3 || qr3d(i,j,k) &gt;= 0.1e-3) {</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                    <span class="keywordflow">if</span> (psacwg &gt; 0.0 || pracg &gt; 0.0) {</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                      <span class="keywordflow">if</span> (t3d(i,j,k) &lt; 270.16 &amp;&amp; t3d(i,j,k) &gt; 265.16) {</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                        amrex::Real fmult = 0.0;</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160; </div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                        <span class="keywordflow">if</span> (t3d(i,j,k) &gt; 270.16) {</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                          fmult = 0.0;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t3d(i,j,k) &lt;= 270.16 &amp;&amp; t3d(i,j,k) &gt; 268.16) {</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                          fmult = (270.16 - t3d(i,j,k)) / 2.0;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t3d(i,j,k) &gt;= 265.16 &amp;&amp; t3d(i,j,k) &lt;= 268.16) {</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                          fmult = (t3d(i,j,k) - 265.16) / 3.0;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t3d(i,j,k) &lt; 265.16) {</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                          fmult = 0.0;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                        }</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160; </div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                        <span class="comment">// 1000 IS TO CONVERT FROM KG TO G</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                        <span class="comment">// SPLINTERING FROM DROPLETS ACCRETED ONTO GRAUPEL</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                        <span class="keywordflow">if</span> (psacwg &gt; 0.0) {</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                          nmultg = 35.0e4 * psacwg * fmult * 1000.0;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                          qmultg = nmultg * m_mmult;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160; </div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                          <span class="comment">// CONSTRAIN SO THAT TRANSFER OF MASS FROM GRAUPEL TO ICE CANNOT BE MORE MASS</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                          <span class="comment">// THAN WAS RIMED ONTO GRAUPEL</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                          qmultg = std::min(qmultg, psacwg);</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                          psacwg = psacwg - qmultg;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                        }</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160; </div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                        <span class="comment">// RIMING AND SPLINTERING FROM ACCRETED RAINDROPS</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                        <span class="keywordflow">if</span> (pracg &gt; 0.0) {</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                          nmultrg = 35.0e4 * pracg * fmult * 1000.0;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                          qmultrg = nmultrg * m_mmult;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160; </div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                          <span class="comment">// CONSTRAIN SO THAT TRANSFER OF MASS FROM GRAUPEL TO ICE CANNOT BE MORE MASS</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                          <span class="comment">// THAN WAS RIMED ONTO GRAUPEL</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;                          qmultrg = std::min(qmultrg, pracg);</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                          pracg = pracg - qmultrg;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;                        }</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                      }</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                    }</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                  }</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;                }</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160; </div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                <span class="comment">// CONVERSION OF RIMED CLOUD WATER ONTO SNOW TO GRAUPEL/HAIL</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                <span class="keywordflow">if</span> (psacws &gt; 0.0) {</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                  <span class="comment">// ONLY ALLOW CONVERSION IF QNI &gt; 0.1 AND QC &gt; 0.5 G/KG FOLLOWING RUTLEDGE AND HOBBS (1984)</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                  <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 0.1e-3 &amp;&amp; qc3d(i,j,k) &gt;= 0.5e-3) {</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                    <span class="comment">// PORTION OF RIMING CONVERTED TO GRAUPEL (REISNER ET AL. 1998, ORIGINALLY IS1991)</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                    pgsacw = std::min(psacws, m_cons17 * dt * n0s(i,j,k) * qc3d(i,j,k) * qc3d(i,j,k) *</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                                      asn(i,j,k) * asn(i,j,k) /</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                                      (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * std::pow(lams(i,j,k), (2.0 * m_bs + 2.0))));</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160; </div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                    <span class="comment">// MIX RAT CONVERTED INTO GRAUPEL AS EMBRYO (REISNER ET AL. 1998, ORIG M1990)</span></div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                    dum = std::max(m_rhosn / (m_rhog - m_rhosn) * pgsacw, 0.0);</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160; </div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                    <span class="comment">// NUMBER CONCENTRAITON OF EMBRYO GRAUPEL FROM RIMING OF SNOW</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                    nscng = dum / m_mg0 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                    <span class="comment">// LIMIT MAX NUMBER CONVERTED TO SNOW NUMBER</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                    nscng = std::min(nscng, ns3d(i,j,k) / dt);</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160; </div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                    <span class="comment">// PORTION OF RIMING LEFT FOR SNOW</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                    psacws = psacws - pgsacw;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                  }</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                }</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160; </div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                <span class="comment">// CONVERSION OF RIMED RAINWATER ONTO SNOW CONVERTED TO GRAUPEL</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                <span class="keywordflow">if</span> (pracs &gt; 0.0) {</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;                  <span class="comment">// ONLY ALLOW CONVERSION IF QNI &gt; 0.1 AND QR &gt; 0.1 G/KG FOLLOWING RUTLEDGE AND HOBBS (1984)</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;                  <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 0.1e-3 &amp;&amp; qr3d(i,j,k) &gt;= 0.1e-3) {</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                    <span class="comment">// PORTION OF COLLECTED RAINWATER CONVERTED TO GRAUPEL (REISNER ET AL. 1998)</span></div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                    dum = m_cons18 * std::pow(4.0 / lams(i,j,k), 3) * std::pow(4.0 / lams(i,j,k), 3) /</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                      (m_cons18 * std::pow(4.0 / lams(i,j,k), 3) * std::pow(4.0 / lams(i,j,k), 3) +</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;                       m_cons19 * std::pow(4.0 / lamr(i,j,k), 3) * std::pow(4.0 / lamr(i,j,k), 3));</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                    dum = std::min(dum, 1.0);</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;                    dum = std::max(dum, 0.0);</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160; </div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;                    pgracs = (1.0 - dum) * pracs;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                    ngracs = (1.0 - dum) * npracs;</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160; </div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                    <span class="comment">// LIMIT MAX NUMBER CONVERTED TO MIN OF EITHER RAIN OR SNOW NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                    ngracs = std::min(ngracs, nr3d(i,j,k) / dt);</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                    ngracs = std::min(ngracs, ns3d(i,j,k) / dt);</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160; </div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                    <span class="comment">// AMOUNT LEFT FOR SNOW PRODUCTION</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                    pracs = pracs - pgracs;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                    npracs = npracs - ngracs;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160; </div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                    <span class="comment">// CONVERSION TO GRAUPEL DUE TO COLLECTION OF SNOW BY RAIN</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                    psacr = psacr * (1.0 - dum);</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                  }</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                }</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160; </div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                <span class="comment">// FREEZING OF RAIN DROPS</span></div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                <span class="comment">// FREEZING ALLOWED BELOW -4 C</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;                <span class="keywordflow">if</span> (t3d(i,j,k) &lt; 269.15 &amp;&amp; qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;                  <span class="comment">// IMMERSION FREEZING (BIGG 1953)</span></div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;                  <span class="comment">// hm fix 7/15/13 for consistency w/ original formula</span></div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;                  mnuccr = m_cons20 * nr3d(i,j,k) * (std::exp(m_aimm * (273.15 - t3d(i,j,k))) - 1.0) /</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;                    std::pow(lamr(i,j,k), 3) / std::pow(lamr(i,j,k), 3);</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160; </div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;                  nnuccr = m_pi * nr3d(i,j,k) * m_bimm * (std::exp(m_aimm * (273.15 - t3d(i,j,k))) - 1.0) /</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;                    std::pow(lamr(i,j,k), 3);</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160; </div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;                  <span class="comment">// PREVENT DIVERGENCE BETWEEN MIXING RATIO AND NUMBER CONC</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;                  nnuccr = std::min(nnuccr, nr3d(i,j,k) / dt);</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;                }</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160; </div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;                <span class="comment">// ACCRETION OF CLOUD LIQUID WATER BY RAIN</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;                <span class="comment">// CONTINUOUS COLLECTION EQUATION WITH</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                <span class="comment">// GRAVITATIONAL COLLECTION KERNEL, DROPLET FALL SPEED NEGLECTED</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qc3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;                  <span class="comment">// 12/13/06 hm add, replace with newer formula from</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;                  <span class="comment">// khairoutdinov and kogan 2000, mwr</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;                  dum = qc3d(i,j,k) * qr3d(i,j,k);</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;                  pra = 67.0 * std::pow(dum, 1.15);</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;                  npra = pra / (qc3d(i,j,k) / nc3d(i,j,k));</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                }</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160; </div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;                <span class="comment">// SELF-COLLECTION OF RAIN DROPS</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;                <span class="comment">// FROM BEHENG(1994)</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                <span class="comment">// FROM NUMERICAL SIMULATION OF THE STOCHASTIC COLLECTION EQUATION</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;                <span class="comment">// AS DESCRINED ABOVE FOR AUTOCONVERSION</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8) {</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                  <span class="comment">// include breakup add 10/09/09</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                  dum1 = 300.0e-6;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                  <span class="keywordflow">if</span> (1.0 / lamr(i,j,k) &lt; dum1) {</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                    dum = 1.0;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1.0 / lamr(i,j,k) &gt;= dum1) {</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                    dum = 2.0 - std::exp(2300.0 * (1.0 / lamr(i,j,k) - dum1));</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                  }</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                  nragg = -5.78 * dum * nr3d(i,j,k) * qr3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                }</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160; </div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                <span class="comment">// AUTOCONVERSION OF CLOUD ICE TO SNOW</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                <span class="comment">// FOLLOWING HARRINGTON ET AL. (1995) WITH MODIFICATION</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                <span class="comment">// HERE IT IS ASSUMED THAT AUTOCONVERSION CAN ONLY OCCUR WHEN THE</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                <span class="comment">// ICE IS GROWING, I.E. IN CONDITIONS OF ICE SUPERSATURATION</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qvqvsi &gt;= 1.0) {</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                  nprci = m_cons21 * (qv3d(i,j,k) - qvi) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) *</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                    n0i(i,j,k) * std::exp(-lami(i,j,k) * m_dcs) * dv / abi;</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                  prci = m_cons22 * nprci;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                  nprci = std::min(nprci, ni3d(i,j,k) / dt);</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                }</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160; </div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                <span class="comment">// ACCRETION OF CLOUD ICE BY SNOW</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                <span class="comment">// FOR THIS CALCULATION, IT IS ASSUMED THAT THE VS &gt;&gt; VI</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                <span class="comment">// AND DS &gt;&gt; DI FOR CONTINUOUS COLLECTION</span></div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qi3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                  prai = m_cons23 * asn(i,j,k) * qi3d(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * n0s(i,j,k) /</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                    std::pow(lams(i,j,k), (m_bs + 3.0));</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                  nprai = m_cons23 * asn(i,j,k) * ni3d(i,j,k) *</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                    <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * n0s(i,j,k) /</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                    std::pow(lams(i,j,k), (m_bs + 3.0));</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                  nprai = std::min(nprai, ni3d(i,j,k) / dt);</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                }</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160; </div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                <span class="comment">// hm, add 12/13/06, collision of rain and ice to produce snow or graupel</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                <span class="comment">// follows reisner et al. 1998</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                <span class="comment">// assumed fallspeed and size of ice crystal &lt;&lt; than for rain</span></div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; qi3d(i,j,k) &gt;= 1.0e-8 &amp;&amp; t3d(i,j,k) &lt;= 273.15) {</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                  <span class="comment">// allow graupel formation from rain-ice collisions only if rain mixing ratio &gt; 0.1 g/kg,</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                  <span class="comment">// otherwise add to snow</span></div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                  <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= 0.1e-3) {</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                    niacr = m_cons24 * ni3d(i,j,k) * n0r(i,j,k)* arn(i,j,k) /</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                      std::pow(lamr(i,j,k), (m_br + 3.0)) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                    piacr = m_cons25 * ni3d(i,j,k) * n0r(i,j,k) * arn(i,j,k) /</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;                      std::pow(lamr(i,j,k), (m_br + 3.0)) / std::pow(lamr(i,j,k), 3) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                    praci = m_cons24 * qi3d(i,j,k) * n0r(i,j,k) * arn(i,j,k) /</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                      std::pow(lamr(i,j,k), (m_br + 3.0)) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                    niacr = std::min(niacr, nr3d(i,j,k) / dt);</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                    niacr = std::min(niacr, ni3d(i,j,k) / dt);</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                    niacrs = m_cons24 * ni3d(i,j,k) * n0r(i,j,k) * arn(i,j,k) /</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                      std::pow(lamr(i,j,k), (m_br + 3.0)) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;                    piacrs = m_cons25 * ni3d(i,j,k) * n0r(i,j,k) * arn(i,j,k) /</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                      std::pow(lamr(i,j,k), (m_br + 3.0)) / std::pow(lamr(i,j,k), 3) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                    pracis = m_cons24 * qi3d(i,j,k) * n0r(i,j,k) * arn(i,j,k) /</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                      std::pow(lamr(i,j,k), (m_br + 3.0)) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                    niacrs = std::min(niacrs, nr3d(i,j,k) / dt);</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;                    niacrs = std::min(niacrs, ni3d(i,j,k) / dt);</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;                  }</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;                }</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160; </div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                <span class="comment">// NUCLEATION OF CLOUD ICE FROM HOMOGENEOUS AND HETEROGENEOUS FREEZING ON AEROSOL</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;                <span class="keywordflow">if</span> (m_inuc == 0) {</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                  <span class="comment">// ADD THRESHOLD ACCORDING TO GREG THOMSPON</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                  <span class="keywordflow">if</span> ((qvqvs &gt;= 0.999 &amp;&amp; t3d(i,j,k) &lt;= 265.15) || qvqvsi &gt;= 1.08) {</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                    <span class="comment">// hm, modify dec. 5, 2006, replace with cooper curve</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                    kc2 = 0.005 * std::exp(0.304 * (273.15 - t3d(i,j,k))) * 1000.0; <span class="comment">// CONVERT FROM L-1 TO M-3</span></div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                    <span class="comment">// LIMIT TO 500 L-1</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                    kc2 = std::min(kc2, 500.0e3);</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                    kc2 = std::max(kc2 / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.0);  <span class="comment">// CONVERT TO KG-1</span></div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160; </div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                    <span class="keywordflow">if</span> (kc2 &gt; ni3d(i,j,k) + ns3d(i,j,k) + ng3d(i,j,k)) {</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                      nnuccd = (kc2 - ni3d(i,j,k) - ns3d(i,j,k) - ng3d(i,j,k)) / dt;</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                      mnuccd = nnuccd * m_mi0;</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                    }</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                  }</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_inuc == 1) {</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                  <span class="keywordflow">if</span> (t3d(i,j,k) &lt; 273.15 &amp;&amp; qvqvsi &gt; 1.0) {</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                    kc2 = 0.16 * 1000.0 / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);  <span class="comment">// CONVERT FROM L-1 TO KG-1</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                    <span class="keywordflow">if</span> (kc2 &gt; ni3d(i,j,k) + ns3d(i,j,k) + ng3d(i,j,k)) {</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                      nnuccd = (kc2 - ni3d(i,j,k) - ns3d(i,j,k) - ng3d(i,j,k)) / dt;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                      mnuccd = nnuccd * m_mi0;</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                    }</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                  }</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                }</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160; </div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                <span class="comment">// CALCULATE EVAP/SUB/DEP TERMS FOR QI,QNI,QR</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                <span class="comment">// NO VENTILATION FOR CLOUD ICE</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                epsi = 0.0;</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;                  epsi = 2.0 * m_pi * n0i(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv / (lami(i,j,k) * lami(i,j,k));</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;                }</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160; </div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;                <span class="comment">// VENTILATION FOR SNOW</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;                epss = 0.0;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;                  epss = 2.0 * m_pi * n0s(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv *</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                    (m_f1s / (lams(i,j,k) * lams(i,j,k)) +</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                     m_f2s * std::pow(asn(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) / mu(i,j,k), 0.5) *</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;                     std::pow(sc_schmidt, (1.0 / 3.0)) * m_cons10 /</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                     std::pow(lams(i,j,k), m_cons35));</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;                }</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160; </div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                <span class="comment">// Ventilation for graupel</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                epsg = 0.0;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;                  epsg = 2.0 * m_pi * n0g(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv *</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;                    (m_f1s / (lamg(i,j,k) * lamg(i,j,k)) +</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;                     m_f2s * std::pow(agn(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) / mu(i,j,k), 0.5) *</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                     std::pow(sc_schmidt, (1.0 / 3.0)) * m_cons11 /</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;                     std::pow(lamg(i,j,k), m_cons36));</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                }</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160; </div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;                <span class="comment">// VENTILATION FOR RAIN</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                epsr = 0.0;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;                  epsr = 2.0 * m_pi * n0r(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) * dv *</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;                    (m_f1r / (lamr(i,j,k) * lamr(i,j,k)) +</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                     m_f2r * std::pow(arn(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k) / mu(i,j,k), 0.5) *</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                     std::pow(sc_schmidt, (1.0 / 3.0)) * m_cons9 /</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                     std::pow(lamr(i,j,k), m_cons34));</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                }</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160; </div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                <span class="comment">// ONLY INCLUDE REGION OF ICE SIZE DIST &lt; DCS</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                <span class="comment">// DUM IS FRACTION OF D*N(D) &lt; DCS</span></div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                <span class="comment">// LOGIC BELOW FOLLOWS THAT OF HARRINGTON ET AL. 1995 (JAS)</span></div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                  dum = (1.0 - std::exp(-lami(i,j,k) * m_dcs) * (1.0 + lami(i,j,k) * m_dcs));</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                  prd = epsi * (qv3d(i,j,k) - qvi) / abi * dum;</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                  dum = 0.0;</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                }</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160; </div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                <span class="comment">// ADD DEPOSITION IN TAIL OF ICE SIZE DIST TO SNOW IF SNOW IS PRESENT</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;                  prds = epss * (qv3d(i,j,k) - qvi) / abi +</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;                    epsi * (qv3d(i,j,k) - qvi) / abi * (1.0 - dum);</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;                  <span class="comment">// OTHERWISE ADD TO CLOUD ICE</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;                  prd = prd + epsi * (qv3d(i,j,k) - qvi) / abi * (1.0 - dum);</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;                }</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160; </div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;                <span class="comment">// VAPOR DPEOSITION ON GRAUPEL</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;                prdg = epsg * (qv3d(i,j,k) - qvi) / abi;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160; </div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                <span class="comment">// NO CONDENSATION ONTO RAIN, ONLY EVAP</span></div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;                <span class="keywordflow">if</span> (qv3d(i,j,k) &lt; qvs) {</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;                  pre = epsr * (qv3d(i,j,k) - qvs) / ab;</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                  pre = std::min(pre, 0.0);</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;                  pre = 0.0;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;                }</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160; </div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;                <span class="comment">// MAKE SURE NOT PUSHED INTO ICE SUPERSAT/SUBSAT</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;                <span class="comment">// FORMULA FROM REISNER 2 SCHEME</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                dum = (qv3d(i,j,k) - qvi) / dt;</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160; </div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;                fudgef = 0.9999;</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;                sum_dep = prd + prds + mnuccd + prdg;</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160; </div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                <span class="keywordflow">if</span> ((dum &gt; 0.0 &amp;&amp; sum_dep &gt; dum * fudgef) ||</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;                    (dum &lt; 0.0 &amp;&amp; sum_dep &lt; dum * fudgef)) {</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;                  mnuccd = fudgef * mnuccd * dum / sum_dep;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                  prd = fudgef * prd * dum / sum_dep;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                  prds = fudgef * prds * dum / sum_dep;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                  prdg = fudgef * prdg * dum / sum_dep;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                }</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160; </div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;                <span class="comment">// IF CLOUD ICE/SNOW/GRAUPEL VAP DEPOSITION IS NEG, THEN ASSIGN TO SUBLIMATION PROCESSES</span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;                <span class="keywordflow">if</span> (prd &lt; 0.0) {</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;                  eprd = prd;</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                  prd = 0.0;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                }</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                <span class="keywordflow">if</span> (prds &lt; 0.0) {</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                  eprds = prds;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                  prds = 0.0;</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                }</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;                <span class="keywordflow">if</span> (prdg &lt; 0.0) {</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;                  eprdg = prdg;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                  prdg = 0.0;</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;                }</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;                <span class="comment">// CONSERVATION OF WATER</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                <span class="comment">// THIS IS ADOPTED LOOSELY FROM MM5 RESINER CODE. HOWEVER, HERE WE</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                <span class="comment">// ONLY ADJUST PROCESSES THAT ARE NEGATIVE, RATHER THAN ALL PROCESSES.</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160; </div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                <span class="comment">// IF MIXING RATIOS LESS THAN QSMALL, THEN NO DEPLETION OF WATER</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;                <span class="comment">// THROUGH MICROPHYSICAL PROCESSES, SKIP CONSERVATION</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160; </div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;                <span class="comment">// NOTE: CONSERVATION CHECK NOT APPLIED TO NUMBER CONCENTRATION SPECIES. ADDITIONAL CATCH</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;                <span class="comment">// BELOW WILL PREVENT NEGATIVE NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                <span class="comment">// FOR EACH MICROPHYSICAL PROCESS WHICH PROVIDES A SOURCE FOR NUMBER, THERE IS A CHECK</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;                <span class="comment">// TO MAKE SURE THAT CAN&#39;T EXCEED TOTAL NUMBER OF DEPLETED SPECIES WITH THE TIME</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                <span class="comment">// STEP</span></div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160; </div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;                <span class="comment">// ****SENSITIVITY - NO ICE</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;                <span class="keywordflow">if</span> (m_iliq == 1) {</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;                  mnuccc = 0.0;</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;                  nnuccc = 0.0;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;                  mnuccr = 0.0;</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;                  nnuccr = 0.0;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                  mnuccd = 0.0;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                  nnuccd = 0.0;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;                }</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160; </div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                <span class="comment">// ****SENSITIVITY - NO GRAUPEL</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;                <span class="keywordflow">if</span> (m_igraup == 1) {</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;                  pracg = 0.0;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;                  psacr = 0.0;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;                  psacwg = 0.0;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;                  prdg = 0.0;</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                  eprdg = 0.0;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                  evpmg = 0.0;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                  pgmlt = 0.0;</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                  npracg = 0.0;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                  npsacwg = 0.0;</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                  nscng = 0.0;</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;                  ngracs = 0.0;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;                  nsubg = 0.0;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;                  ngmltg = 0.0;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;                  ngmltr = 0.0;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160; </div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;                  <span class="comment">// fix 053011</span></div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                  piacrs = piacrs + piacr;</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;                  piacr = 0.0;</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160; </div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;                  <span class="comment">// fix 070713</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;                  pracis = pracis + praci;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                  praci = 0.0;</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;                  psacws = psacws + pgsacw;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;                  pgsacw = 0.0;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;                  pracs = pracs + pgracs;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                  pgracs = 0.0;</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                }</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160; </div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                <span class="comment">// CONSERVATION OF QC</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;                dum = (prc + pra + mnuccc + psacws + psacwi + qmults + psacwg + pgsacw + qmultg) * dt;</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160; </div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qc3d(i,j,k) &amp;&amp; qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;                  ratio = qc3d(i,j,k) / dum;</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160; </div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                  prc = prc * ratio;</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                  pra = pra * ratio;</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;                  mnuccc = mnuccc * ratio;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                  psacws = psacws * ratio;</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                  psacwi = psacwi * ratio;</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                  qmults = qmults * ratio;</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                  qmultg = qmultg * ratio;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                  psacwg = psacwg * ratio;</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                  pgsacw = pgsacw * ratio;</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                }</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160; </div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;                <span class="comment">// CONSERVATION OF QI</span></div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                dum = (-prd - mnuccc + prci + prai - qmults - qmultg - qmultr - qmultrg</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                       - mnuccd + praci + pracis - eprd - psacwi) * dt;</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160; </div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qi3d(i,j,k) &amp;&amp; qi3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;                  ratio = (qi3d(i,j,k) / dt + prd + mnuccc + qmults + qmultg + qmultr + qmultrg +</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;                                       mnuccd + psacwi) /</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;                    (prci + prai + praci + pracis - eprd);</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160; </div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;                  prci = prci * ratio;</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;                  prai = prai * ratio;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                  praci = praci * ratio;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                  pracis = pracis * ratio;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                  eprd = eprd * ratio;</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;                }</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160; </div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;                <span class="comment">// CONSERVATION OF QR</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                dum = ((pracs - pre) + (qmultr + qmultrg - prc) + (mnuccr - pra) +</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                       piacr + piacrs + pgracs + pracg) * dt;</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160; </div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qr3d(i,j,k) &amp;&amp; qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                  ratio = (qr3d(i,j,k) / dt + prc + pra) /</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                    (-pre + qmultr + qmultrg + pracs + mnuccr + piacr + piacrs + pgracs + pracg);</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160; </div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;                  pre = pre * ratio;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;                  pracs = pracs * ratio;</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;                  qmultr = qmultr * ratio;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;                  qmultrg = qmultrg * ratio;</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                  mnuccr = mnuccr * ratio;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                  piacr = piacr * ratio;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                  piacrs = piacrs * ratio;</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;                  pgracs = pgracs * ratio;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;                  pracg = pracg * ratio;</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;                }</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160; </div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;                <span class="comment">// CONSERVATION OF QNI</span></div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;                <span class="keywordflow">if</span> (m_igraup == 0) {</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                  dum = (-prds - psacws - prai - prci - pracs - eprds + psacr - piacrs - pracis) * dt;</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160; </div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                  <span class="keywordflow">if</span> (dum &gt; qni3d(i,j,k) &amp;&amp; qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                    ratio = (qni3d(i,j,k) / dt + prds + psacws + prai + prci + pracs + piacrs + pracis) /</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                      (-eprds + psacr);</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160; </div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;                    eprds = eprds * ratio;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;                    psacr = psacr * ratio;</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;                  }</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_igraup == 1) {</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;                  <span class="comment">// FOR NO GRAUPEL, NEED TO INCLUDE FREEZING OF RAIN FOR SNOW</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                  dum = (-prds - psacws - prai - prci - pracs - eprds + psacr - piacrs - pracis - mnuccr) * dt;</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160; </div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                  <span class="keywordflow">if</span> (dum &gt; qni3d(i,j,k) &amp;&amp; qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;                    ratio = (qni3d(i,j,k) / dt + prds + psacws + prai + prci + pracs + piacrs + pracis + mnuccr) /</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                      (-eprds + psacr);</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160; </div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;                    eprds = eprds * ratio;</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;                    psacr = psacr * ratio;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;                  }</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;                }</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160; </div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;                <span class="comment">// CONSERVATION OF QG</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;                dum = (-psacwg - pracg - pgsacw - pgracs - prdg - mnuccr - eprdg - piacr - praci - psacr) * dt;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160; </div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;                <span class="keywordflow">if</span> (dum &gt; qg3d(i,j,k) &amp;&amp; qg3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;                  ratio = (qg3d(i,j,k) / dt + psacwg + pracg + pgsacw + pgracs + prdg + mnuccr + psacr +</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                                       piacr + praci) / (-eprdg);</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160; </div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                  eprdg = eprdg * ratio;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                }</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160; </div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;                <span class="comment">// TENDENCIES</span></div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                qv3dten(i,j,k) = qv3dten(i,j,k) + (-pre - prd - prds - mnuccd - eprd - eprds - prdg - eprdg);</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160; </div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;                <span class="comment">// bug fix hm, 3/1/11, include piacr and piacrs</span></div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;                t3dten(i,j,k) = t3dten(i,j,k) + (pre * xxlv(i,j,k) +</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;                                                 (prd + prds + mnuccd + eprd + eprds + prdg + eprdg) * xxls(i,j,k) +</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;                                                 (psacws + psacwi + mnuccc + mnuccr + qmults + qmultg + qmultr + qmultrg + pracs +</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;                                                  psacwg + pracg + pgsacw + pgracs + piacr + piacrs) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k)) / cpm(i,j,k);</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160; </div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;                qc3dten(i,j,k) = qc3dten(i,j,k) +</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;                  (-pra - prc - mnuccc + pcc -</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;                   psacws - psacwi - qmults - qmultg - psacwg - pgsacw);</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160; </div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                qi3dten(i,j,k) = qi3dten(i,j,k) +</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;                  (prd + eprd + psacwi + mnuccc - prci -</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                   prai + qmults + qmultg + qmultr + qmultrg + mnuccd - praci - pracis);</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160; </div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;                qr3dten(i,j,k) = qr3dten(i,j,k) +</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;                  (pre + pra + prc - pracs - mnuccr - qmultr - qmultrg -</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;                   piacr - piacrs - pracg - pgracs);</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;                <span class="keywordflow">if</span> (m_igraup == 0) {</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;                  qni3dten(i,j,k) = qni3dten(i,j,k) +</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;                    (prai + psacws + prds + pracs + prci + eprds - psacr + piacrs + pracis);</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160; </div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;                  ns3dten(i,j,k) = ns3dten(i,j,k) + (nsagg + nprci - nscng - ngracs + niacrs);</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160; </div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;                  qg3dten(i,j,k) = qg3dten(i,j,k) + (pracg + psacwg + pgsacw + pgracs +</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;                                                     prdg + eprdg + mnuccr + piacr + praci + psacr);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160; </div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;                  ng3dten(i,j,k) = ng3dten(i,j,k) + (nscng + ngracs + nnuccr + niacr);</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_igraup == 1) {</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;                  <span class="comment">// FOR NO GRAUPEL, NEED TO INCLUDE FREEZING OF RAIN FOR SNOW</span></div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;                  qni3dten(i,j,k) = qni3dten(i,j,k) +</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;                    (prai + psacws + prds + pracs + prci + eprds - psacr + piacrs + pracis + mnuccr);</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160; </div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;                  ns3dten(i,j,k) = ns3dten(i,j,k) + (nsagg + nprci - nscng - ngracs + niacrs + nnuccr);</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;                }</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160; </div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                nc3dten(i,j,k) = nc3dten(i,j,k) + (-nnuccc - npsacws -</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;                                                   npra - nprc - npsacwi - npsacwg);</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160; </div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                ni3dten(i,j,k) = ni3dten(i,j,k) +</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                  (nnuccc - nprci - nprai + nmults + nmultg + nmultr + nmultrg +</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;                   nnuccd - niacr - niacrs);</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160; </div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;                nr3dten(i,j,k) = nr3dten(i,j,k) + (nprc1 - npracs - nnuccr +</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;                                                   nragg - niacr - niacrs - npracg - ngracs);</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160; </div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;                <span class="comment">// hm add, wrf-chem, add tendencies for c2prec</span></div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;                c2prec = pra + prc + psacws + qmults + qmultg + psacwg +</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                  pgsacw + mnuccc + psacwi;</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160; </div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                <span class="comment">// CALCULATE SATURATION ADJUSTMENT TO CONDENSE EXTRA VAPOR ABOVE</span></div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;                <span class="comment">// WATER SATURATION</span></div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;                dumt = t3d(i,j,k) + dt * t3dten(i,j,k);</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                dumqv = qv3d(i,j,k) + dt * qv3dten(i,j,k);</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160; </div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;                <span class="comment">// hm, add fix for low pressure, 5/12/10</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                dum = std::min(0.99 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k), <a class="code" href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7">calc_saturation_vapor_pressure</a>(dumt, 0));</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;                dumqss = m_ep_2 * dum / (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) - dum);</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160; </div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;                dumqc = qc3d(i,j,k) + dt * qc3dten(i,j,k);</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;                dumqc = std::max(dumqc, 0.0);</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160; </div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                <span class="comment">// SATURATION ADJUSTMENT FOR LIQUID</span></div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                dums = dumqv - dumqss;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160; </div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;                pcc = dums / (1.0 + std::pow(xxlv(i,j,k), 2) * dumqss / (cpm(i,j,k) * m_Rv * std::pow(dumt, 2))) / dt;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160; </div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;                <span class="keywordflow">if</span> (pcc * dt + dumqc &lt; 0.0) {</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;                  pcc = -dumqc / dt;</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;                }</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160; </div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;                qv3dten(i,j,k) = qv3dten(i,j,k) - pcc;</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;                t3dten(i,j,k) = t3dten(i,j,k) + pcc * xxlv(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;                qc3dten(i,j,k) = qc3dten(i,j,k) + pcc;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;                <span class="comment">// SUBLIMATE, MELT, OR EVAPORATE NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;                <span class="comment">// THIS FORMULATION ASSUMES 1:1 RATIO BETWEEN MASS LOSS AND</span></div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;                <span class="comment">// LOSS OF NUMBER CONCENTRATION</span></div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;                <span class="keywordflow">if</span> (eprd &lt; 0.0) {</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                  dum = eprd * dt / qi3d(i,j,k);</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                  nsubi = dum * ni3d(i,j,k) / dt;</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                }</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160; </div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;                <span class="keywordflow">if</span> (eprds &lt; 0.0) {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;                  dum = eprds * dt / qni3d(i,j,k);</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;                  nsubs = dum * ns3d(i,j,k) / dt;</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;                }</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160; </div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;                <span class="keywordflow">if</span> (pre &lt; 0.0) {</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                  dum = pre * dt / qr3d(i,j,k);</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                  nsubr = dum * nr3d(i,j,k) / dt;</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;                }</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160; </div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;                <span class="keywordflow">if</span> (eprdg &lt; 0.0) {</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                  dum = eprdg * dt / qg3d(i,j,k);</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;                  dum = std::max(-1.0, dum);</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                  nsubg = dum * ng3d(i,j,k) / dt;</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;                }</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160; </div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;                <span class="comment">// UPDATE TENDENCIES</span></div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;                ni3dten(i,j,k) = ni3dten(i,j,k) + nsubi;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;                ns3dten(i,j,k) = ns3dten(i,j,k) + nsubs;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;                ng3dten(i,j,k) = ng3dten(i,j,k) + nsubg;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;                nr3dten(i,j,k) = nr3dten(i,j,k) + nsubr;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;            }</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;            ltrue = 1;</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;            }</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;            <span class="comment">//            label_200:</span></div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160; </div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;           }</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=klo; k&lt;=khi; k++) {</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;            <span class="comment">// INITIALIZE PRECIP AND SNOW RATES</span></div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;            precrt(i,j,k) = 0.0;</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;            snowrt(i,j,k) = 0.0;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        <span class="comment">// hm added 7/13/13</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;            snowprt(i,j,k) = 0.0;</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;            grplprt(i,j,k) = 0.0;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;            }</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;            nstep = 1;</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;            <span class="keywordflow">if</span>(ltrue != 0) {</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;            <span class="comment">//goto 400</span></div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;            <span class="comment">// CALCULATE SEDIMENTATION</span></div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;            <span class="comment">// THE NUMERICS HERE FOLLOW FROM REISNER ET AL. (1998)</span></div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;            <span class="comment">// FALLOUT TERMS ARE CALCULATED ON SPLIT TIME STEPS TO ENSURE NUMERICAL</span></div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;            <span class="comment">// STABILITY, I.E. COURANT# &lt; 1</span></div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;            <span class="comment">// Loop from top to bottom (KTE to KTS)</span></div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=khi; k&gt;=klo; k--) {</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160; </div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;              amrex::Real dum;                <span class="comment">// DUM: General dummy variable</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160; </div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;              amrex::Real di0;                <span class="comment">// DI0: Characteristic diameter for ice</span></div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;              amrex::Real ds0;                <span class="comment">// DS0: Characteristic diameter for snow</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;              amrex::Real dg0;                <span class="comment">// DG0: Characteristic diameter for graupel</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;              amrex::Real lammax;             <span class="comment">// LAMMAX: Maximum value for slope parameter</span></div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;              amrex::Real lammin;             <span class="comment">// LAMMIN: Minimum value for slope parameter</span></div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160; </div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;              ds0 = 3.0;       <span class="comment">// Size distribution parameter for snow</span></div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;              di0 = 3.0;       <span class="comment">// Size distribution parameter for cloud ice</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;              dg0 = 3.0;       <span class="comment">// Size distribution parameter for graupel</span></div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160; </div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;              <span class="comment">// Update prognostic variables with tendencies</span></div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;              dumi(i,j,k) = qi3d(i,j,k) + qi3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;              dumqs(i,j,k) = qni3d(i,j,k) + qni3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;              dumr(i,j,k) = qr3d(i,j,k) + qr3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;              dumfni(i,j,k) = ni3d(i,j,k) + ni3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;              dumfns(i,j,k) = ns3d(i,j,k) + ns3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;              dumfnr(i,j,k) = nr3d(i,j,k) + nr3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;              dumc(i,j,k) = qc3d(i,j,k) + qc3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;              dumfnc(i,j,k) = nc3d(i,j,k) + nc3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;              dumg(i,j,k) = qg3d(i,j,k) + qg3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;              dumfng(i,j,k) = ng3d(i,j,k) + ng3dten(i,j,k) * dt;</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160; </div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;              <span class="comment">// SWITCH FOR CONSTANT DROPLET NUMBER</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;              <span class="keywordflow">if</span> (iinum == 1) {</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;                dumfnc(i,j,k) = nc3d(i,j,k);</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;              }</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160; </div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;              <span class="comment">// MAKE SURE NUMBER CONCENTRATIONS ARE POSITIVE</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;              dumfni(i,j,k) = amrex::max(0., dumfni(i,j,k));</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;              dumfns(i,j,k) = amrex::max(0., dumfns(i,j,k));</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;              dumfnc(i,j,k) = amrex::max(0., dumfnc(i,j,k));</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;              dumfnr(i,j,k) = amrex::max(0., dumfnr(i,j,k));</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;              dumfng(i,j,k) = amrex::max(0., dumfng(i,j,k));</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160; </div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;              <span class="comment">// CLOUD ICE</span></div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;              <span class="keywordflow">if</span> (dumi(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;                dlami(i,j,k) = std::pow(m_cons12 * dumfni(i,j,k) / dumi(i,j,k), 1.0/di0);</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;                dlami(i,j,k) = amrex::max(dlami(i,j,k), m_lammini);</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;                dlami(i,j,k) = amrex::min(dlami(i,j,k), m_lammaxi);</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;              }</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160; </div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;              <span class="comment">// RAIN</span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;              <span class="keywordflow">if</span> (dumr(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                dlamr(i,j,k) = std::pow(m_pi * m_rhow * dumfnr(i,j,k) / dumr(i,j,k), 1.0/3.0);</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                dlamr(i,j,k) = amrex::max(dlamr(i,j,k), m_lamminr);</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                dlamr(i,j,k) = amrex::min(dlamr(i,j,k), m_lammaxr);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;              }</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160; </div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;              <span class="comment">// CLOUD DROPLETS</span></div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;              <span class="keywordflow">if</span> (dumc(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;                dum = <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) / (287.15 * t3d(i,j,k));</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;                pgam(i,j,k) = 0.0005714 * (nc3d(i,j,k) / 1.0e6 * dum) + 0.2714;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;                pgam(i,j,k) = 1.0 / (pgam(i,j,k) * pgam(i,j,k)) - 1.0;</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;                pgam(i,j,k) = amrex::max(pgam(i,j,k), 2.0);</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;                pgam(i,j,k) = amrex::min(pgam(i,j,k), 10.0);</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160; </div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;                dlamc(i,j,k) = std::pow(m_cons26 * dumfnc(i,j,k) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0) /</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;                                        (dumc(i,j,k) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 1.0)), 1.0/3.0);</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;                lammin = (pgam(i,j,k) + 1.0) / 60.0e-6;</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;                lammax = (pgam(i,j,k) + 1.0) / 1.0e-6;</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;                dlamc(i,j,k) = amrex::max(dlamc(i,j,k), lammin);</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;                dlamc(i,j,k) = amrex::min(dlamc(i,j,k), lammax);</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;              }</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160; </div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;              <span class="comment">// SNOW</span></div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;              <span class="keywordflow">if</span> (dumqs(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;                dlams(i,j,k) = std::pow(m_cons1 * dumfns(i,j,k) / dumqs(i,j,k), 1.0/ds0);</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;                dlams(i,j,k) = amrex::max(dlams(i,j,k), m_lammins);</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                dlams(i,j,k) = amrex::min(dlams(i,j,k), m_lammaxs);</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;              }</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160; </div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;              <span class="comment">// GRAUPEL</span></div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;              <span class="keywordflow">if</span> (dumg(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;                dlamg(i,j,k) = std::pow(m_cons2 * dumfng(i,j,k) / dumg(i,j,k), 1.0/dg0);</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;                dlamg(i,j,k) = amrex::max(dlamg(i,j,k), m_lamming);</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;                dlamg(i,j,k) = amrex::min(dlamg(i,j,k), m_lammaxg);</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;              }</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160; </div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;              <span class="comment">// Calculate number-weighted and mass-weighted terminal fall speeds</span></div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;              <span class="comment">// CLOUD WATER</span></div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;              <span class="keywordflow">if</span> (dumc(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;                unc(i,j,k) = acn(i,j,k) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(1. + m_bc + pgam(i,j,k)) /</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                             (std::pow(dlamc(i,j,k), m_bc) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 1.));</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;                umc(i,j,k) = acn(i,j,k) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(4. + m_bc + pgam(i,j,k)) /</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                             (std::pow(dlamc(i,j,k), m_bc) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.));</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;                umc(i,j,k) = 0.;</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                unc(i,j,k) = 0.;</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;              }</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160; </div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;              <span class="comment">// CLOUD ICE</span></div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;              <span class="keywordflow">if</span> (dumi(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;                uni(i,j,k) = ain(i,j,k) * m_cons27 / std::pow(dlami(i,j,k), m_bi);</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                umi(i,j,k) = ain(i,j,k) * m_cons28 / std::pow(dlami(i,j,k), m_bi);</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                umi(i,j,k) = 0.;</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                uni(i,j,k) = 0.;</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;              }</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160; </div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;              <span class="comment">// RAIN</span></div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;              <span class="keywordflow">if</span> (dumr(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                unr(i,j,k) = arn(i,j,k) * m_cons6 / std::pow(dlamr(i,j,k), m_br);</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                umr(i,j,k) = arn(i,j,k) * m_cons4 / std::pow(dlamr(i,j,k), m_br);</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                umr(i,j,k) = 0.;</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                unr(i,j,k) = 0.;</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;              }</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160; </div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;              <span class="comment">// SNOW</span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;              <span class="keywordflow">if</span> (dumqs(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;                ums(i,j,k) = asn(i,j,k) * m_cons3 / std::pow(dlams(i,j,k), m_bs);</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;                uns(i,j,k) = asn(i,j,k) * m_cons5 / std::pow(dlams(i,j,k), m_bs);</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                ums(i,j,k) = 0.;</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;                uns(i,j,k) = 0.;</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;              }</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160; </div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;              <span class="comment">// GRAUPEL</span></div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;              <span class="keywordflow">if</span> (dumg(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                umg(i,j,k) = agn(i,j,k) * m_cons7 / std::pow(dlamg(i,j,k), m_bg);</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                ung(i,j,k) = agn(i,j,k) * m_cons8 / std::pow(dlamg(i,j,k), m_bg);</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;                umg(i,j,k) = 0.;</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                ung(i,j,k) = 0.;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;              }</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160; </div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;              <span class="comment">// SET REALISTIC LIMITS ON FALLSPEED</span></div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;              <span class="comment">// Bug fix, 10/08/09</span></div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;              dum = std::pow(m_rhosu / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.54);</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;              ums(i,j,k) = std::min(ums(i,j,k), 1.2 * dum);</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;              uns(i,j,k) = std::min(uns(i,j,k), 1.2 * dum);</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160; </div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;              <span class="comment">// Fix 053011</span></div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;              <span class="comment">// Fix for correction by AA 4/6/11</span></div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;              umi(i,j,k) = std::min(umi(i,j,k), 1.2 * std::pow(m_rhosu / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.35));</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;              uni(i,j,k) = std::min(uni(i,j,k), 1.2 * std::pow(m_rhosu / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k), 0.35));</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;              umr(i,j,k) = std::min(umr(i,j,k), 9.1 * dum);</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;              unr(i,j,k) = std::min(unr(i,j,k), 9.1 * dum);</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;              umg(i,j,k) = std::min(umg(i,j,k), 20. * dum);</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;              ung(i,j,k) = std::min(ung(i,j,k), 20. * dum);</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160; </div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;              <span class="comment">// Set fall speed values</span></div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;              fr(i,j,k) = umr(i,j,k);         <span class="comment">// RAIN FALL SPEED</span></div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;              fi(i,j,k) = umi(i,j,k);         <span class="comment">// CLOUD ICE FALL SPEED</span></div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;              fni(i,j,k) = uni(i,j,k);        <span class="comment">// CLOUD ICE NUMBER FALL SPEED</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;              fs(i,j,k) = ums(i,j,k);         <span class="comment">// SNOW FALL SPEED</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;              fns(i,j,k) = uns(i,j,k);        <span class="comment">// SNOW NUMBER FALL SPEED</span></div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;              fnr(i,j,k) = unr(i,j,k);        <span class="comment">// RAIN NUMBER FALL SPEED</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;              fc(i,j,k) = umc(i,j,k);         <span class="comment">// CLOUD WATER FALL SPEED</span></div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;              fnc(i,j,k) = unc(i,j,k);        <span class="comment">// CLOUD NUMBER FALL SPEED</span></div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;              fg(i,j,k) = umg(i,j,k);         <span class="comment">// GRAUPEL FALL SPEED</span></div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;              fng(i,j,k) = ung(i,j,k);        <span class="comment">// GRAUPEL NUMBER FALL SPEED</span></div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160; </div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;              <span class="comment">// V3.3 MODIFY FALLSPEED BELOW LEVEL OF PRECIP</span></div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;              <span class="keywordflow">if</span> (fr(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                fr(i,j,k) = fr(i,j,k+1);</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;              }</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;              <span class="keywordflow">if</span> (fi(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                fi(i,j,k) = fi(i,j,k+1);</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;              }</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;              <span class="keywordflow">if</span> (fni(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                fni(i,j,k) = fni(i,j,k+1);</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;              }</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;              <span class="keywordflow">if</span> (fs(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                fs(i,j,k) = fs(i,j,k+1);</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;              }</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;              <span class="keywordflow">if</span> (fns(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;                fns(i,j,k) = fns(i,j,k+1);</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;              }</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;              <span class="keywordflow">if</span> (fnr(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;                fnr(i,j,k) = fnr(i,j,k+1);</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;              }</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;              <span class="keywordflow">if</span> (fc(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;                fc(i,j,k) = fc(i,j,k+1);</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;              }</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;              <span class="keywordflow">if</span> (fnc(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;                fnc(i,j,k) = fnc(i,j,k+1);</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;              }</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;              <span class="keywordflow">if</span> (fg(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;                fg(i,j,k) = fg(i,j,k+1);</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;              }</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;              <span class="keywordflow">if</span> (fng(i,j,k) &lt; 1.e-10) {</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;                fng(i,j,k) = fng(i,j,k+1);</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;              }</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160; </div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;              <span class="comment">// CALCULATE NUMBER OF SPLIT TIME STEPS</span></div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;              <span class="comment">// Find maximum fall speed at this point</span></div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;              rgvm(i,j,k) = std::max({fr(i,j,k), fi(i,j,k), fs(i,j,k), fc(i,j,k),</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;                  fni(i,j,k), fnr(i,j,k), fns(i,j,k), fnc(i,j,k),</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                  fg(i,j,k), fng(i,j,k)});</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160; </div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;              <span class="comment">// Calculate number of steps (dt and nstep would need to be defined elsewhere)</span></div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;              nstep = std::max(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(rgvm(i,j,k) * dt / dzq(i,j,k) + 1.), nstep);</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;              <span class="comment">// MULTIPLY VARIABLES BY RHO</span></div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;              dumr(i,j,k) = dumr(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);       <span class="comment">// Rain water content * density</span></div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;              dumi(i,j,k) = dumi(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);       <span class="comment">// Cloud ice content * density</span></div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;              dumfni(i,j,k) = dumfni(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);   <span class="comment">// Cloud ice number * density</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;              dumqs(i,j,k) = dumqs(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);     <span class="comment">// Snow content * density</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;              dumfns(i,j,k) = dumfns(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);   <span class="comment">// Snow number * density</span></div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;              dumfnr(i,j,k) = dumfnr(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);   <span class="comment">// Rain number * density</span></div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;              dumc(i,j,k) = dumc(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);       <span class="comment">// Cloud water content * density</span></div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;              dumfnc(i,j,k) = dumfnc(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);   <span class="comment">// Cloud droplet number * density</span></div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;              dumg(i,j,k) = dumg(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);       <span class="comment">// Graupel content * density</span></div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;              dumfng(i,j,k) = dumfng(i,j,k) * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);   <span class="comment">// Graupel number * density</span></div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;            }</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;            <span class="comment">// Main time stepping loop for sedimentation</span></div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 1; n &lt;= nstep; n++) {</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;              <span class="comment">// Calculate initial fallout for each hydrometeor type for all levels</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = klo; k &lt;= khi; k++) {</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;                faloutr(i,j,k) = fr(i,j,k) * dumr(i,j,k);</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;                falouti(i,j,k) = fi(i,j,k) * dumi(i,j,k);</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;                faloutni(i,j,k) = fni(i,j,k) * dumfni(i,j,k);</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;                falouts(i,j,k) = fs(i,j,k) * dumqs(i,j,k);</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;                faloutns(i,j,k) = fns(i,j,k) * dumfns(i,j,k);</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;                faloutnr(i,j,k) = fnr(i,j,k) * dumfnr(i,j,k);</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;                faloutc(i,j,k) = fc(i,j,k) * dumc(i,j,k);</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;                faloutnc(i,j,k) = fnc(i,j,k) * dumfnc(i,j,k);</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;                faloutg(i,j,k) = fg(i,j,k) * dumg(i,j,k);</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;                faloutng(i,j,k) = fng(i,j,k) * dumfng(i,j,k);</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;              }</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160; </div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;              <span class="comment">// Process top of model level</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;              <span class="keywordtype">int</span> k = khi;</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160; </div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;              <span class="comment">// Calculate tendencies at top level</span></div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;              faltndr(i,j,k) = faloutr(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;              faltndi(i,j,k) = falouti(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;              faltndni(i,j,k) = faloutni(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;              faltnds(i,j,k) = falouts(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;              faltndns(i,j,k) = faloutns(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;              faltndnr(i,j,k) = faloutnr(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;              faltndc(i,j,k) = faloutc(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;              faltndnc(i,j,k) = faloutnc(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;              faltndg(i,j,k) = faloutg(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;              faltndng(i,j,k) = faloutng(i,j,k) / dzq(i,j,k);</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160; </div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;              <span class="comment">// Add fallout terms to Eulerian tendencies (scaled by time step and density)</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;              qrsten(i,j,k) = qrsten(i,j,k) - faltndr(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;              qisten(i,j,k) = qisten(i,j,k) - faltndi(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;              ni3dten(i,j,k) = ni3dten(i,j,k) - faltndni(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;              qnisten(i,j,k) = qnisten(i,j,k) - faltnds(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;              ns3dten(i,j,k) = ns3dten(i,j,k) - faltndns(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;              nr3dten(i,j,k) = nr3dten(i,j,k) - faltndnr(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;              qcsten(i,j,k) = qcsten(i,j,k) - faltndc(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;              nc3dten(i,j,k) = nc3dten(i,j,k) - faltndnc(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;              qgsten(i,j,k) = qgsten(i,j,k) - faltndg(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;              ng3dten(i,j,k) = ng3dten(i,j,k) - faltndng(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160; </div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;              <span class="comment">// Update temporary working variables</span></div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;              dumr(i,j,k) = dumr(i,j,k) - faltndr(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;              dumi(i,j,k) = dumi(i,j,k) - faltndi(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;              dumfni(i,j,k) = dumfni(i,j,k) - faltndni(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;              dumqs(i,j,k) = dumqs(i,j,k) - faltnds(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;              dumfns(i,j,k) = dumfns(i,j,k) - faltndns(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;              dumfnr(i,j,k) = dumfnr(i,j,k) - faltndnr(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;              dumc(i,j,k) = dumc(i,j,k) - faltndc(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;              dumfnc(i,j,k) = dumfnc(i,j,k) - faltndnc(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;              dumg(i,j,k) = dumg(i,j,k) - faltndg(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;              dumfng(i,j,k) = dumfng(i,j,k) - faltndng(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160; </div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;              <span class="comment">// Process remaining levels from top to bottom</span></div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;              <span class="keywordflow">for</span> (k = khi-1; k &gt;= klo; k--) {</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;                <span class="comment">// Calculate tendencies based on difference between levels</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;                faltndr(i,j,k) = (faloutr(i,j,k+1) - faloutr(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;                faltndi(i,j,k) = (falouti(i,j,k+1) - falouti(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;                faltndni(i,j,k) = (faloutni(i,j,k+1) - faloutni(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;                faltnds(i,j,k) = (falouts(i,j,k+1) - falouts(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;                faltndns(i,j,k) = (faloutns(i,j,k+1) - faloutns(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                faltndnr(i,j,k) = (faloutnr(i,j,k+1) - faloutnr(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;                faltndc(i,j,k) = (faloutc(i,j,k+1) - faloutc(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;                faltndnc(i,j,k) = (faloutnc(i,j,k+1) - faloutnc(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;                faltndg(i,j,k) = (faloutg(i,j,k+1) - faloutg(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;                faltndng(i,j,k) = (faloutng(i,j,k+1) - faloutng(i,j,k)) / dzq(i,j,k);</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160; </div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;                <span class="comment">// Add fallout terms to Eulerian tendencies (positive here, as mass flows in from above)</span></div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                qrsten(i,j,k) = qrsten(i,j,k) + faltndr(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;                qisten(i,j,k) = qisten(i,j,k) + faltndi(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;                ni3dten(i,j,k) = ni3dten(i,j,k) + faltndni(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                qnisten(i,j,k) = qnisten(i,j,k) + faltnds(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;                ns3dten(i,j,k) = ns3dten(i,j,k) + faltndns(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                nr3dten(i,j,k) = nr3dten(i,j,k) + faltndnr(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                qcsten(i,j,k) = qcsten(i,j,k) + faltndc(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;                nc3dten(i,j,k) = nc3dten(i,j,k) + faltndnc(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                qgsten(i,j,k) = qgsten(i,j,k) + faltndg(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;                ng3dten(i,j,k) = ng3dten(i,j,k) + faltndng(i,j,k) / nstep / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;                <span class="comment">// Update temporary working variables</span></div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;                dumr(i,j,k) = dumr(i,j,k) + faltndr(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;                dumi(i,j,k) = dumi(i,j,k) + faltndi(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;                dumfni(i,j,k) = dumfni(i,j,k) + faltndni(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;                dumqs(i,j,k) = dumqs(i,j,k) + faltnds(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;                dumfns(i,j,k) = dumfns(i,j,k) + faltndns(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                dumfnr(i,j,k) = dumfnr(i,j,k) + faltndnr(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                dumc(i,j,k) = dumc(i,j,k) + faltndc(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;                dumfnc(i,j,k) = dumfnc(i,j,k) + faltndnc(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                dumg(i,j,k) = dumg(i,j,k) + faltndg(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;                dumfng(i,j,k) = dumfng(i,j,k) + faltndng(i,j,k) * dt / nstep;</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;              }</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;              <span class="comment">// Get precipitation and snowfall accumulation during the time step</span></div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;              <span class="comment">// Factor of 1000 converts from m to mm, but division by density</span></div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;              <span class="comment">// of liquid water cancels this factor of 1000</span></div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;              <span class="keywordtype">int</span> kts=klo;</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;              precrt(i,j,klo) += (faloutr(i,j,kts) + faloutc(i,j,kts) + falouts(i,j,kts) +</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                         falouti(i,j,kts) + faloutg(i,j,kts)) * dt / nstep;</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;              snowrt(i,j,klo) += (falouts(i,j,kts) + falouti(i,j,kts) + faloutg(i,j,kts)) * dt / nstep;</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160; </div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;              <span class="comment">// Added 7/13/13</span></div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;              snowprt(i,j,klo) += (falouti(i,j,kts) + falouts(i,j,kts)) * dt / nstep;</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;              grplprt(i,j,klo) += faloutg(i,j,kts) * dt / nstep;</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;            }</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=klo; k&lt;=khi; k++) {</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;              amrex::Real evs;                <span class="comment">// EVS: Saturation vapor pressure</span></div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;              amrex::Real eis;                <span class="comment">// EIS: Ice saturation vapor pressure</span></div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;              amrex::Real qvs;                <span class="comment">// QVS: Saturation mixing ratio</span></div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;              amrex::Real qvi;                <span class="comment">// QVI: Ice saturation mixing ratio</span></div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;              amrex::Real qvqvs;              <span class="comment">// QVQVS: Saturation ratio</span></div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;              amrex::Real qvqvsi;             <span class="comment">// QVQVSI: Ice saturation ratio</span></div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160; </div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;              <span class="comment">// ADD ON SEDIMENTATION TENDENCIES FOR MIXING RATIO TO REST OF TENDENCIES</span></div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;              qr3dten(i,j,k) = qr3dten(i,j,k) + qrsten(i,j,k);</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;              qi3dten(i,j,k) = qi3dten(i,j,k) + qisten(i,j,k);</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;              qc3dten(i,j,k) = qc3dten(i,j,k) + qcsten(i,j,k);</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;              qg3dten(i,j,k) = qg3dten(i,j,k) + qgsten(i,j,k);</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;              qni3dten(i,j,k) = qni3dten(i,j,k) + qnisten(i,j,k);</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;              <span class="comment">// PUT ALL CLOUD ICE IN SNOW CATEGORY IF MEAN DIAMETER EXCEEDS 2 * dcs</span></div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;              <span class="comment">// bug fix</span></div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;              <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= m_qsmall &amp;&amp; t3d(i,j,k) &lt; 273.15 &amp;&amp; lami(i,j,k) &gt;= 1.e-10) {</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                <span class="keywordflow">if</span> (1.0/lami(i,j,k) &gt;= 2.0*m_dcs) {</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                  qni3dten(i,j,k) = qni3dten(i,j,k) + qi3d(i,j,k)/dt + qi3dten(i,j,k);</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;                  ns3dten(i,j,k) = ns3dten(i,j,k) + ni3d(i,j,k)/dt + ni3dten(i,j,k);</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;                  qi3dten(i,j,k) = -qi3d(i,j,k)/dt;</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;                  ni3dten(i,j,k) = -ni3d(i,j,k)/dt;</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;                }</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;              }</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160; </div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;              <span class="comment">// Add tendencies to ensure consistency between mixing ratio and number concentration</span></div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;              qc3d(i,j,k) = qc3d(i,j,k) + qc3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;              qi3d(i,j,k) = qi3d(i,j,k) + qi3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;              qni3d(i,j,k) = qni3d(i,j,k) + qni3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;              qr3d(i,j,k) = qr3d(i,j,k) + qr3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;              nc3d(i,j,k) = nc3d(i,j,k) + nc3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;              ni3d(i,j,k) = ni3d(i,j,k) + ni3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;              ns3d(i,j,k) = ns3d(i,j,k) + ns3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;              nr3d(i,j,k) = nr3d(i,j,k) + nr3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;              <span class="keywordflow">if</span> (m_igraup == 0) {</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;                qg3d(i,j,k) = qg3d(i,j,k) + qg3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;                ng3d(i,j,k) = ng3d(i,j,k) + ng3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;              }</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160; </div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;              <span class="comment">// ADD TEMPERATURE AND WATER VAPOR TENDENCIES FROM MICROPHYSICS</span></div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;              t3d(i,j,k) = t3d(i,j,k) + t3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;              qv3d(i,j,k) = qv3d(i,j,k) + qv3dten(i,j,k)*dt;</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;              <span class="comment">// SATURATION VAPOR PRESSURE AND MIXING RATIO</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;              <span class="comment">// hm, add fix for low pressure, 5/12/10</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;              <span class="comment">// Assuming POLYSVP is defined elsewhere</span></div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;              evs = std::min(0.99 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k), <a class="code" href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7">calc_saturation_vapor_pressure</a>(t3d(i,j,k), 0));  <span class="comment">// PA</span></div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;              eis = std::min(0.99 * <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k), <a class="code" href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7">calc_saturation_vapor_pressure</a>(t3d(i,j,k), 1));  <span class="comment">// PA</span></div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160; </div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;              <span class="comment">// MAKE SURE ICE SATURATION DOESN&#39;T EXCEED WATER SAT. NEAR FREEZING</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;              <span class="keywordflow">if</span> (eis &gt; evs) {</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;                eis = evs; <span class="comment">// temporary update: adjust ice saturation pressure</span></div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;              }</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160; </div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;              <span class="comment">// SATURATION MIXING RATIOS</span></div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;              qvs = m_ep_2 * evs / (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) - evs); <span class="comment">// budget equation: calculate water saturation mixing ratio</span></div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;              qvi = m_ep_2 * eis / (<a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) - eis); <span class="comment">// budget equation: calculate ice saturation mixing ratio</span></div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160; </div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;              <span class="comment">// SATURATION RATIOS</span></div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;              qvqvs = qv3d(i,j,k) / qvs; <span class="comment">// budget equation: calculate water saturation ratio</span></div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;              qvqvsi = qv3d(i,j,k) / qvi; <span class="comment">// budget equation: calculate ice saturation ratio</span></div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;              <span class="comment">// AT SUBSATURATION, REMOVE SMALL AMOUNTS OF CLOUD/PRECIP WATER</span></div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;              <span class="keywordflow">if</span> (qvqvs &lt; 0.9) {</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;                  qv3d(i,j,k) += qr3d(i,j,k);</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;                  t3d(i,j,k) -= qr3d(i,j,k) * xxlv(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;                  qr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;                }</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;                <span class="keywordflow">if</span> (qc3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;                  qv3d(i,j,k) += qc3d(i,j,k);</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                  t3d(i,j,k) -= qc3d(i,j,k) * xxlv(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;                  qc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;                }</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;              }</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;              <span class="keywordflow">if</span> (qvqvsi &lt; 0.9) {</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;                <span class="keywordflow">if</span> (qi3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;                  qv3d(i,j,k) += qi3d(i,j,k);</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;                  t3d(i,j,k) -= qi3d(i,j,k) * xxls(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                  qi3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;                }</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                  qv3d(i,j,k) += qni3d(i,j,k);</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                  t3d(i,j,k) -= qni3d(i,j,k) * xxls(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;                  qni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;                }</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;                <span class="keywordflow">if</span> (qg3d(i,j,k) &lt; 1.0e-8) {</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;                  qv3d(i,j,k) += qg3d(i,j,k);</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                  t3d(i,j,k) -= qg3d(i,j,k) * xxls(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;                  qg3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                }</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;              }</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;              <span class="comment">// IF MIXING RATIO &lt; QSMALL SET MIXING RATIO AND NUMBER CONC TO ZERO</span></div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;              <span class="keywordflow">if</span> (qc3d(i,j,k) &lt; m_qsmall) {</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                qc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                nc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                effc(i,j,k) = 0.0;</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;              }</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;              <span class="keywordflow">if</span> (qr3d(i,j,k) &lt; m_qsmall) {</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;                qr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                nr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;                effr(i,j,k) = 0.0;</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;              }</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;              <span class="keywordflow">if</span> (qi3d(i,j,k) &lt; m_qsmall) {</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;                qi3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;                ni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;                effi(i,j,k) = 0.0;</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;              }</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;              <span class="keywordflow">if</span> (qni3d(i,j,k) &lt; m_qsmall) {</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;                qni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;                ns3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;                effs(i,j,k) = 0.0;</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;              }</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;              <span class="keywordflow">if</span> (qg3d(i,j,k) &lt; m_qsmall) {</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                qg3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;                ng3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;                effg(i,j,k) = 0.0;</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;              }</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;              <span class="comment">/*</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;<span class="comment">              // Skip calculations if there is no cloud/precipitation water</span></div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;<span class="comment">              if ((qc3d(i,j,k) &lt; m_qsmall &amp;&amp;    // CLOUD WATER MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;<span class="comment">                    qi3d(i,j,k) &lt; m_qsmall &amp;&amp;    // CLOUD ICE MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;<span class="comment">                    qni3d(i,j,k) &lt; m_qsmall &amp;&amp;   // SNOW MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;<span class="comment">                    qr3d(i,j,k) &lt; m_qsmall &amp;&amp;    // RAIN MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;<span class="comment">                    qg3d(i,j,k) &lt; m_qsmall)) {    // GRAUPEL MIX RATIO (KG/KG)</span></div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="comment">                goto label_500;</span></div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="comment">              } else {*/</span></div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;              <span class="keywordflow">if</span> (!(qc3d(i,j,k) &lt; m_qsmall &amp;&amp;    <span class="comment">// CLOUD WATER MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                    qi3d(i,j,k) &lt; m_qsmall &amp;&amp;    <span class="comment">// CLOUD ICE MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;                    qni3d(i,j,k) &lt; m_qsmall &amp;&amp;   <span class="comment">// SNOW MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                    qr3d(i,j,k) &lt; m_qsmall &amp;&amp;    <span class="comment">// RAIN MIXING RATIO (KG/KG)</span></div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;                    qg3d(i,j,k) &lt; m_qsmall)) {    <span class="comment">// GRAUPEL MIX RATIO (KG/KG)</span></div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;              <span class="comment">// CALCULATE INSTANTANEOUS PROCESSES</span></div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160; </div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;              <span class="comment">// ADD MELTING OF CLOUD ICE TO FORM RAIN</span></div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;              <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= m_qsmall &amp;&amp; t3d(i,j,k) &gt;= 273.15) {</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                qr3d(i,j,k) = qr3d(i,j,k) + qi3d(i,j,k);</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                t3d(i,j,k) = t3d(i,j,k) - qi3d(i,j,k) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                qi3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;                nr3d(i,j,k) = nr3d(i,j,k) + ni3d(i,j,k);</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;                ni3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;              }</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;              <span class="comment">// ****SENSITIVITY - NO ICE</span></div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;              <span class="keywordflow">if</span> ((m_iliq != 1)) {</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160; </div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;                <span class="comment">// HOMOGENEOUS FREEZING OF CLOUD WATER</span></div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;                <span class="keywordflow">if</span> (t3d(i,j,k) &lt;= 233.15 &amp;&amp; qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;                  qi3d(i,j,k) = qi3d(i,j,k) + qc3d(i,j,k);</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;                  t3d(i,j,k) = t3d(i,j,k) + qc3d(i,j,k) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;                  qc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;                  ni3d(i,j,k) = ni3d(i,j,k) + nc3d(i,j,k);</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;                  nc3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;                }</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;                <span class="comment">// HOMOGENEOUS FREEZING OF RAIN</span></div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;                <span class="keywordflow">if</span> (m_igraup == 0) {</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;                  <span class="keywordflow">if</span> (t3d(i,j,k) &lt;= 233.15 &amp;&amp; qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                    qg3d(i,j,k) = qg3d(i,j,k) + qr3d(i,j,k);</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;                    t3d(i,j,k) = t3d(i,j,k) + qr3d(i,j,k) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;                    qr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;                    ng3d(i,j,k) = ng3d(i,j,k) + nr3d(i,j,k);</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                    nr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                  }</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_igraup == 1) {</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;                  <span class="keywordflow">if</span> (t3d(i,j,k) &lt;= 233.15 &amp;&amp; qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;                    qni3d(i,j,k) = qni3d(i,j,k) + qr3d(i,j,k);</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;                    t3d(i,j,k) = t3d(i,j,k) + qr3d(i,j,k) * <a class="code" href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">xlf</a>(i,j,k) / cpm(i,j,k);</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                    qr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;                    ns3d(i,j,k) = ns3d(i,j,k) + nr3d(i,j,k);</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;                    nr3d(i,j,k) = 0.0;</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;                  }</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;                }</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160; </div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;              }<span class="comment">/* else {</span></div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;<span class="comment">                Real dontdoanything=m_iliq;//printf(&quot;m_iliq: %d\n&quot;,m_iliq);//                goto label_778;</span></div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;<span class="comment">              }*/</span></div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160; </div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;<span class="comment">//            label_778:</span></div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;                <span class="comment">// MAKE SURE NUMBER CONCENTRATIONS AREN&#39;T NEGATIVE</span></div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;                ni3d(i,j,k) = std::max(0.0, ni3d(i,j,k));</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;                ns3d(i,j,k) = std::max(0.0, ns3d(i,j,k));</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;                nc3d(i,j,k) = std::max(0.0, nc3d(i,j,k));</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;                nr3d(i,j,k) = std::max(0.0, nr3d(i,j,k));</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;                ng3d(i,j,k) = std::max(0.0, ng3d(i,j,k));</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160; </div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;                <span class="comment">// CLOUD ICE</span></div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;                <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;                  lami(i,j,k) = std::pow(m_cons12 * ni3d(i,j,k) / qi3d(i,j,k), 1.0/m_di);</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;                  <span class="comment">// CHECK FOR SLOPE</span></div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;                  <span class="comment">// ADJUST VARS</span></div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                  <span class="keywordflow">if</span> (lami(i,j,k) &lt; m_lammini) {</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;                    lami(i,j,k) = m_lammini;</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;                    n0i(i,j,k) = std::pow(lami(i,j,k), 4) * qi3d(i,j,k) / m_cons12;</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;                    ni3d(i,j,k) = n0i(i,j,k) / lami(i,j,k);</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lami(i,j,k) &gt; m_lammaxi) {</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;                    lami(i,j,k) = m_lammaxi;</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;                    n0i(i,j,k) = std::pow(lami(i,j,k), 4) * qi3d(i,j,k) / m_cons12;</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;                    ni3d(i,j,k) = n0i(i,j,k) / lami(i,j,k);</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;                  }</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;                }</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160; </div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;                <span class="comment">// RAIN</span></div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;                <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;                  lamr(i,j,k) = std::pow(m_pi * m_rhow * nr3d(i,j,k) / qr3d(i,j,k), 1.0/3.0);</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160; </div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;                  <span class="comment">// CHECK FOR SLOPE</span></div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;                  <span class="comment">// ADJUST VARS</span></div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;                  <span class="keywordflow">if</span> (lamr(i,j,k) &lt; m_lamminr) {</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                    lamr(i,j,k) = m_lamminr;</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;                    n0r(i,j,k) = std::pow(lamr(i,j,k), 4) * qr3d(i,j,k) / (m_pi * m_rhow);</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;                    nr3d(i,j,k) = n0r(i,j,k) / lamr(i,j,k);</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamr(i,j,k) &gt; m_lammaxr) {</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;                    lamr(i,j,k) = m_lammaxr;</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;                    n0r(i,j,k) = std::pow(lamr(i,j,k), 4) * qr3d(i,j,k) / (m_pi * m_rhow);</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;                    nr3d(i,j,k) = n0r(i,j,k) / lamr(i,j,k);</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;                  }</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;                }</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160; </div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;                <span class="comment">// CLOUD DROPLETS</span></div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;                <span class="comment">// MARTIN ET AL. (1994) FORMULA FOR PGAM</span></div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;                <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;                  amrex::Real dum = <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">pres</a>(i,j,k) / (287.15 * t3d(i,j,k));</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;                  pgam(i,j,k) = 0.0005714 * (nc3d(i,j,k) / 1.0e6 * dum) + 0.2714;</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;                  pgam(i,j,k) = 1.0/(std::pow(pgam(i,j,k), 2)) - 1.0;</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;                  pgam(i,j,k) = std::max(pgam(i,j,k), 2.0);</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                  pgam(i,j,k) = std::min(pgam(i,j,k), 10.0);</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160; </div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;                  <span class="comment">// CALCULATE LAMC</span></div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;                  lamc(i,j,k) = std::pow(m_cons26 * nc3d(i,j,k) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0) /</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;                                  (qc3d(i,j,k) * <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 1.0)), 1.0/3.0);</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160; </div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                  <span class="comment">// LAMMIN, 60 MICRON DIAMETER</span></div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;                  <span class="comment">// LAMMAX, 1 MICRON</span></div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;                  amrex::Real lammin = (pgam(i,j,k) + 1.0) / 60.0e-6;</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;                  amrex::Real lammax = (pgam(i,j,k) + 1.0) / 1.0e-6;</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160; </div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;                  <span class="keywordflow">if</span> (lamc(i,j,k) &lt; lammin) {</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;                    lamc(i,j,k) = lammin;</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;                    nc3d(i,j,k) = std::exp(3.0 * std::log(lamc(i,j,k)) + std::log(qc3d(i,j,k)) +</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;                                           std::log(<a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 1.0)) - std::log(<a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0))) / m_cons26;</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamc(i,j,k) &gt; lammax) {</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;                    lamc(i,j,k) = lammax;</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;                    nc3d(i,j,k) = std::exp(3.0 * std::log(lamc(i,j,k)) + std::log(qc3d(i,j,k)) +</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;                                           std::log(<a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 1.0)) - std::log(<a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0))) / m_cons26;</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;                  }</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;                }</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160; </div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;                <span class="comment">// SNOW</span></div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;                <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;                  lams(i,j,k) = std::pow(m_cons1 * ns3d(i,j,k) / qni3d(i,j,k), 1.0/m_ds);</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160; </div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;                  <span class="comment">// CHECK FOR SLOPE</span></div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;                  <span class="comment">// ADJUST VARS</span></div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;                  <span class="keywordflow">if</span> (lams(i,j,k) &lt; m_lammins) {</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;                    lams(i,j,k) = m_lammins;</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;                    n0s(i,j,k) = std::pow(lams(i,j,k), 4) * qni3d(i,j,k) / m_cons1;</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;                    ns3d(i,j,k) = n0s(i,j,k) / lams(i,j,k);</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lams(i,j,k) &gt; m_lammaxs) {</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;                    lams(i,j,k) = m_lammaxs;</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                    n0s(i,j,k) = std::pow(lams(i,j,k), 4) * qni3d(i,j,k) / m_cons1;</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                    ns3d(i,j,k) = n0s(i,j,k) / lams(i,j,k);</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                  }</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                }</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160; </div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                <span class="comment">// GRAUPEL</span></div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;                <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;                  lamg(i,j,k) = std::pow(m_cons2 * ng3d(i,j,k) / qg3d(i,j,k), 1.0/m_dg);</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160; </div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;                  <span class="comment">// CHECK FOR SLOPE</span></div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;                  <span class="comment">// ADJUST VARS</span></div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;                  <span class="keywordflow">if</span> (lamg(i,j,k) &lt; m_lamming) {</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;                    lamg(i,j,k) = m_lamming;</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;                    n0g(i,j,k) = std::pow(lamg(i,j,k), 4) * qg3d(i,j,k) / m_cons2;</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;                    ng3d(i,j,k) = n0g(i,j,k) / lamg(i,j,k);</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lamg(i,j,k) &gt; m_lammaxg) {</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;                    lamg(i,j,k) = m_lammaxg;</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;                    n0g(i,j,k) = std::pow(lamg(i,j,k), 4) * qg3d(i,j,k) / m_cons2;</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;                    ng3d(i,j,k) = n0g(i,j,k) / lamg(i,j,k);</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;                  }</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;                }</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;              }</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160; </div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="comment">//            label_500:</span></div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;              <span class="comment">// CALCULATE EFFECTIVE RADIUS</span></div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;              <span class="keywordflow">if</span> (qi3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;                effi(i,j,k) = 3.0 / lami(i,j,k) / 2.0 * 1.0e6;</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;                effi(i,j,k) = 25.0;</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;              }</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160; </div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;              <span class="keywordflow">if</span> (qni3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                effs(i,j,k) = 3.0 / lams(i,j,k) / 2.0 * 1.0e6;</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;                effs(i,j,k) = 25.0;</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;              }</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160; </div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;              <span class="keywordflow">if</span> (qr3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;                effr(i,j,k) = 3.0 / lamr(i,j,k) / 2.0 * 1.0e6;</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;                effr(i,j,k) = 25.0;</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;              }</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160; </div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;              <span class="keywordflow">if</span> (qc3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;                effc(i,j,k) = <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 4.0) / <a class="code" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a>(pgam(i,j,k) + 3.0) / lamc(i,j,k) / 2.0 * 1.0e6;</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;                effc(i,j,k) = 25.0;</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;              }</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160; </div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;              <span class="keywordflow">if</span> (qg3d(i,j,k) &gt;= m_qsmall) {</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;                effg(i,j,k) = 3.0 / lamg(i,j,k) / 2.0 * 1.0e6;</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;                effg(i,j,k) = 25.0;</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;              }</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160; </div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;              <span class="comment">// HM ADD 1/10/06, ADD UPPER BOUND ON ICE NUMBER, THIS IS NEEDED</span></div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;              <span class="comment">// TO PREVENT VERY LARGE ICE NUMBER DUE TO HOMOGENEOUS FREEZING</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;              <span class="comment">// OF DROPLETS, ESPECIALLY WHEN INUM = 1, SET MAX AT 10 CM-3</span></div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;              <span class="comment">// HM, 12/28/12, LOWER MAXIMUM ICE CONCENTRATION TO ADDRESS PROBLEM</span></div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;              <span class="comment">// OF EXCESSIVE AND PERSISTENT ANVIL</span></div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;              <span class="comment">// NOTE: THIS MAY CHANGE/REDUCE SENSITIVITY TO AEROSOL/CCN CONCENTRATION</span></div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;              ni3d(i,j,k) = std::min(ni3d(i,j,k), 0.3e6 / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k));</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160; </div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;              <span class="comment">// ADD BOUND ON DROPLET NUMBER - CANNOT EXCEED AEROSOL CONCENTRATION</span></div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;              <span class="keywordflow">if</span> (iinum == 0 &amp;&amp; m_iact == 2) {</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;                nc3d(i,j,k) = std::min(nc3d(i,j,k), (m_nanew1 + m_nanew2) / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k));</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;              }</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160; </div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;              <span class="comment">// SWITCH FOR CONSTANT DROPLET NUMBER</span></div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;              <span class="keywordflow">if</span> (iinum == 1) {</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;                <span class="comment">// CHANGE NDCNST FROM CM-3 TO KG-1</span></div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;                nc3d(i,j,k) = m_ndcnst * 1.0e6 / <a class="code" href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">rho</a>(i,j,k);</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;              }</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;            }</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160; </div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;            }<span class="comment">/* else {</span></div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;<span class="comment">              goto label_400;</span></div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;<span class="comment">         label_400:*/</span></div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;            <span class="comment">//End of _micro</span></div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;            <span class="keywordflow">if</span>(use_morr_cpp_answer) {</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=klo; k&lt;=khi; k++) {</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160; </div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;            <span class="comment">// Transfer 1D variables back to 3D arrays</span></div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;            qcl_arr(i,j,k) = qc3d(i,j,k);</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;            qci_arr(i,j,k) = qi3d(i,j,k);</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;            qps_arr(i,j,k) = qni3d(i,j,k);</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;            qpr_arr(i,j,k) = qr3d(i,j,k);</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;            ni_arr(i,j,k) = ni3d(i,j,k);</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;            ns_arr(i,j,k) = ns3d(i,j,k);</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;            nr_arr(i,j,k) = nr3d(i,j,k);</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;            qpg_arr(i,j,k) = qg3d(i,j,k);</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;            ng_arr(i,j,k) = ng3d(i,j,k);</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160; </div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;            <span class="comment">// Temperature and potential temperature conversion</span></div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;            theta_arr(i,j,k) = t3d(i,j,k) / pii_arr(i,j,k); <span class="comment">// Convert temp back to potential temp</span></div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;            qv_arr(i,j,k) = qv3d(i,j,k);</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160; </div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;            <span class="comment">//Deleted wrf-check, effc, and precr type data as not used by ERF</span></div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;<span class="comment">            // NEED gpu-compatabile summation for rain_accum, check SAM or Kessler for better example</span></div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;<span class="comment">            rain_accum_arr(i,j,k) = rain_accum_arr(i,j,k) + precrt(i,j,k);</span></div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;<span class="comment">            snow_accum_arr(i,j,k) = snow_accum_arr(i,j,k) + snowprt(i,j,k);</span></div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;<span class="comment">            graup_accum_arr(i,j,k) = graup_accum_arr(i,j,k) + grplprt(i,j,k);*/</span></div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;            rainncv_arr(i,j,0) = precrt(i,j,klo);</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;            snowncv_arr(i,j,0) = snowprt(i,j,klo);</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;            graupelncv_arr(i,j,0) = grplprt(i,j,klo);</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;            sr_arr(i,j,0) = snowrt(i,j,klo) / (precrt(i,j,klo) + 1.e-12);</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;              }</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;            <span class="comment">// Update precipitation accumulation variables</span></div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;            <span class="comment">// These are outside the k-loop in the original code</span></div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;            rain_accum_arr(i,j,klo) = rain_accum_arr(i,j,klo) + precrt(i,j,klo);</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;            snow_accum_arr(i,j,klo) = snow_accum_arr(i,j,klo) + snowprt(i,j,klo);</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;            graup_accum_arr(i,j,klo) = graup_accum_arr(i,j,klo) + grplprt(i,j,klo);</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;            }</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;         });</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;          <span class="comment">//          amrex::Print()&lt;&lt;FArrayBox(qv_arr)&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;          }</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160; </div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;          amrex::Print()&lt;&lt;<span class="stringliteral">&quot;fortran should run &quot;</span>&lt;&lt;run_morr_fort&lt;&lt;std::endl;</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160; </div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;          <span class="keywordflow">if</span>(run_morr_fort) {</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;<span class="preprocessor">#ifdef ERF_USE_MORR_FORT</span></div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;          <a class="code" href="ERF__Morrison__Fortran__Interface_8H.html#aa1e15a22d6cf65c21c2a28cd25a16946">mp_morr_two_moment_c</a></div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;          (</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;              1,  <span class="comment">// ITIMESTEP - Use 1 for simplicity</span></div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160; </div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;              <span class="comment">// 3D arrays in Fortran expected order (assume column-major for Fortran)</span></div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;              theta_arr.dataPtr(),      <span class="comment">// TH</span></div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;              qv_arr.dataPtr(),         <span class="comment">// QV</span></div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;              qcl_arr.dataPtr(),        <span class="comment">// QC</span></div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;              qpr_arr.dataPtr(),        <span class="comment">// QR</span></div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;              qci_arr.dataPtr(),        <span class="comment">// QI</span></div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;              qps_arr.dataPtr(),        <span class="comment">// QS</span></div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;              qpg_arr.dataPtr(),        <span class="comment">// QG</span></div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;              ni_arr.dataPtr(),         <span class="comment">// NI</span></div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;              ns_arr.dataPtr(),         <span class="comment">// NS</span></div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;              nr_arr.dataPtr(),         <span class="comment">// NR</span></div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;              ng_arr.dataPtr(),         <span class="comment">// NG</span></div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160; </div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;              rho_arr.dataPtr(),        <span class="comment">// RHO</span></div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;              pii_arr.dataPtr(),        <span class="comment">// PII (Exner function)</span></div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;              pres_arr.dataPtr(),       <span class="comment">// P (in hPa, convert if needed)</span></div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;              dt,                       <span class="comment">// DT_IN</span></div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;              dz_arr.dataPtr(),         <span class="comment">// DZ</span></div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;              w_arr.dataPtr(),          <span class="comment">// W (vertical velocity)</span></div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160; </div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;              <span class="comment">// 2D arrays for precipitation accounting</span></div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;              rain_accum_arr.dataPtr(), <span class="comment">// RAINNC</span></div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;              rainncv_arr.dataPtr(),    <span class="comment">// RAINNCV</span></div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;              sr_arr.dataPtr(),         <span class="comment">// SR</span></div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;              snow_accum_arr.dataPtr(), <span class="comment">// SNOWNC</span></div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;              snowncv_arr.dataPtr(),    <span class="comment">// SNOWNCV</span></div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;              graup_accum_arr.dataPtr(),<span class="comment">// GRAUPELNC</span></div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;              graupelncv_arr.dataPtr(), <span class="comment">// GRAUPELNCV</span></div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160; </div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;              <span class="comment">// Radar reflectivity</span></div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;              dummy_reflectivity_ptr,  <span class="comment">// refl_10cm</span></div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;              <span class="keyword">true</span>,                     <span class="comment">// diagflag</span></div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;              0,   <span class="comment">// do_radar_ref</span></div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160; </div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;              <span class="comment">// Cumulus tendencies</span></div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;              qrcuten_arr.dataPtr(),    <span class="comment">// qrcuten</span></div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;              qscuten_arr.dataPtr(),    <span class="comment">// qscuten</span></div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;              qicuten_arr.dataPtr(),    <span class="comment">// qicuten</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160; </div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;              <span class="comment">// WRF-Chem flags</span></div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;              flag_qndrop,              <span class="comment">// F_QNDROP</span></div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;              <span class="keyword">nullptr</span>,                  <span class="comment">// qndrop (not used here)</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;              ht_arr.dataPtr(),         <span class="comment">// HT (terrain height - not used)</span></div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160; </div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;              <span class="comment">// Domain dimensions</span></div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;              ilo, ihi, jlo, jhi, klo, khi,  <span class="comment">// IDS,IDE,JDS,JDE,KDS,KDE</span></div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;              ilom, ihim, jlom, jhim, klom, khim,  <span class="comment">// IMS,IME,JMS,JME,KMS,KME</span></div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;              ilo, ihi, jlo, jhi, klo, khi,  <span class="comment">// ITS,ITE,JTS,JTE,KTS,KTE</span></div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160; </div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;              <span class="comment">// Optional WRF-Chem outputs</span></div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;              <span class="keyword">false</span>,                    <span class="comment">// wetscav_on</span></div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;              rainprod_arr.dataPtr(),   <span class="comment">// rainprod</span></div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;              evapprod_arr.dataPtr(),   <span class="comment">// evapprod</span></div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;              qlsink_arr.dataPtr(),     <span class="comment">// QLSINK</span></div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;              precr_arr.dataPtr(),      <span class="comment">// PRECR</span></div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;              preci_arr.dataPtr(),      <span class="comment">// PRECI</span></div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;              precs_arr.dataPtr(),      <span class="comment">// PRECS</span></div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;              precg_arr.dataPtr()       <span class="comment">// PRECG</span></div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;          );</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;          amrex::Abort(<span class="stringliteral">&quot;Trying to run fortran without compiling with USE_MORR_FORT=TRUE&quot;</span>);</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        }</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;          <span class="comment">//          amrex::Print()&lt;&lt;FArrayBox(qv_arr)&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;          <span class="comment">// After the call, all fields are updated</span></div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;          <span class="comment">// We don&#39;t need to copy results back since we passed direct pointers</span></div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;          <span class="comment">// to our class member arrays</span></div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;        }</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    }</div>
<div class="ttc" id="aERF__AdvanceMorrison_8cpp_html_a1d61dd254dd6d74236cdd989226eb4d7"><div class="ttname"><a href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7">calc_saturation_vapor_pressure</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE amrex::Real calc_saturation_vapor_pressure(const amrex::Real T, const int type)</div><div class="ttdef"><b>Definition:</b> ERF_AdvanceMorrison.cpp:317</div></div>
<div class="ttc" id="aERF__AdvanceMorrison_8cpp_html_af8756cf103eb5b43c28400e574f81bd5"><div class="ttname"><a href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5">gamma_function</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE Real gamma_function(Real x)</div><div class="ttdef"><b>Definition:</b> ERF_AdvanceMorrison.cpp:304</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_ac54f1d17d8842acb42b2312cd353e469"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#ac54f1d17d8842acb42b2312cd353e469">pp</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE amrex::Real pp(amrex::Real y)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:219</div></div>
<div class="ttc" id="aERF__Morrison__Fortran__Interface_8H_html_aa1e15a22d6cf65c21c2a28cd25a16946"><div class="ttname"><a href="ERF__Morrison__Fortran__Interface_8H.html#aa1e15a22d6cf65c21c2a28cd25a16946">mp_morr_two_moment_c</a></div><div class="ttdeci">void mp_morr_two_moment_c(int itimestep, double *th, double *qv, double *qc, double *qr, double *qi, double *qs, double *qg, double *ni, double *ns, double *nr, double *ng, double *rho, double *pii, double *p, double dt_in, double *dz, double *w, double *rainnc, double *rainncv, double *sr, double *snownc, double *snowncv, double *graupelnc, double *graupelncv, double *refl_10cm, bool diagflag, int do_radar_ref, double *qrcuten, double *qscuten, double *qicuten, bool f_qndrop, double *qndrop, double *ht, int ids, int ide, int jds, int jde, int kds, int kde, int ims, int ime, int jms, int jme, int kms, int kme, int its, int ite, int jts, int jte, int kts, int kte, bool wetscav_on, double *rainprod, double *evapprod, double *qlsink, double *precr, double *preci, double *precs, double *precg)</div></div>
<div class="ttc" id="aERF__TileNoZ_8H_html_a8da113f1d5603f7297fe1d03e5013f00"><div class="ttname"><a href="ERF__TileNoZ_8H.html#a8da113f1d5603f7297fe1d03e5013f00">TileNoZ</a></div><div class="ttdeci">AMREX_FORCE_INLINE amrex::IntVect TileNoZ()</div><div class="ttdef"><b>Definition:</b> ERF_TileNoZ.H:11</div></div>
<div class="ttc" id="aclassMorrison_html_a104c04cee2e446fcfa520dfb79c6563d"><div class="ttname"><a href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">Morrison::m_geom</a></div><div class="ttdeci">amrex::Geometry m_geom</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:278</div></div>
<div class="ttc" id="aclassMorrison_html_a9b6b084ace42c7992815942eed92212f"><div class="ttname"><a href="classMorrison.html#a9b6b084ace42c7992815942eed92212f">Morrison::m_axis</a></div><div class="ttdeci">int m_axis</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:287</div></div>
<div class="ttc" id="aclassMorrison_html_ad8a4391c39d380a1e77105cfbe3d88ac"><div class="ttname"><a href="classMorrison.html#ad8a4391c39d380a1e77105cfbe3d88ac">Morrison::m_rdOcp</a></div><div class="ttdeci">amrex::Real m_rdOcp</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:294</div></div>
<div class="ttc" id="aclassMorrison_html_ade405c635b58955a140d38af3b06e6aa"><div class="ttname"><a href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">Morrison::mic_fab_vars</a></div><div class="ttdeci">amrex::Array&lt; FabPtr, MicVar_Morr::NumVars &gt; mic_fab_vars</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:301</div></div>
<div class="ttc" id="anamespaceMicVar__Kess_html_a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad"><div class="ttname"><a href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa82dd7c202e6cce14520ac01cfaa4f4ad">MicVar_Kess::pres</a></div><div class="ttdeci">@ pres</div><div class="ttdef"><b>Definition:</b> ERF_Kessler.H:25</div></div>
<div class="ttc" id="anamespaceMicVar__Kess_html_a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61"><div class="ttname"><a href="namespaceMicVar__Kess.html#a889f8349e0684381d06cc26a8b1f49ffa89de8c3bfc941080efb960e5119fbd61">MicVar_Kess::rho</a></div><div class="ttdeci">@ rho</div><div class="ttdef"><b>Definition:</b> ERF_Kessler.H:22</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a27ed8ba8d37ae85125221394270eceaf"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a27ed8ba8d37ae85125221394270eceaf">MicVar_Morr::qv</a></div><div class="ttdeci">@ qv</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:34</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a281c2ff050bdb2a9349d3408926af821"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a281c2ff050bdb2a9349d3408926af821">MicVar_Morr::ng</a></div><div class="ttdeci">@ ng</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:48</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a32b6a00f33c7394555eff62ce6457bc6"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a32b6a00f33c7394555eff62ce6457bc6">MicVar_Morr::nc</a></div><div class="ttdeci">@ nc</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:44</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a434cf2c831802bb076e8bc31d16f0887"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a434cf2c831802bb076e8bc31d16f0887">MicVar_Morr::qpg</a></div><div class="ttdeci">@ qpg</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:41</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">MicVar_Morr::pres</a></div><div class="ttdeci">@ pres</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:30</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a6764e4c83976308b665ab846e77b53b0"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a6764e4c83976308b665ab846e77b53b0">MicVar_Morr::nr</a></div><div class="ttdeci">@ nr</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:45</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a786bbec2d1f95dad377cda134055cda1"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a786bbec2d1f95dad377cda134055cda1">MicVar_Morr::qcl</a></div><div class="ttdeci">@ qcl</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:35</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">MicVar_Morr::tabs</a></div><div class="ttdeci">@ tabs</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:29</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a7f3916bd057e43e125de3cbef18bcad3"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7f3916bd057e43e125de3cbef18bcad3">MicVar_Morr::theta</a></div><div class="ttdeci">@ theta</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:28</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a9021df498ba0043b1ac9ecf05f45c584"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a9021df498ba0043b1ac9ecf05f45c584">MicVar_Morr::ni</a></div><div class="ttdeci">@ ni</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:46</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a92a76bfaaf4385e0d2051d0124f254ea"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a92a76bfaaf4385e0d2051d0124f254ea">MicVar_Morr::ns</a></div><div class="ttdeci">@ ns</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:47</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a93264ee6dc9b23e994674a68250a2f16"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a93264ee6dc9b23e994674a68250a2f16">MicVar_Morr::omega</a></div><div class="ttdeci">@ omega</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:53</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0aa1b82f9b40da8ffccead09f9e102ff82"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0aa1b82f9b40da8ffccead09f9e102ff82">MicVar_Morr::qps</a></div><div class="ttdeci">@ qps</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:40</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0ab593766917aa9a7d6accf04b88139545"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab593766917aa9a7d6accf04b88139545">MicVar_Morr::graup_accum</a></div><div class="ttdeci">@ graup_accum</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:52</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0ab60d6bdceb03bf869685c46558bcbe89"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab60d6bdceb03bf869685c46558bcbe89">MicVar_Morr::rho</a></div><div class="ttdeci">@ rho</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:27</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0ab77c2781abdd9ebaa8b4cc3b271b57aa"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab77c2781abdd9ebaa8b4cc3b271b57aa">MicVar_Morr::qpr</a></div><div class="ttdeci">@ qpr</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:39</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0abdf878ba9b9f2644fa4354fbd6775d89"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0abdf878ba9b9f2644fa4354fbd6775d89">MicVar_Morr::qci</a></div><div class="ttdeci">@ qci</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:36</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0ad5e247bb2905b3b4a81c6487da6e0e45"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ad5e247bb2905b3b4a81c6487da6e0e45">MicVar_Morr::rain_accum</a></div><div class="ttdeci">@ rain_accum</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:50</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0af0a4b2d254cb85c987d8c9a64a592e50"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0af0a4b2d254cb85c987d8c9a64a592e50">MicVar_Morr::snow_accum</a></div><div class="ttdeci">@ snow_accum</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:51</div></div>
<div class="ttc" id="anamespacemodule__model__constants_html_a2dcccd992b668c86eecdd9a825970d4a"><div class="ttname"><a href="namespacemodule__model__constants.html#a2dcccd992b668c86eecdd9a825970d4a">module_model_constants::p0</a></div><div class="ttdeci">real(c_double), parameter p0</div><div class="ttdef"><b>Definition:</b> ERF_module_model_constants.F90:40</div></div>
<div class="ttc" id="anamespacemodule__model__constants_html_a771da7442ffd61d3eedb28c31a7e16a3"><div class="ttname"><a href="namespacemodule__model__constants.html#a771da7442ffd61d3eedb28c31a7e16a3">module_model_constants::xlf</a></div><div class="ttdeci">real(c_double), parameter xlf</div><div class="ttdef"><b>Definition:</b> ERF_module_model_constants.F90:58</div></div>
<div class="ttc" id="astructSolverChoice_html_aacbfbe6f4a3040db3efdc6dbf8fa291b"><div class="ttname"><a href="structSolverChoice.html#aacbfbe6f4a3040db3efdc6dbf8fa291b">SolverChoice::moisture_type</a></div><div class="ttdeci">MoistureType moisture_type</div><div class="ttdef"><b>Definition:</b> ERF_DataStruct.H:752</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a14321f6398d7555cc4bcb02dae4b0be1_cgraph.png" border="0" usemap="#aclassMorrison_a14321f6398d7555cc4bcb02dae4b0be1_cgraph" alt=""/></div>
<map name="aclassMorrison_a14321f6398d7555cc4bcb02dae4b0be1_cgraph" id="aclassMorrison_a14321f6398d7555cc4bcb02dae4b0be1_cgraph">
<area shape="rect" title=" " alt="" coords="5,122,148,149"/>
<area shape="rect" href="ERF__AdvanceMorrison_8cpp.html#a1d61dd254dd6d74236cdd989226eb4d7" title=" " alt="" coords="207,5,373,47"/>
<area shape="rect" href="ERF__AdvanceMorrison_8cpp.html#af8756cf103eb5b43c28400e574f81bd5" title=" " alt="" coords="224,71,356,98"/>
<area shape="rect" href="ERF__Morrison__Fortran__Interface_8H.html#aa1e15a22d6cf65c21c2a28cd25a16946" title=" " alt="" coords="196,122,384,149"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#ac54f1d17d8842acb42b2312cd353e469" title=" " alt="" coords="271,173,309,199"/>
<area shape="rect" href="ERF__TileNoZ_8H.html#a8da113f1d5603f7297fe1d03e5013f00" title=" " alt="" coords="253,223,327,250"/>
<area shape="rect" href="namespacemodule__mp__morr__two__moment.html#af11f1d093484c24bcfe7ca392ab7f34f" title=" " alt="" coords="432,5,600,47"/>
<area shape="rect" href="ERF__AdvanceMorrison_8cpp.html#a79f9c6159f68ac54125bd28fbb157de8" title=" " alt="" coords="466,71,566,98"/>
</map>
</div>

</div>
</div>
<a id="a7d3bd1b9f29e84bc115d7a9f42595f76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d3bd1b9f29e84bc115d7a9f42595f76">&#9670;&nbsp;</a></span>Compute_Coefficients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Compute_Coefficients </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">auto</span> dz   = <a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a>.CellSize(2);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">auto</span> lowz = <a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a>.ProbLo(2);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keyword">auto</span> accrrc_t  = <a class="code" href="classMorrison.html#aa5df21d7c7adfd10586783871524fac4">accrrc</a>.table();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keyword">auto</span> accrsi_t  = <a class="code" href="classMorrison.html#a9e5363db069243651289087f05115fcd">accrsi</a>.table();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keyword">auto</span> accrsc_t  = <a class="code" href="classMorrison.html#af3f26a0a44abe58527b22336648d8e56">accrsc</a>.table();</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keyword">auto</span> coefice_t = <a class="code" href="classMorrison.html#a96fb0e34b50bf691859ca0434b594b2e">coefice</a>.table();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keyword">auto</span> evaps1_t  = <a class="code" href="classMorrison.html#ac9054cb36d2b174d1033972de065b37b">evaps1</a>.table();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keyword">auto</span> evaps2_t  = <a class="code" href="classMorrison.html#ad0b73c861dc791272e1ac6d781d72562">evaps2</a>.table();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">auto</span> accrgi_t  = <a class="code" href="classMorrison.html#a540699586b918c354be6e8347fbbd83c">accrgi</a>.table();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keyword">auto</span> accrgc_t  = <a class="code" href="classMorrison.html#a5e4e4de3f0961b43f5972bc78c964d38">accrgc</a>.table();</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">auto</span> evapg1_t  = <a class="code" href="classMorrison.html#aae5e0add59ee0f17b03518b5888d0a61">evapg1</a>.table();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keyword">auto</span> evapg2_t  = <a class="code" href="classMorrison.html#a186c1ded94acbad74e980303e9867a61">evapg2</a>.table();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">auto</span> evapr1_t  = <a class="code" href="classMorrison.html#abdd637dd50f94ad624ad86ec6bed76d8">evapr1</a>.table();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keyword">auto</span> evapr2_t  = <a class="code" href="classMorrison.html#aeeb1fc95ab35c46faf404d62d505108e">evapr2</a>.table();</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keyword">auto</span> rho1d_t  = <a class="code" href="classMorrison.html#ae08598f7fe3990c39c84b9222d3a8cdb">rho1d</a>.table();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keyword">auto</span> pres1d_t = <a class="code" href="classMorrison.html#a46d87d763b7db8aa5e9c9e1d8ed40ac2">pres1d</a>.table();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keyword">auto</span> tabs1d_t = <a class="code" href="classMorrison.html#a625091bf149aa3bd952e50b9b438681d">tabs1d</a>.table();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keyword">auto</span> gamaz_t  = <a class="code" href="classMorrison.html#a8be05adcddf26645e0afe16f7fd7959b">gamaz</a>.table();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keyword">auto</span> zmid_t   = <a class="code" href="classMorrison.html#a47672a46dbf0d5919e8a4575a9bf2b21">zmid</a>.table();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    Real gam3  = <a class="code" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a>(3.0             );</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    Real gamr1 = <a class="code" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a>(3.0+<a class="code" href="ERF__Constants_8H.html#a73a3e2e084667177abe0e4d2cd3da51c">b_rain</a>      );</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    Real gamr2 = <a class="code" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a>((5.0+<a class="code" href="ERF__Constants_8H.html#a73a3e2e084667177abe0e4d2cd3da51c">b_rain</a>)/2.0);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    Real gams1 = <a class="code" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a>(3.0+<a class="code" href="ERF__Constants_8H.html#aee22c64edc9a6e972b3866ee44c575fc">b_snow</a>      );</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    Real gams2 = <a class="code" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a>((5.0+<a class="code" href="ERF__Constants_8H.html#aee22c64edc9a6e972b3866ee44c575fc">b_snow</a>)/2.0);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    Real gamg1 = <a class="code" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a>(3.0+<a class="code" href="ERF__Constants_8H.html#a5b9ceb4b022305781565b213273b24df">b_grau</a>      );</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    Real gamg2 = <a class="code" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a>((5.0+<a class="code" href="ERF__Constants_8H.html#a5b9ceb4b022305781565b213273b24df">b_grau</a>)/2.0);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// calculate the plane average variables</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="classPlaneAverage.html">PlaneAverage</a> rho_ave(<a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab60d6bdceb03bf869685c46558bcbe89">MicVar_Morr::rho</a>].get(), <a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a>, <a class="code" href="classMorrison.html#a9b6b084ace42c7992815942eed92212f">m_axis</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="classPlaneAverage.html">PlaneAverage</a> theta_ave(<a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7f3916bd057e43e125de3cbef18bcad3">MicVar_Morr::theta</a>].get(), <a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a>, <a class="code" href="classMorrison.html#a9b6b084ace42c7992815942eed92212f">m_axis</a>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="classPlaneAverage.html">PlaneAverage</a> qv_ave(<a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a27ed8ba8d37ae85125221394270eceaf">MicVar_Morr::qv</a>].get(), <a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a>, <a class="code" href="classMorrison.html#a9b6b084ace42c7992815942eed92212f">m_axis</a>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    rho_ave.compute_averages(<a class="code" href="ERF__DirectionSelector_8H.html#aca321ed7fddfe43ff7549b4632a3c0d1">ZDir</a>(), rho_ave.field());</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    theta_ave.compute_averages(<a class="code" href="ERF__DirectionSelector_8H.html#aca321ed7fddfe43ff7549b4632a3c0d1">ZDir</a>(), theta_ave.field());</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    qv_ave.compute_averages(<a class="code" href="ERF__DirectionSelector_8H.html#aca321ed7fddfe43ff7549b4632a3c0d1">ZDir</a>(), qv_ave.field());</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// get host variable rho, and rhotheta</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">int</span> ncell = rho_ave.ncell_line();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    Gpu::HostVector&lt;Real&gt; rho_h(ncell), theta_h(ncell), qv_h(ncell);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    rho_ave.line_average(0, rho_h);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    theta_ave.line_average(0, theta_h);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    qv_ave.line_average(0, qv_h);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// copy data to device</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    Gpu::DeviceVector&lt;Real&gt; rho_d(ncell), theta_d(ncell), qv_d(ncell);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    Gpu::copyAsync(Gpu::hostToDevice, rho_h.begin(), rho_h.end(), rho_d.begin());</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    Gpu::copyAsync(Gpu::hostToDevice, theta_h.begin(), theta_h.end(), theta_d.begin());</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    Gpu::copyAsync(Gpu::hostToDevice, qv_h.begin(), qv_h.end(), qv_d.begin());</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    Gpu::streamSynchronize();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    Real* rho_dptr   = rho_d.data();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    Real* theta_dptr = theta_d.data();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    Real* qv_dptr    = qv_d.data();</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    Real gOcp = <a class="code" href="classMorrison.html#a4930ab51ce1a492bdddb2aa1cb001b21">m_gOcp</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    ParallelFor(<a class="code" href="classMorrison.html#a7bc485a108780b844d2ecdc70f7a618b">nlev</a>, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        Real RhoTheta = rho_dptr[k]*theta_dptr[k];</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        Real pressure = <a class="code" href="ERF__EOS_8H.html#a08354ab110fb9e873bce9250b4f4b46e">getPgivenRTh</a>(RhoTheta, qv_dptr[k]);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        rho1d_t(k)    = rho_dptr[k];</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        pres1d_t(k)   = pressure*0.01;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">// NOTE: Limit the temperature to the melting point of ice to avoid a divide by</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">//       0 condition when computing the cold evaporation coefficients. This should</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">//       not affect results since evporation requires snow/graupel to be present</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">//       and thus T&lt;273.16</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        tabs1d_t(k)   = std::min(<a class="code" href="ERF__EOS_8H.html#a65cf1718b7a1fcc56cb16685642543da">getTgivenRandRTh</a>(rho_dptr[k], RhoTheta, qv_dptr[k]),273.16);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        zmid_t(k)     = lowz + (k+0.5)*dz;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        gamaz_t(k)    = gOcp*zmid_t(k);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    });</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span>(round(gam3) != 2) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;cannot compute gamma-function in Microphysics::Init&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        std::exit(-1);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// Populate all the coefficients</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    ParallelFor(<a class="code" href="classMorrison.html#a7bc485a108780b844d2ecdc70f7a618b">nlev</a>, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> k) noexcept</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        Real Prefactor;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        Real pratio = sqrt(1.29 / rho1d_t(k));</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="comment">//Real rrr1   = 393.0/(tabs1d_t(k)+120.0)*std::pow((tabs1d_t(k)/273.0),1.5);</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">//Real rrr2   = std::pow((tabs1d_t(k)/273.0),1.94)*(1000.0/pres1d_t(k));</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        Real estw   = 100.0*<a class="code" href="ERF__MicrophysicsUtils_8H.html#a16a390366e7e68ca35fdac4cad824428">erf_esatw</a>(tabs1d_t(k));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        Real esti   = 100.0*<a class="code" href="ERF__MicrophysicsUtils_8H.html#a4ea516e89f4e87b4ffc305504e8f0bf1">erf_esati</a>(tabs1d_t(k));</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">// accretion by snow:</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        Real coef1   = 0.25 * <a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ae56996ced8497f129d813e2f9c94786e">nzeros</a> * <a class="code" href="ERF__Constants_8H.html#aeb6d6f09d27c3f646bc4d91b7b88e570">a_snow</a> * gams1 * pratio/pow((<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ac0e05183a58d4400f06346d18371218f">rhos</a> * <a class="code" href="ERF__Constants_8H.html#ae56996ced8497f129d813e2f9c94786e">nzeros</a>/rho1d_t(k) ) , ((3.0+<a class="code" href="ERF__Constants_8H.html#aee22c64edc9a6e972b3866ee44c575fc">b_snow</a>)/4.0));</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        Real coef2   = exp(0.025*(tabs1d_t(k) - 273.15));</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        accrsi_t(k)  =  coef1 * coef2 * <a class="code" href="ERF__Constants_8H.html#a414035f12e97c86f4e40cb6763c29ddb">esicoef</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        accrsc_t(k)  =  coef1 * <a class="code" href="ERF__Constants_8H.html#ac16a7511bec41b7d5a558b5841e8f3b1">esccoef</a>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        coefice_t(k) =  coef2;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">// evaporation of snow:</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        coef1 = (<a class="code" href="ERF__Constants_8H.html#a3ab435b88eae71bef826cb01254ff33d">lsub</a>/(tabs1d_t(k)*<a class="code" href="ERF__Constants_8H.html#a0ab59ff21ef0b178fde0843394f5674a">R_v</a>)-1.0)*<a class="code" href="ERF__Constants_8H.html#a3ab435b88eae71bef826cb01254ff33d">lsub</a>/(<a class="code" href="ERF__Constants_8H.html#a583248545708b1481d513f2c9621f0ba">therco</a>*tabs1d_t(k));</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        coef2 = <a class="code" href="ERF__Constants_8H.html#a0ab59ff21ef0b178fde0843394f5674a">R_v</a> * <a class="code" href="ERF__Constants_8H.html#aeb133d0ac46d639050313ce36187e870">R_d</a> / (<a class="code" href="ERF__Constants_8H.html#a4e1c44dade7fcd7648d3e87ba5bba4c1">diffelq</a> * esti);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        Prefactor = 2.0 * <a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ae56996ced8497f129d813e2f9c94786e">nzeros</a> / (rho1d_t(k) * (coef1 + coef2));</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        Prefactor *= (2.0/<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a>); <span class="comment">// Shape factor snow</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        evaps1_t(k) = Prefactor * 0.65 * sqrt(rho1d_t(k) / (<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ac0e05183a58d4400f06346d18371218f">rhos</a> * <a class="code" href="ERF__Constants_8H.html#ae56996ced8497f129d813e2f9c94786e">nzeros</a>));</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        evaps2_t(k) = Prefactor * 0.44 * sqrt(<a class="code" href="ERF__Constants_8H.html#aeb6d6f09d27c3f646bc4d91b7b88e570">a_snow</a> * rho1d_t(k) / <a class="code" href="ERF__Constants_8H.html#a0e5683feac33352111ce4445dbedbf45">muelq</a>) * gams2</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    * sqrt(pratio) * pow(rho1d_t(k) / (<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ac0e05183a58d4400f06346d18371218f">rhos</a> * <a class="code" href="ERF__Constants_8H.html#ae56996ced8497f129d813e2f9c94786e">nzeros</a>) , ((5.0+<a class="code" href="ERF__Constants_8H.html#aee22c64edc9a6e972b3866ee44c575fc">b_snow</a>)/8.0));</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// accretion by graupel:</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        coef1 = 0.25*<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a>*<a class="code" href="ERF__Constants_8H.html#a1d5b108314147320a74eaccbfa0d09b0">nzerog</a>*<a class="code" href="ERF__Constants_8H.html#a2fe4f2c6313692ac5073cb9ca72552e2">a_grau</a>*gamg1*pratio/pow((<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a>*<a class="code" href="ERF__Constants_8H.html#a00c6555efa1735f66b36929196ff6b98">rhog</a>*<a class="code" href="ERF__Constants_8H.html#a1d5b108314147320a74eaccbfa0d09b0">nzerog</a>/rho1d_t(k)) , ((3.0+<a class="code" href="ERF__Constants_8H.html#a5b9ceb4b022305781565b213273b24df">b_grau</a>)/4.0));</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        coef2 = exp(0.025*(tabs1d_t(k) - 273.15));</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        accrgi_t(k) = coef1 * coef2 * <a class="code" href="ERF__Constants_8H.html#a6b49f5e9d61881c5a59656453a6c025f">egicoef</a>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        accrgc_t(k) = coef1 * <a class="code" href="ERF__Constants_8H.html#a65f78c57eaba4f35dc9183cd2f3e66e3">egccoef</a>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="comment">// evaporation of graupel:</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        coef1 = (<a class="code" href="ERF__Constants_8H.html#a3ab435b88eae71bef826cb01254ff33d">lsub</a>/(tabs1d_t(k)*<a class="code" href="ERF__Constants_8H.html#a0ab59ff21ef0b178fde0843394f5674a">R_v</a>)-1.0)*<a class="code" href="ERF__Constants_8H.html#a3ab435b88eae71bef826cb01254ff33d">lsub</a>/(<a class="code" href="ERF__Constants_8H.html#a583248545708b1481d513f2c9621f0ba">therco</a>*tabs1d_t(k));</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        coef2 = <a class="code" href="ERF__Constants_8H.html#a0ab59ff21ef0b178fde0843394f5674a">R_v</a> * <a class="code" href="ERF__Constants_8H.html#aeb133d0ac46d639050313ce36187e870">R_d</a> / (<a class="code" href="ERF__Constants_8H.html#a4e1c44dade7fcd7648d3e87ba5bba4c1">diffelq</a> * esti);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        Prefactor = 2.0 * <a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#a1d5b108314147320a74eaccbfa0d09b0">nzerog</a> / (rho1d_t(k) * (coef1 + coef2)); <span class="comment">// Shape factor for graupel is 1</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        evapg1_t(k) = Prefactor * 0.78 * sqrt(rho1d_t(k) / (<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#a00c6555efa1735f66b36929196ff6b98">rhog</a> * <a class="code" href="ERF__Constants_8H.html#a1d5b108314147320a74eaccbfa0d09b0">nzerog</a>));</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        evapg2_t(k) = Prefactor * 0.31 * sqrt(<a class="code" href="ERF__Constants_8H.html#a2fe4f2c6313692ac5073cb9ca72552e2">a_grau</a> * rho1d_t(k) / <a class="code" href="ERF__Constants_8H.html#a0e5683feac33352111ce4445dbedbf45">muelq</a>) * gamg2</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    * sqrt(pratio) * pow(rho1d_t(k) / (<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#a00c6555efa1735f66b36929196ff6b98">rhog</a> * <a class="code" href="ERF__Constants_8H.html#a1d5b108314147320a74eaccbfa0d09b0">nzerog</a>) , ((5.0+<a class="code" href="ERF__Constants_8H.html#a5b9ceb4b022305781565b213273b24df">b_grau</a>)/8.0));</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="comment">// accretion by rain:</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        accrrc_t(k) = 0.25 * <a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#aaa2fd2941341ea7699a9acfb434b2ee1">nzeror</a> * <a class="code" href="ERF__Constants_8H.html#adf319f31edb7d4f2b4b712096189734b">a_rain</a> * gamr1 * pratio/pow((<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ad6e28022b74cd595f282e2cc97c2c0d8">rhor</a> * <a class="code" href="ERF__Constants_8H.html#aaa2fd2941341ea7699a9acfb434b2ee1">nzeror</a> / rho1d_t(k)) , ((3.0+<a class="code" href="ERF__Constants_8H.html#a73a3e2e084667177abe0e4d2cd3da51c">b_rain</a>)/4.))* <a class="code" href="ERF__Constants_8H.html#af90fa8b6a26f98067ce125597f35d983">erccoef</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment">// evaporation of rain:</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        coef1 = (<a class="code" href="ERF__Constants_8H.html#a7b45c0074d559f423ac2d48e1b171518">lcond</a>/(tabs1d_t(k)*<a class="code" href="ERF__Constants_8H.html#a0ab59ff21ef0b178fde0843394f5674a">R_v</a>)-1.0)*<a class="code" href="ERF__Constants_8H.html#a7b45c0074d559f423ac2d48e1b171518">lcond</a>/(<a class="code" href="ERF__Constants_8H.html#a583248545708b1481d513f2c9621f0ba">therco</a>*tabs1d_t(k));</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        coef2 = <a class="code" href="ERF__Constants_8H.html#a0ab59ff21ef0b178fde0843394f5674a">R_v</a> * <a class="code" href="ERF__Constants_8H.html#aeb133d0ac46d639050313ce36187e870">R_d</a> / (<a class="code" href="ERF__Constants_8H.html#a4e1c44dade7fcd7648d3e87ba5bba4c1">diffelq</a> * estw);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        Prefactor = 2.0 * <a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#aaa2fd2941341ea7699a9acfb434b2ee1">nzeror</a> / (rho1d_t(k) * (coef1 + coef2)); <span class="comment">// Shape factor for rain is 1</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        evapr1_t(k) = Prefactor * 0.78 * sqrt(rho1d_t(k) / (<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ad6e28022b74cd595f282e2cc97c2c0d8">rhor</a> * <a class="code" href="ERF__Constants_8H.html#aaa2fd2941341ea7699a9acfb434b2ee1">nzeror</a>));</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        evapr2_t(k) = Prefactor * 0.31 * sqrt(<a class="code" href="ERF__Constants_8H.html#adf319f31edb7d4f2b4b712096189734b">a_rain</a> * rho1d_t(k) / <a class="code" href="ERF__Constants_8H.html#a0e5683feac33352111ce4445dbedbf45">muelq</a>) * gamr2</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    * sqrt(pratio) * pow(rho1d_t(k) / (<a class="code" href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a> * <a class="code" href="ERF__Constants_8H.html#ad6e28022b74cd595f282e2cc97c2c0d8">rhor</a> * <a class="code" href="ERF__Constants_8H.html#aaa2fd2941341ea7699a9acfb434b2ee1">nzeror</a>) , ((5.0+<a class="code" href="ERF__Constants_8H.html#a73a3e2e084667177abe0e4d2cd3da51c">b_rain</a>)/8.0));</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    });</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
<div class="ttc" id="aERF__Constants_8H_html_a00c6555efa1735f66b36929196ff6b98"><div class="ttname"><a href="ERF__Constants_8H.html#a00c6555efa1735f66b36929196ff6b98">rhog</a></div><div class="ttdeci">constexpr amrex::Real rhog</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:30</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a0ab59ff21ef0b178fde0843394f5674a"><div class="ttname"><a href="ERF__Constants_8H.html#a0ab59ff21ef0b178fde0843394f5674a">R_v</a></div><div class="ttdeci">constexpr amrex::Real R_v</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:11</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a0e5683feac33352111ce4445dbedbf45"><div class="ttname"><a href="ERF__Constants_8H.html#a0e5683feac33352111ce4445dbedbf45">muelq</a></div><div class="ttdeci">constexpr amrex::Real muelq</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:75</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a1d5b108314147320a74eaccbfa0d09b0"><div class="ttname"><a href="ERF__Constants_8H.html#a1d5b108314147320a74eaccbfa0d09b0">nzerog</a></div><div class="ttdeci">constexpr amrex::Real nzerog</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:59</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a2fe4f2c6313692ac5073cb9ca72552e2"><div class="ttname"><a href="ERF__Constants_8H.html#a2fe4f2c6313692ac5073cb9ca72552e2">a_grau</a></div><div class="ttdeci">constexpr amrex::Real a_grau</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:42</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a3ab435b88eae71bef826cb01254ff33d"><div class="ttname"><a href="ERF__Constants_8H.html#a3ab435b88eae71bef826cb01254ff33d">lsub</a></div><div class="ttdeci">constexpr amrex::Real lsub</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:68</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a414035f12e97c86f4e40cb6763c29ddb"><div class="ttname"><a href="ERF__Constants_8H.html#a414035f12e97c86f4e40cb6763c29ddb">esicoef</a></div><div class="ttdeci">constexpr amrex::Real esicoef</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:53</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a4e1c44dade7fcd7648d3e87ba5bba4c1"><div class="ttname"><a href="ERF__Constants_8H.html#a4e1c44dade7fcd7648d3e87ba5bba4c1">diffelq</a></div><div class="ttdeci">constexpr amrex::Real diffelq</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:73</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a583248545708b1481d513f2c9621f0ba"><div class="ttname"><a href="ERF__Constants_8H.html#a583248545708b1481d513f2c9621f0ba">therco</a></div><div class="ttdeci">constexpr amrex::Real therco</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:74</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a5b9ceb4b022305781565b213273b24df"><div class="ttname"><a href="ERF__Constants_8H.html#a5b9ceb4b022305781565b213273b24df">b_grau</a></div><div class="ttdeci">constexpr amrex::Real b_grau</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:43</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a65f78c57eaba4f35dc9183cd2f3e66e3"><div class="ttname"><a href="ERF__Constants_8H.html#a65f78c57eaba4f35dc9183cd2f3e66e3">egccoef</a></div><div class="ttdeci">constexpr amrex::Real egccoef</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:54</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a6b49f5e9d61881c5a59656453a6c025f"><div class="ttname"><a href="ERF__Constants_8H.html#a6b49f5e9d61881c5a59656453a6c025f">egicoef</a></div><div class="ttdeci">constexpr amrex::Real egicoef</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:55</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a73a3e2e084667177abe0e4d2cd3da51c"><div class="ttname"><a href="ERF__Constants_8H.html#a73a3e2e084667177abe0e4d2cd3da51c">b_rain</a></div><div class="ttdeci">constexpr amrex::Real b_rain</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:39</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a7b45c0074d559f423ac2d48e1b171518"><div class="ttname"><a href="ERF__Constants_8H.html#a7b45c0074d559f423ac2d48e1b171518">lcond</a></div><div class="ttdeci">constexpr amrex::Real lcond</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:66</div></div>
<div class="ttc" id="aERF__Constants_8H_html_a988c4efd6fd0d855e241e77a73191428"><div class="ttname"><a href="ERF__Constants_8H.html#a988c4efd6fd0d855e241e77a73191428">PI</a></div><div class="ttdeci">constexpr amrex::Real PI</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:6</div></div>
<div class="ttc" id="aERF__Constants_8H_html_aaa2fd2941341ea7699a9acfb434b2ee1"><div class="ttname"><a href="ERF__Constants_8H.html#aaa2fd2941341ea7699a9acfb434b2ee1">nzeror</a></div><div class="ttdeci">constexpr amrex::Real nzeror</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:57</div></div>
<div class="ttc" id="aERF__Constants_8H_html_ac0e05183a58d4400f06346d18371218f"><div class="ttname"><a href="ERF__Constants_8H.html#ac0e05183a58d4400f06346d18371218f">rhos</a></div><div class="ttdeci">constexpr amrex::Real rhos</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:29</div></div>
<div class="ttc" id="aERF__Constants_8H_html_ac16a7511bec41b7d5a558b5841e8f3b1"><div class="ttname"><a href="ERF__Constants_8H.html#ac16a7511bec41b7d5a558b5841e8f3b1">esccoef</a></div><div class="ttdeci">constexpr amrex::Real esccoef</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:52</div></div>
<div class="ttc" id="aERF__Constants_8H_html_ad6e28022b74cd595f282e2cc97c2c0d8"><div class="ttname"><a href="ERF__Constants_8H.html#ad6e28022b74cd595f282e2cc97c2c0d8">rhor</a></div><div class="ttdeci">constexpr amrex::Real rhor</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:28</div></div>
<div class="ttc" id="aERF__Constants_8H_html_adf319f31edb7d4f2b4b712096189734b"><div class="ttname"><a href="ERF__Constants_8H.html#adf319f31edb7d4f2b4b712096189734b">a_rain</a></div><div class="ttdeci">constexpr amrex::Real a_rain</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:38</div></div>
<div class="ttc" id="aERF__Constants_8H_html_ae56996ced8497f129d813e2f9c94786e"><div class="ttname"><a href="ERF__Constants_8H.html#ae56996ced8497f129d813e2f9c94786e">nzeros</a></div><div class="ttdeci">constexpr amrex::Real nzeros</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:58</div></div>
<div class="ttc" id="aERF__Constants_8H_html_aeb133d0ac46d639050313ce36187e870"><div class="ttname"><a href="ERF__Constants_8H.html#aeb133d0ac46d639050313ce36187e870">R_d</a></div><div class="ttdeci">constexpr amrex::Real R_d</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:10</div></div>
<div class="ttc" id="aERF__Constants_8H_html_aeb6d6f09d27c3f646bc4d91b7b88e570"><div class="ttname"><a href="ERF__Constants_8H.html#aeb6d6f09d27c3f646bc4d91b7b88e570">a_snow</a></div><div class="ttdeci">constexpr amrex::Real a_snow</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:40</div></div>
<div class="ttc" id="aERF__Constants_8H_html_aee22c64edc9a6e972b3866ee44c575fc"><div class="ttname"><a href="ERF__Constants_8H.html#aee22c64edc9a6e972b3866ee44c575fc">b_snow</a></div><div class="ttdeci">constexpr amrex::Real b_snow</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:41</div></div>
<div class="ttc" id="aERF__Constants_8H_html_af90fa8b6a26f98067ce125597f35d983"><div class="ttname"><a href="ERF__Constants_8H.html#af90fa8b6a26f98067ce125597f35d983">erccoef</a></div><div class="ttdeci">constexpr amrex::Real erccoef</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:51</div></div>
<div class="ttc" id="aERF__DirectionSelector_8H_html_aca321ed7fddfe43ff7549b4632a3c0d1"><div class="ttname"><a href="ERF__DirectionSelector_8H.html#aca321ed7fddfe43ff7549b4632a3c0d1">ZDir</a></div><div class="ttdeci">DirectionSelector&lt; 2 &gt; ZDir</div><div class="ttdef"><b>Definition:</b> ERF_DirectionSelector.H:38</div></div>
<div class="ttc" id="aERF__EOS_8H_html_a08354ab110fb9e873bce9250b4f4b46e"><div class="ttname"><a href="ERF__EOS_8H.html#a08354ab110fb9e873bce9250b4f4b46e">getPgivenRTh</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE amrex::Real getPgivenRTh(const amrex::Real rhotheta, const amrex::Real qv=0.)</div><div class="ttdef"><b>Definition:</b> ERF_EOS.H:84</div></div>
<div class="ttc" id="aERF__EOS_8H_html_a65cf1718b7a1fcc56cb16685642543da"><div class="ttname"><a href="ERF__EOS_8H.html#a65cf1718b7a1fcc56cb16685642543da">getTgivenRandRTh</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE amrex::Real getTgivenRandRTh(const amrex::Real rho, const amrex::Real rhotheta, const amrex::Real qv=0.0)</div><div class="ttdef"><b>Definition:</b> ERF_EOS.H:46</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_a16a390366e7e68ca35fdac4cad824428"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#a16a390366e7e68ca35fdac4cad824428">erf_esatw</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE amrex::Real erf_esatw(amrex::Real t)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:64</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_a4ea516e89f4e87b4ffc305504e8f0bf1"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#a4ea516e89f4e87b4ffc305504e8f0bf1">erf_esati</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE amrex::Real erf_esati(amrex::Real t)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:24</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_abd125e107924437493cbcbac9a97c017"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017">erf_gammafff</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE amrex::Real erf_gammafff(amrex::Real x)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:15</div></div>
<div class="ttc" id="aclassMorrison_html_a186c1ded94acbad74e980303e9867a61"><div class="ttname"><a href="classMorrison.html#a186c1ded94acbad74e980303e9867a61">Morrison::evapg2</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; evapg2</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:313</div></div>
<div class="ttc" id="aclassMorrison_html_a46d87d763b7db8aa5e9c9e1d8ed40ac2"><div class="ttname"><a href="classMorrison.html#a46d87d763b7db8aa5e9c9e1d8ed40ac2">Morrison::pres1d</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; pres1d</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:319</div></div>
<div class="ttc" id="aclassMorrison_html_a47672a46dbf0d5919e8a4575a9bf2b21"><div class="ttname"><a href="classMorrison.html#a47672a46dbf0d5919e8a4575a9bf2b21">Morrison::zmid</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; zmid</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:326</div></div>
<div class="ttc" id="aclassMorrison_html_a4930ab51ce1a492bdddb2aa1cb001b21"><div class="ttname"><a href="classMorrison.html#a4930ab51ce1a492bdddb2aa1cb001b21">Morrison::m_gOcp</a></div><div class="ttdeci">amrex::Real m_gOcp</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:293</div></div>
<div class="ttc" id="aclassMorrison_html_a540699586b918c354be6e8347fbbd83c"><div class="ttname"><a href="classMorrison.html#a540699586b918c354be6e8347fbbd83c">Morrison::accrgi</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; accrgi</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:310</div></div>
<div class="ttc" id="aclassMorrison_html_a5e4e4de3f0961b43f5972bc78c964d38"><div class="ttname"><a href="classMorrison.html#a5e4e4de3f0961b43f5972bc78c964d38">Morrison::accrgc</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; accrgc</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:311</div></div>
<div class="ttc" id="aclassMorrison_html_a625091bf149aa3bd952e50b9b438681d"><div class="ttname"><a href="classMorrison.html#a625091bf149aa3bd952e50b9b438681d">Morrison::tabs1d</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; tabs1d</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:320</div></div>
<div class="ttc" id="aclassMorrison_html_a7bc485a108780b844d2ecdc70f7a618b"><div class="ttname"><a href="classMorrison.html#a7bc485a108780b844d2ecdc70f7a618b">Morrison::nlev</a></div><div class="ttdeci">int nlev</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:284</div></div>
<div class="ttc" id="aclassMorrison_html_a8be05adcddf26645e0afe16f7fd7959b"><div class="ttname"><a href="classMorrison.html#a8be05adcddf26645e0afe16f7fd7959b">Morrison::gamaz</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; gamaz</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:325</div></div>
<div class="ttc" id="aclassMorrison_html_a96fb0e34b50bf691859ca0434b594b2e"><div class="ttname"><a href="classMorrison.html#a96fb0e34b50bf691859ca0434b594b2e">Morrison::coefice</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; coefice</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:307</div></div>
<div class="ttc" id="aclassMorrison_html_a9e5363db069243651289087f05115fcd"><div class="ttname"><a href="classMorrison.html#a9e5363db069243651289087f05115fcd">Morrison::accrsi</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; accrsi</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:305</div></div>
<div class="ttc" id="aclassMorrison_html_aa5df21d7c7adfd10586783871524fac4"><div class="ttname"><a href="classMorrison.html#aa5df21d7c7adfd10586783871524fac4">Morrison::accrrc</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; accrrc</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:304</div></div>
<div class="ttc" id="aclassMorrison_html_aae5e0add59ee0f17b03518b5888d0a61"><div class="ttname"><a href="classMorrison.html#aae5e0add59ee0f17b03518b5888d0a61">Morrison::evapg1</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; evapg1</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:312</div></div>
<div class="ttc" id="aclassMorrison_html_abdd637dd50f94ad624ad86ec6bed76d8"><div class="ttname"><a href="classMorrison.html#abdd637dd50f94ad624ad86ec6bed76d8">Morrison::evapr1</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; evapr1</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:314</div></div>
<div class="ttc" id="aclassMorrison_html_ac9054cb36d2b174d1033972de065b37b"><div class="ttname"><a href="classMorrison.html#ac9054cb36d2b174d1033972de065b37b">Morrison::evaps1</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; evaps1</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:308</div></div>
<div class="ttc" id="aclassMorrison_html_ad0b73c861dc791272e1ac6d781d72562"><div class="ttname"><a href="classMorrison.html#ad0b73c861dc791272e1ac6d781d72562">Morrison::evaps2</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; evaps2</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:309</div></div>
<div class="ttc" id="aclassMorrison_html_ae08598f7fe3990c39c84b9222d3a8cdb"><div class="ttname"><a href="classMorrison.html#ae08598f7fe3990c39c84b9222d3a8cdb">Morrison::rho1d</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; rho1d</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:318</div></div>
<div class="ttc" id="aclassMorrison_html_aeeb1fc95ab35c46faf404d62d505108e"><div class="ttname"><a href="classMorrison.html#aeeb1fc95ab35c46faf404d62d505108e">Morrison::evapr2</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; evapr2</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:315</div></div>
<div class="ttc" id="aclassMorrison_html_af3f26a0a44abe58527b22336648d8e56"><div class="ttname"><a href="classMorrison.html#af3f26a0a44abe58527b22336648d8e56">Morrison::accrsc</a></div><div class="ttdeci">amrex::TableData&lt; amrex::Real, 1 &gt; accrsc</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:306</div></div>
<div class="ttc" id="aclassPlaneAverage_html"><div class="ttname"><a href="classPlaneAverage.html">PlaneAverage</a></div><div class="ttdef"><b>Definition:</b> ERF_PlaneAverage.H:14</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="classMorrison.html#a3b223b2f67d6de76f1edd249b4a16d63">Update_Micro_Vars()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_cgraph.png" border="0" usemap="#aclassMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_cgraph" alt=""/></div>
<map name="aclassMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_cgraph" id="aclassMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_cgraph">
<area shape="rect" title=" " alt="" coords="5,223,236,250"/>
<area shape="rect" href="classPlaneAverage.html#a603aee4caf3a370d06bee77fddb0e33e" title=" " alt="" coords="287,5,463,47"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a4ea516e89f4e87b4ffc305504e8f0bf1" title=" " alt="" coords="335,71,414,98"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a16a390366e7e68ca35fdac4cad824428" title=" " alt="" coords="331,122,418,149"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017" title=" " alt="" coords="319,173,430,199"/>
<area shape="rect" href="classPlaneAverage.html#a027673d7c6dd35a1b45cd1fa8f2b4cb5" title=" " alt="" coords="301,223,448,250"/>
<area shape="rect" href="ERF__EOS_8H.html#a08354ab110fb9e873bce9250b4f4b46e" title=" " alt="" coords="319,274,430,301"/>
<area shape="rect" href="ERF__EOS_8H.html#a65cf1718b7a1fcc56cb16685642543da" title=" " alt="" coords="303,325,447,351"/>
<area shape="rect" href="classPlaneAverage.html#af12478c0cb46a8afc438846f8f24e949" title=" " alt="" coords="303,376,446,417"/>
<area shape="rect" href="classPlaneAverage.html#ab65036a99da90fb854f7dfd33cd700b1" title=" " alt="" coords="284,442,465,469"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#afac5e7caca80647972b208a0248b2ed8" title=" " alt="" coords="513,122,620,149"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_icgraph.png" border="0" usemap="#aclassMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_icgraph" alt=""/></div>
<map name="aclassMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_icgraph" id="aclassMorrison_a7d3bd1b9f29e84bc115d7a9f42595f76_icgraph">
<area shape="rect" title=" " alt="" coords="265,5,496,32"/>
<area shape="rect" href="classMorrison.html#a3b223b2f67d6de76f1edd249b4a16d63" title=" " alt="" coords="5,5,217,32"/>
</map>
</div>

</div>
</div>
<a id="a816f41f9bbd55757684c2f307940b117"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a816f41f9bbd55757684c2f307940b117">&#9670;&nbsp;</a></span>Copy_Micro_to_State()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Copy_Micro_to_State </td>
          <td>(</td>
          <td class="paramtype">amrex::MultiFab &amp;&#160;</td>
          <td class="paramname"><em>cons_in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Updates conserved and microphysics variables in the provided MultiFabs from the internal MultiFabs that store <a class="el" href="classMicrophysics.html" title="Base class for microphysics interface.">Microphysics</a> module data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">cons</td><td>Conserved variables </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">qmoist</td><td>qv, qc, qi, qr, qs, qg </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classNullMoist.html#a11a25944d4ddb955f74e355838b9d8b0">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;{</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="comment">// Get the temperature, density, theta, qt and qp from input</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordflow">for</span> ( MFIter mfi(<a class="code" href="namespaceVars.html#a3e5e550795a0b745a4e43177e81f8c57a47abe072e12c61d29cde15a509a0664b">cons</a>,TilingIfNotGPU()); mfi.isValid(); ++mfi) {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; box3d = mfi.tilebox();</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keyword">auto</span> states_arr = <a class="code" href="namespaceVars.html#a3e5e550795a0b745a4e43177e81f8c57a47abe072e12c61d29cde15a509a0664b">cons</a>.array(mfi);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="keyword">auto</span> rho_arr    = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab60d6bdceb03bf869685c46558bcbe89">MicVar_Morr::rho</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keyword">auto</span> theta_arr  = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7f3916bd057e43e125de3cbef18bcad3">MicVar_Morr::theta</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keyword">auto</span> qv_arr     = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a27ed8ba8d37ae85125221394270eceaf">MicVar_Morr::qv</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keyword">auto</span> qc_arr     = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a786bbec2d1f95dad377cda134055cda1">MicVar_Morr::qcl</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keyword">auto</span> qi_arr     = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0abdf878ba9b9f2644fa4354fbd6775d89">MicVar_Morr::qci</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <span class="keyword">auto</span> qpr_arr     = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab77c2781abdd9ebaa8b4cc3b271b57aa">MicVar_Morr::qpr</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keyword">auto</span> qps_arr     = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0aa1b82f9b40da8ffccead09f9e102ff82">MicVar_Morr::qps</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keyword">auto</span> qpg_arr     = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a434cf2c831802bb076e8bc31d16f0887">MicVar_Morr::qpg</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="comment">// get potential total density, temperature, qt, qp</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        ParallelFor( box3d, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            states_arr(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a28f96fd04e1ff08fa7a8f53ccde0f877">RhoTheta_comp</a>) = rho_arr(i,j,k)*theta_arr(i,j,k);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            states_arr(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#aa965e9988f14d5d2a5aef4a942168a15">RhoQ1_comp</a>)    = rho_arr(i,j,k)*std::max(0.0,qv_arr(i,j,k));</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            states_arr(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a3bf0a4783e82ba30db2b7c0a332c2f16">RhoQ2_comp</a>)    = rho_arr(i,j,k)*std::max(0.0,qc_arr(i,j,k));</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            states_arr(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a49fe20d81f4d923a4a6ec4eb1652072b">RhoQ3_comp</a>)    = rho_arr(i,j,k)*std::max(0.0,qi_arr(i,j,k));</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            states_arr(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a28c5deab9008c0999c26affeff2fa6da">RhoQ4_comp</a>)    = rho_arr(i,j,k)*std::max(0.0,qpr_arr(i,j,k));</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            states_arr(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#ac46d015fd5b1ee0060bbaf22e79113e7">RhoQ5_comp</a>)    = rho_arr(i,j,k)*std::max(0.0,qps_arr(i,j,k));</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            states_arr(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#aae057dae5f599b944184a0ecf7801064">RhoQ6_comp</a>)    = rho_arr(i,j,k)*std::max(0.0,qpg_arr(i,j,k));</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        });</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Fill interior ghost cells and periodic boundaries</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="namespaceVars.html#a3e5e550795a0b745a4e43177e81f8c57a47abe072e12c61d29cde15a509a0664b">cons</a>.FillBoundary(<a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a>.periodicity());</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
<div class="ttc" id="aERF__IndexDefines_8H_html_a28c5deab9008c0999c26affeff2fa6da"><div class="ttname"><a href="ERF__IndexDefines_8H.html#a28c5deab9008c0999c26affeff2fa6da">RhoQ4_comp</a></div><div class="ttdeci">#define RhoQ4_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:45</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_a28f96fd04e1ff08fa7a8f53ccde0f877"><div class="ttname"><a href="ERF__IndexDefines_8H.html#a28f96fd04e1ff08fa7a8f53ccde0f877">RhoTheta_comp</a></div><div class="ttdeci">#define RhoTheta_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:37</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_a3bf0a4783e82ba30db2b7c0a332c2f16"><div class="ttname"><a href="ERF__IndexDefines_8H.html#a3bf0a4783e82ba30db2b7c0a332c2f16">RhoQ2_comp</a></div><div class="ttdeci">#define RhoQ2_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:43</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_a49fe20d81f4d923a4a6ec4eb1652072b"><div class="ttname"><a href="ERF__IndexDefines_8H.html#a49fe20d81f4d923a4a6ec4eb1652072b">RhoQ3_comp</a></div><div class="ttdeci">#define RhoQ3_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:44</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_aa965e9988f14d5d2a5aef4a942168a15"><div class="ttname"><a href="ERF__IndexDefines_8H.html#aa965e9988f14d5d2a5aef4a942168a15">RhoQ1_comp</a></div><div class="ttdeci">#define RhoQ1_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:42</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_aae057dae5f599b944184a0ecf7801064"><div class="ttname"><a href="ERF__IndexDefines_8H.html#aae057dae5f599b944184a0ecf7801064">RhoQ6_comp</a></div><div class="ttdeci">#define RhoQ6_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:47</div></div>
<div class="ttc" id="aERF__IndexDefines_8H_html_ac46d015fd5b1ee0060bbaf22e79113e7"><div class="ttname"><a href="ERF__IndexDefines_8H.html#ac46d015fd5b1ee0060bbaf22e79113e7">RhoQ5_comp</a></div><div class="ttdeci">#define RhoQ5_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:46</div></div>
<div class="ttc" id="anamespaceVars_html_a3e5e550795a0b745a4e43177e81f8c57a47abe072e12c61d29cde15a509a0664b"><div class="ttname"><a href="namespaceVars.html#a3e5e550795a0b745a4e43177e81f8c57a47abe072e12c61d29cde15a509a0664b">Vars::cons</a></div><div class="ttdeci">@ cons</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:140</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="classMorrison.html#af3dba4bdf7e085ec4b872fd28317b521">Update_State_Vars()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a816f41f9bbd55757684c2f307940b117_icgraph.png" border="0" usemap="#aclassMorrison_a816f41f9bbd55757684c2f307940b117_icgraph" alt=""/></div>
<map name="aclassMorrison_a816f41f9bbd55757684c2f307940b117_icgraph" id="aclassMorrison_a816f41f9bbd55757684c2f307940b117_icgraph">
<area shape="rect" title=" " alt="" coords="264,5,427,47"/>
<area shape="rect" href="classMorrison.html#af3dba4bdf7e085ec4b872fd28317b521" title=" " alt="" coords="5,13,216,39"/>
</map>
</div>

</div>
</div>
<a id="a5fe61e6c89f21c46207142a8ef2d67b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fe61e6c89f21c46207142a8ef2d67b1">&#9670;&nbsp;</a></span>Copy_State_to_Micro()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Copy_State_to_Micro </td>
          <td>(</td>
          <td class="paramtype">const amrex::MultiFab &amp;&#160;</td>
          <td class="paramname"><em>cons_in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Initializes the <a class="el" href="classMicrophysics.html" title="Base class for microphysics interface.">Microphysics</a> module.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cons_in</td><td>Conserved variables input </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classNullMoist.html#aacb06ee696c6870e899d1bc26aa9933e">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;{</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Get the temperature, density, theta, qt and qp from input</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">for</span> ( MFIter mfi(cons_in); mfi.isValid(); ++mfi) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; box3d = mfi.growntilebox();</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keyword">auto</span> states_array = cons_in.array(mfi);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment">// Non-precipitating</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keyword">auto</span> qv_array    = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a27ed8ba8d37ae85125221394270eceaf">MicVar_Morr::qv</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keyword">auto</span> qc_array    = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a786bbec2d1f95dad377cda134055cda1">MicVar_Morr::qcl</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keyword">auto</span> qi_array    = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0abdf878ba9b9f2644fa4354fbd6775d89">MicVar_Morr::qci</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keyword">auto</span> qn_array    = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab41c6386b3e7d1c383c564f0c8552b98">MicVar_Morr::qn</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keyword">auto</span> qt_array    = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0af5996f1c67f951c3d3202be1ab05b739">MicVar_Morr::qt</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">// Precipitating</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keyword">auto</span> qpr_array   = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab77c2781abdd9ebaa8b4cc3b271b57aa">MicVar_Morr::qpr</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keyword">auto</span> qps_array   = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0aa1b82f9b40da8ffccead09f9e102ff82">MicVar_Morr::qps</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keyword">auto</span> qpg_array   = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a434cf2c831802bb076e8bc31d16f0887">MicVar_Morr::qpg</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keyword">auto</span> qp_array    = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a8e3daf95f86ccf4c96771824b0175a3e">MicVar_Morr::qp</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keyword">auto</span> rho_array   = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab60d6bdceb03bf869685c46558bcbe89">MicVar_Morr::rho</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keyword">auto</span> theta_array = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7f3916bd057e43e125de3cbef18bcad3">MicVar_Morr::theta</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keyword">auto</span> tabs_array  = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">MicVar_Morr::tabs</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keyword">auto</span> pres_array  = <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">MicVar_Morr::pres</a>]-&gt;array(mfi);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">// Get pressure, theta, temperature, density, and qt, qp</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        ParallelFor( box3d, [=] AMREX_GPU_DEVICE (<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            rho_array(i,j,k)   = states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            theta_array(i,j,k) = states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a28f96fd04e1ff08fa7a8f53ccde0f877">RhoTheta_comp</a>)/states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            qv_array(i,j,k)    = std::max(0.0,states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#aa965e9988f14d5d2a5aef4a942168a15">RhoQ1_comp</a>)/states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>));</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            qc_array(i,j,k)    = std::max(0.0,states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a3bf0a4783e82ba30db2b7c0a332c2f16">RhoQ2_comp</a>)/states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>));</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            qi_array(i,j,k)    = std::max(0.0,states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a49fe20d81f4d923a4a6ec4eb1652072b">RhoQ3_comp</a>)/states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>));</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            qn_array(i,j,k)    = qc_array(i,j,k) + qi_array(i,j,k);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            qt_array(i,j,k)    = qv_array(i,j,k) + qn_array(i,j,k);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            qpr_array(i,j,k)   = std::max(0.0,states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a28c5deab9008c0999c26affeff2fa6da">RhoQ4_comp</a>)/states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>));</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            qps_array(i,j,k)   = std::max(0.0,states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#ac46d015fd5b1ee0060bbaf22e79113e7">RhoQ5_comp</a>)/states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>));</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            qpg_array(i,j,k)   = std::max(0.0,states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#aae057dae5f599b944184a0ecf7801064">RhoQ6_comp</a>)/states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>));</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;             qp_array(i,j,k)   = qpr_array(i,j,k) + qps_array(i,j,k) + qpg_array(i,j,k);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            tabs_array(i,j,k)  = <a class="code" href="ERF__EOS_8H.html#a65cf1718b7a1fcc56cb16685642543da">getTgivenRandRTh</a>(states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a>),</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                                  states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a28f96fd04e1ff08fa7a8f53ccde0f877">RhoTheta_comp</a>),</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                                  qv_array(i,j,k));</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="comment">// NOTE: the Morrison Fortran version uses Pa not hPa so we don&#39;t divideby 100!</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            pres_array(i,j,k)  = <a class="code" href="ERF__EOS_8H.html#a08354ab110fb9e873bce9250b4f4b46e">getPgivenRTh</a>(states_array(i,j,k,<a class="code" href="ERF__IndexDefines_8H.html#a28f96fd04e1ff08fa7a8f53ccde0f877">RhoTheta_comp</a>), qv_array(i,j,k)); <span class="comment">//  * 0.01;</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        });</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="ttc" id="aERF__IndexDefines_8H_html_a27dcc910aeb002a0fd44727954dc0e49"><div class="ttname"><a href="ERF__IndexDefines_8H.html#a27dcc910aeb002a0fd44727954dc0e49">Rho_comp</a></div><div class="ttdeci">#define Rho_comp</div><div class="ttdef"><b>Definition:</b> ERF_IndexDefines.H:36</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0a8e3daf95f86ccf4c96771824b0175a3e"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a8e3daf95f86ccf4c96771824b0175a3e">MicVar_Morr::qp</a></div><div class="ttdeci">@ qp</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:38</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0ab41c6386b3e7d1c383c564f0c8552b98"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab41c6386b3e7d1c383c564f0c8552b98">MicVar_Morr::qn</a></div><div class="ttdeci">@ qn</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:33</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0af5996f1c67f951c3d3202be1ab05b739"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0af5996f1c67f951c3d3202be1ab05b739">MicVar_Morr::qt</a></div><div class="ttdeci">@ qt</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:32</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="classMorrison.html#a3b223b2f67d6de76f1edd249b4a16d63">Update_Micro_Vars()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_cgraph.png" border="0" usemap="#aclassMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_cgraph" alt=""/></div>
<map name="aclassMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_cgraph" id="aclassMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_cgraph">
<area shape="rect" title=" " alt="" coords="5,23,167,65"/>
<area shape="rect" href="ERF__EOS_8H.html#a08354ab110fb9e873bce9250b4f4b46e" title=" " alt="" coords="231,5,342,32"/>
<area shape="rect" href="ERF__EOS_8H.html#a65cf1718b7a1fcc56cb16685642543da" title=" " alt="" coords="215,56,359,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_icgraph.png" border="0" usemap="#aclassMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_icgraph" alt=""/></div>
<map name="aclassMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_icgraph" id="aclassMorrison_a5fe61e6c89f21c46207142a8ef2d67b1_icgraph">
<area shape="rect" title=" " alt="" coords="265,5,427,47"/>
<area shape="rect" href="classMorrison.html#a3b223b2f67d6de76f1edd249b4a16d63" title=" " alt="" coords="5,13,217,39"/>
</map>
</div>

</div>
</div>
<a id="a883ebd47f7f1232c523a87076ccb1ad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a883ebd47f7f1232c523a87076ccb1ad5">&#9670;&nbsp;</a></span>Define()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Define </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSolverChoice.html">SolverChoice</a> &amp;&#160;</td>
          <td class="paramname"><em>sc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#aab112947c592c330b45a2d7e5529ec07">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <a class="code" href="classMorrison.html#a903d92435272b6b12ab6e7bcaf6fa23c">m_fac_cond</a> = <a class="code" href="ERF__Constants_8H.html#a7b45c0074d559f423ac2d48e1b171518">lcond</a> / sc.<a class="code" href="structSolverChoice.html#a43d16f0628ba5fbe64a813de7f25f56a">c_p</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="classMorrison.html#af97b098dae958c8fc69ec92b6779acf3">m_fac_fus</a>  = <a class="code" href="ERF__Constants_8H.html#a0f65ea12b4405c50f1d777f7ca82dcfd">lfus</a> / sc.<a class="code" href="structSolverChoice.html#a43d16f0628ba5fbe64a813de7f25f56a">c_p</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <a class="code" href="classMorrison.html#a94005ac35edcdb59eb0b2f2d18e53425">m_fac_sub</a>  = <a class="code" href="ERF__Constants_8H.html#a3ab435b88eae71bef826cb01254ff33d">lsub</a> / sc.<a class="code" href="structSolverChoice.html#a43d16f0628ba5fbe64a813de7f25f56a">c_p</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="classMorrison.html#a4930ab51ce1a492bdddb2aa1cb001b21">m_gOcp</a>     = <a class="code" href="ERF__Constants_8H.html#ac2d0c304ab1117368778efcda612de43">CONST_GRAV</a> / sc.<a class="code" href="structSolverChoice.html#a43d16f0628ba5fbe64a813de7f25f56a">c_p</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <a class="code" href="classMorrison.html#a9b6b084ace42c7992815942eed92212f">m_axis</a>     = sc.<a class="code" href="structSolverChoice.html#afdd906d035384fd962efab24e7a6da7c">ave_plane</a>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <a class="code" href="classMorrison.html#ad8a4391c39d380a1e77105cfbe3d88ac">m_rdOcp</a>    = sc.<a class="code" href="structSolverChoice.html#a2e1ef762ee1dc1bd3d4cbd08125c758a">rdOcp</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div>
<div class="ttc" id="aERF__Constants_8H_html_a0f65ea12b4405c50f1d777f7ca82dcfd"><div class="ttname"><a href="ERF__Constants_8H.html#a0f65ea12b4405c50f1d777f7ca82dcfd">lfus</a></div><div class="ttdeci">constexpr amrex::Real lfus</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:67</div></div>
<div class="ttc" id="aERF__Constants_8H_html_ac2d0c304ab1117368778efcda612de43"><div class="ttname"><a href="ERF__Constants_8H.html#ac2d0c304ab1117368778efcda612de43">CONST_GRAV</a></div><div class="ttdeci">constexpr amrex::Real CONST_GRAV</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:21</div></div>
<div class="ttc" id="aclassMorrison_html_a903d92435272b6b12ab6e7bcaf6fa23c"><div class="ttname"><a href="classMorrison.html#a903d92435272b6b12ab6e7bcaf6fa23c">Morrison::m_fac_cond</a></div><div class="ttdeci">amrex::Real m_fac_cond</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:290</div></div>
<div class="ttc" id="aclassMorrison_html_a94005ac35edcdb59eb0b2f2d18e53425"><div class="ttname"><a href="classMorrison.html#a94005ac35edcdb59eb0b2f2d18e53425">Morrison::m_fac_sub</a></div><div class="ttdeci">amrex::Real m_fac_sub</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:292</div></div>
<div class="ttc" id="aclassMorrison_html_af97b098dae958c8fc69ec92b6779acf3"><div class="ttname"><a href="classMorrison.html#af97b098dae958c8fc69ec92b6779acf3">Morrison::m_fac_fus</a></div><div class="ttdeci">amrex::Real m_fac_fus</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:291</div></div>
<div class="ttc" id="astructSolverChoice_html_a2e1ef762ee1dc1bd3d4cbd08125c758a"><div class="ttname"><a href="structSolverChoice.html#a2e1ef762ee1dc1bd3d4cbd08125c758a">SolverChoice::rdOcp</a></div><div class="ttdeci">amrex::Real rdOcp</div><div class="ttdef"><b>Definition:</b> ERF_DataStruct.H:704</div></div>
<div class="ttc" id="astructSolverChoice_html_a43d16f0628ba5fbe64a813de7f25f56a"><div class="ttname"><a href="structSolverChoice.html#a43d16f0628ba5fbe64a813de7f25f56a">SolverChoice::c_p</a></div><div class="ttdeci">amrex::Real c_p</div><div class="ttdef"><b>Definition:</b> ERF_DataStruct.H:703</div></div>
<div class="ttc" id="astructSolverChoice_html_afdd906d035384fd962efab24e7a6da7c"><div class="ttname"><a href="structSolverChoice.html#afdd906d035384fd962efab24e7a6da7c">SolverChoice::ave_plane</a></div><div class="ttdeci">int ave_plane</div><div class="ttdef"><b>Definition:</b> ERF_DataStruct.H:768</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9f2177b8af1d7f3f0597a7248343569e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f2177b8af1d7f3f0597a7248343569e">&#9670;&nbsp;</a></span>Init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Init </td>
          <td>(</td>
          <td class="paramtype">const amrex::MultiFab &amp;&#160;</td>
          <td class="paramname"><em>cons_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::BoxArray &amp;&#160;</td>
          <td class="paramname"><em>grids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Geometry &amp;&#160;</td>
          <td class="paramname"><em>geom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Real &amp;&#160;</td>
          <td class="paramname"><em>dt_advance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; amrex::MultiFab &gt; &amp;&#160;</td>
          <td class="paramname"><em>z_phys_nd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; amrex::MultiFab &gt; &amp;&#160;</td>
          <td class="paramname"><em>detJ_cc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Initializes the <a class="el" href="classMicrophysics.html" title="Base class for microphysics interface.">Microphysics</a> module.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cons_in</td><td>Conserved variables input </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">qc_in</td><td>Cloud variables input </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">qv_in</td><td>Vapor variables input </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">qi_in</td><td>Ice variables input </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grids</td><td>The boxes on which we will evolve the solution </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">geom</td><td>Geometry associated with these MultiFabs and grids </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt_advance</td><td>Timestep for the advance </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classNullMoist.html#a6f526044328db858069e4b6a70fdbdf7">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    [[maybe_unused]] amrex::Real dt     = dt_advance;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <a class="code" href="classMorrison.html#a104c04cee2e446fcfa520dfb79c6563d">m_geom</a> = geom;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="classMorrison.html#acb7bda8ea77a4cd5a81e504f5131440e">m_gtoe</a> = grids;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="classMorrison.html#a71131fbedee0de3f7bc4abfd339921e9">m_z_phys_nd</a> = z_phys_nd.get();</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="classMorrison.html#a88d75ccdce5c7a7de7033c7ceb2fed41">m_detJ_cc</a>   = detJ_cc.get();</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="classMorrison.html#a6284af8ee4608059214c45bc39425011">MicVarMap</a>.resize(<a class="code" href="classMorrison.html#aae728919a37c1eebbf4956d78da9f3cd">m_qmoist_size</a>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="classMorrison.html#a6284af8ee4608059214c45bc39425011">MicVarMap</a> = {<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a32b6a00f33c7394555eff62ce6457bc6">MicVar_Morr::nc</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a6764e4c83976308b665ab846e77b53b0">MicVar_Morr::nr</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a9021df498ba0043b1ac9ecf05f45c584">MicVar_Morr::ni</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a92a76bfaaf4385e0d2051d0124f254ea">MicVar_Morr::ns</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a281c2ff050bdb2a9349d3408926af821">MicVar_Morr::ng</a>,</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                 <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ad5e247bb2905b3b4a81c6487da6e0e45">MicVar_Morr::rain_accum</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0af0a4b2d254cb85c987d8c9a64a592e50">MicVar_Morr::snow_accum</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0ab593766917aa9a7d6accf04b88139545">MicVar_Morr::graup_accum</a>};</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// initialize microphysics variables</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> ivar = 0; ivar &lt; <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0acf4ab6355daf2584b0bb61fd45c79511">MicVar_Morr::NumVars</a>; ++ivar) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[ivar] = std::make_shared&lt;MultiFab&gt;(cons_in.boxArray(), cons_in.DistributionMap(),</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                                        1, cons_in.nGrowVect());</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[ivar]-&gt;setVal(0.);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// Set class data members</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">for</span> ( MFIter mfi(cons_in, <a class="code" href="ERF__TileNoZ_8H.html#a8da113f1d5603f7297fe1d03e5013f00">TileNoZ</a>()); mfi.isValid(); ++mfi) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; box3d = mfi.tilebox();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; lo = lbound(box3d);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hi = ubound(box3d);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <a class="code" href="classMorrison.html#a7bc485a108780b844d2ecdc70f7a618b">nlev</a> = box3d.length(2);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>  = lo.z;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>  = hi.z;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">// parameters</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="classMorrison.html#aa5df21d7c7adfd10586783871524fac4">accrrc</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="classMorrison.html#a9e5363db069243651289087f05115fcd">accrsi</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <a class="code" href="classMorrison.html#af3f26a0a44abe58527b22336648d8e56">accrsc</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <a class="code" href="classMorrison.html#a96fb0e34b50bf691859ca0434b594b2e">coefice</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>}, {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="classMorrison.html#ac9054cb36d2b174d1033972de065b37b">evaps1</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <a class="code" href="classMorrison.html#ad0b73c861dc791272e1ac6d781d72562">evaps2</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <a class="code" href="classMorrison.html#a540699586b918c354be6e8347fbbd83c">accrgi</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <a class="code" href="classMorrison.html#a5e4e4de3f0961b43f5972bc78c964d38">accrgc</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="classMorrison.html#aae5e0add59ee0f17b03518b5888d0a61">evapg1</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="classMorrison.html#a186c1ded94acbad74e980303e9867a61">evapg2</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="classMorrison.html#abdd637dd50f94ad624ad86ec6bed76d8">evapr1</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="classMorrison.html#aeeb1fc95ab35c46faf404d62d505108e">evapr2</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>},  {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="comment">// data (input)</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <a class="code" href="classMorrison.html#ae08598f7fe3990c39c84b9222d3a8cdb">rho1d</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>}, {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="classMorrison.html#a46d87d763b7db8aa5e9c9e1d8ed40ac2">pres1d</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>}, {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <a class="code" href="classMorrison.html#a625091bf149aa3bd952e50b9b438681d">tabs1d</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>}, {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="classMorrison.html#a8be05adcddf26645e0afe16f7fd7959b">gamaz</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>}, {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <a class="code" href="classMorrison.html#a47672a46dbf0d5919e8a4575a9bf2b21">zmid</a>.resize({<a class="code" href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">zlo</a>}, {<a class="code" href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">zhi</a>});</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#ifdef ERF_USE_MORR_FORT</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">int</span> morr_rimed_ice = 0; <span class="comment">// This is used to set something called &quot;ihail&quot;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    amrex::ParmParse <a class="code" href="ERF__MicrophysicsUtils_8H.html#ac54f1d17d8842acb42b2312cd353e469">pp</a>(<span class="stringliteral">&quot;erf&quot;</span>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    MoistureType moisture_type;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="ERF__MicrophysicsUtils_8H.html#ac54f1d17d8842acb42b2312cd353e469">pp</a>.query_enum_case_insensitive(<span class="stringliteral">&quot;moisture_model&quot;</span>,moisture_type);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">int</span> morr_noice = (moisture_type == MoistureType::Morrison_NoIce);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    Print()&lt;&lt;<span class="stringliteral">&quot;Setting No Ice flag in fortran to &quot;</span>&lt;&lt;morr_noice&lt;&lt;std::endl;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="ERF__Morrison__Fortran__Interface_8H.html#aff6bd4d2d4ab8af93b3b93f250364681">morr_two_moment_init_c</a>(morr_rimed_ice, morr_noice);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div>
<div class="ttc" id="aERF__Morrison__Fortran__Interface_8H_html_aff6bd4d2d4ab8af93b3b93f250364681"><div class="ttname"><a href="ERF__Morrison__Fortran__Interface_8H.html#aff6bd4d2d4ab8af93b3b93f250364681">morr_two_moment_init_c</a></div><div class="ttdeci">void morr_two_moment_init_c(int morr_rimed_ice, int morr_noice)</div></div>
<div class="ttc" id="aclassMorrison_html_a6284af8ee4608059214c45bc39425011"><div class="ttname"><a href="classMorrison.html#a6284af8ee4608059214c45bc39425011">Morrison::MicVarMap</a></div><div class="ttdeci">amrex::Vector&lt; int &gt; MicVarMap</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:275</div></div>
<div class="ttc" id="aclassMorrison_html_a71131fbedee0de3f7bc4abfd339921e9"><div class="ttname"><a href="classMorrison.html#a71131fbedee0de3f7bc4abfd339921e9">Morrison::m_z_phys_nd</a></div><div class="ttdeci">amrex::MultiFab * m_z_phys_nd</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:297</div></div>
<div class="ttc" id="aclassMorrison_html_a88d75ccdce5c7a7de7033c7ceb2fed41"><div class="ttname"><a href="classMorrison.html#a88d75ccdce5c7a7de7033c7ceb2fed41">Morrison::m_detJ_cc</a></div><div class="ttdeci">amrex::MultiFab * m_detJ_cc</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:298</div></div>
<div class="ttc" id="aclassMorrison_html_aae728919a37c1eebbf4956d78da9f3cd"><div class="ttname"><a href="classMorrison.html#aae728919a37c1eebbf4956d78da9f3cd">Morrison::m_qmoist_size</a></div><div class="ttdeci">int m_qmoist_size</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:266</div></div>
<div class="ttc" id="aclassMorrison_html_ac84562ae1d4a60e286c7566cb1203194"><div class="ttname"><a href="classMorrison.html#ac84562ae1d4a60e286c7566cb1203194">Morrison::zlo</a></div><div class="ttdeci">int zlo</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:284</div></div>
<div class="ttc" id="aclassMorrison_html_acb7bda8ea77a4cd5a81e504f5131440e"><div class="ttname"><a href="classMorrison.html#acb7bda8ea77a4cd5a81e504f5131440e">Morrison::m_gtoe</a></div><div class="ttdeci">amrex::BoxArray m_gtoe</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:281</div></div>
<div class="ttc" id="aclassMorrison_html_aed36f1497440d681a1a10977a0b5f5ae"><div class="ttname"><a href="classMorrison.html#aed36f1497440d681a1a10977a0b5f5ae">Morrison::zhi</a></div><div class="ttdeci">int zhi</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:284</div></div>
<div class="ttc" id="anamespaceMicVar__Morr_html_a3bbcd161d5650f41b41f14a1977ee2a0acf4ab6355daf2584b0bb61fd45c79511"><div class="ttname"><a href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0acf4ab6355daf2584b0bb61fd45c79511">MicVar_Morr::NumVars</a></div><div class="ttdeci">@ NumVars</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:54</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a9f2177b8af1d7f3f0597a7248343569e_cgraph.png" border="0" usemap="#aclassMorrison_a9f2177b8af1d7f3f0597a7248343569e_cgraph" alt=""/></div>
<map name="aclassMorrison_a9f2177b8af1d7f3f0597a7248343569e_cgraph" id="aclassMorrison_a9f2177b8af1d7f3f0597a7248343569e_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,113,83"/>
<area shape="rect" href="ERF__Morrison__Fortran__Interface_8H.html#aff6bd4d2d4ab8af93b3b93f250364681" title=" " alt="" coords="161,5,349,32"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#ac54f1d17d8842acb42b2312cd353e469" title=" " alt="" coords="236,56,275,83"/>
<area shape="rect" href="ERF__TileNoZ_8H.html#a8da113f1d5603f7297fe1d03e5013f00" title=" " alt="" coords="219,107,292,133"/>
</map>
</div>

</div>
</div>
<a id="a9899e6e638c26d33096fd5f40a2f7704"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9899e6e638c26d33096fd5f40a2f7704">&#9670;&nbsp;</a></span>NewtonIterSat()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">AMREX_GPU_HOST_DEVICE static AMREX_FORCE_INLINE amrex::Real Morrison::NewtonIterSat </td>
          <td>(</td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Real &amp;&#160;</td>
          <td class="paramname"><em>fac_cond</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Real &amp;&#160;</td>
          <td class="paramname"><em>fac_fus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Real &amp;&#160;</td>
          <td class="paramname"><em>fac_sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Real &amp;&#160;</td>
          <td class="paramname"><em>an</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Real &amp;&#160;</td>
          <td class="paramname"><em>bn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Array4&lt; amrex::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>tabs_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Array4&lt; amrex::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>pres_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Array4&lt; amrex::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>qv_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Array4&lt; amrex::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>qc_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Array4&lt; amrex::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>qi_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Array4&lt; amrex::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>qn_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const amrex::Array4&lt; amrex::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>qt_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment">// Solution tolerance</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        amrex::Real tol = 1.0e-4;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// Saturation moisture fractions</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        amrex::Real omn, domn;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        amrex::Real qsat, dqsat;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        amrex::Real qsatw, dqsatw;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        amrex::Real qsati, dqsati;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">// Newton iteration vars</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordtype">int</span>  niter;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        amrex::Real fff, dfff, dtabs;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        amrex::Real lstar, dlstar;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        amrex::Real lstarw, lstari;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        amrex::Real delta_qv, delta_qc, delta_qi;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="comment">// Initial guess for temperature &amp; pressure</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        amrex::Real <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a> = tabs_array(i,j,k);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        amrex::Real <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">pres</a> = pres_array(i,j,k);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        niter = 0;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        dtabs = 1;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="comment">//==================================================</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">// Newton iteration to qv=qsat (cloud phase only)</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">//==================================================</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="comment">// Latent heats and their derivatives wrt to T</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            lstarw  = fac_cond;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            lstari  = fac_fus;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            domn    = 0.0;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="comment">// Saturation moisture fractions</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <a class="code" href="ERF__MicrophysicsUtils_8H.html#a8e4b0c6ed8b95c2040dc0c9e8fcb8615">erf_qsatw</a>(<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">pres</a>, qsatw);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <a class="code" href="ERF__MicrophysicsUtils_8H.html#ac39ef2a869ef543f708d5ed7da4754d3">erf_qsati</a>(<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">pres</a>, qsati);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <a class="code" href="ERF__MicrophysicsUtils_8H.html#a41126403c4da6ee876e9e391f3f67699">erf_dtqsatw</a>(<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">pres</a>, dqsatw);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <a class="code" href="ERF__MicrophysicsUtils_8H.html#a7baba5d74922033bf93526933a0d77ec">erf_dtqsati</a>(<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a>, <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a531c978e174d063e1cf107eae6a84073">pres</a>, dqsati);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="comment">// Cloud ice not permitted (condensation &amp; fusion)</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a> &gt;= <a class="code" href="ERF__Constants_8H.html#a2b4ea8a29735038e49703c7f8c1f20c8">tbgmax</a>) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                omn   = 1.0;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="comment">// Cloud water not permitted (sublimation &amp; fusion)</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a> &lt;= <a class="code" href="ERF__Constants_8H.html#abf1e890912f1117211516f13b27ed2e8">tbgmin</a>) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                omn    = 0.0;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                lstarw = fac_sub;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="comment">// Mixed cloud phase (condensation &amp; fusion)</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                omn   = an*<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a>-bn;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                domn  = an;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="comment">// Linear combination of each component</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            qsat   =  omn * qsatw  + (1.0-omn) * qsati;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            dqsat  =  omn * dqsatw + (1.0-omn) * dqsati</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                   + domn *  qsatw -     domn  *  qsati;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            lstar  =  omn * lstarw + (1.0-omn) * lstari;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            dlstar = domn * lstarw -     domn  * lstari;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="comment">// Function for root finding:</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="comment">// 0 = -T_new + T_old + L_eff/C_p * (qv - qsat)</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            fff   = -<a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a> + tabs_array(i,j,k) +  lstar*(qv_array(i,j,k) - qsat);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="comment">// Derivative of function (T_new iterated on)</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            dfff  = -1.0 + dlstar*(qv_array(i,j,k) - qsat) - lstar*dqsat;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="comment">// Update the temperature</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            dtabs = -fff/dfff;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a> += dtabs;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="comment">// Update iteration</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            niter = niter+1;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        } <span class="keywordflow">while</span>(std::abs(dtabs) &gt; tol &amp;&amp; niter &lt; 20);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// Update qsat from last iteration (dq = dq/dt * dt)</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        qsat += dqsat*dtabs;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment">// Changes in each component</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        delta_qv = qv_array(i,j,k) - qsat;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        delta_qc = std::max(-qc_array(i,j,k), delta_qv * omn);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        delta_qi = std::max(-qi_array(i,j,k), delta_qv * (1.0-omn));</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="comment">// Partition the change in non-precipitating q</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        qv_array(i,j,k)  = qsat;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        qc_array(i,j,k) += delta_qc;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        qi_array(i,j,k) += delta_qi;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        qn_array(i,j,k)  = qc_array(i,j,k) + qi_array(i,j,k);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        qt_array(i,j,k)  = qv_array(i,j,k) + qn_array(i,j,k);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment">// Return to temperature</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0a7da82a8f5893f7ed1f0f3002015f15fb">tabs</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="ttc" id="aERF__Constants_8H_html_a2b4ea8a29735038e49703c7f8c1f20c8"><div class="ttname"><a href="ERF__Constants_8H.html#a2b4ea8a29735038e49703c7f8c1f20c8">tbgmax</a></div><div class="ttdeci">constexpr amrex::Real tbgmax</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:32</div></div>
<div class="ttc" id="aERF__Constants_8H_html_abf1e890912f1117211516f13b27ed2e8"><div class="ttname"><a href="ERF__Constants_8H.html#abf1e890912f1117211516f13b27ed2e8">tbgmin</a></div><div class="ttdeci">constexpr amrex::Real tbgmin</div><div class="ttdef"><b>Definition:</b> ERF_Constants.H:31</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_a41126403c4da6ee876e9e391f3f67699"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#a41126403c4da6ee876e9e391f3f67699">erf_dtqsatw</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE void erf_dtqsatw(amrex::Real t, amrex::Real p, amrex::Real &amp;dtqsatw)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:170</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_a7baba5d74922033bf93526933a0d77ec"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#a7baba5d74922033bf93526933a0d77ec">erf_dtqsati</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE void erf_dtqsati(amrex::Real t, amrex::Real p, amrex::Real &amp;dtqsati)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:165</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_a8e4b0c6ed8b95c2040dc0c9e8fcb8615"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#a8e4b0c6ed8b95c2040dc0c9e8fcb8615">erf_qsatw</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE void erf_qsatw(amrex::Real t, amrex::Real p, amrex::Real &amp;qsatw)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:158</div></div>
<div class="ttc" id="aERF__MicrophysicsUtils_8H_html_ac39ef2a869ef543f708d5ed7da4754d3"><div class="ttname"><a href="ERF__MicrophysicsUtils_8H.html#ac39ef2a869ef543f708d5ed7da4754d3">erf_qsati</a></div><div class="ttdeci">AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE void erf_qsati(amrex::Real t, amrex::Real p, amrex::Real &amp;qsati)</div><div class="ttdef"><b>Definition:</b> ERF_MicrophysicsUtils.H:151</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a9899e6e638c26d33096fd5f40a2f7704_cgraph.png" border="0" usemap="#aclassMorrison_a9899e6e638c26d33096fd5f40a2f7704_cgraph" alt=""/></div>
<map name="aclassMorrison_a9899e6e638c26d33096fd5f40a2f7704_cgraph" id="aclassMorrison_a9899e6e638c26d33096fd5f40a2f7704_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,185,108"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a7baba5d74922033bf93526933a0d77ec" title=" " alt="" coords="237,5,329,32"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a41126403c4da6ee876e9e391f3f67699" title=" " alt="" coords="233,56,332,83"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#ac39ef2a869ef543f708d5ed7da4754d3" title=" " alt="" coords="243,107,322,133"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a8e4b0c6ed8b95c2040dc0c9e8fcb8615" title=" " alt="" coords="239,157,326,184"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a45320981110c862bac93f657781eb79f" title=" " alt="" coords="383,5,475,32"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a2e94fb836d3c733ebac8263bfa479ca8" title=" " alt="" coords="380,56,479,83"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a66e2273b5b2661fa12fea623630afaf8" title=" " alt="" coords="527,56,647,83"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a4ea516e89f4e87b4ffc305504e8f0bf1" title=" " alt="" coords="390,107,469,133"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a16a390366e7e68ca35fdac4cad824428" title=" " alt="" coords="386,157,473,184"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#afac5e7caca80647972b208a0248b2ed8" title=" " alt="" coords="533,157,640,184"/>
</map>
</div>

</div>
</div>
<a id="a6b77aa8b347b286ffeae1aabc2e4b69a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b77aa8b347b286ffeae1aabc2e4b69a">&#9670;&nbsp;</a></span>Qmoist_Ptr()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::MultiFab* Morrison::Qmoist_Ptr </td>
          <td>(</td>
          <td class="paramtype">const int &amp;&#160;</td>
          <td class="paramname"><em>varIdx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#a1b6a72d67d9b2642e99a5b768315476c">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        AMREX_ALWAYS_ASSERT(varIdx &lt; <a class="code" href="classMorrison.html#aae728919a37c1eebbf4956d78da9f3cd">m_qmoist_size</a>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classMorrison.html#ade405c635b58955a140d38af3b06e6aa">mic_fab_vars</a>[<a class="code" href="classMorrison.html#a6284af8ee4608059214c45bc39425011">MicVarMap</a>[varIdx]].get();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2269eb1d7ce46e6eba5ffe3ad1489c57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2269eb1d7ce46e6eba5ffe3ad1489c57">&#9670;&nbsp;</a></span>Qmoist_Restart_Vars()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Qmoist_Restart_Vars </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structSolverChoice.html">SolverChoice</a> &amp;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>a_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>a_names</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#a77d6c9875f6a3a7242b090e6fece5c0f">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        a_idx.clear();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        a_names.clear();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment">// The ordering here needs to match that in</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">// MicVarMap = {MicVar_Morr::nc, MicVar_Morr::nr, MicVar_Morr::ni, MicVar_Morr::ns, MicVar_Morr::ng,</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="comment">//              MicVar_Morr::rain_accum, MicVar_Morr::snow_accum, MicVar_Morr::graup_accum};</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        a_idx.push_back(0); a_names.push_back(<span class="stringliteral">&quot;Nc&quot;</span>);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        a_idx.push_back(1); a_names.push_back(<span class="stringliteral">&quot;Nr&quot;</span>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        a_idx.push_back(2); a_names.push_back(<span class="stringliteral">&quot;Ni&quot;</span>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        a_idx.push_back(3); a_names.push_back(<span class="stringliteral">&quot;Ns&quot;</span>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        a_idx.push_back(4); a_names.push_back(<span class="stringliteral">&quot;Ng&quot;</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        a_idx.push_back(5); a_names.push_back(<span class="stringliteral">&quot;RainAccum&quot;</span>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        a_idx.push_back(6); a_names.push_back(<span class="stringliteral">&quot;SnowAccum&quot;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        a_idx.push_back(7); a_names.push_back(<span class="stringliteral">&quot;GraupAccum&quot;</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9fc43dc29aa5c3106aa69d1350c793c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fc43dc29aa5c3106aa69d1350c793c1">&#9670;&nbsp;</a></span>Qmoist_Size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::Qmoist_Size </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#abdf706f193bbb09c62e41734570f3cd1">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classMorrison.html#aae728919a37c1eebbf4956d78da9f3cd">Morrison::m_qmoist_size</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a44bce0ee7f1e62e84fa21f326346ad0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44bce0ee7f1e62e84fa21f326346ad0b">&#9670;&nbsp;</a></span>Qstate_Size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::Qstate_Size </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#afaa201a3a1dc21c18888d9c6a068f956">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classMorrison.html#a5f9d7082f6b82a86ab3ffe666857d8cf">Morrison::m_qstate_size</a>; }</div>
<div class="ttc" id="aclassMorrison_html_a5f9d7082f6b82a86ab3ffe666857d8cf"><div class="ttname"><a href="classMorrison.html#a5f9d7082f6b82a86ab3ffe666857d8cf">Morrison::m_qstate_size</a></div><div class="ttdeci">int m_qstate_size</div><div class="ttdef"><b>Definition:</b> ERF_Morrison.H:269</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3b223b2f67d6de76f1edd249b4a16d63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b223b2f67d6de76f1edd249b4a16d63">&#9670;&nbsp;</a></span>Update_Micro_Vars()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Update_Micro_Vars </td>
          <td>(</td>
          <td class="paramtype">amrex::MultiFab &amp;&#160;</td>
          <td class="paramname"><em>cons_in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#aece7a50f16bf40e3e9d536cc030458f7">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        this-&gt;<a class="code" href="classMorrison.html#a5fe61e6c89f21c46207142a8ef2d67b1">Copy_State_to_Micro</a>(cons_in);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        this-&gt;<a class="code" href="classMorrison.html#a7d3bd1b9f29e84bc115d7a9f42595f76">Compute_Coefficients</a>();</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div>
<div class="ttc" id="aclassMorrison_html_a5fe61e6c89f21c46207142a8ef2d67b1"><div class="ttname"><a href="classMorrison.html#a5fe61e6c89f21c46207142a8ef2d67b1">Morrison::Copy_State_to_Micro</a></div><div class="ttdeci">void Copy_State_to_Micro(const amrex::MultiFab &amp;cons_in) override</div><div class="ttdef"><b>Definition:</b> ERF_InitMorrison.cpp:98</div></div>
<div class="ttc" id="aclassMorrison_html_a7d3bd1b9f29e84bc115d7a9f42595f76"><div class="ttname"><a href="classMorrison.html#a7d3bd1b9f29e84bc115d7a9f42595f76">Morrison::Compute_Coefficients</a></div><div class="ttdeci">void Compute_Coefficients()</div><div class="ttdef"><b>Definition:</b> ERF_InitMorrison.cpp:152</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_a3b223b2f67d6de76f1edd249b4a16d63_cgraph.png" border="0" usemap="#aclassMorrison_a3b223b2f67d6de76f1edd249b4a16d63_cgraph" alt=""/></div>
<map name="aclassMorrison_a3b223b2f67d6de76f1edd249b4a16d63_cgraph" id="aclassMorrison_a3b223b2f67d6de76f1edd249b4a16d63_cgraph">
<area shape="rect" title=" " alt="" coords="5,333,217,360"/>
<area shape="rect" href="classMorrison.html#a7d3bd1b9f29e84bc115d7a9f42595f76" title=" " alt="" coords="265,245,496,272"/>
<area shape="rect" href="classMorrison.html#a5fe61e6c89f21c46207142a8ef2d67b1" title=" " alt="" coords="300,385,461,426"/>
<area shape="rect" href="classPlaneAverage.html#a603aee4caf3a370d06bee77fddb0e33e" title=" " alt="" coords="547,326,723,367"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a4ea516e89f4e87b4ffc305504e8f0bf1" title=" " alt="" coords="595,5,674,32"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#a16a390366e7e68ca35fdac4cad824428" title=" " alt="" coords="591,56,678,83"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#abd125e107924437493cbcbac9a97c017" title=" " alt="" coords="579,107,690,133"/>
<area shape="rect" href="classPlaneAverage.html#a027673d7c6dd35a1b45cd1fa8f2b4cb5" title=" " alt="" coords="561,157,708,184"/>
<area shape="rect" href="ERF__EOS_8H.html#a08354ab110fb9e873bce9250b4f4b46e" title=" " alt="" coords="579,443,690,469"/>
<area shape="rect" href="ERF__EOS_8H.html#a65cf1718b7a1fcc56cb16685642543da" title=" " alt="" coords="563,392,707,419"/>
<area shape="rect" href="classPlaneAverage.html#af12478c0cb46a8afc438846f8f24e949" title=" " alt="" coords="563,209,706,250"/>
<area shape="rect" href="classPlaneAverage.html#ab65036a99da90fb854f7dfd33cd700b1" title=" " alt="" coords="544,275,725,301"/>
<area shape="rect" href="ERF__MicrophysicsUtils_8H.html#afac5e7caca80647972b208a0248b2ed8" title=" " alt="" coords="773,56,880,83"/>
</map>
</div>

</div>
</div>
<a id="af3dba4bdf7e085ec4b872fd28317b521"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3dba4bdf7e085ec4b872fd28317b521">&#9670;&nbsp;</a></span>Update_State_Vars()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Morrison::Update_State_Vars </td>
          <td>(</td>
          <td class="paramtype">amrex::MultiFab &amp;&#160;</td>
          <td class="paramname"><em>cons_in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="classNullMoist.html#a24f0528f7d31b89f36a3c225c7e53010">NullMoist</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        this-&gt;<a class="code" href="classMorrison.html#a816f41f9bbd55757684c2f307940b117">Copy_Micro_to_State</a>(cons_in);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    }</div>
<div class="ttc" id="aclassMorrison_html_a816f41f9bbd55757684c2f307940b117"><div class="ttname"><a href="classMorrison.html#a816f41f9bbd55757684c2f307940b117">Morrison::Copy_Micro_to_State</a></div><div class="ttdeci">void Copy_Micro_to_State(amrex::MultiFab &amp;cons_in) override</div><div class="ttdef"><b>Definition:</b> ERF_UpdateMorrison.cpp:17</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMorrison_af3dba4bdf7e085ec4b872fd28317b521_cgraph.png" border="0" usemap="#aclassMorrison_af3dba4bdf7e085ec4b872fd28317b521_cgraph" alt=""/></div>
<map name="aclassMorrison_af3dba4bdf7e085ec4b872fd28317b521_cgraph" id="aclassMorrison_af3dba4bdf7e085ec4b872fd28317b521_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,216,39"/>
<area shape="rect" href="classMorrison.html#a816f41f9bbd55757684c2f307940b117" title=" " alt="" coords="264,5,427,47"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a5e4e4de3f0961b43f5972bc78c964d38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e4e4de3f0961b43f5972bc78c964d38">&#9670;&nbsp;</a></span>accrgc</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::accrgc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a540699586b918c354be6e8347fbbd83c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a540699586b918c354be6e8347fbbd83c">&#9670;&nbsp;</a></span>accrgi</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::accrgi</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aa5df21d7c7adfd10586783871524fac4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5df21d7c7adfd10586783871524fac4">&#9670;&nbsp;</a></span>accrrc</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::accrrc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="af3f26a0a44abe58527b22336648d8e56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3f26a0a44abe58527b22336648d8e56">&#9670;&nbsp;</a></span>accrsc</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::accrsc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a9e5363db069243651289087f05115fcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e5363db069243651289087f05115fcd">&#9670;&nbsp;</a></span>accrsi</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::accrsi</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5c8fa0f20176eac476a6a0a3fc95de37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c8fa0f20176eac476a6a0a3fc95de37">&#9670;&nbsp;</a></span>CFL_MAX</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr amrex::Real Morrison::CFL_MAX = 0.5</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">constexpr</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a96fb0e34b50bf691859ca0434b594b2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96fb0e34b50bf691859ca0434b594b2e">&#9670;&nbsp;</a></span>coefice</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::coefice</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aae5e0add59ee0f17b03518b5888d0a61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae5e0add59ee0f17b03518b5888d0a61">&#9670;&nbsp;</a></span>evapg1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::evapg1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a186c1ded94acbad74e980303e9867a61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a186c1ded94acbad74e980303e9867a61">&#9670;&nbsp;</a></span>evapg2</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::evapg2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="abdd637dd50f94ad624ad86ec6bed76d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdd637dd50f94ad624ad86ec6bed76d8">&#9670;&nbsp;</a></span>evapr1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::evapr1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aeeb1fc95ab35c46faf404d62d505108e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeeb1fc95ab35c46faf404d62d505108e">&#9670;&nbsp;</a></span>evapr2</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::evapr2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac9054cb36d2b174d1033972de065b37b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9054cb36d2b174d1033972de065b37b">&#9670;&nbsp;</a></span>evaps1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::evaps1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad0b73c861dc791272e1ac6d781d72562"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0b73c861dc791272e1ac6d781d72562">&#9670;&nbsp;</a></span>evaps2</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::evaps2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8be05adcddf26645e0afe16f7fd7959b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8be05adcddf26645e0afe16f7fd7959b">&#9670;&nbsp;</a></span>gamaz</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::gamaz</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a9b6b084ace42c7992815942eed92212f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b6b084ace42c7992815942eed92212f">&#9670;&nbsp;</a></span>m_axis</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::m_axis</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a883ebd47f7f1232c523a87076ccb1ad5">Define()</a>.</p>

</div>
</div>
<a id="a88d75ccdce5c7a7de7033c7ceb2fed41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88d75ccdce5c7a7de7033c7ceb2fed41">&#9670;&nbsp;</a></span>m_detJ_cc</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::MultiFab* Morrison::m_detJ_cc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a903d92435272b6b12ab6e7bcaf6fa23c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a903d92435272b6b12ab6e7bcaf6fa23c">&#9670;&nbsp;</a></span>m_fac_cond</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Real Morrison::m_fac_cond</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a883ebd47f7f1232c523a87076ccb1ad5">Define()</a>.</p>

</div>
</div>
<a id="af97b098dae958c8fc69ec92b6779acf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af97b098dae958c8fc69ec92b6779acf3">&#9670;&nbsp;</a></span>m_fac_fus</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Real Morrison::m_fac_fus</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a883ebd47f7f1232c523a87076ccb1ad5">Define()</a>.</p>

</div>
</div>
<a id="a94005ac35edcdb59eb0b2f2d18e53425"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94005ac35edcdb59eb0b2f2d18e53425">&#9670;&nbsp;</a></span>m_fac_sub</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Real Morrison::m_fac_sub</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a883ebd47f7f1232c523a87076ccb1ad5">Define()</a>.</p>

</div>
</div>
<a id="a104c04cee2e446fcfa520dfb79c6563d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a104c04cee2e446fcfa520dfb79c6563d">&#9670;&nbsp;</a></span>m_geom</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Geometry Morrison::m_geom</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a4930ab51ce1a492bdddb2aa1cb001b21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4930ab51ce1a492bdddb2aa1cb001b21">&#9670;&nbsp;</a></span>m_gOcp</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Real Morrison::m_gOcp</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a883ebd47f7f1232c523a87076ccb1ad5">Define()</a>.</p>

</div>
</div>
<a id="acb7bda8ea77a4cd5a81e504f5131440e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb7bda8ea77a4cd5a81e504f5131440e">&#9670;&nbsp;</a></span>m_gtoe</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::BoxArray Morrison::m_gtoe</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aae728919a37c1eebbf4956d78da9f3cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae728919a37c1eebbf4956d78da9f3cd">&#9670;&nbsp;</a></span>m_qmoist_size</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::m_qmoist_size = 8</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a6b77aa8b347b286ffeae1aabc2e4b69a">Qmoist_Ptr()</a>, and <a class="el" href="classMorrison.html#a9fc43dc29aa5c3106aa69d1350c793c1">Qmoist_Size()</a>.</p>

</div>
</div>
<a id="a5f9d7082f6b82a86ab3ffe666857d8cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f9d7082f6b82a86ab3ffe666857d8cf">&#9670;&nbsp;</a></span>m_qstate_size</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::m_qstate_size = 6</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a44bce0ee7f1e62e84fa21f326346ad0b">Qstate_Size()</a>.</p>

</div>
</div>
<a id="ad8a4391c39d380a1e77105cfbe3d88ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8a4391c39d380a1e77105cfbe3d88ac">&#9670;&nbsp;</a></span>m_rdOcp</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Real Morrison::m_rdOcp</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a883ebd47f7f1232c523a87076ccb1ad5">Define()</a>.</p>

</div>
</div>
<a id="a71131fbedee0de3f7bc4abfd339921e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71131fbedee0de3f7bc4abfd339921e9">&#9670;&nbsp;</a></span>m_z_phys_nd</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::MultiFab* Morrison::m_z_phys_nd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ade405c635b58955a140d38af3b06e6aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade405c635b58955a140d38af3b06e6aa">&#9670;&nbsp;</a></span>mic_fab_vars</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Array&lt;<a class="el" href="classMorrison.html#aeb27c9fd26acdb5c0ada38bef3763b6d">FabPtr</a>, <a class="el" href="namespaceMicVar__Morr.html#a3bbcd161d5650f41b41f14a1977ee2a0acf4ab6355daf2584b0bb61fd45c79511">MicVar_Morr::NumVars</a>&gt; Morrison::mic_fab_vars</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a6b77aa8b347b286ffeae1aabc2e4b69a">Qmoist_Ptr()</a>.</p>

</div>
</div>
<a id="a6284af8ee4608059214c45bc39425011"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6284af8ee4608059214c45bc39425011">&#9670;&nbsp;</a></span>MicVarMap</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::Vector&lt;int&gt; Morrison::MicVarMap</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="classMorrison.html#a6b77aa8b347b286ffeae1aabc2e4b69a">Qmoist_Ptr()</a>.</p>

</div>
</div>
<a id="a7bc485a108780b844d2ecdc70f7a618b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bc485a108780b844d2ecdc70f7a618b">&#9670;&nbsp;</a></span>nlev</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::nlev</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a46d87d763b7db8aa5e9c9e1d8ed40ac2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46d87d763b7db8aa5e9c9e1d8ed40ac2">&#9670;&nbsp;</a></span>pres1d</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::pres1d</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a28bcd44d952e8e94b71d198dbaf29ffb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28bcd44d952e8e94b71d198dbaf29ffb">&#9670;&nbsp;</a></span>qn1d</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::qn1d</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a7430923cd0f47c37a3251286bc68a5dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7430923cd0f47c37a3251286bc68a5dc">&#9670;&nbsp;</a></span>qt1d</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::qt1d</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8d0b90f78d6e626e91fb286fd4b1bbb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d0b90f78d6e626e91fb286fd4b1bbb8">&#9670;&nbsp;</a></span>qv1d</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::qv1d</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ae08598f7fe3990c39c84b9222d3a8cdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae08598f7fe3990c39c84b9222d3a8cdb">&#9670;&nbsp;</a></span>rho1d</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::rho1d</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a625091bf149aa3bd952e50b9b438681d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a625091bf149aa3bd952e50b9b438681d">&#9670;&nbsp;</a></span>tabs1d</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::tabs1d</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aed36f1497440d681a1a10977a0b5f5ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed36f1497440d681a1a10977a0b5f5ae">&#9670;&nbsp;</a></span>zhi</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::zhi</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac84562ae1d4a60e286c7566cb1203194"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac84562ae1d4a60e286c7566cb1203194">&#9670;&nbsp;</a></span>zlo</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Morrison::zlo</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a47672a46dbf0d5919e8a4575a9bf2b21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47672a46dbf0d5919e8a4575a9bf2b21">&#9670;&nbsp;</a></span>zmid</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">amrex::TableData&lt;amrex::Real, 1&gt; Morrison::zmid</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Source/Microphysics/Morrison/<a class="el" href="ERF__Morrison_8H_source.html">ERF_Morrison.H</a></li>
<li>Source/Microphysics/Morrison/<a class="el" href="ERF__AdvanceMorrison_8cpp.html">ERF_AdvanceMorrison.cpp</a></li>
<li>Source/Microphysics/Morrison/<a class="el" href="ERF__InitMorrison_8cpp.html">ERF_InitMorrison.cpp</a></li>
<li>Source/Microphysics/Morrison/<a class="el" href="ERF__UpdateMorrison_8cpp.html">ERF_UpdateMorrison.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classMorrison.html">Morrison</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
